<!DOCTYPE html>  <head> <meta charset=UTF-8> <title>TAKGPT - ChatGPT </title> <meta name=description content="TAKGPT - A ChatGPT Webpage ."> <meta name=viewport content="width=device-width,initial-scale=0.8,minimum-scale=0.5,maximum-scale=2,user-scalable=yes,viewport-fit=cover"> <link rel="shortcut icon" href=https://openai.com/favicon.ico> <link rel=apple-touch-icon href=https://openai.com/favicon.ico> <script src=https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js></script> <script>window.Vue||document.write(unescape('%3Cscript src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"%3E%3C/script%3E'))</script> <style>#loading-mask{background-color:#ededed;z-index:900999}#loading-mask div{text-align:center;font-size:12px;color:#b4b4b4}::-webkit-scrollbar{width:7px;height:7px}::-webkit-scrollbar-thumb{background-color:#e1e1e1;border-radius:10px}::-webkit-scrollbar-thumb:hover{background-color:#cdcdcd}body::-webkit-scrollbar-thumb{background-color:#e1e1e1;border-radius:10px}body::-webkit-scrollbar-thumb:hover{background-color:#cdcdcd}body::-webkit-scrollbar-track{background-color:#ededed}body::-webkit-scrollbar-track:hover{background-color:#ededed}body::-webkit-scrollbar-corner{background-color:#ededed}.dialog-wrapper .dialog-scroll::-webkit-scrollbar-thumb{background-color:#d2d2d2;border-radius:10px}.dialog-wrapper .dialog-scroll::-webkit-scrollbar-thumb:hover{background-color:#c3c3c3}.dialog-wrapper .dialog-scroll::-webkit-scrollbar-track{background-color:#ededed;border-radius:10px}.dialog-wrapper .dialog-scroll::-webkit-scrollbar-track:hover{background-color:#ededed}.dialog-wrapper .dialog-scroll::-webkit-scrollbar-corner{background-color:#ededed}.notification-wrapper .dialog-scroll::-webkit-scrollbar-thumb{background-color:#e8eb95;border-radius:10px}.notification-wrapper .dialog-scroll::-webkit-scrollbar-thumb:hover{background-color:#dadd8b}.notification-wrapper .dialog-scroll::-webkit-scrollbar-track{background-color:#fdffb4}.notification-wrapper .dialog-scroll::-webkit-scrollbar-track:hover{background-color:#fdffb4}.notification-wrapper .dialog-scroll::-webkit-scrollbar-corner{background-color:#fdffb4}body{margin-bottom:0;margin-top:8px;overflow-y:scroll;background-color:#ededed;font-family:Helvetica Neue,Helvetica,Hiragino Sans GB,"SF Pro SC",Microsoft YaHei,"PingFang SC",Arial,sans-serif}.bottom-position{height:95px}.newcontext-hr{height:1px;background-color:#cfcfcf;border:none;width:92%;margin-top:16px;margin-bottom:20px}.wechatstyle-datetime{display:block;font-size:13px;text-align:center;color:#bbb;margin-top:20px;margin-bottom:17px;-webkit-text-size-adjust:100%}.msgdatetimediv{position:relative;-webkit-text-size-adjust:100%}.usermsg-datetime{font-size:12px;color:#bbb;bottom:auto;left:auto;right:54px;top:-14px;position:absolute}.aimsg-datetime{font-size:12px;color:#bbb;bottom:auto;left:57px;right:auto;top:-14px;position:absolute}.userinfo{display:flex;flex-direction:row-reverse;align-items:flex-start;padding-right:2px;margin-top:17px;animation:oneshow .8s ease 1}.usermsg{color:#191919;display:flex;flex-direction:column;justify-content:center;padding:9px 13px;border-radius:6px;overflow-x:auto;overflow-y:hidden;scrollbar-width:thin;margin-right:11px;background-color:#95eb6c}.aiinfo{display:flex;flex-direction:row;align-items:flex-start;margin-left:7px;margin-top:17px;animation:oneshow .8s ease 1}.aimsg{color:#191919;display:flex;flex-direction:column;justify-content:center;padding:9px 13px;border-radius:6px;overflow-x:auto;overflow-y:hidden;scrollbar-width:thin;margin-left:11px;background-color:#fff}.aiinfo .msgdiv::before{content:"";display:block;position:absolute;border:12px solid transparent;border-right-color:#fff;left:-7px;top:8px}.userinfo .msgdiv::before{content:"";display:block;position:absolute;border:12px solid transparent;border-left-color:#95eb6c;right:-7px;top:8px}.msgcopydiv{width:auto;max-width:76%}.chat-img{border-radius:6px;height:2.3rem;width:2.3rem;color:rgba(255,255,255);background-color:#f5f5f5;display:flex;flex-direction:row;justify-content:center;align-items:center}.chat-img img{height:100%;width:100%;object-fit:cover;border-radius:6px}.chat-green-svg{background:linear-gradient(to bottom,#17c882,#14b482)}.chat-img-border{box-shadow:0 0 2px 1px rgba(56,82,56,.3);-webkit-box-shadow:0 0 2px 1px rgba(56,82,56,.3);-moz-box-shadow:0 0 2px 1px rgba(56,82,56,.3)}.chat-img-bg{background-image:radial-gradient(#fff,#f5f5f5 40%,#e6e6e6);background-image:-webkit-radial-gradient(#fff,#f5f5f5 40%,#e6e6e6);background-image:-moz-radial-gradient(#fff,#f5f5f5 40%,#e6e6e6)}.update-img-size{margin-right:4px!important;height:33px;width:33px}.flex-column-center{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;position:fixed;bottom:0;width:100%;left:0;background-color:#f6f6f6;border-top:.8px solid #ddd}.justify-end{display:flex;flex-direction:row;justify-content:flex-start;align-items:right;bottom:0}.panelrow{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-end;width:100%;height:30px}.dh-input{font-size:14px;color:#191919;width:100%;height:25px;border-radius:6px;padding-left:10px;padding-right:10px;margin-left:10px;margin-right:4px;border:1px solid #ddd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;scrollbar-width:thin}.dh-input:disabled{border:1px solid #ddd;color:#ccc!important}.dh-input:read-only{border:1px solid #ddd;color:#ccc!important}.textareaSPReadOnly:read-only{color:#555!important;background-color:#ededed!important;overflow:scroll}input[type=password],input[type=text],textarea{outline:0}input[type=password]:focus,input[type=text]:focus,textarea:focus{border:1px solid #17a316!important;box-shadow:inset 0 1px 2px rgba(0,0,0,.075),0 0 5px rgba(81,167,232,.5)}input:focus{z-index:2}.dropdown{-webkit-appearance:none;-moz-appearance:none;appearance:none;flex-shrink:0;width:auto;height:25px;align-items:center;justify-content:center;margin:0;padding:0 10px;border-radius:6px;border:none;font-weight:400;font-size:12px;overflow:hidden;outline:0;cursor:pointer;color:#fff;background:#1aad19;background:linear-gradient(to bottom,#1ac83c,#1aa819);-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.btn{display:flex;flex-shrink:0;width:auto;height:25px;align-items:center;justify-content:center;padding:0 10px;margin-right:7px;background-color:#1aad19;border-color:#1aad19;background:linear-gradient(to bottom,#1ac83c,#1aa819);color:#fff;border-radius:6px;border:none;outline:0;font-weight:400;font-size:12px;text-decoration:none;text-align:center;line-height:25px;cursor:pointer;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:.3s;transition-duration:.3s}.btn *,.copybtn *{align-items:center;justify-content:center;display:flex}.btn:visited,.dropdown:visited{color:#fff}.btn:focus,.btn:hover,.dropdown:hover{background-color:#25c524;border-color:#25c524;background:linear-gradient(to bottom,#24dc46,#24b423);color:#fff}.dropdown:active,.dropdown:focus{background:#0fb9af;background-color:#0fb9af;border-color:#0fb9af;color:#f5feff}.dropdown option:disabled{color:#0c8b6e}.bluedropdown option:disabled{color:#008398}.orangereddropdown option:disabled{color:#a23300}.btn:active{background-color:#17a316;border-color:#17a316;background:linear-gradient(to bottom,#17be39,#179616);color:#f9fff5}.bluebtn:disabled,.btn:disabled,.dropdown:disabled{border:1px solid #ddd!important;background-color:#f5f5f5!important;background:linear-gradient(to bottom,#fcfcfc,#f0f0f0)!important;color:#1aad19!important}.minibtn{width:14px;height:14px;line-height:12px;padding:1px;font-size:12px;flex-shrink:0;display:inline-block;vertical-align:middle;border-radius:50%;margin-bottom:1px!important;transform:scale(.85);-ms-transform:scale(.85);-webkit-transform:scale(.85);-moz-transform:scale(.85);-o-transform:scale(.85)}.minibtn-default{width:auto;height:16px;padding:2px 7px;border-radius:4px}.bluebtn,.bluedropdown{background-color:#1ca5c2;border-color:#1ca5c2;background:linear-gradient(to bottom,#1cbec8,#1c9bc3)}.bluebtn:focus,.bluebtn:hover{background-color:#22b9d9;border-color:#22b9d9;background:linear-gradient(to bottom,#26d2d2,#26afcd);color:#fff}.bluebtn:active{background-color:#1ca5c2;border-color:#1ca5c2;background:linear-gradient(to bottom,#19b4c5,#1991c0);color:#effcff}.bluedropdown:focus,.bluedropdown:hover{background-color:#22b9d9;border-color:#22b9d9;background:#22b9d9;color:#fff}.redbtn{background-color:#dd3838;border-color:#dd3838;background:linear-gradient(to bottom,#f34d2d,#eb0505);box-shadow:0 0 3px 0 rgba(221,56,56,.55)}.redbtn:focus,.redbtn:hover{background-color:#ff4040;border-color:#ff4040;background:linear-gradient(to bottom,#fd5f4b,#eb1919);color:#fff}.redbtn:active{background-color:#c73737;border-color:#c73737;background:linear-gradient(to bottom,#ea4607,#ea0002);color:#fff5f0}.orangeredbtn,.orangereddropdown{background-color:#f44400;border-color:#f44400;background:linear-gradient(to bottom,#ff7800,#f74900);box-shadow:0 0 2px 0 rgba(241,64,14,.55)}.orangeredbtn:focus,.orangeredbtn:hover{background-color:#ff4f00;border-color:#ff4f00;background:linear-gradient(to bottom,#ff8c0a,#fe580a);color:#fff}.orangeredbtn:active{background-color:#da3600;border-color:#da3600;background:linear-gradient(to bottom,#fc6e00,#f13a00);color:#fff9f6}.orangereddropdown:focus,.orangereddropdown:hover{background-color:#ff4f00;border-color:#ff4f00;background:#ff4f00;color:#fff}.btnzoom-a{transition:all .5s;cursor:pointer}.btnzoom-a:hover{transform:scale(1.18)}.btnzoom-b{transition:all .2s}.btnzoom-b:hover{transform:scale(1)}.btnzoom-c{transition:all .2s}.btnzoom-c:hover{transform:scale(1.1)}.btnzoom-d{transition:all .2s}.btnzoom-d:hover{transform:scale(.95)}.aimsg *,.usermsg *{margin:0;word-wrap:break-word}.aimsg ol,.aimsg ul,.usermsg ol,.usermsg ul{white-space:normal;margin:5px 0;padding-left:28px}.aimsg p,.aimsg span,.usermsg p,.usermsg span{line-height:1.6;margin-top:3px}.aimsg li,.usermsg li{word-break:break-all}.aimsg code,.usermsg code{font-size:12px;font-family:Consolas,Monaco,monospace}.aimsg code:not(precode){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#efefef}.usermsg code:not(precode){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#a9f289}.aimsg table code:not(precode),.usermsg table code:not(precode){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#e3e3d4}.aimsg pre,.usermsg pre{margin:5px 0;width:100%;min-width:100px;white-space:pre;border-radius:6px;box-sizing:border-box;color:#e6e6e6;background:#2a2c2d}.aimsg pre>code,.usermsg pre>code{display:block;padding:1em;-moz-tab-size:4;tab-size:4;overflow-x:auto;white-space:pre;word-break:normal;scrollbar-width:thin}.aimsg img:not(.clippy),.usermsg img:not(.clippy){margin:5px 0;max-width:100%}.aimsg table img,.usermsg table img{max-width:300px}.usermsg blockquote{white-space:normal;margin:8px 14px;max-width:100%;color:#373737;border-left:1px solid #6eac4e;padding:0 0 0 8px}.aimsg blockquote{white-space:normal;margin:8px 14px;max-width:100%;color:#57606a;border-left:1px solid #c8c8c8;padding:0 0 0 8px}.aimsg blockquote *,.usermsg blockquote *{margin-top:0;margin-bottom:0}.aimsg blockquote,.aimsg blockquote p,.aimsg h1,.aimsg h2,.aimsg h3,.aimsg h4,.aimsg h5,.aimsg h6,.aimsg ol,.aimsg ol p,.aimsg ul,.aimsg ul p,.usermsg blockquote,.usermsg blockquote p,.usermsg h1,.usermsg h2,.usermsg h3,.usermsg h4,.usermsg h5,.usermsg h6,.usermsg ol,.usermsg ol p,.usermsg ul,.usermsg ul p{line-height:1.5}.aimsg h1,.aimsg h2,.aimsg h3,.aimsg h4,.aimsg h5,.aimsg h6,.usermsg h1,.usermsg h2,.usermsg h3,.usermsg h4,.usermsg h5,.usermsg h6{margin-top:5px}.aimsg h1,.usermsg h1{font-size:1.4em;margin:0 0 .5em 0;padding:1em 0 .5em;border-bottom:1px solid #7dc35a}.aimsg h2,.usermsg h2{font-size:1.25em;margin:.5em 0;padding:.2em 0 .3em;border-bottom:1px solid #7dc35a}.aimsg h1{border-bottom:1px solid #b4b4b4}.aimsg h2{border-bottom:1px solid #b4b4b4}.aimsg h3,.usermsg h3{font-size:1.125em}.aimsg h4,.usermsg h4{font-size:1em}.aimsg h5,.usermsg h5{font-size:.875em}.usermsg h6{font-size:.85em;color:#373737}.aimsg h6{font-size:.85em;color:#57606a}.usermsg hr{height:1px;border:none;background-color:#7dc35a;margin:.6em 0 .7em 0}.aimsg hr{height:1px;border:none;background-color:#b4b4b4;margin:.6em 0 .7em 0}.aimsg table,.usermsg table{margin:5px 0;border-spacing:0;border-collapse:collapse;display:table;max-width:100%;overflow:auto;color:#282828;word-break:break-all}.aimsg td,.aimsg th,.usermsg td,.usermsg th{padding:0}.aimsg table th,.usermsg table th{font-weight:600}.aimsg table td,.aimsg table th,.usermsg table td,.usermsg table th{padding:5px 8px;border:1px solid #e4e6d0}.aimsg table tr,.usermsg table tr{background-color:#f6f9f1;border-top:1px solid}.aimsg table tr:nth-child(2n),.usermsg table tr:nth-child(2n){background-color:#edf1e5}.aimsg table img,.usermsg table img{background-color:transparent}.clippy{margin:4px;position:relative}.copybtn[disabled] .clippy{opacity:.3}.msgcopydiv,.snippet{position:relative;overflow:visible}.msgcopydiv .copybtn,.notification-content .copybtn,.panelrow .copybtn,.snippet .copybtn{-webkit-transition:opacity .3s ease-in-out;-o-transition:opacity .3s ease-in-out;transition:opacity .3s ease-in-out;opacity:0;padding:0;position:absolute;right:4px;top:4px;display:inline-block;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-appearance:none}.msgcopydiv:hover>.copybtn,.msgcopydiv>.copybtn:focus,.snippet:hover>.copybtn,.snippet>.copybtn:focus{opacity:1}@media screen and (max-width:768px){.snippet>.copybtn{opacity:.4}}.userinfo>.msgcopydiv{margin-left:30px}.aiinfo>.msgcopydiv{margin-right:30px}.userinfo>.msgcopydiv>.copybtn{top:auto;bottom:4px;left:-30px;right:auto}.aiinfo>.msgcopydiv>.copybtn{top:auto;bottom:4px;left:auto;right:-30px}.copybtn:focus{text-decoration:none;border-color:#51a7e8;outline:0;box-shadow:0 0 5px rgba(81,167,232,.5)}.copybtn.selected:focus,.copybtn:focus:hover{border-color:#51a7e8}.copybtn:active,.copybtn:hover{text-decoration:none;background-color:#ddd;background-image:linear-gradient(#eee,#ddd);border-color:#ccc}.copybtn.selected,.copybtn:active{background-color:#dcdcdc;background-image:none;border-color:#b5b5b5;box-shadow:inset 0 2px 4px rgba(0,0,0,.15)}.copybtn.selected:hover{background-color:#cfcfcf}.copybtn.disabled,.copybtn.disabled:hover,.copybtn:disabled,.copybtn:disabled:hover{color:rgba(102,102,102,.5);cursor:default;background-color:rgba(229,229,229,.5);background-image:none;border-color:rgba(197,197,197,.5);box-shadow:none}.snippet .tooltipped-w:after{background:#6e7681}.snippet .tooltipped-w:before{border-left-color:#6e7681}.tooltipped{position:relative}.tooltipped:after{position:absolute;z-index:1000000;display:none;padding:5px 8px;font:normal normal 11px/1.5 Helvetica,arial,nimbussansl,liberationsans,freesans,clean,sans-serif,"Segoe UI Emoji","Segoe UI Symbol";color:#fff;text-align:center;text-decoration:none;text-shadow:none;text-transform:none;letter-spacing:normal;word-wrap:break-word;white-space:pre;pointer-events:none;content:attr(aria-label);background:rgba(0,0,0,.8);border-radius:3px;-webkit-font-smoothing:subpixel-antialiased}.tooltipped:before{position:absolute;z-index:1000001;display:none;width:0;height:0;color:rgba(0,0,0,.8);pointer-events:none;content:"";border:5px solid transparent}.tooltipped:active:after,.tooltipped:active:before,.tooltipped:focus:after,.tooltipped:focus:before,.tooltipped:hover:after,.tooltipped:hover:before{display:inline-block;text-decoration:none}.tooltipped-n:after,.tooltipped-ne:after,.tooltipped-nw:after{right:50%;bottom:100%;margin-bottom:5px}.tooltipped-n:before,.tooltipped-ne:before,.tooltipped-nw:before{top:-5px;right:50%;bottom:auto;margin-right:-5px;border-top-color:rgba(0,0,0,.8)}.tooltipped-ne:after{right:auto;left:50%;margin-left:-15px}.tooltipped-nw:after{margin-right:-15px}.tooltipped-n:after{-webkit-transform:translateX(50%);-ms-transform:translateX(50%);transform:translateX(50%)}.tooltipped-w:after{right:100%;bottom:50%;margin-right:5px;-webkit-transform:translateY(50%);-ms-transform:translateY(50%);transform:translateY(50%)}.tooltipped-w:before{top:50%;bottom:50%;left:-5px;margin-top:-5px;border-left-color:rgba(0,0,0,.8)}.tooltipped-e:after{bottom:50%;left:100%;margin-left:5px;-webkit-transform:translateY(50%);-ms-transform:translateY(50%);transform:translateY(50%)}.tooltipped-e:before{top:50%;right:-5px;bottom:50%;margin-top:-5px;border-right-color:rgba(0,0,0,.8)}#app{display:flex;flex-flow:column;margin:1;white-space:pre-wrap}.dialog-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:900100}.dialog-wrapper-hide{display:none}.dialog{width:95%;max-width:800px;height:78%;max-height:1000px;overflow:hidden;border-radius:10px;z-index:900101;position:fixed;background-color:#ededed;box-shadow:0 0 10px rgba(0,0,0,.3)}.dialog-header{position:relative;height:40px;line-height:40px;padding:0 20px;background-color:#f5f5f5;border-top-left-radius:10px;border-top-right-radius:10px}.dialog-bottom{position:relative;height:15px;line-height:15px;border-bottom-left-radius:10px;border-bottom-right-radius:10px}.dialog-close{line-height:20px;color:#333;position:absolute;top:10px;right:10px;width:20px;height:20px;cursor:pointer}.dialog-title{font-size:14px;line-height:20px;color:#333;position:absolute;top:10px;align-items:center;justify-content:center;display:flex;-webkit-text-size-adjust:100%}.dialog-scroll{position:relative;width:100%;height:calc(100% - 54.5px);overflow:auto;scrollbar-width:thin}.dialog-content{padding:20px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center}.dialog-content .btn,.dialog-content .dh-input{margin:0 2px}.dialog-content .panelrow{height:26px;margin-bottom:4px}.dialog-content .panelrow>:last-child{margin-right:2px}.dialog-content .panelgroup{width:100%;box-shadow:0 3px 8px 0 rgba(20,20,20,.16),0 0 1px 1px rgba(20,20,20,.07);padding:5px 6px 4px 8px;border-radius:5px;margin-bottom:12px}.dialog-content .panelgroup-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;padding-bottom:1px;border-bottom:1px solid rgb(220,220,220,.5)}.dialog-content .panelgroup-head>span{color:#666;font-size:12px}.dialog-content .panelgroup-shadow{box-shadow:0 3px 8px 2px rgba(20,20,20,.14),0 0 1px 1px rgba(20,20,20,.065)}.dialog-content span{font-size:12px;color:#333;margin-left:4px;line-height:18px;-webkit-text-size-adjust:100%}.dialog-mask{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:-1}.panelgroup-chatdata-selected{box-shadow:0 0 .5px 1px rgba(26,168,50,.8)!important;background:linear-gradient(rgba(26,168,50,.015),rgba(26,168,50,.15))}.panelgroup-chatdata-selected-transparent{box-shadow:0 0 .5px 2px #1aa832!important;background:linear-gradient(rgba(26,168,50,.005),rgba(26,168,50,.05))}.control-container{width:auto;margin-right:6px}.control-bg{padding:2px 5px;width:auto;height:auto;background:#fcfcfc;border-radius:5px;display:flex}.slider{-webkit-appearance:none!important;-moz-appearance:none;appearance:none;width:100%;height:2px;margin:9px 4px;padding:0 2px;background:linear-gradient(to bottom,#17d51e,#179e16);border:none;border-radius:2px;outline:0;-webkit-transition:.2s;transition:opacity .2s}.slider::-webkit-slider-thumb{-webkit-appearance:none!important;appearance:none;width:12px;height:17px;border:none;background:linear-gradient(to bottom,#17d51e,#179e16);border-radius:4px;cursor:pointer}.slider::-moz-range-thumb{-webkit-appearance:none!important;-moz-appearance:none!important;appearance:none;width:12px;height:17px;border:none;background:linear-gradient(to bottom,#17d51e,#179e16);border-radius:4px;cursor:pointer}.slider::-ms-thumb{-webkit-appearance:none!important;appearance:none;width:12px;height:17px;border:none;background:linear-gradient(to bottom,#17d51e,#179e16);border-radius:4px;cursor:pointer}.slider::-webkit-slider-thumb:focus,.slider::-webkit-slider-thumb:hover{background:linear-gradient(to bottom,#1ac83c,#179b16);outline:0}.slider::-moz-range-thumb:focus,.slider::-moz-range-thumb:hover{background:linear-gradient(to bottom,#1ac83c,#179b16);outline:0}.slider::-ms-thumb:focus,.slider::-ms-thumb:hover{background:linear-gradient(to bottom,#1ac83c,#179b16);outline:0}.slider::-webkit-slider-thumb:active{background:linear-gradient(to bottom,#1ac83c,#179b16)}.slider::-moz-range-thumb:active{background:linear-gradient(to bottom,#1ac83c,#179b16)}.slider::-ms-thumb:active{background:linear-gradient(to bottom,#1ac83c,#179b16)}@media only screen and (max-width:768px){.slider::-webkit-slider-thumb{width:25px;height:18px}.slider::-moz-range-thumb{width:25px;height:18px}.slider::-ms-thumb{width:25px;height:18px}}.slider:disabled::-webkit-slider-thumb{background:linear-gradient(to bottom,#d7ebd7,#c3d6c2);cursor:not-allowed}.slider:disabled::-moz-range-thumb{background:linear-gradient(to bottom,#d7ebd7,#c3d6c2);cursor:not-allowed}.slider:disabled::-ms-thumb{background:linear-gradient(to bottom,#d7ebd7,#c3d6c2);cursor:not-allowed}.slider:disabled{background:linear-gradient(to bottom,#d7ebd7,#c3d6c2);cursor:not-allowed}#dialog-promptgenerator .dh-input,#dialog-settings .dh-input{font-size:12px;color:#333;background-color:#fcfcfc}#dialog-promptgenerator .dh-input{font-size:13px}#loading-mask button{margin:30px;display:inline-block;padding:8px 16px;font-size:14px;text-align:center;color:#333;background-color:#fdffb4;border:3px solid #555;border-radius:10px;cursor:pointer}.notification{position:relative;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:900900}.notification-wrapper{max-width:600px;overflow:hidden;position:fixed;transform:translate(-50%,-50%);background-color:#fdffb4;box-shadow:0 0 8px rgba(191,169,16,.3);border:1px solid rgba(166,152,27,.45);z-index:900902}.notification-content{color:#664909;font-size:13px;line-height:1.6;-webkit-text-size-adjust:100%}.notification-content-center{display:block;text-align:start;padding-left:6px;margin:5px 10px 0 10px;word-break:break-word}.notification-content-bottom{display:flex;text-align:center;padding-left:0;margin:5px 11px 5px 11px;word-break:break-word}.notification-center{width:82%;min-width:160px;bottom:auto;left:50%;top:50%;right:auto;border-radius:10px}.notification-bottom{width:auto;min-width:45px;bottom:calc(0% + 4.5px);left:50%;top:auto;right:auto;border-radius:6px;animation:slideIn .4s ease-out forwards}.notification-mask{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.65);z-index:900901}@keyframes slideIn{from{transform:translate(-50%,-3px);opacity:0}to{transform:translate(-50%,-18px);opacity:1}}</style> </head> <body> <div id=app> <div id=loading-mask class=dialog-wrapper style=z-index:999999> <div>Loader<br>Not By Tak</div> </div> <div style=width:100%> <div> <div v-for="(x,i) in msgList" :key=i> <span v-if=x.my class=wechatstyle-datetime :style="{ display: (settingsTime_WechatStyle && x.wechatstyledatetime != null) ? 'block' : 'none', marginBottom: settingsTime_Message == 3 ? '27px' : '17px', fontSize: settingsFontSize * 0.9 + 'px' }">{{x.wechatstyledatetime}}</span> <div v-if=x.my :data-hr=x.hr class=msgdatetimediv :style="{ display: settingsTime_Message == 1 ? 'none' : 'block' }"><span class=usermsg-datetime>{{x.datetime}}</span></div> <div v-if=!x.my :data-hr=x.hr class=msgdatetimediv :style="{ display: settingsTime_Message == 1 ? 'none' : 'block' }"><span class=aimsg-datetime>{{x.datetime}}</span></div> <div v-if=x.my class=userinfo :style="{ marginTop : settingsTime_Message == 3 ? '27px' : '17px' }"> <div class="chat-img btnzoom-a" @click="isShowDialog_ChatList = true" :title="settingsLanguage == 'cn' ? '打开对话列表' : 'Open Chat List'"> <img :src=userAvatarURL> </div> <div class="justify-end msgcopydiv msgdiv"> <div v-html=x.msg class=usermsg :style="{ fontSize: settingsFontSize + 'px' }"> </div> </div> </div> <div v-if=!x.my class=aiinfo :style="{ marginTop : settingsTime_Message == 3 ? '27px' : '17px' }"> <div class="chat-img btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'none' : 'flex' }" @click="isShowDialog_ChatList = true" :title="settingsLanguage == 'cn' ? '打开对话列表' : 'Open Chat List'"> <img :src=gptAvatarURL> </div> <div class="chat-img chat-green-svg btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'flex' : 'none'}" @click="isShowDialog_ChatList = true" :title="settingsLanguage == 'cn' ? '打开对话列表' : 'Open Chat List'"> <svg width=27 height=27 viewBox="0 0 41 41" fill=none xmlns=http://www.w3.org/2000/svg stroke-width=1.5 role=img> <path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill=currentColor> </path> </svg> </div> <div class="msgcopydiv msgdiv"> <div v-html=x.msg class=aimsg :style="{ fontSize: settingsFontSize + 'px' }"> </div> </div> </div> </div> <div class=bottom-position></div> </div> </div> <div class=flex-column-center> <div class=panelrow style=margin-top:6px;height:40px> <button @click="isShowDialog_PromptGenerator = true" class=btn :class="{ 'orangeredbtn': !(gptSystemPromptReadOnly.trim() == '') }" :disabled="(gptSystemPrompt_hidden.trim() != '')" :title="gptSystemPrompt_hidden.trim() == '' ? (settingsLanguage == 'cn' ? '打开提示词窗口' : 'Open Prompt Generator') : (settingsLanguage == 'cn' ? '功能已被禁用' : 'The feature has been disabled') " style="margin-left:12px;margin-right:-1px;border-radius:6px 0 0 6px;line-height:38px;width:27px;height:38px;padding:0 8px;z-index:900001"> <div> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24"> <path clip-rule=evenodd d="M14.526 6.10576C15.0265 6.33917 15.2667 6.88343 15.0625 7.3214L9.88541 18.4237C9.68118 18.8616 9.10985 19.0275 8.60931 18.7941C8.10877 18.5607 7.86857 18.0164 8.0728 17.5784L13.2499 6.47616C13.4541 6.03819 14.0254 5.87235 14.526 6.10576Z" fill=currentColor fill-rule=evenodd /></svg>  </div> </button> <textarea @click=scrollToBottomViewClick @blur=textareaChatInputBox_blur @focus=textareaChatInputBox_focus @keydown=textareaMobileInputCompatibility @keydown.enter.exact=textareaEnter @keydown.ctrl.enter.exact=newLine @keydown.meta.enter.exact=newLine v-model=msg type=text class="dh-input textareachatinputbox" style="margin-left:0;height:38px;min-height:38px;max-height:38px;border-radius:0 6px 6px 0;z-index:900000" placeholder="" enterkeyhint=send></textarea> <button @click=sendMsg(); :disabled=btnDisabledState_Sending class=btn :title="settingsLanguage == 'cn' ? '发送' : 'Send'" style="line-height:38px;height:38px;font-size:14px;padding:0 15px">{{sentext}}</button> </div> <div class=panelrow style=margin-bottom:7px> <button @click=clearContext :disabled=btnDisabledState_Clear class=btn style=margin-left:12px;margin-right:4px :class="{'orangeredbtn': !Number.isInteger(settingsContextualMode) ? false : (  !btnDisabledState_Clear && ( (settingsContextualMode > 100 && succQA_Count >= settingsContextualMode - 103 && succQA_Count < settingsContextualMode - 101) || (settingsContextualMode > 0 && settingsContextualMode < 100 && succQA_Count >= settingsContextualMode - 3 && succQA_Count < settingsContextualMode - 1) )  ) ? true : false ,
					'redbtn': !Number.isInteger(settingsContextualMode) ? false : (  !btnDisabledState_Clear && ( (settingsContextualMode > 100 && succQA_Count >= settingsContextualMode - 101) || (settingsContextualMode > 0 && settingsContextualMode < 100 && succQA_Count >= settingsContextualMode - 1) )  ) ? true : false   }" :title="settingsLanguage == 'cn' ? '清除记忆' : 'Clear Context'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=17 height=17 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.9 stroke-linecap=round stroke-linejoin=round> <polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path> <line x1=10 y1=11 x2=10 y2=17></line> <line x1=14 y1=11 x2=14 y2=17></line> </svg> </div> <span v-if="settingsLanguage == 'cn' " :style="{ display: isShowQACountLabel ? 'flex' : 'none' }">&nbsp;记忆</span> <span v-else :style="{ display: isShowQACountLabel ? 'flex' : 'none' }">&nbsp;Context</span> <span>:&nbsp;{{succQA_Count}}</span> </button> <button disabled class=btn style=margin-left:0;margin-right:4px;cursor:auto :style="{ color: totaltokens < 2000 ? '#1aad19 !important' : (  totaltokens < ( gptModelList.find(model => model.modelname === apiGPTModel) ? gptModelList.find(model => model.modelname === apiGPTModel).maxtokens : 4096 ) * 0.9 ? '#f94000 !important' : '#fa1e0a !important'  ),
				fontWeight: totaltokens < ( gptModelList.find(model => model.modelname === apiGPTModel) ? gptModelList.find(model => model.modelname === apiGPTModel).maxtokens : 4096 ) * 0.9 ? 'normal' : 'bold'  }" :title="settingsLanguage == 'cn' ? 'Token用量' : 'Tokens Usage'"> <div :style="{ display: isShowTotaltokensSVG ? 'flex' : 'none' }"> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=25 height=18 viewBox="0 0 25 19" fill=currentColor stroke-width=0.02 stroke=currentColor stroke-linecap=round stroke-linejoin=round> <path d="m10.62109,1.66441c-1.05095,-0.60518 -2.43437,-0.9385 -3.89526,-0.9385c-1.46093,0 -2.84426,0.33332 -3.89526,0.9385c-1.12359,0.64701 -1.74652,1.53053 -1.75767,2.49024l-0.00051,0l0,10.75701c0,1.91873 2.48327,3.42172 5.65344,3.42172c3.17018,0 5.65349,-1.50299 5.65349,-3.42172l0,-10.74381l-0.00023,0c-0.00557,-0.96482 -0.62926,-1.85344 -1.758,-2.50345zm0.77473,6.82194c0,1.32648 -2.13857,2.44712 -4.66998,2.44712c-2.53136,0 -4.66994,-1.12064 -4.66994,-2.44712l0,-0.18096c1.01002,0.8957 2.70835,1.47278 4.66994,1.47278c1.96163,0 3.65992,-0.57714 4.66998,-1.47278l0,0.18096zm0,2.13876c0,1.32652 -2.13857,2.44716 -4.66998,2.44716c-2.53136,0 -4.66994,-1.12068 -4.66994,-2.44716l0,-0.18092c1.01002,0.89565 2.70835,1.47278 4.66994,1.47278c1.96163,0 3.65992,-0.57713 4.66998,-1.47278l0,0.18092zm-9.33992,1.95788c1.01002,0.8957 2.70835,1.47278 4.66993,1.47278c1.96164,0 3.65992,-0.57713 4.66998,-1.47283l0,0.18102c0,1.32647 -2.13857,2.44711 -4.66998,2.44711c-2.53136,0 -4.66993,-1.12064 -4.66993,-2.44711l0,-0.18097zm9.33992,-6.23549c0,1.32647 -2.13857,2.44711 -4.66998,2.44711c-2.53137,0.00005 -4.66994,-1.12063 -4.66994,-2.44711l0,-0.22269c1.01002,0.88937 2.70835,1.46238 4.66993,1.46238c1.96164,0 3.65992,-0.57306 4.66998,-1.46238l0,0.22269l0,0zm-8.07442,-3.83077c0.90403,-0.52061 2.11309,-0.80727 3.40444,-0.80727c1.29139,0 2.50046,0.28671 3.40449,0.80727c0.80423,0.46309 1.2655,1.06963 1.2655,1.66405c0,1.31336 -2.13857,2.4229 -4.66998,2.4229c-2.53136,0 -4.66994,-1.10954 -4.66994,-2.4229c0,-0.59441 0.46127,-1.20095 1.26549,-1.66405zm3.40444,14.83319c-2.53136,0 -4.66993,-1.11656 -4.66993,-2.43826l0,-0.18982c1.01002,0.89566 2.70835,1.47279 4.66993,1.47279c1.96164,0 3.65992,-0.57713 4.66998,-1.47279l0,0.18987c0,1.32166 -2.13862,2.43822 -4.66998,2.43822z"/> <path d="m24.01826,10.37334c-0.00347,-0.9667 -0.62739,-1.85725 -1.75804,-2.50833c-1.05095,-0.60519 -2.43437,-0.9385 -3.89531,-0.9385c-1.46088,0 -2.84426,0.33332 -3.89526,0.9385c-1.1338,0.65286 -1.75818,1.54655 -1.75818,2.51633c0,0.00023 0,0.00047 0,0.00075l0,0l0,4.32772c0,1.91086 2.48326,3.40772 5.65344,3.40772c3.17018,0 5.65349,-1.49686 5.65349,-3.40772l0,-4.33653l-0.00014,0l0,0.00005zm-0.98337,2.17477c0,1.32648 -2.13857,2.44717 -4.66999,2.44717c-2.53137,0 -4.66993,-1.12065 -4.66993,-2.44717l0,-0.22269c1.01002,0.88937 2.7083,1.46238 4.66993,1.46238s3.65992,-0.57301 4.66999,-1.46238l0,0.22269zm-8.07442,-3.83077c0.90403,-0.52061 2.11309,-0.80727 3.40444,-0.80727c1.29135,0 2.50046,0.28672 3.40449,0.80727c0.80423,0.46309 1.2655,1.06964 1.2655,1.66405c0,1.31336 -2.13857,2.4229 -4.66999,2.4229c-2.53137,0 -4.66993,-1.10954 -4.66993,-2.4229c0.00005,-0.59441 0.46127,-1.20096 1.2655,-1.66405zm3.40444,8.41673c-2.53137,0 -4.66993,-1.11014 -4.66993,-2.42421l0,-0.20386c1.01002,0.89565 2.7083,1.47277 4.66993,1.47277s3.65992,-0.57708 4.66998,-1.47277l0,0.20386c0,1.31407 -2.13857,2.42421 -4.66998,2.42421z"/> </svg> </div> <span v-if="settingsLanguage == 'cn' " :style="{ display: isShowTotaltokensLabel ? 'flex' : 'none' }">&nbsp;Token用量</span> <span v-else :style="{ display: isShowTotaltokensLabel ? 'flex' : 'none' }">&nbsp;Tokens</span> <span>:&nbsp;{{totaltokens}}</span> </button> <button @click=showStatus class=btn style="width:30px;padding:0 5px" :class="{'bluebtn': (apiGPTModel.includes('gpt-3.5') && (apiGPTModel.includes('16k') || totaltokens > 9999 )),
					'orangeredbtn': (!apiGPTModel.includes('gpt-3.5') && !(apiGPTModel.includes('32k') || openSmartMaxTokens || apiMaxTokens > 3999 || totaltokens > 3999)),
					'redbtn': (!apiGPTModel.includes('gpt-3.5') && (apiGPTModel.includes('32k') || openSmartMaxTokens || apiMaxTokens > 3999 || totaltokens > 3999)) }" :title="settingsLanguage == 'cn' ? '状态' : 'Status'"> <div> <svg fill=currentColor stroke=none width=18 height=18 viewBox="0 -0.028 0.4 0.4" xmlns=http://www.w3.org/2000/svg><path d="M.246.171.334.083A.012.012 0 0 0 .317.066L.229.154a.013.013 0 0 0-.004.004A.05.05 0 0 0 .2.15.05.05 0 1 0 .25.2.05.05 0 0 0 .243.175.013.013 0 0 0 .247.171ZM.2.225A.025.025 0 1 1 .225.2.025.025 0 0 1 .2.225ZM.4.192a.2.2 0 0 1-.057.15.013.013 0 0 1-.018 0L.292.309A.012.012 0 0 1 .309.292l.024.023A.175.175 0 0 0 .375.2H.337a.013.013 0 0 1 0-.025h.035a.181.181 0 0 0-.014-.05.013.013 0 1 1 .023-.011.196.196 0 0 1 .017.067.011.011 0 0 1 0 .01Zm-.29.1a.012.012 0 0 1 0 .017L.077.342a.013.013 0 0 1-.018 0A.2.2 0 0 1 0 .2V.19a.011.011 0 0 1 0-.003.01.01 0 0 1 0-.004A.199.199 0 0 1 .198 0H.2a.01.01 0 0 1 .004 0 .196.196 0 0 1 .081.018.012.012 0 0 1 .006.017.012.012 0 0 1-.017.006.178.178 0 0 0-.061-.014v.036a.013.013 0 0 1-.025 0V.025a.175.175 0 0 0-.111.05.173.173 0 0 0-.05.1h.036a.013.013 0 0 1 0 .025H.025a.173.173 0 0 0 .043.115L.092.292a.012.012 0 0 1 .017 0Z"/> </svg> </div> </button> <button @click=undo :disabled=btnDisabledState_Undo class=btn style=margin-left:auto;margin-right:4px;width:45px :title="settingsLanguage == 'cn' ? '撤销' : 'Undo'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=24px height=23px viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.4 stroke-linecap=round stroke-linejoin=round> <path d="M5 9.5C8.5 9.5 11.5 9.5 15 9.5C15.1615 9.5 19 9.5 19 13.5C19 18 15.2976 18 15 18C12 18 10 18 7 18"/> <path d="M8.5 13C7.13317 11.6332 6.36683 10.8668 5 9.5C6.36683 8.13317 7.13317 7.36683 8.5 6"/> </svg> </div> </button> <button @click=retry :disabled=btnDisabledState_Undo class=btn style=margin-right:4px;width:45px :title="settingsLanguage == 'cn' ? '重问' : 'Retry'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.9 stroke-linecap=round stroke-linejoin=round> <path d="M17 2.1l4 4-4 4"/> <path d="M3 12.2v-2a4 4 0 0 1 4-4h12.8M7 21.9l-4-4 4-4"/> <path d="M21 11.8v2a4 4 0 0 1-4 4H4.2"/> </svg> </div> </button> <button @click=openDialogTodo_Settings class=btn :class="{ 'redbtn': !btnDisabledState_CheckAPI }" style=margin-right:4px;width:45px :title="settingsLanguage == 'cn' ? '设置' : 'Settings'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round> <circle cx=12 cy=12 r=3></circle> <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path> </svg> </div> </button> <button @click=openDialog_Help class="btn bluebtn" style=width:45px :title="settingsLanguage == 'cn' ? '帮助' : 'Help'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=17 height=17 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round> <circle cx=12 cy=12 r=10></circle> <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path> <line x1=12 y1=17 x2=12.01 y2=17></line> </svg> </div> </button> </div> </div> <div id=dialog-settings class=dialog-wrapper v-show=isShowDialog_Settings> <div class=dialog style=max-height:800px> <div class=dialog-header> <div class=dialog-title style="justify-content:space-between;width:calc(95% - 27px)"> <svg xmlns=http://www.w3.org/2000/svg width=22 height=22 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=3></circle> <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path> </svg> {{ settingsLanguage == 'cn' ? '&nbsp;设置' : '&nbsp;Settings' }} <select @change=changeSimpleMode(true) class="dropdown minibtn minibtn-default bluedropdown btnzoom-b" v-model=isSimpleMode :style="{ marginLeft: settingsLanguage == 'cn' ? '5px' : '5px',marginTop: settingsLanguage == 'cn' ? '0.5px' : '1.5px', width: settingsLanguage == 'cn' ? ( isSimpleMode ? '64px' : '77px' ) : ( isSimpleMode ? '91px' : '111px' )}" :title="settingsLanguage == 'cn' ? '当前TAKGPT模式' : 'Current TAKGPT Mode'"> <option v-if="settingsLanguage == 'cn'" v-for="option in simpleModeOptions_cn" :value=option.state>{{ option.label }}</option> <option v-else v-for="option in simpleModeOptions_en" :value=option.state>{{ option.label }}</option> </select> <span style=margin-left:auto :title="settingsLanguage == 'cn' ? '当前版本' : 'Current Version'">v69.69&nbsp;&nbsp;</span> </div> <div class=dialog-close @click="isShowDialog_Settings = false" :title="settingsLanguage == 'cn' ? '关闭' : 'Close'"> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=fill:none;stroke:#333;stroke-width:2;stroke-linecap:round;stroke-linejoin:round> <path d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> <div class=dialog-scroll> <div class=dialog-content> <div class="panelgroup panelgroup-shadow"> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? 'API Key (OpenAI / 第三方) ' : 'API Key (OpenAI / Third-party) ' }}</span> <button @click="showMiniHelp('A-CheckAPIKey')" class="btn minibtn bluebtn btnzoom-b" :style="{ marginRight: btnDisabledState_CheckAPI ? 'auto' : '2px' }" :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <span :style="{ display: btnDisabledState_CheckAPI ? 'none' : 'block' }" style=margin-right:auto;color:#fa1e0a;font-size:11px>{{ settingsLanguage == 'cn' ? '*必填' : '*Required' }}</span> <button @click=clickOpenAutoKeyRotation class="btn minibtn minibtn-default btnzoom-b" :class="{ 'orangereddropdown': btnDisabledState_CheckAPI && ( (!isThirdPartyAPIKeyEnabled && apiCheckedData.filter(data => data.vpn !== 'third-party').length > 0) || (isThirdPartyAPIKeyEnabled && apiCheckedData.filter(data => data.vpn === 'third-party').length > 0) ) }" :style="{ marginRight: settingsLanguage == 'cn' ? '-11px' : '-11px'}" style=display:flex :title="settingsLanguage == 'cn' ? '管理自动轮换API Key' : 'Auto Key Rotation Management'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=12 height=12 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/> </svg> </div> &nbsp;{{ !isThirdPartyAPIKeyEnabled ? (settingsLanguage == 'cn' ? 'Key模式: 自动轮换API Key' : 'Key Mode: Auto Key Rotation') : (settingsLanguage == 'cn' ? 'Key模式: 第三方单Key模式' : 'Key Mode: 3rd party Key Mode') }} </button> <button style=display:none @click=sendRequest_usingSessionKey class="btn minibtn minibtn-default btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-4px' : '-5px'}" :title="settingsLanguage == 'cn' ? '查询OpenAI API余额 (via Session Key)' : 'Check OpenAI API balances (via Session Key)'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=13px height=13px viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.75 stroke-miterlimit=10> <circle cx=9.5106 cy=9.42613 r=7.64 /> <path d="m6.6506,12.28613l3.34,0a1.43,1.43 0 0 0 1.43,-1.43l0,0a1.43,1.43 0 0 0 -1.43,-1.43l-0.95,0a1.44,1.44 0 0 1 -1.39,-1.44l0,0a1.44,1.44 0 0 1 1.44,-1.43l3.34,0"/> <line x1=9.5106 x2=9.5106 y1=4.64613 y2=6.55613 /><line x1=9.5106 x2=9.5106 y1=12.28613 y2=14.19613 /><line transform="rotate(90 18.2202 18.6877)" x1=14.70164 x2=21.73886 y1=22.20633 y2=15.16912 /> </svg> </div> {{ settingsLanguage == 'cn' ? 'Session Key' : 'Session Key' }} </button> </div> <div class=panelrow> <button class="copybtn btncopyapikey" data-clipboard-nextelementsibling="" style="opacity:1;position:relative;flex-shrink:0;height:25px;top:0;right:0;margin-right:-4px;border-radius:6px 0 0 6px;border:1px solid #ddd;width:25px" :title="settingsLanguage == 'cn' ? '一键复制' : 'One-Click Copy'"> <div> <svg width=14 height=17 class=clippy fill=currentColor> <path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z"> </path> </svg> </div> </button> <input class=inputghostforcopyapikey v-model=api style=opacity:0;height:1px;width:1px;overflow:hidden;margin:0;padding:0;border:none> <input @blur=inputapiblur @focus=inputapifocus @input=inputapichange(false) :style="{ color: btnDisabledState_CheckAPI ? '#cccccc' : '#191919' }" v-model=api type=password class="dh-input inputapikey" style=border-radius:0 :placeholder="settingsLanguage == 'cn' ? 'API Key 粘贴到这里，支持第三方Key' : 'Paste API Key here, support Third-party Key.' "> <button @click=checkAPIbtn :disabled=btnDisabledState_CheckAPI class=btn :class="{ 'redbtn': !btnDisabledState_CheckAPI }" style="border-radius:0 6px 6px 0;margin-left:-3px">{{apibtntext}}</button> <button @click=sendRequest_or_restoreApiKeyInput class=btn :class="{ 'redbtn': !btnDisabledState_CheckAPI }" :style="{ padding: !btnDisabledState_CheckAPI ? '0 4px' : '0 8px' }" :title="settingsLanguage == 'cn' ? (btnDisabledState_CheckAPI ? '查询OpenAI API余额' : '取消修改 并恢复API Key') : (btnDisabledState_CheckAPI ? 'Check OpenAI API balances' : 'Cancel and Restore API Key')"> <div :style="{ display: btnDisabledState_CheckAPI ? 'flex' : 'none' }"> <svg xmlns=http://www.w3.org/2000/svg width=21px height=20px viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.75 stroke-miterlimit=10> <circle cx=9.5106 cy=9.42613 r=7.64 /> <path d="m6.6506,12.28613l3.34,0a1.43,1.43 0 0 0 1.43,-1.43l0,0a1.43,1.43 0 0 0 -1.43,-1.43l-0.95,0a1.44,1.44 0 0 1 -1.39,-1.44l0,0a1.44,1.44 0 0 1 1.44,-1.43l3.34,0"/> <line x1=9.5106 x2=9.5106 y1=4.64613 y2=6.55613 /><line x1=9.5106 x2=9.5106 y1=12.28613 y2=14.19613 /><line transform="rotate(90 18.2202 18.6877)" x1=14.70164 x2=21.73886 y1=22.20633 y2=15.16912 /> </svg> </div> <div :style="{ display: btnDisabledState_CheckAPI ? 'none' : 'flex' }"> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round> <circle cx=12 cy=12 r=10></circle> <line x1=15 y1=9 x2=9 y2=15></line> <line x1=9 y1=9 x2=15 y2=15></line> </svg> </div> </button> </div> </div> <div class="panelgroup panelgroup-shadow"> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? 'API设置' : 'API Settings' }}</span> <button @click="showMiniHelp('A-APISettings')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:auto :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <button @click="showMiniHelp('A-SmartMaxTokens')" class="btn minibtn orangeredbtn btnzoom-c" style=width:12px;height:12px :style="{ display: openSmartMaxTokens  ? 'block' : 'none', marginRight: settingsLanguage == 'cn' ? '-7px' : '-9px'}" :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <select @change=changeSmartMaxTokens class="dropdown minibtn minibtn-default btnzoom-d" :class="{ 'orangereddropdown': openSmartMaxTokens }" v-model=openSmartMaxTokens :style="{ marginRight: settingsLanguage == 'cn' ? '-9px' : '-13px'}" :title="settingsLanguage == 'cn' ? '当前[Smart max_tokens]状态' : 'Current [Smart max_tokens] Status'"> <option v-if="settingsLanguage == 'cn'" v-for="option in smartMaxTokensOptions_cn" :value=option.state>{{ option.label }}</option> <option v-else v-for="option in smartMaxTokensOptions_en" :value=option.state>{{ option.label }}</option> </select> <button @click=restoreDefault_APISettings class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}" :title="settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default'">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button> </div> <div class=panelrow style=align-items:start;height:auto> <div class=control-container style=width:108px;flex-shrink:0> <div> <span>temperature: {{apitemperature}}</span> </div> <div class=control-bg> <input @change=changeTemperature type=range class=slider v-model.number=apitemperature min=0.0 max=2.0 step=0.1 value=0.7> </div> </div> <div class=control-container style="flex:1 1 0%"> <div> <span>max_tokens(</span><span style=margin-left:0;font-weight:500>1~{{ gptModelList.find(model => model.modelname === apiGPTModel) ? gptModelList.find(model => model.modelname === apiGPTModel).maxtokens : 4096 }}</span><span style=margin-left:0>): {{apiMaxTokens}}</span> </div> <div class=control-bg> <input @change=changeMaxTokens type=range :disabled=openSmartMaxTokens class=slider v-model.number=apiMaxTokens min=1 :max=" gptModelList.find(model => model.modelname === apiGPTModel) ? gptModelList.find(model => model.modelname === apiGPTModel).maxtokens : 4096 " step=1 value=2048> </div> </div> </div> <div class=panelrow style=align-items:start;height:auto> <div class=control-container style=flex-shrink:0 :style="{ width: apiGPTModel === 'pai-001-light-beta' ? '178px' : '156px'}"> <div> <span>model: {{apiGPTModel}}</span> </div> <select @change=changeGPTModel class=dropdown v-model=apiGPTModel style=width:100%;height:24px> <option v-for="model in gptModelList" :value=model.modelname>{{ model.alias ? model.alias : model.modelname }}</option> </select> </div> <div class=control-container style="flex:1 1 0%"> <div> <span :title="settingsLanguage == 'cn' ? 'max_tokens (1~300)' : 'max_tokens (1~300)'">{{ settingsLanguage == 'cn' ? 'max_tokens(微调)' : 'max_tokens(Fine)' }}</span> </div> <div class=control-bg> <input @change=changeMaxTokens type=range :disabled=openSmartMaxTokens class=slider v-model.number=apiMaxTokens min=1 max=600 step=1 value=2048> </div> </div> <div class=control-container> <div> <span>{{ settingsLanguage == 'cn' ? ' 更多' : ' More' }}</span> </div> <button @click=showProConfig class="btn bluebtn btnzoom-c" :class="{ 'orangereddropdown': ( inputApiURL.toLowerCase().trim() !== OpenAI_API_URL ) }" style="margin:0;padding:0 4px" :title="settingsLanguage == 'cn' ? '显示更多专业设置' : 'Show more Pro settings'"> <div> PRO </div> </button> </div> </div> </div> <div class="panelgroup panelgroup-shadow" :style="{ display: isShowProConfig ? 'block' : 'none'}"> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? 'API专业设置' : 'Professional API Settings' }}</span> <button @click="showMiniHelp('A-ProfessionalAPISettings')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:auto :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <button @click=loadThirdPartyPaidAPIs class="btn minibtn minibtn-default btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-7.5px' : '-10px', display: settingsLanguage == 'cn' ? 'block' : 'none' }" :title="isLoadThirdPartyPaidAPIs ? (settingsLanguage == 'cn' ? '隐藏第三方代理平台' : 'Hide 3rd-party APIs') : (settingsLanguage == 'cn' ? '显示第三方代理平台' : 'Show 3rd-party APIs')"> {{ isLoadThirdPartyPaidAPIs ? (settingsLanguage == 'cn' ? '隐藏第三方代理平台' : 'Hide 3rd-party APIs') : (settingsLanguage == 'cn' ? '显示第三方代理平台' : 'Show 3rd-party APIs') }} </button> <button @click=restoreDefault_ProfessionalAPISettings class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}" :title="settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default'">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button> </div> <div class=panelrow style=align-items:start;height:auto> <span style=line-height:25px;font-size:12px;flex-shrink:0 :title="settingsLanguage == 'cn' ? 'API URL (API Endpoint)' : 'API Endpoint'"> {{ settingsLanguage == 'cn' ? '接口网址 :' : 'API URL :' }} </span> <input @input=inputApiURLChange v-model=inputApiURL class=dh-input style="border-radius:6px 0 0 6px" :placeholder="settingsLanguage == 'cn' ? '清空后保存 可重置为OpenAI官方接口' : 'Clear and save, can be reset to OpenAI API endpoint.' "> <button @click=saveApiURL :disabled=btnDisabledState_SaveApiURL class=btn style="border-radius:0 6px 6px 0;margin-left:-3px"> {{ settingsLanguage == 'cn' ? '保存' : 'Save' }} </button> <select @change=updateInputApiURL :disabled=btnDisabledState_ApiURL class=dropdown v-model=selectedApiURL :class="{ 'orangereddropdown': ( !btnDisabledState_ApiURL && inputApiURL.toLowerCase().trim() !== OpenAI_API_URL ) }" :style="{ width: selectedApiURL === '' ? '31px' : (  settingsLanguage == 'cn' ? (selectedApiURL === apiURLOptions_en[0]['url'] ? '46px' : '57px') : (selectedApiURL === apiURLOptions_en[0]['url'] ? '63px' : '71px')  )  }" :title="settingsLanguage == 'cn' ? '接口URL选项 (可选)' : 'Endpoint Options (Optional)'"> <option disabled value="">▼&nbsp;{{ settingsLanguage == 'cn' ? '预设选项：GPT官方接口 和 第三方接口(来源于网络)' : 'Pre-set options: OpenAI API and Third-party APIs (Internet resources)' }}</option> <option v-if="settingsLanguage == 'cn'" v-for="option in apiURLOptions_cn" :value=option.url>{{ option.label }}</option> <option v-else v-for="option in apiURLOptions_en" :value=option.url>{{ option.label }}</option> <option v-if=" !isLoadThirdPartyPaidAPIs" disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 第三方接口来源网络，无法保证隐私安全和实效性' : ' - Third-party APIs can be unsafe or unreliable' }}</option> <option v-if=!isSimpleMode disabled value=help2>{{ settingsLanguage == 'cn' ? ' - 使用第三方接口时，颜色会出现变化' : ' - The colors will change when using third-party APIs' }}</option> <option v-if=isLoadThirdPartyPaidAPIs disabled value=help4>{{ settingsLanguage == 'cn' ? '***以下为收集自网络的付费代理API资源，需在各平台注册，涉及支付' : '***以下为收集自网络的付费代理API资源，需在各平台注册，涉及支付' }}</option> <option v-if=isLoadThirdPartyPaidAPIs disabled value=help5>{{ settingsLanguage == 'cn' ? '***请注意保护隐私和增强反诈意识，预防信息泄露和平台倒闭等情况' : '***请注意保护隐私和增强反诈意识，预防信息泄露和平台倒闭等情况' }}</option> <option v-if=isLoadThirdPartyPaidAPIs v-for="option in apiURLOptions_LoadThirdPartyPaidAPIs" :value=option.url>{{ option.label }}</option> </select> </div> <div class=panelrow style=align-items:start;height:auto> <div class=control-container style="flex:1 1 0%"> <div> <span style=font-size:11px>top_p: {{apiTopP}}</span> </div> <div class=control-bg> <input @change=changeTopP type=range class=slider v-model.number=apiTopP min=0.0 max=1 step=0.1 value=1> </div> </div> <div class=control-container style="width:48%;flex:1 1 15%"> <div> <span style=font-size:11px>presence_penalty: {{apiPresencePenalty}}</span> </div> <div class=control-bg> <input @change=changePresencePenalty type=range class=slider v-model.number=apiPresencePenalty min=-2.0 max=2.0 step=0.1 value=0> </div> </div> <div class=control-container style="width:48%;flex:1 1 15%"> <div> <span style=font-size:11px>frequency_penalty: {{apiFrequencyPenalty}}</span> </div> <div class=control-bg> <input @change=changeFrequencyPenalty type=range class=slider v-model.number=apiFrequencyPenalty min=-2.0 max=2.0 step=0.1 value=0> </div> </div> </div> </div> <div class="panelgroup panelgroup-shadow"> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? '常规设置' : 'General Settings' }}</span> <button @click="showMiniHelp('A-GeneralSettings')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:auto :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <div style=margin-right:-7px> <svg width=22 height=22 :fill="(pageScaling === '0.8' || pageScaling === '0.80') ? '#25ad24' : '#f44400'" viewBox="0 0 32 32" xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg xmlns:se=http://svg-edit.googlecode.com> <path d="m22,29l-12,0a3,3 0 0 1 -3,-3l0,-20a3,3 0 0 1 3,-3l12,0a3,3 0 0 1 3,3l0,20a3,3 0 0 1 -3,3zm-12,-24a1,1 0 0 0 -1,1l0,20a1,1 0 0 0 1,1l12,0a1,1 0 0 0 1,-1l0,-20a1,1 0 0 0 -1,-1l-12,0z" id=svg_1 /> <path d="m18,7l-4,0a2,2 0 0 1 -2,-2l0,-1a1,1 0 0 1 1,-1l6,0a1,1 0 0 1 1,1l0,1a2,2 0 0 1 -2,2zm-4,-2l0,0z"/> </svg> </div> <select @change=changePageScaling(true) class="dropdown minibtn minibtn-default btnzoom-b" v-model=selectedPageScaling :class="{ 'orangereddropdown': !(pageScaling === '0.8' || pageScaling === '0.80') }" :style="{ marginRight: settingsLanguage == 'cn' ? '-4px' : '-7px', width: settingsLanguage == 'cn' ? '64px' : '90px' }" :title="settingsLanguage == 'cn' ? '更改页面缩放比例 (移动端)' : 'Change Page Scaling (Mobile)'"> <option disabled value="">{{ settingsLanguage == 'cn' ? '页面缩放' : 'Page Scaling' }}</option> <option disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 当前缩放为 ' + (parseFloat(this.pageScaling) * 100).toFixed(0) + '%，默认的缩放设置是 80%' : ' - Current scaling is ' + (parseFloat(this.pageScaling) * 100).toFixed(0) + '%, and default scaling is 80%' }}</option> <option disabled value=help2>{{ settingsLanguage == 'cn' ? ' - 仅支持移动设备，电脑端不会进行缩放' : ' - Only mobile devices are supported, and there will be no scaling on desktop' }}</option> <option v-for="option in selectedPageScalingOptions" :value=option>{{ option }}</option> </select> <button @click=restoreDefault_GeneralSettings class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}" :title="settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default'">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button> </div> <div class=panelrow style=align-items:start;height:auto;flex-wrap:wrap;justify-content:stretch> <div class=control-container style="min-width:110px;max-width:210px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '记忆模式' : 'Contextual Mode' }}</span> </div> <select @change=changeContextualMode :disabled=btnDisabledState_ContextualMode class=dropdown v-model=settingsContextualMode style=width:100%;height:24px :class="{ 'orangereddropdown': !Number.isInteger(settingsContextualMode) ? false : settingsContextualMode === 0 ? false : btnDisabledState_ContextualMode ? false : true }"> <option v-if=!isSimpleMode disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 记忆: 即"上下文"。每次一问一答会产生 2 条记忆' : " - Every 2 context messages correspond to each Q&A session." }}</option> <option disabled value=help2>{{ settingsLanguage == 'cn' ? ' - 设置[记忆上限]，达到后，会在发送新消息时自动清除之前全部记忆' : " - [Limit]: The context will be automatically cleared after reaching the limit." }}</option> <option disabled value=help3>{{ settingsLanguage == 'cn' ? ' - 设置[保留最后xx条记忆]，会始终保持记忆为最新的xx条历史消息 *待开发' : " - [Keep Last]: Always keep the last ** number of messages as the context. *To be developed" }}</option> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsContextualModeOptions_cn" :value=option.mode>{{ option.label }}</option> <option v-else v-for="option in settingsContextualModeOptions_en" :value=option.mode>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:80px;max-width:180px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? 'Language &#127464;&#127475;' : '语言 &#x1F1EC;&#x1F1E7;' }}</span> </div> <select @change=changeLanguage :disabled=btnDisabledState_Language class=dropdown v-model=settingsLanguage style=width:100%;height:24px> <option v-for="option in settingsLanguageOptions" :value=option.lang>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:65px;max-width:165px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '字体大小' : 'Font Size' }}</span> </div> <select @change=changeStyle_FontSize class=dropdown v-model=settingsFontSize style=width:100%;height:24px> <option disabled value="">{{ settingsLanguage == 'cn' ? ' - 避免在文本过多的对话中进行更改，以免导致网页崩溃' : " - To avoid crashes, don't make changes in chats with excessive content" }}</option> <option v-for="option in settingsFontSizeOptions" :value=option.fontsize>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:125px;max-width:225px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '仿微信时间' : 'Time (WeChat style)' }}</span> </div> <select @change=changeStyle_Time_WechatStyle class=dropdown v-model=settingsTime_WechatStyle style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsTimeWechatStyleOptions_cn" :value=option.displaytime>{{ option.label }}</option> <option v-else v-for="option in settingsTimeWechatStyleOptions_en" :value=option.displaytime>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:105px;max-width:205px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '消息时间' : 'Time (Message)' }}</span> </div> <select @change=changeStyle_Time class=dropdown v-model=settingsTime_Message style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsTimeMessageOptions_cn" :value=option.displaytime>{{ option.label }}</option> <option v-else v-for="option in settingsTimeMessageOptions_en" :value=option.displaytime>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:125px;max-width:225px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '记忆分割线' : 'Context Divider Line' }}</span> </div> <select @change=changeStyle_DividerLine class=dropdown v-model=settingsDividerLine style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsDividerLineOptions_cn" :value=option.displaydividerline>{{ option.label }}</option> <option v-else v-for="option in settingsDividerLineOptions_en" :value=option.displaydividerline>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:150px;max-width:260px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '[Key 模式] 快捷键' : '[Key Mode] Shortcut' }}</span> </div> <select class=dropdown v-model=settingsShortcut_CheckApiKey style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutCheckApiKeyOptions_cn" :value=option.shortcut>{{ option.label }}</option> <option v-else v-for="option in settingsShortcutCheckApiKeyOptions_en" :value=option.shortcut>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:140px;max-width:250px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '[清除记忆] 快捷键' : '[Clear Context] Shortcut' }}</span> </div> <select class=dropdown v-model=settingsShortcut_Clear style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutClearOptions_cn" :value=option.shortcut>{{ option.label }}</option> <option v-else v-for="option in settingsShortcutClearOptions_en" :value=option.shortcut>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:95px;max-width:195px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '[撤销] 快捷键' : '[Undo] Shortcut' }}</span> </div> <select class=dropdown v-model=settingsShortcut_Undo style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutUndoOptions_cn" :value=option.shortcut>{{ option.label }}</option> <option v-else v-for="option in settingsShortcutUndoOptions_en" :value=option.shortcut>{{ option.label }}</option> </select> </div> <div class=control-container style="min-width:95px;max-width:195px;flex:1 1 0%;margin:0 3px"> <div> <span>{{ settingsLanguage == 'cn' ? '[重问] 快捷键' : '[Retry] Shortcut' }}</span> </div> <select class=dropdown v-model=settingsShortcut_Retry style=width:100%;height:24px> <option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutRetryOptions_cn" :value=option.shortcut>{{ option.label }}</option> <option v-else v-for="option in settingsShortcutRetryOptions_en" :value=option.shortcut>{{ option.label }}</option> </select> </div> </div> <div class=panelrow style=height:36px> <select class=dropdown v-model=selectedImageUrl @change="updateSelectedImage('user')" :style="{ width: settingsLanguage == 'cn' ? '72px' : '87px' }" style=flex-shrink:0;height:24px;margin-right:4px;margin-left:3px :title="settingsLanguage == 'cn' ? '用户头像选项 (可选)' : 'User Avatar Options (Optional)'"> <option value="">{{ settingsLanguage == 'cn' ? '用户头像' : 'User Avatar' }}</option> <option v-if=!isSimpleMode disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 支持多种方式更改头像，点击面板[?]了解更多' : ' - Offering multiple options to change avatars. Click the panel [?] to learn more' }}</option> <option value=uploadimage>{{ settingsLanguage == 'cn' ? ' - 点击右侧头像 可上传图片' : ' - Click the Avatar on the right to upload an image' }}</option> <option :value=userAvatarUp_blobUrl>{{ settingsLanguage == 'cn' ? (userAvatarUp_blobUrl == '' ? '1) 最近上传的用户头像 (您还没上传小于350KB的头像)' : '1) 最近上传的用户头像 (可用)') : (userAvatarUp_blobUrl == '' ? '1) Uploaded User Avatar (No uploaded avatar within 350KB)' : '1) Uploaded User Avatar (Available)') }}</option> <option v-if="settingsLanguage == 'cn'" v-for="image in userpresetImages_cn" :value=image.url>{{ image.name }}</option> <option v-else v-for="image in userpresetImages_en" :value=image.url>{{ image.name }}</option> </select> <span style=line-height:25px;font-size:12px;flex-shrink:0 :title="settingsLanguage == 'cn' ? '或手动输入网络图片网址/本地图片路径' : 'or Manually Enter Image URL / Local Image Path'">{{ settingsLanguage == 'cn' ? '或 URL:' : 'or URL' }}</span> <input v-model=inputUserImageUrl @input="inputImageUrlChange('user')" class=dh-input style="flex:1 1 0%;border-radius:6px 0 0 6px" :placeholder="settingsLanguage == 'cn' ? '输入图片的网址（本地运行.html网页时支持电脑中图片的本地路径）' : 'Image URL. (Local image paths are supported when running *.html from PC/Mac.)' "> <button @click="updateAvatar('user')" :disabled=btnDisabledState_updateUserImageUrl class=btn :style="{ width: settingsLanguage == 'cn' ? '68px' : '85px' }" style="flex-shrink:0;border-radius:0 6px 6px 0;margin-left:-3px;margin-right:4px" :title="settingsLanguage == 'cn' ? '可选: 在修改图片网址后 点击更换' : 'Optional: Click Update after modifying the image URL'">{{ settingsLanguage == 'cn' ? '更换 >>' : 'Update >>' }}</button> <div id=div-upload-userAvataror class="chat-img chat-img-bg chat-img-border update-img-size btnzoom-a" :title="settingsLanguage == 'cn' ? '可选: 点击上传我的头像' : 'Optional: Click to upload my avatar'"> <img :src=userAvatarURL> </div> </div> <div class=panelrow style=height:35px> <select class=dropdown v-model=selectedImageUrl @change="updateSelectedImage('gpt')" :style="{ width: settingsLanguage == 'cn' ? '72px' : '87px' }" style=flex-shrink:0;height:24px;margin-right:4px;margin-left:3px :title="settingsLanguage == 'cn' ? 'GPT头像选项 (可选)' : 'GPT Avatar Options (Optional)'"> <option value="">{{ settingsLanguage == 'cn' ? 'GPT头像' : 'GPT Avatar' }}</option> <option v-if=!isSimpleMode disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 支持多种方式更改头像，点击面板[?]了解更多' : ' - Offering multiple options to change avatars. Click the panel [?] to learn more' }}</option> <option value=uploadimage>{{ settingsLanguage == 'cn' ? ' - 点击右侧头像 可上传图片' : ' - Click the Avatar on the right to upload an image' }}</option> <option v-if="settingsLanguage == 'cn'" v-for="image in gptpresetImages_cn" :value=image.url>{{ image.name }}</option> <option v-else v-for="image in gptpresetImages_en" :value=image.url>{{ image.name }}</option> </select> <span style=line-height:25px;font-size:12px;flex-shrink:0 :title="settingsLanguage == 'cn' ? '或手动输入网络图片网址/本地图片路径' : 'or Manually Enter Image URL / Local Image Path'">{{ settingsLanguage == 'cn' ? '或 URL:' : 'or URL' }}</span> <input v-model=inputGPTImageUrl @input="inputImageUrlChange('gpt')" class=dh-input style="flex:1 1 0%;border-radius:6px 0 0 6px" :placeholder="settingsLanguage == 'cn' ? '输入图片的网址（本地运行.html网页时支持电脑中图片的本地路径）' : 'Image URL. (Local image paths are supported when running *.html from PC/Mac.)' "> <button @click="updateAvatar('gpt')" :disabled=btnDisabledState_updateGPTImageUrl class=btn :style="{ width: settingsLanguage == 'cn' ? '68px' : '85px' }" style="flex-shrink:0;border-radius:0 6px 6px 0;margin-left:-3px;margin-right:4px" :title="settingsLanguage == 'cn' ? '可选: 在修改图片网址后 点击更换' : 'Optional: Click Update after modifying the image URL'">{{ settingsLanguage == 'cn' ? '更换 >>' : 'Update >>' }}</button> <div id=div-upload-gptAvataror class="chat-img chat-img-bg chat-img-border update-img-size btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'none' : 'flex' }" :title="settingsLanguage == 'cn' ? '可选: 点击上传GPT头像' : 'Optional: Click to upload GPT avatar'"> <img :src=gptAvatarURL> </div> <div id=div-upload-gptAvataror-SVG class="chat-img chat-img-border chat-green-svg update-img-size btnzoom-a" :style="{ display: isgptGreenSvgShow  ? 'flex' : 'none' }" :title="settingsLanguage == 'cn' ? '可选: 点击上传GPT头像' : 'Optional: Click to upload GPT avatar'"> <svg width=27 height=27 viewBox="0 0 41 41" fill=none xmlns=http://www.w3.org/2000/svg stroke-width=1.5 role=img> <path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill=currentColor> </path></svg> </div> </div> </div> <div class="panelgroup panelgroup-shadow"> <div class=panelrow style=align-items:center;height:auto;flex-wrap:wrap;justify-content:stretch> <div class=control-container style="flex:1 1 0%" :style="{ minWidth: settingsLanguage == 'cn' ? '119px' : '129px',maxWidth: settingsLanguage == 'cn' ? '179px' : '199px' }"> <div> <span>{{ settingsLanguage == 'cn' ? '对话列表' : 'Chat List' }}</span> <button @click="showMiniHelp('C-ChatList')" class="btn minibtn bluebtn btnzoom-b" :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> </div> <button @click=clickOpenChatList class="btn bluebtn" style="width:100%;margin:2px 0 4px 0;justify-content:start"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path> </svg>&nbsp;{{ settingsLanguage == 'cn' ? '打开对话列表' : 'Open Chat List' }} </button> </div> <div class=control-container style="flex:1 1 0%" :style="{ minWidth: settingsLanguage == 'cn' ? '130px' : '179px',maxWidth: settingsLanguage == 'cn' ? '190px' : '239px' }"> <div> <span>{{ settingsLanguage == 'cn' ? '提示词窗口' : 'Prompt Generator' }}</span> </div> <button @click=clickOpenPromptGenerator class="btn bluebtn" style="width:100%;margin:2px 0 4px 0;justify-content:start"> <svg xmlns=http://www.w3.org/2000/svg width=15 height=15 viewBox="0 0 24 24" fill=currentColor stroke=currentColor stroke-width=0.6 stroke-linecap=round stroke-linejoin=round> <path d="M19.7,23.5H4.3c-2.1,0-3.8-1.7-3.8-3.8V4.3c0-2.1,1.7-3.8,3.8-3.8h15.3c2.1,0,3.8,1.7,3.8,3.8v15.3    C23.5,21.8,21.8,23.5,19.7,23.5z M4.3,1.5c-1.6,0-2.8,1.3-2.8,2.8v15.3c0,1.6,1.3,2.8,2.8,2.8h15.3c1.6,0,2.8-1.3,2.8-2.8V4.3    c0-1.6-1.3-2.8-2.8-2.8H4.3z"/> <path d="M10.4,19.2H7.3c-0.3,0-0.5-0.2-0.5-0.5V5.3c0-0.3,0.2-0.5,0.5-0.5h9.3c0.3,0,0.5,0.2,0.5,0.5v8.5c0,0.3-0.2,0.5-0.5,0.5    h-5.7v4.4C10.9,19,10.7,19.2,10.4,19.2z M7.8,18.2h2.1v-4.4c0-0.3,0.2-0.5,0.5-0.5h5.7V5.8H7.8V18.2z M13.6,11.2h-3.2    c-0.3,0-0.5-0.2-0.5-0.5V8.4c0-0.3,0.2-0.5,0.5-0.5h3.2c0.3,0,0.5,0.2,0.5,0.5v2.3C14.1,11,13.9,11.2,13.6,11.2z M10.9,10.2h2.2    V8.9h-2.2V10.2z"/> </svg>&nbsp;{{ settingsLanguage == 'cn' ? '打开提示词窗口' : 'Open Prompt Generator' }} </button> </div> <div class=control-container style="flex:1 1 0%" :style="{ minWidth: settingsLanguage == 'cn' ? '130px' : '179px' }"> <div> <span>{{ settingsLanguage == 'cn' ? '导出聊天记录/日志' : 'Export Chat History / Logs' }}</span> <button @click="showMiniHelp('A-ExportChatHistory')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:auto :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> </div> <select @change=changeSelectedExportChatHistory :disabled=btnDisabledState_Export class=dropdown v-model=selectedExportChatHistory style="width:100%;height:25px;margin:2px 0 4px"> <option value="">{{ settingsLanguage == 'cn' ? '当前对话ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 18 ? (this.chatid.toString().slice(0, 18) + " ...") : this.chatid.toString().slice(0, 18)) ) : 'Current Chat ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 18 ? (this.chatid.toString().slice(0, 18) + " ...") : this.chatid.toString().slice(0, 18)) ) }}</option> <option disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 导出当前对话的文本内容' : ' - Export the text content of the current chat' }}</option> <option v-if="settingsLanguage == 'cn'" v-for="option in selectedExportChatHistoryOptions_cn" :value=option.type>{{ option.label }}</option> <option v-else v-for="option in selectedExportChatHistoryOptions_en" :value=option.type>{{ option.label }}</option> <option v-if=!isSimpleMode disabled value=help2>{{ settingsLanguage == 'cn' ? ' - 导出为纯文本，不可用于导入' : ' - Export to Plain Text, Not available for import' }}</option> <option v-if=!isSimpleMode disabled value=help3>{{ settingsLanguage == 'cn' ? ' - 文本内容使用Markdown格式' : ' - Plain text is formatted using Markdown syntax' }}</option> </select> </div> </div> </div> <div class="panelgroup panelgroup-shadow"> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? '数据管理与隐私 ' : 'Data Privacy and Management ' }}</span> <button @click="showMiniHelp('A-DataPrivacyAndManagement')" class="btn minibtn bluebtn btnzoom-b" :class="{ 'orangeredbtn': (isLocalStorageSupported && !isSimpleMode) ,'redbtn': !isLocalStorageSupported }" :style="{ marginRight: isLocalStorageSupported ? '2px' : '2px' }" :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <span :style="{ color: isLocalStorageSupported ? '#f94000' : '#fa1e0a'}" style=display:block;margin-right:auto;font-size:12px>{{ isLocalStorageSupported ? ( isSimpleMode ? '' : (settingsLanguage == 'cn' ? '已启用自动保存，用户数据仅存储在浏览器的缓存中' : "Autosave has been enabled. User data is stored solely in the browser's local storage.") ) : (settingsLanguage == 'cn' ? '自动保存不可用，当前浏览器或浏览器模式不支持"浏览器本地存储"' : 'Autosave is not available. LocalStorage is not supported in this browser or browser mode.') }}</span> </div> <div class=panelrow style=align-items:start;height:auto;flex-wrap:wrap;justify-content:stretch> <select @change=changeSelectedDeleteLocalStorageData class=dropdown v-model=selectedDeleteLocalStorageData style="width:auto;height:24px;flex:1 1 0%;margin:4px 3px 1px 0" :style="{ minWidth: settingsLanguage == 'cn' ? '71px' : '85px' }"> <option value="">{{ settingsLanguage == 'cn' ? '删除数据' : 'Delete Data' }}</option> <option v-if=!isSimpleMode disabled value=help>{{ settingsLanguage == 'cn' ? ' - 谨慎操作，数据删除不可逆' : ' - The deletion of data is irreversible' }}</option> <option v-if="settingsLanguage == 'cn'" v-for="option in selectedDeleteLocalStorageDataOptions_cn" :value=option.type>{{ option.label }}</option> <option v-else v-for="option in selectedDeleteLocalStorageDataOptions_en" :value=option.type>{{ option.label }}</option> </select> <select @change=changeSelectedExportLocalStorageData :disabled=!isLocalStorageSupported class=dropdown v-model=selectedExportLocalStorageData style="width:auto;height:24px;flex:1 1 0%;margin:4px 3px 1px 3px" :style="{ minWidth: settingsLanguage == 'cn' ? '86px' : '95px' }"> <option value="">{{ settingsLanguage == 'cn' ? '导出 (.json)' : 'Export (.json)' }}</option> <option v-if=!isSimpleMode disabled value=help1>{{ settingsLanguage == 'cn' ? ' - 导出的JSON文件，可再次导入到TAKGPT' : ' - Export as JSON File for Re-import into TAKGPT' }}</option> <option v-if=!isSimpleMode disabled value=help2>{{ settingsLanguage == 'cn' ? ' - 用途：迁移数据、分享给他人、备份数据' : ' - Use: Data Transfer, Share with Others, Backup' }}</option> <option v-if="settingsLanguage == 'cn'" v-for="option in selectedExportLocalStorageDataOptions_cn" :value=option.type>{{ option.label }}</option> <option v-else v-for="option in selectedExportLocalStorageDataOptions_en" :value=option.type>{{ option.label }}</option> <option v-if=!isSimpleMode disabled value=help3>{{ settingsLanguage == 'cn' ? ' - 只想导出单个对话，请在[对话列表]中点击[•••]' : ' - To export a single chat, click [•••] in [Chat List]' }}</option> <option v-if=!isSimpleMode disabled value=help4>{{ settingsLanguage == 'cn' ? ' - 浏览器兼容性问题会导致失败' : ' - Browser compatibility issues may cause failure' }}</option> </select> <button @click=importLocalStorageData :disabled=!isLocalStorageSupported class=btn style="justify-content:start;width:auto;height:24px;flex:1 1 0%;margin:4px 3px 1px 3px" :style="{ minWidth: settingsLanguage == 'cn' ? '87px' : '98px' }"> {{ settingsLanguage == 'cn' ? '导入 (.json)' : 'Import (.json)' }} </button> <button @click=getLocalStorageSize :disabled=!isLocalStorageSupported class=btn style="padding:0 4px;height:24px;line-height:24px;margin:4px 2px 1px 3px;min-width:23px" :title="settingsLanguage == 'cn' ? '用量统计' : 'Usage statistics'"> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M20.2 7.8l-7.7 7.7-4-4-5.7 5.7"/><path d="M15 7h6v6"/> </svg> </button> </div> </div> </div> </div> <div class=dialog-bottom> </div> </div> <div class=dialog-mask @click="isShowDialog_Settings = false"> </div> </div> <div id=dialog-promptgenerator class=dialog-wrapper v-show=isShowDialog_PromptGenerator> <div class=dialog style=width:95%;max-width:800px;max-height:680px> <div class=dialog-header> <div class=dialog-title> <svg xmlns=http://www.w3.org/2000/svg width=23 height=23 viewBox="0 0 24 24" fill=currentColor stroke=currentColor stroke-width=0.6 stroke-linecap=round stroke-linejoin=round> <path d="M19.7,23.5H4.3c-2.1,0-3.8-1.7-3.8-3.8V4.3c0-2.1,1.7-3.8,3.8-3.8h15.3c2.1,0,3.8,1.7,3.8,3.8v15.3    C23.5,21.8,21.8,23.5,19.7,23.5z M4.3,1.5c-1.6,0-2.8,1.3-2.8,2.8v15.3c0,1.6,1.3,2.8,2.8,2.8h15.3c1.6,0,2.8-1.3,2.8-2.8V4.3    c0-1.6-1.3-2.8-2.8-2.8H4.3z"/> <path d="M10.4,19.2H7.3c-0.3,0-0.5-0.2-0.5-0.5V5.3c0-0.3,0.2-0.5,0.5-0.5h9.3c0.3,0,0.5,0.2,0.5,0.5v8.5c0,0.3-0.2,0.5-0.5,0.5    h-5.7v4.4C10.9,19,10.7,19.2,10.4,19.2z M7.8,18.2h2.1v-4.4c0-0.3,0.2-0.5,0.5-0.5h5.7V5.8H7.8V18.2z M13.6,11.2h-3.2    c-0.3,0-0.5-0.2-0.5-0.5V8.4c0-0.3,0.2-0.5,0.5-0.5h3.2c0.3,0,0.5,0.2,0.5,0.5v2.3C14.1,11,13.9,11.2,13.6,11.2z M10.9,10.2h2.2    V8.9h-2.2V10.2z"/> </svg> {{ settingsLanguage == 'cn' ? '&nbsp;提示词&nbsp;' : '&nbsp;Prompt Generator&nbsp;' }} <button @click=changePromptGeneratorMaxWidth class="btn bluebtn" style="margin-right:7px;width:22px;padding:0 1px;height:20px" :title="settingsLanguage == 'cn' ? '更改最大宽度' : 'Change Maximum Width'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=2 /><path d="M3 9h18M9 21V9"/></svg> </div> </button> <button @click=changePromptGeneratorLayout class="btn bluebtn" style="margin-right:auto;margin-left:1px;width:22px;padding:0 1px;height:20px" :title="settingsLanguage == 'cn' ? '更改布局 (适用于移动设备)' : 'Change Layout (For Mobile)'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=2 /><path d="M9 3v18"/></svg> </div> </button> </div> <div class=dialog-close @click="isShowDialog_PromptGenerator = false" :title="settingsLanguage == 'cn' ? '关闭' : 'Close'"> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=fill:none;stroke:#333;stroke-width:2;stroke-linecap:round;stroke-linejoin:round> <path d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> <div class=dialog-scroll> <div class=dialog-content :style=styleDialogLayout> <div class=panelgroup> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? '当前系统提示词 ( system prompt )' : 'Current System Prompt' }} </span> <button @click="showMiniHelp('B-CurrentSystemPrompt')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:4px :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <span style=color:#f94000;display:block;margin-right:auto;font-size:12px>{{ settingsLanguage == 'cn' ? '对话ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 20 ? (this.chatid.toString().slice(0, 20) + " ...") : this.chatid.toString().slice(0, 20)) ) : 'Chat ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 20 ? (this.chatid.toString().slice(0, 20) + " ...") : this.chatid.toString().slice(0, 20)) ) }}</span> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=copySystemPromptToEditor class=btn style=margin-left:5px> {{ settingsLanguage == 'cn' ? '复制到编辑框' : 'Copy To Editor' }} </button> <button @click="changeElementHeight('textareaSPReadOnly')" class="btn bluebtn" style="width:25px;padding:0 2px;margin:0 5px" :title="settingsLanguage == 'cn' ? '快速切换高度' : 'Quick Height Toggle'"> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 32 32" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10> <path d="m28,30l-24,0c-1.1,0 -2,-0.9 -2,-2l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2z" id=svg_1></path> <line id=svg_2 x1=20 x2=20 y1=2 y2=30></line><polyline points="27,24 25,26 23,24 "></polyline><polyline points="23,8 25,6 27,8 "></polyline><line x1=6 x2=16 y1=9 y2=9></line><line x1=6 x2=12 y1=13 y2=13></line><line x1=6 x2=12 y1=17 y2=17></line> </svg> </button> <button @click="changeElementLineBreak('textareaSPReadOnly')" class="btn bluebtn" style="margin-right:auto;width:25px;padding:0 2px" :title="settingsLanguage == 'cn' ? '更改换行模式' : 'Change Wrap Mode'"> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 32 32" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10> <path d="m2,28l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2l-24,0c-1.1,0 -2,-0.9 -2,-2z" id=svg_1 /> <line x1=30 x2=2 y1=20 y2=20 /><polyline points="8,27 6,25 8,23 "/><polyline points="24,23 26,25 24,27 "/><line x1=6 x2=16 y1=9 y2=9 /><line x1=6 x2=12 y1=13 y2=13 /> </svg> </button> <button class=copybtn data-clipboard-nextelementsibling="" style="opacity:1;position:relative;flex-shrink:0;top:auto;right:auto;margin:0 5px 0 0" :title="settingsLanguage == 'cn' ? '一键复制' : 'One-Click Copy'"> <div> <svg width=14 height=17 class=clippy fill=currentColor> <path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z"> </path> </svg> </div> </button> <textarea readonly v-model=gptSystemPromptReadOnly type=text class="dh-input textareaSPReadOnly" style="flex:0 0 100%;margin:4px 0 0 0;height:100px;min-height:80px;max-height:1000px" placeholder=""></textarea> </div> </div> <div class=panelgroup> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? '提示词编辑区' : 'Prompt Editor' }}</span> <button @click="showMiniHelp('B-PromptEditor')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:auto :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=setSystemPrompt :disabled=btnDisabledState_SetSystemPrompt class=btn style=margin-left:5px> {{ settingsLanguage == 'cn' ? '保存为系统提示词' : 'Save as System Prompt' }} </button> <button @click="changeElementHeight('textareasystemprompt')" class="btn bluebtn" style="width:25px;padding:0 2px;margin:0 5px" :title="settingsLanguage == 'cn' ? '快速切换高度' : 'Quick Height Toggle'"> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 32 32" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10> <path d="m28,30l-24,0c-1.1,0 -2,-0.9 -2,-2l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2z" id=svg_1></path> <line id=svg_2 x1=20 x2=20 y1=2 y2=30></line><polyline points="27,24 25,26 23,24 "></polyline><polyline points="23,8 25,6 27,8 "></polyline><line x1=6 x2=16 y1=9 y2=9></line><line x1=6 x2=12 y1=13 y2=13></line><line x1=6 x2=12 y1=17 y2=17></line> </svg> </button> <button @click="changeElementLineBreak('textareasystemprompt')" class="btn bluebtn" style="margin-right:auto;width:25px;padding:0 2px" :title="settingsLanguage == 'cn' ? '更改换行模式' : 'Change Wrap Mode'"> <svg xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 32 32" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10> <path d="m2,28l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2l-24,0c-1.1,0 -2,-0.9 -2,-2z" id=svg_1 /> <line x1=30 x2=2 y1=20 y2=20 /><polyline points="8,27 6,25 8,23 "/><polyline points="24,23 26,25 24,27 "/><line x1=6 x2=16 y1=9 y2=9 /><line x1=6 x2=12 y1=13 y2=13 /> </svg> </button> <button class=copybtn data-clipboard-nextelementsibling="" style="opacity:1;position:relative;flex-shrink:0;top:auto;right:auto;margin:0 5px 0 0" :title="settingsLanguage == 'cn' ? '一键复制' : 'One-Click Copy'"> <div> <svg width=14 height=17 class=clippy fill=currentColor> <path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z"> </path> </svg> </div> </button> <textarea @input="btnDisabledState_SetSystemPrompt=false;" v-model=gptSystemPrompt type=text class="dh-input textareasystemprompt" style="flex:0 0 100%;margin:4px 0 0 0;height:100px;min-height:80px;max-height:1000px" :placeholder=" settingsLanguage == 'cn' ? '输入提示词，保存后生效。如需取消系统提示词，请清空输入框后点保存。' : 'Input prompt: Changes will take effect after saving. To cancel system prompt, clear the input field and save.' "></textarea> </div> </div> </div> </div> <div class=dialog-bottom> </div> </div> <div class=dialog-mask @click="isShowDialog_PromptGenerator = false"> </div> </div> <div id=dialog-ChatList class=dialog-wrapper v-show=isShowDialog_ChatList> <div class=dialog style=max-width:430px;width:95%;max-height:720px;background-color:#ededed> <div class=dialog-header> <div class=dialog-title style="width:calc(95% - 35px)"> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path> </svg> {{ settingsLanguage == 'cn' ? '&nbsp;对话列表&nbsp;' : '&nbsp;Chat List&nbsp;' }} <button @click="showMiniHelp('C-ChatList')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:8px :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <button @click=changeChatListMaxWidth class="btn bluebtn" style="margin-right:8px;width:22px;padding:0 1px;height:20px" :title="settingsLanguage == 'cn' ? '更改最大宽度' : 'Change Maximum Width'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=2 /><path d="M3 9h18M9 21V9"/></svg> </div> </button> <button @click=changeChatListTransparent class="btn bluebtn" style="margin-right:auto;width:22px;padding:0 1px;height:20px" :title="settingsLanguage == 'cn' ? '更改透明度' : 'Change Transparency'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=17 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx=12 cy=12 r=3></circle></svg> </div> </button> <button @click=chatList_addNewChatData(false) class=btn style="width:auto;padding:0 8px;height:20px;line-height:20px;border-radius:5px;font-size:13px;margin-left:8px;margin-right:10px"> <div> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M3 3h18v18H3zM12 8v8m-4-4h8"/> </svg> </div> {{ settingsLanguage == 'cn' ? '&nbsp;新对话&nbsp;' : '&nbsp;New Chat' }} </button> </div> <div class=dialog-close @click="isShowDialog_ChatList = false" :title="settingsLanguage == 'cn' ? '关闭' : 'Close'"> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=fill:none;stroke:#333;stroke-width:2;stroke-linecap:round;stroke-linejoin:round> <path d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> <div class=dialog-scroll> <div class=dialog-content> <div class=panelgroup v-for="chatdata in chatDataList" :key=chatdata.chatcreatedtime @click=chatList_ClickChatData(chatdata) :class="{'panelgroup-chatdata-selected': (chatdata.chatcreatedtime === selectedChatData.chatcreatedtime && !isChatListTransparent) ,'panelgroup-chatdata-selected-transparent':  (chatdata.chatcreatedtime === selectedChatData.chatcreatedtime && isChatListTransparent) }"> <div class=panelgroup-head> <span style=margin-right:auto :style="{ color: isChatListTransparent ? 'rgba(204, 204, 204, 0.3)' : '#444444' }">{{ (settingsLanguage == 'cn' ? '创建时间: ' : 'Creation Date: ') + (chatdata.chatcreatedtime === null ? (settingsLanguage == 'cn' ? '新对话' : 'New Chat') : (chatdata.chatcreatedtime.startsWith(current_Year) ? chatdata.chatcreatedtime.slice(5) : chatdata.chatcreatedtime) ) }}</span> <button class="btn minibtn" style="display:flex;width:auto;height:16px;padding:0;margin-right:0;border-radius:4px;cursor:auto;border:none!important;background:0 0!important" :style="{ color: isChatListTransparent ? 'rgba(204, 204, 204, 0.3)' : '#444444' , display: chatdata.chatcreatedtime === null ? 'none' : 'flex' }" :title="settingsLanguage == 'cn' ? '占用存储空间大小' : 'Storage Usage'"> <svg xmlns=http://www.w3.org/2000/svg width=12 height=13 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><ellipse cx=12 cy=5 rx=9 ry=3></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path> </svg> <span :style="{ color: isChatListTransparent ? 'rgba(204, 204, 204, 0.3)' : '#444444' }">{{ (JSON.stringify(chatdata).length * 2 / 1024 / 1024).toFixed(2)}} MB</span> </button> <button @click=gotoTop class="btn minibtn btnzoom-c" :style="{ display:  (chatdata.chatcreatedtime === null || chatdata.chatcreatedtime !== selectedChatData.chatcreatedtime)  ? 'none' : 'flex'}" style=width:18px;height:16px;padding:0;border-radius:4px :title="settingsLanguage == 'cn' ? '滚动到顶部' : 'Scroll to Top'"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M17 11l-5-5-5 5M17 18l-5-5-5 5"/> </svg> </button> <button @click=gotoBottom class="btn minibtn btnzoom-c" :style="{ display:  (chatdata.chatcreatedtime === null || chatdata.chatcreatedtime !== selectedChatData.chatcreatedtime)  ? 'none' : 'flex'}" style=width:18px;height:16px;padding:0;border-radius:4px;margin-left:1px :title="settingsLanguage == 'cn' ? '滚动到底部' : 'Scroll to Bottom'"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/> </svg> </button> <select @change=changeSelectedChatListMoreOptions(chatdata) class="dropdown minibtn minibtn-default btnzoom-c" v-model=selectedChatListMoreOptions :style="{ display: chatdata.chatcreatedtime === null  ? 'none' : 'block' }" style=width:31px :title="settingsLanguage == 'cn' ? '更多选项' : 'More Options'"> <option value="">•••</option> <option v-if="settingsLanguage == 'cn'" v-for="option in selectedChatListMoreOptions_Options_cn" :value=option.op>{{ option.label }}</option> <option v-else v-for="option in selectedChatListMoreOptions_Options_en" :value=option.op>{{ option.label }}</option> <option value=EraseLogs>5) {{ ( settingsLanguage == 'cn' ? '抹掉日志(Markdown格式, ≈' : 'Erase logs (Markdown, ≈' ) + (chatdata.chatVariables.chathistory.length * 2 / 1024 / 1024).toFixed(2) + 'MB)' }}</option> </select> <button @click=deleteChatData(chatdata) class="btn minibtn redbtn btnzoom-c" style=display:flex;width:16px;height:16px;padding:0;border-radius:4px :title="settingsLanguage == 'cn' ? '删除对话' : 'Delete Chat'"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=18 y1=6 x2=6 y2=18></line><line x1=6 y1=6 x2=18 y2=18></line> </svg> </button> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=chatList_EditChatID(chatdata) class="btn btnzoom-c" style="width:auto;padding:0 8px;background:0 0!important;color:#1aad19!important" :style="{ border: isChatListTransparent ? '1px solid rgba(221, 221, 221, 0.3) !important' : '1px solid #DDD !important' }" :title="settingsLanguage == 'cn' ? '对话ID' : 'Chat ID'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2.2 stroke-linecap=round stroke-linejoin=round><line x1=4 y1=9 x2=20 y2=9></line><line x1=4 y1=15 x2=20 y2=15></line><line x1=10 y1=3 x2=8 y2=21></line><line x1=16 y1=3 x2=14 y2=21></line> </svg> </div> <span style=color:#1aad19;font-size:13px>&nbsp;{{ chatdata.chatid }}</span> </button> <button disabled class=btn style="margin-right:auto;width:auto;padding:0 8px;cursor:auto;border:none!important;background:0 0!important" :style="{ display: chatdata.chatcreatedtime === null  ? 'none' : 'flex'}"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><polyline points="12 6 12 12 16 14"></polyline> </svg> </div> <span :style="{ color: isChatListTransparent ? 'rgba(204, 204, 204, 0.3)' : '#444444' }">&nbsp;{{ (settingsLanguage == 'cn' ? '上次活动时间: ' : 'Last Activity Time: ') + (chatdata.chatlasttime === null ? (settingsLanguage == 'cn' ? '新对话' : 'New Chat') : (chatdata.chatlasttime.startsWith(current_Year) ? chatdata.chatlasttime.slice(5) : chatdata.chatlasttime) ) }}</span> </button> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=chatList_EditChatTitle(chatdata) class="btn btnzoom-c" style="width:auto;padding:0 8px;background:0 0!important;color:#1aad19!important" :style="{ border: isChatListTransparent ? '1px solid rgba(221, 221, 221, 0.3) !important' : '1px solid #DDD !important' }" :title="settingsLanguage == 'cn' ? '对话标题 / 描述' : 'Chat Title / Description'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path><polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon> </svg> </div> <span :style="{ color: isChatListTransparent ? 'rgba(204, 204, 204, 0.3)' : (chatdata.chattitle == '' ? '#cccccc' : '#444444') }">&nbsp;{{ chatdata.chattitle == '' ? (settingsLanguage == 'cn' ? '尚未写描述' : 'No description yet.') : chatdata.chattitle }}</span> </button> </div> </div> </div> </div> <div class=dialog-bottom> </div> </div> <div class=dialog-mask @click="isShowDialog_ChatList = false"> </div> </div> <div id=dialog-AutoKeyRotation class=dialog-wrapper v-show=isShowDialog_AutoKeyRotation> <div class=dialog style=max-width:520px;width:90%;max-height:720px;background-color:#ededed> <div class=dialog-header> <div class=dialog-title style="width:calc(95% - 35px)"> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/> </svg> {{ !isThirdPartyAPIKeyEnabled ? (settingsLanguage == 'cn' ? '&nbsp;自动轮换API Key&nbsp;' : '&nbsp;Auto Key Rotation&nbsp;') : (settingsLanguage == 'cn' ? '&nbsp;第三方单Key模式&nbsp;' : '&nbsp;3rd party Key Mode&nbsp;') }} <button @click="showMiniHelp('D-AutoKeyRotation')" class="btn minibtn bluebtn btnzoom-b" style=margin-right:8px :title="settingsLanguage == 'cn' ? '功能说明' : 'Help'">?</button> <button @click=changeAutoKeyRotationSorted class="btn bluebtn" style="margin-right:auto;width:22px;padding:0 1px;height:20px" :title="settingsLanguage == 'cn' ? '三种排序方式以供查看' : 'Three ways to sort for viewing'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=19 height=18 viewBox="0 0 24 24" fill=currentColor><path d="M7 20h2V8h3L8 4 4 8h3zm13-4h-3V4h-2v12h-3l4 4z"/> </svg> </div> </button> <button @click=autoKeyRotation_BulkAdd class=btn :style="{ display: isThirdPartyAPIKeyEnabled ? 'none' : 'flex' }" style="width:auto;padding:0 8px;height:20px;line-height:20px;border-radius:px;font-size:13px;margin-left:8px;margin-right:10px"> <div> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=8 y1=6 x2=21 y2=6></line><line x1=8 y1=12 x2=21 y2=12></line><line x1=8 y1=18 x2=21 y2=18></line><line x1=3 y1=6 x2=3.01 y2=6></line><line x1=3 y1=12 x2=3.01 y2=12></line><line x1=3 y1=18 x2=3.01 y2=18></line> </svg> </div> {{ settingsLanguage == 'cn' ? '&nbsp;批量添加&nbsp;' : '&nbsp;Bulk Add' }} </button> </div> <div class=dialog-close @click="isShowDialog_AutoKeyRotation = false" :title="settingsLanguage == 'cn' ? '关闭' : 'Close'"> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=fill:none;stroke:#333;stroke-width:2;stroke-linecap:round;stroke-linejoin:round> <path d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> <div class=dialog-scroll> <div class=dialog-content> <div class=panelgroup style=margin-bottom:4px;margin-top:-10px;box-shadow:none> <div class=panelgroup-head style=display:none> <span>{{ settingsLanguage == 'cn' ? 'API Key类型' : 'API Key Types' }}</span> </div> <div class=panelrow style=color:#444;font-size:13px;align-items:end;height:auto;flex-wrap:wrap;justify-content:start> <label style=margin-right:24px> <input type=radio @change=changeIsThirdPartyAPIKeyEnabled :disabled=btnDisabledState_KeyMode v-model=isThirdPartyAPIKeyEnabled :value=false> {{ (settingsLanguage == 'cn' ? '使用 OpenAI 官方Key' : 'Use OpenAI API Keys') + ' (' + apiCheckedData.filter(data => data.vpn !== 'third-party').length + ')' }} </label> <label> <input type=radio @change=changeIsThirdPartyAPIKeyEnabled :disabled=btnDisabledState_KeyMode v-model=isThirdPartyAPIKeyEnabled :value=true> {{ (settingsLanguage == 'cn' ? '使用第三方代理专用Key' : 'Use Third-party Key') + ' (' + apiCheckedData.filter(data => data.vpn === 'third-party').length + ')' }} </label> </div> <div class=panelrow :style="{ display: isThirdPartyAPIKeyEnabled ? 'block' : 'none' }" style=line-height:14px;align-items:end;height:auto;flex-wrap:wrap> <span style=color:#f94000;font-size:11px> {{ settingsLanguage == 'cn' ? ' Tips：1) 当前为单Key模式，请在下方选择第三方接口的专用Key；2) 如何添加第三方Key？仅支持在 [设置] 中逐个添加，请先在 [更多] > [API专业设置] > [接口网址] 中设置第三方接口的URL，然后再验证Key，通过后，添加成功。 ' : ' Tips: 1) Currently in single-key mode, please select the key for the third-party API below. 2) How to add a third-party key? Only one key can be added at a time. First, modify [Settings] > [API URL] to the third-party API Endpoint. Then, fill in and check the third-party key. ' }} </span> <a :href="settingsLanguage == 'cn' ? 'https://lin2025.github.io/img/TAKGPT-sample01-cn.png' : 'https://lin2025.github.io/img/TAKGPT-sample01-en.png' " :style="{ display: apiCheckedData.filter(data => data.vpn === 'third-party').length < 2 ? 'inline' : 'none' }" target=_blank style=font-size:11px> {{ settingsLanguage == 'cn' ? '查看示例 (图)' : 'View Sample (pic)' }} </a> </div> <div class=panelrow :style="{ display: !isThirdPartyAPIKeyEnabled && !apiGPTModel.includes('gpt-4') ? 'block' : 'none' }" style=line-height:14px;align-items:end;height:auto;flex-wrap:wrap> <span style=color:#f94000;font-size:11px> {{ settingsLanguage == 'cn' ? ' Tips：1) 此模式仅支持OpenAI官方Key，请使用官方接口或支持官方Key的第三方接口(反代); 2) 支持GPT-4的标签是自动标记的; 3) API Key会自动分类，对于无法正确识别的第三方Key，可以点击[级别]输入"333"进行修正。' : ' Tips: 1) This mode only supports OpenAI API Keys, please use OpenAI API or Third-party APIs that support OpenAI keys. 2) Automatic tagging of GPT-4. 3) API Keys are automatically categorized. If a Third-party key is not recognized correctly, click [Level] to modify it.' }} </span> </div> <div class=panelrow :style="{ display: !isThirdPartyAPIKeyEnabled && apiGPTModel.includes('gpt-4') ? 'block' : 'none' }" style=line-height:14px;align-items:end;height:auto;flex-wrap:wrap> <span style=color:#f94000;font-size:11px> {{ settingsLanguage == 'cn' ? ' Tips：1) GPT-4标签为自动标记，无法手动添加或修改。2) 如何重新检测GPT-4权限？①手动修改[级别]为0 (付费账号)，允许Key进入GPT-4池并验证权限。②在[设置]中选择拥有权限的GPT-4模型。③进行几次对话。④当然，也可以直接删除Key后重新添加并使用GPT-4模型验证。' : ' Tips: 1) GPT-4 tags are automatically assigned and cannot be manually added or modified. 2) How to retest GPT-4 permissions for a regular Key: ① Set the [Level] to 0 (Paid Account) to allow calling and verified. ② Choose the authorized GPT-4 model in [Settings]. ③ Start chatting. (*Alternatively, you can delete and re-add the Key to validate using the GPT-4 model.)' }} </span> </div> </div> <div class=panelgroup :style="{ display: isShowBulkAddPanel_AutoKeyRotation && !isThirdPartyAPIKeyEnabled ? 'block' : 'none' }" style=margin-bottom:18px> <div class=panelgroup-head> <span>{{ settingsLanguage == 'cn' ? '批量添加 OpenAI API Key' : 'Bulk Add OpenAI API Keys' }}</span> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=submitBulkApiKeys(true,true,null) class=btn style=margin-left:5px> {{ settingsLanguage == 'cn' ? '提交' : 'Submit' }} </button> <button @click="isShowBulkAddPanel_AutoKeyRotation = false" class="btn redbtn" style=margin-left:5px;margin-right:auto> {{ settingsLanguage == 'cn' ? '取消' : 'Cancel' }} </button> <textarea type=text class="dh-input textareabulkaddapikey" style="font-size:13px;flex:0 0 100%;margin:4px 0 0 0;height:108px;min-height:55px;max-height:500px;white-space:pre" :placeholder=" settingsLanguage == 'cn' ? '输入以 &quot;sk-&quot; 开头的 API Key，每行一个。' : 'Enter API Keys starting with &quot;sk-&quot; , one per line.' "></textarea> </div> </div> <div class=panelgroup v-for="apidata in apiCheckedData" :key=apidata.apikey :style="{ display: (isThirdPartyAPIKeyEnabled && apidata.vpn === 'third-party') || (!isThirdPartyAPIKeyEnabled && apidata.vpn !== 'third-party') ? 'block' : 'none' }"> <div class=panelgroup-head> <span style="color:'#444444'">{{ settingsLanguage == 'cn' ? '更新时间: ' : 'Update Time: '}}</span> <span style=margin-right:auto :style="{color: apidata.updatetime === 0 ? '#0096b6' : '#444444' }">{{ apidata.updatetime === 0 ? (settingsLanguage == 'cn' ? '新密钥' : 'New API Key') : ( formatDateYYYYMMDDHHmmss(new Date(apidata.updatetime),':').startsWith(current_Year) ? formatDateYYYYMMDDHHmmss(new Date(apidata.updatetime),':').slice(5) : formatDateYYYYMMDDHHmmss(new Date(apidata.updatetime),':') ) }}</span> <button @click=useThirdPartyApiKey(apidata) class="btn minibtn btnzoom-c" :class="{'orangeredbtn': apidata.apikey === api.trim()  }" :style="{ display: isThirdPartyAPIKeyEnabled  ? 'flex' : 'none'}" style="width:auto;height:16px;padding:0 6px;border-radius:4px;margin-left:1px" :title="settingsLanguage == 'cn' ? '使用这个Key' : 'Use this Key'"> {{ apidata.apikey === api.trim() ? (settingsLanguage == 'cn' ? '正在使用' : 'In use') : (settingsLanguage == 'cn' ? '使用这个Key' : 'Use this Key') }} </button> <button @click=deleteApiData(apidata) class="btn minibtn redbtn btnzoom-c" style=display:flex;width:16px;height:16px;padding:0;border-radius:4px :title="settingsLanguage == 'cn' ? '删除API Key' : 'Delete Key'"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=18 y1=6 x2=6 y2=18></line><line x1=6 y1=6 x2=18 y2=18></line> </svg> </button> </div> <div class=panelrow style=align-items:end;height:auto;flex-wrap:wrap> <button @click=autoKeyRotation_EditLevel(apidata) class="btn btnzoom-c" style="width:auto;padding:0 8px;border:1px solid #ddd!important;background:0 0;color:#1aad19!important" :style="{ display: apidata.vpn === 'third-party' ? 'none' : 'flex' }" :title="settingsLanguage == 'cn' ? '级别' : 'Level'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=4 y1=21 x2=4 y2=14></line><line x1=4 y1=10 x2=4 y2=3></line><line x1=12 y1=21 x2=12 y2=12></line><line x1=12 y1=8 x2=12 y2=3></line><line x1=20 y1=21 x2=20 y2=16></line><line x1=20 y1=12 x2=20 y2=3></line><line x1=1 y1=14 x2=7 y2=14></line><line x1=9 y1=8 x2=15 y2=8></line><line x1=17 y1=16 x2=23 y2=16></line> </svg> </div> <span style=font-size:13px :style="{ color: apidata.level === null ? '#0096b6' : apidata.level === 8 ? '#f42828' : apidata.level === 9 ? '#ff7d0b' : '#1aad19' }">&nbsp;{{ apidata.level === null ? (settingsLanguage == 'cn' ? '等待验证' : 'Pending Check') : apidata.level === 0 ? (settingsLanguage == 'cn' ? '付费账号' : 'Paid Account') : apidata.level === 8 ? (settingsLanguage == 'cn' ? '无效密钥' : 'Invalid key') : apidata.level === 9 ? (settingsLanguage == 'cn' ? '超出配额' : 'Quota exceeded') : (settingsLanguage == 'cn' ? apidata.level + ' 级' : 'Level ' + apidata.level) }}</span> </button> <button class=btn style="width:auto;padding:0 14px;border:none;background:0 0;color:#1aad19!important;cursor:auto" :style="{ marginRight: apidata.vpn !== 'GPT-4' && apidata.vpn !== 'third-party' ? 'auto' : '1px', display: apidata.vpn === 'third-party' ? 'none' : 'flex' }" :title="settingsLanguage == 'cn' ? '成功率' : 'Success rate'"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path> </svg> </div> <span style=color:#1aad19;font-size:13px>&nbsp;{{ Math.round(apidata.succrate * 100) + ' %' }}</span> </button> <button class=btn style="width:auto;border:none;background:0 0;color:#1aad19!important;cursor:auto" :style="{ display: apidata.vpn !== 'GPT-4' && apidata.vpn !== 'third-party' ? 'none' : 'flex' ,padding: apidata.vpn === 'third-party' ? '0px 8px' : '0px 1px', marginRight: apidata.vpn === 'third-party' ? '2px' : 'auto'   }" :title="apidata.vpn === 'third-party' ? (settingsLanguage == 'cn' ? '第三方专用Key' : 'Third-party API Key') : apidata.vpn === 'GPT-4' ? (settingsLanguage == 'cn' ? '支持GPT-4' : 'Support GPT-4') : apidata.vpn"> <div> <svg xmlns=http://www.w3.org/2000/svg width=18 height=18 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1=7 y1=7 x2=7.01 y2=7></line> </svg> </div> <span style=color:#1aad19;font-size:13px>&nbsp;{{ apidata.vpn === 'third-party' ? (settingsLanguage == 'cn' ? '第三方专用' : 'Third-party') : apidata.vpn }}</span> </button> <span style=margin-right:auto;line-height:23px;color:#1aad19;font-size:13px :style="{ display: apidata.vpn === 'third-party' ? 'flex' : 'none'}" :title="settingsLanguage == 'cn' ? '接口网址(上次使用的)' : 'API URL (last used)'">&nbsp;{{ apidata.apiurl }}</span> </div> <div class=panelrow style=align-items:start;height:auto;flex-wrap:nowrap;justify-content:start> <div style="width:auto;padding:0 1px 0 12px;color:#1aad19!important" :title="settingsLanguage == 'cn' ? 'API Key' : 'API Key'"> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=11 width=18 height=11 rx=2 ry=2></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path> </svg> </div> <span style=color:#444;word-break:break-all :title="settingsLanguage == 'cn' ? 'API Key' : 'API Key'">&nbsp;{{ apidata.apikey }}</span> </div> </div> </div> </div> <div class=dialog-bottom> </div> </div> <div class=dialog-mask @click="isShowDialog_AutoKeyRotation = false"> </div> </div> <div v-show=isShowNotification class=notification> <div class=notification-wrapper :class="{'notification-center': isNotificationHasMask, 'notification-bottom': !isNotificationHasMask }"> <div :style="{ display: isNotificationHasMask ? 'block' : 'none' }" style="position:relative;height:30px;padding:2px 16px;border-top-left-radius:10px;border-top-right-radius:10px"> <div class=dialog-title style=color:#664909;font-weight:600> {{setNotificationTitle}} </div> <div class=dialog-close @click=hideNotification style=color:#664909;width:18px;height:18px :title="settingsLanguage == 'cn' ? '关闭' : 'Close'"> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=fill:none;stroke:#333;stroke-width:2;stroke-linecap:round;stroke-linejoin:round> <path d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> <div class=dialog-scroll :style="{ height: isNotificationHasMask ? 'calc(100% - 49.5px)' : 'auto', overflowX: isNotificationHasMask ? 'auto' : 'hidden', overflowY: isNotificationHasMask ? 'scroll' : 'hidden' }"> <div class=notification-content :class="{'notification-content-center': isNotificationHasMask, 'notification-content-bottom': !isNotificationHasMask }"> <button class="copybtn btncopynotification" :style="{ display: isNotificationHasMask ? 'block' : 'none' }" data-clipboard-nextelementsibling="" style="opacity:1;position:fixed;flex-shrink:0;top:7px;right:40px;width:25px;height:25px;color:#664909;border:1px solid #cfd450;background-color:#e5e881;background-image:linear-gradient(#fdffb4,#e5e881)" :title="settingsLanguage == 'cn' ? '一键复制' : 'One-Click Copy'"> <div> <svg width=14 height=17 class=clippy fill=currentColor> <path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z"> </path> </svg> </div> </button> <span>{{setNotificationContent}}</span> <div @click=hideNotification :style="{ display: !isNotificationHasMask && isNotificationBottomShowCloseBtn ? 'block' : 'none' } " style=cursor:pointer;margin-left:5px;margin-right:-3px;font-size:12px>×</div> </div> </div> <div class=dialog-bottom :style="{ display: isNotificationHasMask ? 'block' : 'none' }"> </div> </div> <div class=notification-mask v-show=isNotificationHasMask @click=hideNotification></div> </div> </div> <script>window.Vue||document.write(unescape('%3Cscript src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"%3E%3C/script%3E'));var timermask=setTimeout(function(){var e,i=document.getElementById("loading-mask");i&&((e=i.firstChild)&&i.removeChild(e),(e=document.createElement("button")).innerHTML="<br>The page is loading too slowly. Please refresh the page or check your internet connection.<br>Click [here] to hide the mask and view the webpage. After ruling out network issues such as poor connection or server congestion, if the layout is still incorrect or displaying gibberish, please try using a newer version of the browser or device.",e.onclick=displaymaskbtn,i.appendChild(e)),clearTimeout(timermask)},12e3);function displaymaskbtn(){var e=document.getElementById("loading-mask");e&&e.classList.add("dialog-wrapper-hide")}</script> <script>function addEventListenerCopyBtnTooltip(t){t.addEventListener("mouseleave",clearCopyBtnTooltip),t.addEventListener("blur",clearCopyBtnTooltip)}function clearCopyBtnTooltip(t){t.currentTarget.setAttribute("class","copybtn"),t.currentTarget.removeAttribute("aria-label")}function showCopyBtnTooltip(t,e,n){t.setAttribute("class","copybtn tooltipped "+n),t.setAttribute("aria-label",e)}function fallbackCopyBtnMessage(t){return"cn"==window.currentlang?"无数据 ":"No data"}window.currentlang="cn"</script> <script>window.Vue||alert("错误：\r\nVue.js加载失败，将无法使用GPT！请检查网络后刷新页面。\r\n\r\nError:\r\nFailed to load plugin Vue.js. The GPT will be unavailable. Please check your network and refresh the page to try again.");const createApp=Vue["createApp"];createApp({data(){return{api:"",default_apiKeyArray_WrittenInTheCode:["","","","","","","","",""],default_apiKeyArray_WrittenInTheCode_Encrypted_Base64:["","",""],btnDisabledState_Sending:!0,btnDisabledState_CheckAPI:!1,btnDisabledState_Clear:!0,btnDisabledState_Undo:!0,sentext:"先验证API",apibtntext:"<< 验证",timerId:null,btnDisabledState_Export:!0,hasSystemPromptBeenSaved:!1,userMsgTokensForRetry:0,succQA_Count:0,totaltokens:0,chathistory:"# GPT聊天记录 / Chat History  \r\n\r\n",btnDisabledState_KeyMode:!1,btnDisabledState_SaveApiURL:!0,btnDisabledState_ApiURL:!1,btnDisabledState_Language:!1,btnDisabledState_ContextualMode:!1,btnDisabledState_updateUserImageUrl:!0,btnDisabledState_updateGPTImageUrl:!0,isRetry_RetryMessage:"",isfirstclickonchatinputbox:!0,isShowTotaltokensSVG:!0,isShowTotaltokensLabel:!0,isShowQACountLabel:!0,isSendingNow:!1,isCheckingApiKeyNow:!1,is_Alert_Confirm_Prompt_Open:!1,autoRetry_FirstTime:0,autoRetry_log:"",autoRetry_apiKeyExcludeList:[],current_Year:"2023",bugfixing_BaiduInput_NewLine_timestamp:0,isShowDialog_PromptGenerator:!1,styleDialogLayout:{padding:"20px 20px 20px 20px"},gptSystemPromptReadOnly:"",btnDisabledState_SetSystemPrompt:!1,gptPrompts:[{prompt:"",sort:-1,id:-1,tag:"",note:"",owner:"me",other1:"",other2:""}],isShowDialog_ChatList:!1,selectedChatListMoreOptions:"",selectedChatListMoreOptions_Options_cn:[{label:"1) 导出/分享对话 (.json)",op:"ExportChatData"},{label:"2) 创建副本",op:"CreateCopy"},{label:"3) 清空记录 (保留最近单轮记录)",op:"ClearPrevious"},{label:"4) 清空记录",op:"ClearAll"}],selectedChatListMoreOptions_Options_en:[{label:"1) Export & Share (.json)",op:"ExportChatData"},{label:"2) Creat a copy",op:"CreateCopy"},{label:"3) Clear the history (Keep the latest round)",op:"ClearPrevious"},{label:"4) Clear the history",op:"ClearAll"}],isChatListTransparent:!1,isShowDialog_AutoKeyRotation:!1,changeAutoKeyRotationSorted_Mode:0,isShowBulkAddPanel_AutoKeyRotation:!1,isThirdPartyAPIKeyEnabled:!1,isShowDialog_Settings:!1,isShowProConfig:!0,isSimpleMode:!1,simpleModeOptions_cn:[{label:"默认模式",state:!0},{label:"新用户模式",state:!1}],simpleModeOptions_en:[{label:"Normal Mode",state:!0},{label:"User Onboarding",state:!1}],apiCheckedData:[{apikey:"",apiurl:"",date1:0,date2:0,date3:0,nexttime:0,level:null,freq:0,vpn:"",owner:"me",succcount:0,failcount:0,succrate:0,updatetime:0}],lastCheckApiTime:0,lastAPIKeyInputText:"",lastAPIKeyInputText_Available:"",defaultAPIKey:"",apitemperature:.7,apiMaxTokens:2048,apiTopP:1,apiPresencePenalty:0,apiFrequencyPenalty:0,openSmartMaxTokens:!0,smartMaxTokensOptions_cn:[{label:"已启用 智能max_tokens",state:!0},{label:"已关闭 智能max_tokens",state:!1}],smartMaxTokensOptions_en:[{label:"Smart max_tokens Enabled",state:!0},{label:"Smart max_tokens Disabled",state:!1}],isSendingNow_ForSmartMaxTokens:!1,isFixingMaxTokens_SmartMaxTokens:!1,isFirstRetry_SmartMaxTokens:!0,isReminded_SmartMaxTokens:-1,apiGPTModel:"pai-001-beta",gptModelList:[{modelname:"pai-001-beta",alias:"- pai-001-beta",maxtokens:32768,expiredtime:""},{modelname:"pai-001-beta",alias:"- pai-001-beta",maxtokens:8192,expiredtime:""},{modelname:"pai-001-beta",alias:"- pai-001-beta",maxtokens:4096,expiredtime:""},{modelname:"pai-001-light-beta",alias:"- pai-001-light-beta",maxtokens:32768,expiredtime:""},{modelname:"pai-001-light-beta",alias:"- pai-001-light-beta",maxtokens:8192,expiredtime:""},{modelname:"pai-001-light-beta",alias:"- pai-001-light-beta",maxtokens:4096,expiredtime:""},{modelname:"pai-001-light-beta",alias:"- pai-001-light-beta",maxtokens:32768,expiredtime:""}],apiURL:"",inputApiURL:"",selectedApiURL:"",apiURLOptions_cn:[{label:"官方  • OpenAI官方API (GPT-3.5 / GPT-4) 需魔法",url:"https://api.pawan.krd/v1/chat/completions"},{label:"第三方  • 免魔法 使用官方Key openai-proxy.com",url:"https://api.openai-proxy.com/v1/chat/completions"}],apiURLOptions_en:[{label:"OpenAI  • OpenAI's official API. GPT-3.5 / GPT-4 API endpoint.",url:"https://api.pawan.krd/v1/chat/completions"},{label:"3rd party  • Unofficial. No VPN required, use OpenAI API Key",url:"https://api.openai-proxy.com/v1/chat/completions"}],OpenAI_API_URL:"https://api.pawan.krd/v1/chat/completions",OpenaiProxyCom_API_URL:"https://api.openai-proxy.com/v1/chat/completions",isLoadThirdPartyPaidAPIs:!1,apiURLOptions_LoadThirdPartyPaidAPIs:[{label:"第三方  • 专用Key 免魔法 API2D平台",url:"https://oa.api2d.net/v1/chat/completions"},{label:"第三方  • 专用Key 免魔法 API2D平台·备用",url:"https://openai.api2d.net/v1/chat/completions"},{label:"第三方  • 专用Key 免魔法 Next-Web平台",url:"https://api.nextweb.fun/openai/v1/chat/completions"},{label:"第三方  • (官方Key) 免魔法 Next-Web平台",url:"https://chatgpt1.nextweb.fun/api/proxy/v1/chat/completions"},{label:"第三方  • 专用Key 免魔法 OpenAI-SB平台",url:"https://api.openai-sb.com/v1/chat/completions"},{label:"第三方  • 专用Key 免魔法 AI Proxy平台",url:"https://api.aiproxy.io/v1/chat/completions"}],excludeList_ThirdPartyKeyStartWithSK_DomainKeyword:["ohmygpt","textai.bu","aigptx","opapi.wi","closeai-asia","closeai-proxy","openai-proxy.or","openai-proxy.liv","aiayw","i.aikey.on","czl.n","i.apiai.c","rcouyi","aiproxy.io","openaimax","chatai.beauty/v1/chat"],list_OnlyUseThirdPartyKey_DomainKeyword:["api2d","nextweb.fun/openai/v1/chat","openai-sb","aiproxy.io","openaimax","aigc2d","chatai.beauty/v1/chat","api2gpt","closeai-asia","closeai-proxy","openai-proxy.or","openai-proxy.liv","ohmygpt","textai.bu","aigptx","opapi.wi","aiayw","i.aikey.on","czl.n","i.apiai.c","rcouyi"],pageScaling:"0.8",selectedPageScaling:"",selectedPageScalingOptions:[],settingsLanguage:"en",settingsLanguageOptions:[{label:"中文",lang:"cn"},{label:"English",lang:"en"}],settingsFontSize:14,settingsFontSizeOptions:[{label:"9",fontsize:9},{label:"10",fontsize:10},{label:"11",fontsize:11},{label:"12",fontsize:12},{label:"13",fontsize:13},{label:"14",fontsize:14},{label:"15",fontsize:15},{label:"16",fontsize:16},{label:"17",fontsize:17},{label:"18",fontsize:18},{label:"19",fontsize:19},{label:"20",fontsize:20},{label:"21",fontsize:21},{label:"22",fontsize:22},{label:"23",fontsize:23},{label:"24",fontsize:24},{label:"25",fontsize:25},{label:"26",fontsize:26},{label:"27",fontsize:27},{label:"28",fontsize:28},{label:"29",fontsize:29}],settingsTime_WechatStyle:!0,settingsTimeWechatStyleOptions_cn:[{label:"显示",displaytime:!0},{label:"不显示",displaytime:!1}],settingsTimeWechatStyleOptions_en:[{label:"Show",displaytime:!0},{label:"Hide",displaytime:!1}],settingsTime_Message:1,settingsTimeMessageOptions_cn:[{label:"不显示",displaytime:1},{label:"显示",displaytime:2},{label:"显示(增大间距)",displaytime:3}],settingsTimeMessageOptions_en:[{label:"Hide",displaytime:1},{label:"Show",displaytime:2},{label:"Show(Increase Spacing)",displaytime:3}],settingsDividerLine:!0,settingsDividerLineOptions_cn:[{label:"显示",displaydividerline:!0},{label:"不显示",displaydividerline:!1}],settingsDividerLineOptions_en:[{label:"Show",displaydividerline:!0},{label:"Hide",displaydividerline:!1}],settingsContextualMode:0,settingsContextualModeOptions_cn:[{label:"不限制",mode:0},{label:"记忆上限 2 条",mode:2},{label:"记忆上限 4 条",mode:4},{label:"记忆上限 6 条",mode:6},{label:"记忆上限 8 条",mode:8},{label:"记忆上限 10 条",mode:10},{label:"记忆上限 12 条",mode:12},{label:"记忆上限 14 条",mode:14},{label:"记忆上限 16 条",mode:16},{label:"记忆上限 18 条",mode:18},{label:"记忆上限 20 条",mode:20},{label:"记忆上限 22 条",mode:22},{label:"记忆上限 24 条",mode:24},{label:"记忆上限 26 条",mode:26},{label:"记忆上限 28 条",mode:28},{label:"记忆上限 30 条",mode:30},{label:"记忆上限 32 条",mode:32},{label:"记忆上限 34 条",mode:34},{label:"记忆上限 36 条",mode:36},{label:"记忆上限 38 条",mode:38},{label:"记忆上限 40 条",mode:40},{label:"记忆上限 42 条",mode:42},{label:"记忆上限 44 条",mode:44},{label:"记忆上限 46 条",mode:46},{label:"记忆上限 48 条",mode:48},{label:"记忆上限 50 条",mode:50}],settingsContextualModeOptions_en:[{label:"No Limit",mode:0},{label:"Limit: 2",mode:2},{label:"Limit: 4",mode:4},{label:"Limit: 6",mode:6},{label:"Limit: 8",mode:8},{label:"Limit: 10",mode:10},{label:"Limit: 12",mode:12},{label:"Limit: 14",mode:14},{label:"Limit: 16",mode:16},{label:"Limit: 18",mode:18},{label:"Limit: 20",mode:20},{label:"Limit: 22",mode:22},{label:"Limit: 24",mode:24},{label:"Limit: 26",mode:26},{label:"Limit: 28",mode:28},{label:"Limit: 30",mode:30},{label:"Limit: 32",mode:32},{label:"Limit: 34",mode:34},{label:"Limit: 36",mode:36},{label:"Limit: 38",mode:38},{label:"Limit: 40",mode:40},{label:"Limit: 42",mode:42},{label:"Limit: 44",mode:44},{label:"Limit: 46",mode:46},{label:"Limit: 48",mode:48},{label:"Limit: 50",mode:50}],settingsShortcut_CheckApiKey:!0,settingsShortcutCheckApiKeyOptions_cn:[{label:"F2",shortcut:!0},{label:"无",shortcut:!1}],settingsShortcutCheckApiKeyOptions_en:[{label:"F2",shortcut:!0},{label:"None",shortcut:!1}],settingsShortcut_Clear:!1,settingsShortcutClearOptions_cn:[{label:"F1",shortcut:!0},{label:"无",shortcut:!1}],settingsShortcutClearOptions_en:[{label:"F1",shortcut:!0},{label:"None",shortcut:!1}],settingsShortcut_Undo:!1,settingsShortcutUndoOptions_cn:[{label:"F3",shortcut:!0},{label:"无",shortcut:!1}],settingsShortcutUndoOptions_en:[{label:"F3",shortcut:!0},{label:"None",shortcut:!1}],settingsShortcut_Retry:!0,settingsShortcutRetryOptions_cn:[{label:"F4",shortcut:!0},{label:"无",shortcut:!1}],settingsShortcutRetryOptions_en:[{label:"F4",shortcut:!0},{label:"None",shortcut:!1}],userAvatarURL:"https://tak.teamdts.online/me-bili.jpg",inputUserImageUrl:"https://tak.teamdts.online/me-bili.jpg",gptAvatarURL:"",inputGPTImageUrl:"",selectedImageUrl:"",userpresetImages_cn:[{name:"2) 预设: 哔哩哔哩头像",url:"https://tak.teamdts.online/me-bili.jpg"},{name:"3) 预设: 黑色GPT头像",url:"https://openai.com/favicon.ico"}],userpresetImages_en:[{name:"2) Pre-set: Bilibili Logo",url:"https://tak.teamdts.online/me-bili.jpg"},{name:"3) Pre-set: Black GPT Logo",url:"https://openai.com/favicon.ico"}],gptpresetImages_cn:[{name:"1) 预设: 绿色GPT头像",url:"Change-GPT-Green-SVG"},{name:"2) 预设: 黑色GPT头像",url:"https://openai.com/favicon.ico"}],gptpresetImages_en:[{name:"1) Pre-set: Green GPT Logo",url:"Change-GPT-Green-SVG"},{name:"2) Pre-set: Black GPT Logo",url:"https://openai.com/favicon.ico"}],isgptGreenSvgShow:!0,GPTGreenSVG_UrlText_cn:"GPT-Green-SVG *无网址，仅通过[GPT头像]更新",GPTGreenSVG_UrlText_en:"GPT-Green-SVG *No URL, only updated through [GPT Avatar].",userAvatarUp_base64:"",userAvatarUp_blob:null,userAvatarUp_blobUrl:"",selectedDeleteLocalStorageData:"",selectedDeleteLocalStorageDataOptions_cn:[{label:"1) 一键删除所有数据",type:"DeleteAllData"},{label:"2) 删除所有[对话]数据",type:"DeleteChatDataList"},{label:"3) 删除所有[密钥 API Key]数据",type:"DeleteAPIKeyData"},{label:"4) 删除所有[提示词]数据",type:"DeletePromptsData"},{label:"5) 删除[上传的用户头像]",type:"DeleteUploadedUserAvatar"},{label:"6) 删除所有[设置]数据",type:"DeleteSettingsData"}],selectedDeleteLocalStorageDataOptions_en:[{label:"1) Delete All Data with One Click",type:"DeleteAllData"},{label:"2) Delete All [Chat] Data",type:"DeleteChatDataList"},{label:"3) Delete All [API Key] Data",type:"DeleteAPIKeyData"},{label:"4) Delete All [Prompt Generator] Data",type:"DeletePromptsData"},{label:"5) Delete [Uploaded User Avatar]",type:"DeleteUploadedUserAvatar"},{label:"6) Delete All [Settings] Data",type:"DeleteSettingsData"}],selectedExportLocalStorageData:"",selectedExportLocalStorageDataOptions_cn:[{label:"1) 一键导出所有数据",type:"ExportAllData"},{label:"2) 导出所有[对话]数据",type:"ExportChatDataList"},{label:"3) 导出所有[密钥 API Key]数据",type:"ExportAPIKeyData"},{label:"4) 导出所有[提示词]数据",type:"ExportPromptsData"},{label:"5) 导出所有[设置]数据",type:"ExportSettingsData"}],selectedExportLocalStorageDataOptions_en:[{label:"1) Export All Data with One Click",type:"ExportAllData"},{label:"2) Export All [Chat] Data",type:"ExportChatDataList"},{label:"3) Export All [API Key] Data",type:"ExportAPIKeyData"},{label:"4) Export All [Prompt Generator] Data",type:"ExportPromptsData"},{label:"5) Export All [Settings] Data",type:"ExportSettingsData"}],isLocalStorageSupported:!0,isLocalStorageAllowed:!0,islocalStorageFirstLoad:!0,localStorage_lastSaveTime:null,localStorage_lastSaveTime_onblur:null,chatcreatedtime:null,chatlasttime:null,chatid:null,chattitle:"",chatDataList:[],selectedChatData:{},localStorageEvent_chatDataList_update_start:!1,chatHistoryPromptOnlyUseBackticks:!1,exportTXTFileName:"TAKGPT_ChatHistory",exportTXTFileName_SingleRound:"TAKGPT_ChatHistory_SingleRound",exportJSONFileName:"TAKGPT Data_",selectedExportChatHistory:"",selectedExportChatHistoryOptions_cn:[{label:"1) 导出聊天记录·单轮记忆 (.md)",type:"ChatHistory_Single_MD"},{label:"2) 导出聊天记录·单轮记忆 (.txt)",type:"ChatHistory_Single_TXT"},{label:"3) 导出聊天记录/日志·全部 (.md)",type:"ChatHistory_ALL_MD"},{label:"4) 导出聊天记录/日志·全部 (.txt)",type:"ChatHistory_ALL_TXT"}],selectedExportChatHistoryOptions_en:[{label:"1) Export Chat History for a Single Round (.md)",type:"ChatHistory_Single_MD"},{label:"2) Export Chat History for a Single Round (.txt)",type:"ChatHistory_Single_TXT"},{label:"3) Export All Chat History / Logs (.md)",type:"ChatHistory_ALL_MD"},{label:"4) Export All Chat History / Logs (.txt)",type:"ChatHistory_ALL_TXT"}],isShowNotification:!1,setNotificationContent:"",isNotificationHasMask:!1,isNotificationBottomShowCloseBtn:!1,setNotificationPosition:"center",setNotificationTitle:"",notificationTimeoutId:0,thefirstmessage:"### **GPT** ***v69.69*** \r\n###### The GPT Use Api Key From Pawan.Krd \r\nDiscord link: https://discord.gg/7Uys49KGRs \r\n Use /key In #Bot To Get The API Key",gptSystemPrompt:"",gptSystemPrompt_hidden:"",msgList:[{msg:"",my:!1,datetime:"2000-01-01 00:00:00",wechatstyledatetime:null,hr:!1}],msgContent:[{role:"system",content:""}],msgTokens:[{role:"AI",completion_tokens:0,total_tokens:0}],msg:"",msgContentForMsgList_SingleRound:[{role:"system",content:"",datetime:"2000-01-01 00:00:00"}],userSettings_Version:"1.8.16",userVariables_default:{apitemperature:.7,apiMaxTokens:32768,apiGPTModel:"pai-001-beta",apiTopP:1,apiPresencePenalty:0,apiFrequencyPenalty:0,apiURL:"https://api.pawan.krd/v1/chat/completions",selectedApiURL:"",settingsLanguage:"en",settingsFontSize:14,settingsTime_WechatStyle:!0,settingsTime_Message:1,settingsDividerLine:!0,settingsShortcut_CheckApiKey:!0,settingsShortcut_Clear:!1,settingsShortcut_Undo:!1,settingsShortcut_Retry:!0,chatHistoryPromptOnlyUseBackticks:!1,isShowProConfig:!0,isSimpleMode:!1,pageScaling:"0.8",isThirdPartyAPIKeyEnabled:!1,isLoadThirdPartyPaidAPIs:!1},chatDataList_Version:"1.7.05",chatVariables_default:{btnDisabledState_Export:!0,settingsContextualMode:0,hasSystemPromptBeenSaved:!1,userMsgTokensForRetry:0,succQA_Count:0,totaltokens:0,chathistory:"# GPT聊天记录 / Chat History  \r\n\r\n",gptSystemPromptReadOnly:""},chatData_default:{chatcreatedtime:null,chatlasttime:null,chatid:null,chattitle:"",msgList:[{msg:"",my:!1,datetime:"2000-01-01 00:00:00",wechatstyledatetime:null,hr:!1}],msgContent:[{role:"system",content:""}],msgTokens:[{role:"AI",completion_tokens:0,total_tokens:0}],msgContentForMsgList_SingleRound:[{role:"system",content:"",datetime:"2000-01-01 00:00:00"}],msg:""},apikeyData_Version:"1.7.13",apikeyData_default:{api:"",timerId:null,apiCheckedData:[]},promptsData_Version:"1.7.05",promptsData_default:{gptSystemPrompt:"",gptPrompts:[]}}},methods:{ExportData(t,e,a){var t=new Blob([t],{type:"text/"+a}),t=(window.URL||window.webkitURL||window).createObjectURL(t),i=document.createElement("a"),t=(i.href=t,i.style.display="none",new Date);e=e+" "+this.formatDateYYYYMMDDHHmmss(t,".").slice(5),i.download=e="markdown"==a?e+".md":e+".txt",document.body.appendChild(i),i.click(),document.body.removeChild(i)},ExportData_SingleRound(i,n,o,t){if(!this.checkBusyStatus())if(this.msgContent.length<3){let t="cn"==this.settingsLanguage?"导出本轮上下文记忆：当前不存在有效的聊天记录(单轮)，无数据可导出":"Export current round's context: No valid context records found, no data available for export.";void setTimeout(()=>{this.showNotification(t,"bottom","",7e3)},1800)}else{var r=this.msgContentForMsgList_SingleRound;let s="",a="";if(s="cn"==this.settingsLanguage?"# GPT聊天记录\r\n\r\n":"# Chat History\r\n\r\n",n){n=r[0].content.trim();let t=/\r?\n\r?\n/.test(n);var l=this.findMaxBackticks(n);t=""!=l||t,l=""==l?"````":l;let e=(t=o?!0:t)?"\r\n"+l+"\r\n":"\r\n> ",a=t?"\r\n"+l+"\r\n\r\n":"\r\n\r\n",i="";""==n&&(i="cn"==this.settingsLanguage?": 空":": None",e="\r\n",a="\r\n");o="cn"==this.settingsLanguage?"#### 系统提示词 system prompt ":"#### #System Prompt ";s+=o+i+e+n+a}for(let e=1;e<r.length;e++)if("user"===r[e].role){if(e===r.length-1)break;let t=r[e+1].role;for(;"user"===t&&e+1<r.length-1;)e++,t=r[e+1].role;"assistant"===t&&(a=i?" _"+r[e].datetime+"_  \r\n":" \r\n",s=(s=(s+=(this.settingsLanguage,"**User**"))+a)+r[e].content.replace(/\n/g,"\r\n")+"\r\n\r\n")}else"assistant"===r[e].role&&(a=i?" _"+r[e].datetime+"_  \r\n":" \r\n",s=(s=(s+=(this.settingsLanguage,"**GPT**"))+a)+r[e].content.replace(/\n/g,"\r\n")+"\r\n\r\n");this.ExportData(s,this.exportTXTFileName_SingleRound,t)}},ExportData_JSON(e,t){let a="";try{var i=this.calculateStringSize(e,"utf-16")/1024/1024;let t="";4.99<i?(t="cn"==this.settingsLanguage?"当前导出的数据已达到 "+i.toFixed(2)+" MB，可能无法在一些浏览器中导入 (部分浏览器本地存储上限为5MB)。如果需要适配更多的浏览器，建议分类导出 (或拆分为单个对话导出、抹掉日志)，以减小单个文件的大小。":"The currently exported data has reached "+i.toFixed(2)+" MB, which may exceed the local storage limit of 5MB for some browsers, causing import failure. If you need to adapt to more browsers, it is recommended to export data by categories to reduce the size of individual files or split them into separate chat exports, or erase logs.",setTimeout(()=>{this.showNotification(t,"center","")},1600)):3<i&&(t="cn"==this.settingsLanguage?"当前导出的数据大小为 "+i.toFixed(2)+" MB。小贴士：可以通过拆分对话或抹掉日志来缩小文件":"The current exported data size is "+i.toFixed(2)+" MB. Tip: You can reduce the file size by exporting individual chats or erasing logs.",setTimeout(()=>{this.showNotification(t,"bottom","",8e3)},1600)),a="("+(a=i.toFixed(2))+"MB) "}catch(t){a="",console.error("ExportData_JSON() - 计算大小出错，不影响导出",t)}i=new Blob([e],{type:"application/json"}),e=URL.createObjectURL(i),i=document.createElement("a"),i.href=e,i.style.display="none",e=new Date;t=t+" "+a+this.formatDateYYYYMMDDHHmmss(e,".").slice(5)+".json",i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)},formatDateYYYYMMDDHHmmss(t,e){var a=t.getFullYear();let i,s,n,o,r;return String.prototype.padStart?(i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0")):(i=(t.getMonth()+1).toString(),s=t.getDate().toString(),n=t.getHours().toString(),o=t.getMinutes().toString(),r=t.getSeconds().toString(),1===i.length&&(i="0"+i),1===s.length&&(s="0"+s),1===n.length&&(n="0"+n),1===o.length&&(o="0"+o),1===r.length&&(r="0"+r)),a+"-"+i+"-"+s+" "+n+e+o+e+r},displayDatetime_WeChatStyle(){let t=this.msgList[this.msgList.length-1].datetime;t=t.replace(/-/g,"/");var e=new Date(t).getTime()/1e3,a=(new Date).getTime()/1e3;return 5<(a-e)/60?a:null},showNotification(t,e,a,i){this.isShowNotification&&-1!=this.notificationTimeoutId&&(clearTimeout(this.notificationTimeoutId),this.isShowNotification=!1,this.notificationTimeoutId=-1),setTimeout(()=>{this.setNotificationContent=t,this.setNotificationPosition=e,this.isNotificationHasMask="center"==e,this.notificationTimeoutId="center"==e?-1:this.notificationTimeoutId,null!=a&&(this.setNotificationTitle=a.trim()),document.querySelector(".notification-wrapper").style.height="auto",this.isShowNotification=!0,null==i&&(i=1450),this.isNotificationBottomShowCloseBtn=2999<i,"bottom"==e&&(this.notificationTimeoutId=setTimeout(()=>{this.isShowNotification=!1,this.notificationTimeoutId=-1},i)),"center"==e&&this.$nextTick(()=>{var t=document.documentElement.clientHeight,e=document.querySelector(".notification-wrapper");.6*t<e.offsetHeight&&(e.style.height="65%")})},50)},hideNotification(){clearTimeout(this.notificationTimeoutId),this.isShowNotification=!1},showMiniHelp(t){let e="",a="",i="";this.settingsLanguage;switch(t){case"B-CurrentSystemPrompt":a="展示当前对话的已生效的系统提示词，不可编辑。\r\n\r\n添加、修改、取消请在编辑区操作，保存后生效。\r\n\r\n取消方式：清空编辑区输入框的内容，然后保存，即可取消系统提示词。\r\n\r\n当前系统提示词属于对话数据，与对话一一对应，切换不同的对话，系统提示词会随之变化。",i="Display the system prompt that is in effect for the current chat and cannot be edited.\r\n\r\nTo add, modify, or cancel the system prompt, please operate in the [Prompt Editor] and save for changes to take effect.\r\n\r\nTo cancel the system prompt, clear the input box in the [Prompt Editor] and save.\r\n\r\nThe system prompt is part of the chat data and is associated with each individual chat. When switching to a different chat, the system prompt will change accordingly.",e="";break;case"B-PromptEditor":a="可以在这里自由编辑提示词。\r\n\r\n未保存的提示词不会影响到[当前系统提示词]。\r\n\r\n提示词编辑器的草稿会存储在[提示词]数据中。它不属于[对话]数据，在对话列表中切换对话时，不会影响提示词编辑器中的内容。",i="You can freely edit the prompt.\r\n\r\nUnsaved changes will not affect the system prompt for the current chat.\r\n\r\nThe drafts in the Prompt Editor are saved in the Prompt Generator Data and do not belong to the Chat Data. Switching to a different chat in the Chat List will not affect the content in the Prompt Editor.",e="";break;case"A-CheckAPIKey":a="API Key，即接口密钥。支持OpenAI官方密钥和第三方平台密钥，将密钥粘贴到输入框，然后开始验证。 (点击 [Key模式: ...]，在弹出窗口中点击蓝色小问号 [?] 可以了解更多。)\r\n\r\n  • 验证成功后，开始聊天或查询 OpenAI API 余额。\r\n  • 当 Key 模式为 [使用 OpenAI 官方Key] 时，[自动轮换 API Key] 功能会自动开启，该功能不支持手动关闭。\r\n  • [自动轮换 API Key] 支持 Key 的数量：1 个或以上。",i="Enter OpenAI API Key or third-party platform API Key and check. (Click on [Key Mode: ...] to learn more by clicking the blue question mark [?] in the pop-up window.)\r\n\r\n  • After checking, you can chat or check OpenAI API balance.\r\n  • When the Key Mode is set to [Use OpenAI API Key], the [Auto Key Rotation] function is enabled and cannot be manually turned off. \r\n  • [Auto Key Rotation] supports a minimum of 1 key or more.",a+='\r\n\r\n  • API Key 是什么样的？\r\n    1) OpenAI 官方的 API Key 是以“sk-”开头的一串密钥，例如 sk-bkR8V4tjmD7lXq9aZheZVpc6DtR8vw9VTYFJ1iaohMPpT3Bl\r\n    2) 第三方平台的 API Key 格式由第三方平台设定，可能同样以 "sk-" 开头，也可能是其他任意形式。',i+="\r\n\r\n  • What does API Key look like?\r\n    1) The API Key from OpenAI starts with 'sk-', like this: sk-bkR8V4tjmD7lXq9aZheZVpc6DtR8vw9VTYFJ1iaohMPpT3Bl .\r\n    2) The format of an API Key for a third-party platform is determined by that platform and may also start with 'sk-' or be in any other format they choose. ( * In countries or regions where OpenAI does not provide services, users may need to use a third-party platform's intermediary service to access GPT.)",this.isSimpleMode||(a+='\r\n\r\n  • 如何获取官方的API Key？\r\n    注册成功后，打开官方接口页面免费获取即可，地址 https://platform.openai.com/account/api-keys   但是，国内IP无法直接注册OpenAI账号，网上有很多注册教程，其中最基础的条件是需要优质的魔法（"魔法"是一种可以让您的手机或电脑出趟国的技术，好的魔法会让OpenAI认为您的设备是真的在国外），满足这个条件就有机会免费注册账号并拥有API Key。'),a+="\r\n\r\n附 常用的官方网址：\r\n    OpenAI官网：https://openai.com \r\n    查看API余额：https://platform.openai.com/account/usage \r\n    官方版ChatGPT / GPT-4：https://chat.openai.com/ \r\n",i+="\r\n\r\n  • OpenAI: https://openai.com \r\n    OpenAI - API Keys: https://platform.openai.com/account/api-keys \r\n    OpenAI - API balance: https://platform.openai.com/account/usage \r\n    OpenAI - ChatGPT / GPT-4: https://chat.openai.com/ \r\n",e="";break;case"A-APISettings":a='  • 智能max_tokens(推荐开启): 启用“智能max_tokens”功能后，会出现小问号 [?] ，可以点击了解更多。\r\n\r\n  • temperature: 默认0.7，官方默认1.0。temperature ("温度") 用于控制GPT生成结果的随机性/多样性/创造力。过低 会导致生成的文本更加保守和重复。过高 会导致生成的文本更加随机和具有创造性 (约从1.2开始，就有几率出现无中生有的词或乱码) 。\r\n\r\n  • max_tokens: 生成结果时的最大token数，可随时调节。单轮对话 "上下文已消耗的token数量" 加上设置的 "max_tokens数量" 不能超过模型的上下文长度。',a=(a=(a+="\r\n\r\n • model (模型): ")+'\r\n  - TAKGPT 列出了尽可能多的模型名称，尽管有些模型之间是完全相同的，如果您不确定如何选择，建议：ChatGPT 选 "gpt-3.5-turbo"，GPT-4 选 "GPT-4" (8K)。'+"\r\n  - 使用 GPT4 模型需要使用支持 GPT4 的 API Key。")+'\r\n  - 考虑到 GPT4 的高价格，如果您想节省消耗，建议关闭"Smart max_tokens"功能，改为手动设置 max_tokens。另外，请随时留意上下文 tokens 数量。'+"\r\n  - 在使用第三方接口时，第三方不一定支持所有模型，尤其是付费的第三方代理，请向服务提供方咨询可用模型名称。",this.isSimpleMode||(a=(a=(a+="\r\n  - 不同模型的价格差异很大，GPT-3.5 的 16k 版要比 4k 版贵一倍，GPT-4 的 32k 版也要比 8k 版贵一倍。而 GPT-4 的价格要比 GPT3.5 贵数十倍。查看官方最新价格: https://openai.com/pricing ")+'\r\n  - 每个模型版本都带有一个 "-MMDD(日期)" 的后缀，例如 gpt-3.5-turbo-0613。未标注日期的模型名称，例如 gpt-3.5-turbo，通常会指向最新版本（例如 gpt-3.5-turbo 会指向 gpt-3.5-turbo-0613，在新版本推出前保持不变）。\r\n  - 模型新版本推出后，旧版本通常会在 3 个月后被弃用。(部分模型可能会被延期)')+'\r\n  - 模型版本都带有一个 "-16k(支持的最大tokens)" 的后缀，例如 gpt-3.5-turbo-16k。未标注的模型名称: gpt-3.5 未标注时是支持 4K，gpt-4 未标注时是支持 8K。(1K = 1024 tokens)\r\n  - 不同模型对"系统提示词"的敏感度不同，模型速度也不同，同时价格差异可能会很大。例如: gpt-3.5-turbo-0301 模型在某些方面表现可能更稳定，但是遵循指令的程度、回答速度都不如 gpt-3.5-turbo-0613。'),a+="\r\n\r\n • 更多 (PRO): 点击显示更多的API参数。",i="  • Smart max_tokens (recommended to enable): After enabling the 'Smart max_tokens' feature, a small question mark [?] will appear, which can be clicked to learn more.\r\n\r\n  • temperature: The 'temperature' setting controls how creative and diverse the text generated by GPT is. Lower values result in more repetitive and simpler text, while higher values result in more random and creative text. \r\n\r\n  • max_tokens: The maximum number of tokens to generate in the chat completion. The total length of input tokens and generated tokens is limited by the model's context length.",i=(i=(i+="\r\n\r\n • model: ")+'\r\n  - TAKGPT lists as many model names as possible, even though some models are exactly the same. If you are unsure about which one to choose, it is recommended to select "gpt-3.5-turbo" for ChatGPT and "GPT-4" (8K) for GPT-4.'+"\r\n  - To use the GPT-4 model, you will need an API Key that supports GPT-4.")+'\r\n  - Considering the high price of GPT4, if you want to save costs, it is recommended to disable "Smart max_tokens" and manually set "max_tokens". Additionally, please keep an eye on the number of tokens in the context.'+"\r\n  - Not all models are necessarily supported by third-party API, especially paid third-party agents. Please consult the service provider for the available model names.",this.isSimpleMode||(i=(i=(i+="\r\n  - There is a significant price difference between different models. The 16k version of GPT-3.5 is twice as expensive as the 4k version, and the 32k version of GPT-4 is also twice as expensive as the 8k version. Additionally, the official GPT-4 is priced tens of times higher than GPT-3.5. Please refer to the official pricing table at https://openai.com/pricing for the latest prices.")+"\r\n  - Each model version is dated with an -MMDD suffix; e.g.,  gpt-3.5-turbo-0613. The undated model name, e.g.,  gpt-3.5-turbo, will typically point to the latest version (e.g.  gpt-3.5-turbo points to  gpt-3.5-turbo-0613 and remains unchanged until a newer version is released). \r\n  - After a new version is launched, older versions will typically be deprecated 3 months later. (Some models may have their expiration date extended.)")+"\r\n  - Each model version is suffixed with something similar to -16k (maximum tokens); e.g.,  gpt-3.5-turbo-16k. For models without a suffix, gpt-3.5 supports 4K tokens, and gpt-4 supports 8K tokens. (1K = 1024 tokens)\r\n  - Different models vary in their adherence to instructions (sysyem prompt) and response speed. For instance, the gpt-3.5-turbo-0301 model may exhibit more stability in certain aspects, but it falls behind the gpt-3.5-turbo-0613 model in terms of following instructions and response speed."),i+="\r\n\r\n  • More (PRO)：Click to display more API parameter settings.\r\n\r\n  • OpenAI - API reference: \r\n    https://platform.openai.com/docs/api-reference/chat/create",e="";break;case"A-SmartMaxTokens":a="开启“智能max_tokens”后，全自动调节 max_tokens，无需手动调节。\r\n如果关闭“智能max_tokens”，需要手动调节 max_tokens，且可能需要多次调节，才能让上下文（记忆）达到高使用率。\r\n\r\n  • 默认开启“智能max_tokens”\r\n  • 这是一个非精准调节的计算策略。长对话中，95%可以做到“智能”，5%遇到错误会自动关闭，并提示您手动调节。",i='When "Smart max_tokens" is enabled, max_tokens will be automatically adjusted without manual intervention. \r\nIf "Smart max_tokens" is disabled, you will need to manually adjust max_tokens, which may require multiple adjustments to get the context tokens close to the upper limit of the model. \r\n\r\n  • "Smart max_tokens" is enabled by default.\r\n  • This is not an OpenAI algorithm, but it can be "smart" about 95% of the time for longer chats. If errors occur, it will automatically disable and prompt you to manually adjust the max_tokens.',this.isSimpleMode||(a+="\r\n  • 如何做到精准调节？GPT-3.5 (ChatGPT) 与 GPT-4 模型均采用 cl100k_base 编码器，cl100k_base 可以精准计算 tokens 。您可以自己修改代码以达到完美的效果。\r\n  • 以下现象与OpenAI官方有关：发送的第一条消息，额外有增加 13 tokens，之后发送的消息，每条增加 10 tokens。",i+="\r\n  • How to achieve precise adjustments?  Both GPT-3.5 (ChatGPT) and GPT-4 models use the cl100k_base encoder, which can accurately calculate tokens. If you are familiar with this technology, you can modify the code to achieve perfect results.\r\n  • The following phenomenon is related to OpenAI: the first message sent will have an additional 13 tokens, and each subsequent message will have an additional 10 tokens added."),e="";break;case"A-ProfessionalAPISettings":a='  • 接口网址: 目前仅支持GPT-3.5 / GPT-4 的模型，对应的接口网址应以 "/v1/chat/completions" 结尾，如OpenAI官方接口网址 "https://api.openai.com/v1/chat/completions" ，但也不排除第三方接口的网址结构有所改动。\r\n  • 官方API接口需要魔法才能连接。第三方API有的需要魔法，有的不需要。\r\n  • 有魔法的情况下，推荐使用官方接口，实际体验更好 (连发3条不会报错。超过1分钟未使用，连发3条不会限制，超3条后有20秒限制) 。免费gpt账号目前都有每分钟3次的调用限制 (同一账号下多个Key会共享限制，所以轮询Key要用不同账号的Key) ，但官方接口使用起来明显更流畅，报错几率会低点。\r\n  • 第三方接口无法保证隐私安全，请自辨。',this.isSimpleMode||(a+='\r\n  • "魔法"是一种可以让您的手机或电脑出趟国的技术。'),a+="\r\n\r\n  • 以下3个参数的说明见官网：\r\n    top_p: (默认为1)  https://platform.openai.com/docs/api-reference/chat/create \r\n    presence_penalty: (默认为0)  https://platform.openai.com/docs/api-reference/chat/create \r\n    frequency_penalty: (默认为0)  https://platform.openai.com/docs/api-reference/chat/create ",i='  • API URL: API Endpoint. Currently, only GPT-3.5/GPT-4 models are supported, and the API ENDPOINT URL should end in "/v1/chat/completions", like the official one "https://api.openai.com/v1/chat/completions". But it is not ruled out that the URL of the third-party API may change. \r\n\r\n  • top_p: (Defaults to 1)  https://platform.openai.com/docs/api-reference/chat/create \r\n\r\n  • presence_penalty: (Defaults to 0)  https://platform.openai.com/docs/api-reference/chat/create \r\n\r\n  • frequency_penalty: (Defaults to 0)  https://platform.openai.com/docs/api-reference/chat/create ',this.isSimpleMode||(a=(a+="\r\n\r\n####以下内容均引用自网络：\r\nhttps://zhuanlan.zhihu.com/p/606573556 \r\n\r\n1) top_p:   0.0 ~ 1.0 \r\n- 指定生成文本的多样性。与参数 temperature (温度) 相似，它是一个可用于代替 temperature 的参数，可以控制生成文本的随机性。\r\n- 会根据生成文本的概率分布，只保留前面概率之和达到一定阈值的词语，然后再从中随机选择一个词语作为下一个生成的词语。较高的值会导致生成的文本更具有多样性，但是会牺牲一定的准确性和保真度。较低的值则会导致生成的文本更加保险和准确，但是可能会过于死板和缺乏新意。\r\n\r\n")+"2) presence_penalty:   -2.0 ~ 2.0 \r\n- 正值会根据新 tokens 在文本中的现有频率对其进行惩罚，从而降低模型逐字重复同一行的可能性。\r\n- 控制重复单词的惩罚力度。较大的惩罚力度会导致生成文本中不太可能出现相同的单词，而较小的惩罚力度则会容忍一定程度的重复。\r\n- 控制文本罕见词汇出现情况。当此参数值大于0时，将抑制模型生成频繁出现的单词，并鼓励生成罕见的单词。值越大，生成的文本中罕见单词的数量可能越多。如果值为0，则不会考虑单词的频率，并且每次生成的单词概率分布都是相同的。如果需要鼓励生成罕见的单词，可以增大参数值。\r\n\r\n3) frequency_penalty:   -2.0 ~ 2.0 \r\n- 正值会根据到目前为止是否出现在文本中来惩罚新 tokens，从而增加模型谈论新主题的可能性。\r\n- 控制模型生成与文本样本中不同的单词的惩罚力度。较大的惩罚力度会导致生成文本中更多地包含文本样本中未出现的单词，而较小的惩罚力度则会限制生成文本的多样性。\r\n- 控制文本同一词汇重复情况。当此参数值大于0时，将鼓励模型生成不同的单词，并尽可能避免使用已经在之前生成的文本中出现过的单词。如果值越大，生成的文本中不同单词的数量可能越多。如果值为0，则不会考虑之前生成的单词，并且每次生成的单词概率分布都是相同的。 例如，在文本生成任务中，如果需要鼓励生成不同的单词，并且避免使用相同的单词，可以增大参考值。"),e="";break;case"A-GeneralSettings":a="  • 在 [常规设置] 中，除了 [记忆模式] 之外，其他都是通用设置。仅 [记忆模式] 是与 [对话] 绑定，每个对话的 [记忆模式] 都可以不同。\r\n",a=(a+="  • 记忆，即上下文。新对话的 [记忆模式] 默认为: 不限制。\r\n")+"  • 如果 [记忆模式] 设置了上限，在接近上限时，主界面上的 [清除记忆] 按钮会变为橘红色，当记忆达到上限时， [清除记忆] 按钮会变为红色 (只是提醒作用，无需用户操作。但如果您不想下次发送消息时记忆被清除，此刻仍然可以修改记忆模式)。\r\n\r\n"+'  • 关于头像设置：支持"上传图片"、"网络图片网址"、"本地图片路径"三种方式。\r\n  • 1) 如何上传图片？(推荐，支持手机和电脑)\r\n    点击 [设置] > 右侧头像，或者点击左侧下拉框选择上传图片。\r\n  • 2) 如何使用网络图片？\r\n    填入图片网址，并点击更新。\r\n  • 3) 电脑端如何使用"本地图片路径"？\r\n    需要把html文件下载到电脑中，在本地打开使用时，才支持本地图片路径（填入相对路径或绝对路径的方式，不明白的建议直接使用第一种方式上传本地图片）。\r\n    以下是本地图片路径的示范：\r\n    - Mac/Windows上的相对路径例子：123.jpg （头像需要与html文件放在同一文件夹中）\r\n    - Mac上的绝对路径例子：/Users/LinTongXue/Downloads/123.jpg \r\n    - windows上的绝对路径例子：D:\\LinTongXue\\123.jpg ',i="  • In the [General Settings] panel, all settings except for [Contextual Mode] are general settings. Only [Contextual Mode] is specific to Chat and can be different for each Chat.\r\n",i=(i+="  • The default [Contextual Mode] for new Chats is: No Limit.\r\n")+"  • If a limit is set for [Contextual Mode], the [Clear Context] button on the main interface will turn orange-red when it approaches the limit. When the Context reaches the limit, the [Clear Context] button will turn red (this is just a reminder, no user action is required. However, if you do not want the context to be cleared the next time you send a message, you can still modify the [Contextual Mode] at this time).\r\n\r\n"+'  • Regarding avatar settings: Upload image, Network image, and Local image (path).\r\n  • 1) How to upload an image as an avatar? (Recommended, supports both mobile and computer devices) \r\n    Click on "Settings" > Avatar on the right or select "upload an image" from the dropdown menu on the left.\r\n  • 2) How to use an online image?\r\n    Enter the URL of the image and click on update.\r\n  • 3) How to use a local image (path) as your avatar on Mac/PC?\r\n    You need to download the HTML file to your computer and open it locally to support local images (support relative or absolute paths). \r\n    Here are some examples of local image paths:\r\n    - Mac/Windows relative path:   123.jpg   (the avatar needs to be placed in the same folder as the HTML file)\r\n    - Mac absolute path:   /Users/LinTongXue/Downloads/123.jpg\r\n    - Windows absolute path:   D:\\LinTongXue\\123.jpg',e="";break;case"A-ExportChatHistory":a="  • 将当前对话的聊天记录导出为纯文本格式，可直接阅读。\r\n\r\n  • 导出聊天记录 · 单轮记忆：导出单轮聊天记录，即针对当前的上下文记忆进行导出，包含最新修改的系统提示词，不含发送失败的、撤回的、重问的记录。格式：Markdown。文件类型：.md 或 .txt\r\n\r\n  • 导出聊天记录/日志 · 全部：将网页上的所有聊天记录（包含发送失败的、撤回的、重问的记录）和所有操作记录（包含系统提示词修改记录）导出并下载。格式：Markdown。文件类型：.md 或 .txt\r\n\r\n  • 如果导出时没有反应或下载失败，可能是因为浏览器或设备不兼容。\r\n\r\n  • 附 两个Markdown在线编辑器网站：\r\n    https://stackedit.cn/app# \r\n    http://tool.pfan.cn/markdown ",i="  • Export the chat history of the current chat as plain text format for easy reading.\r\n\r\n  • Export Chat History for a Single Round, which includes the current context and the most recent system prompt, but excluding failed messages, undo messages, and resend messages. Exported file format: Markdown. File type: .md | .txt\r\n\r\n  • Export All Chat History / Logs, export and download all chat history (including failed messages, undo messages, resend messages) and all operation records (including system prompt modification records) on the webpage. Exported file format: Markdown. File type: .md | .txt \r\n\r\n  • If there is no response or the download fails when exporting, it may be due to browser or device incompatibility.\r\n\r\n  • Websites for Markdown online editors:\r\n    https://dillinger.io \r\n    https://stackedit.io/app# ",e="";break;case"C-ChatList":a="  • 单个对话的数据包含聊天历史记录 (含上下文记忆)、当前系统提示词 (单条)、记忆模式 (上下文模式)、聊天输入框内的草稿、以及与对话直接关联的其他数据。",a=(a=(a+="\r\n  • 对话的数据不包括用户设置、用户头像、提示词模板、提示词编辑器草稿、密钥 (API Key) 及API参数信息，切换不同对话时，这些数据不会发生改变。")+"\r\n  • 可导出单个对话数据，或一次导出所有对话的数据。可用于分享，对方导入后可恢复对话数据，完全一致。"+"\r\n\r\n  • 若浏览器支持本地存储 (localStorage) ，所有对话数据将会自动保存在浏览器缓存中。")+"\r\n  • 非隐私模式 (无痕模式) 下，会同步不同标签页间的数据，自动新增、修改、合并，数据冲突会自动创建副本。"+"\r\n  • 可随时通过 [删除数据] 功能或浏览器的清除历史记录 (清除缓存) 功能来删除所有数据。",this.isSimpleMode||(a=(a=(a=(a+="\r\n  • 对话列表按照最近活动时间排序，新的靠前。\r\n  • #编号 和 #描述 可随意修改，仅有长度限制。")+"\r\n  • 手动或自动创建对话副本时，副本的创建时间会自动加1秒或更多。\r\n  • 新对话 (未发送过消息) 不会被保存。")+"\r\n  • 对话日志: 单个对话的所有记录 (包含操作记录、撤回的内容以及发送失败的内容等)，用于导出 Markdown 格式的纯文本聊天记录，有些对话日志可能会比较大。\r\n  • 每个对话都可以在 [设置] 中单独设置记忆模式 (上下文模式)，新对话的记忆模式默认为: 不限制。")+"\r\n\r\n  • 使用浏览器普通模式时：标签页或浏览器窗口可随时刷新或关闭，打开时均能恢复数据，且不同标签页的数据是共享的 (同一浏览器打开相同网页的情况下)。\r\n  • 使用浏览器隐私模式 (无痕模式) 时：大多数支持本地存储，标签页可刷新，标签页或窗口之间不互通数据，标签页关闭时，所有数据都会被销毁。"),i="  • Each chat data includes chat history, the current system prompt, contextual mode, the draft in the chat input box, and other data directly associated with the chat.",i=(i=(i+="\r\n  • Chat data does not include user settings, avatars, prompt generator data, prompt editor drafts, API keys, and API parameter information. These data will not change when switching between different chats.")+"\r\n  • You can export individual chat data or export all chats at once. This can be used for sharing, and the recipient can import and restore the chat data."+"\r\n\r\n  • If the browser supports local storage (localStorage), all data will be automatically saved in the browser cache.")+"\r\n  • In non-private mode, data is synced between different tabs, automatically adding, modifying, and merging. In case of conflicts, copies are created automatically. "+"\r\n  • You can delete all data anytime through [Settings] > [Delete Data] (or by clearing the browser's browsing history).",this.isSimpleMode||(i=(i=(i=(i+="\r\n  • The chat list is sorted by last activity time with the newest at the top.\r\n  • #ID and #description can be freely modified, with length limitations.")+"\r\n  • When manually or automatically creating a copy of a chat, the chat creation time of the copy will be incremented by 1 second or more.\r\n  • New chat (with no messages sent) will not be saved.")+"\r\n  • Chat Logs: All records of individual conversations, including activity logs, retracted messages, and failed messages, are stored. These logs can be exported as plain text chat records in Markdown format. Some logs of chats may be large in size.\r\n  • You can customize the [Contextual Mode] for each chat in [Settings]. Each chat can have a different setting. The default [Contextual Mode] for new chats is: No Limit.")+"\r\n\r\n  • In the normal mode of the browser, Tabs or browser windows can be refreshed or closed at any time, and data will be restored upon reopening. Data is shared between different tabs (when opening the same webpage in the same browser).\r\n  • In private/incognito mode, Local storage is supported in most cases, tabs can be refreshed, but data is not shared between tabs or windows, and cache data is cleared when tabs are closed."),e="";break;case"A-DataPrivacyAndManagement":a="  • 所有数据仅存储于浏览器本地存储 (localStorage) 中，不会通过任何方式对外传输。\r\n",a+="  • [删除数据] 可清空所有数据，或者通过浏览器的历史记录清除功能来清空数据 (清除缓存)。",this.isSimpleMode||(a+="\r\n  • localStorage是浏览器提供的功能，用于在用户的本地设备上存储数据。 1) localStorage与域名相关联，同一个域名下的页面可以共享同一个localStorage。 2) 对于本地运行的HTML文件 (地址以 file:/// 开头)，localStorage通常是共享的。同一浏览器下，不同的本地网页共用着同一个localStorage (以实际情况为准)。 3) 不同浏览器数据不互通。 4) 在浏览器隐私模式下，通常每个标签页都有独立的localStorage。"),a=(a+="\r\n\r\n  • TAKGPT数据:  全自动保存\r\n")+"    数据分为4个部分，支持一键删除或导出，也可以单独删除或导出，同时支持分享和导入，导入时会自动分析包含的数据类型。\r\n\r\n"+"  • 1) Chat Data List:  对话数据，包含所有对话的数据。可导出单个对话或全部对话。\r\n",this.isSimpleMode||(a+="    更新方式：自动合并数据\r\n    导入数据：自动合并数据\r\n    多标签页：实时同步数据\r\n\r\n"),a+="  • 2) API Key Data:  密钥数据，包含 API Key 数据\r\n",this.isSimpleMode||(a+="    更新方式：自动合并数据\r\n    导入数据：自动合并数据\r\n    多标签页：实时同步数据\r\n\r\n"),a+="  • 3) Prompts Data:  提示词数据，包含提示词窗口的数据 (不包括当前系统提示词)  *多功能待开发中\r\n",this.isSimpleMode||(a+="    更新方式：自动合并数据\r\n    导入数据：自动合并数据 *功能待开发中\r\n    多标签页：手动刷新可获取最新数据 \r\n\r\n"),a+="  • 4) User Settings:  用户设置类数据，包括设置、上传的头像和 API 参数设置\r\n",this.isSimpleMode||(a=(a+="    更新方式：覆盖旧数据\r\n    导入数据：覆盖旧数据\r\n    多标签页：\r\n")+"     - 每个刷新的页面，在刷新前都会自动保存 [设置数据]，刷新后又会读取 [设置数据] 。因此，设置不会发生变化。\r\n     - 刷新、关闭、切换标签页等操作都会触发自动保存，所以最新的 [设置] 通常以最后一次操作的网页为准。\r\n\r\n"),i="  • All data is stored only in the browser's local storage (localStorage) and is not transmitted externally.\r\n",i+="  • [Delete Data] can clear all data or use the browser's history clearing function to empty the data (clear cache).",this.isSimpleMode||(i+="\r\n  • localStorage is a browser-provided feature that allows storing data on the user's local device. 1) localStorage is associated with a specific domain, enabling sharing of the same localStorage among pages within the same domain.  2) For locally-run HTML files (address starting with file:///), localStorage is generally shared. In the same browser, different local web pages share the same localStorage (depending on the actual situation).  3) localStorage is not shared across different browsers.  4) In privacy mode, typically each tab has its own isolated localStorage."),i=(i+="\r\n\r\n  • TAKGPT Data: Fully automated saving\r\n")+"    The data is divided into four parts, supporting one-click deletion or export. It also allows individual deletion or export, and supports sharing and importing. When importing, it automatically analyzes the included data types.\r\n\r\n"+"  • 1) Chat Data List: Including data from all chats. Can export single or all chats.\r\n",this.isSimpleMode||(i+="    Update method: Automatically merge data\r\n    Import method: Automatically merge data\r\n    Multiple tabs: Real-time data synchronization\r\n\r\n"),i+="  • 2) API Key Data: Including API Key data *Functionality under development\r\n",this.isSimpleMode||(i+="    Update method: Automatically merge data\r\n    Import method: Automatically merge data\r\n    Multiple tabs: Real-time data synchronization\r\n\r\n"),i+="  • 3) Prompts Data: Including data from the prompt generator window (excluding current system prompt) *Functionality under development\r\n",this.isSimpleMode||(i+="    Update method: Automatically merge data\r\n    Import method: Automatically merge data *Functionality under development\r\n    Multiple tabs: Manually refresh to get the latest data\r\n\r\n"),i+="  • 4) User Settings: Including configurations, uploaded user avatar and API parameter settings\r\n",this.isSimpleMode||(i=(i+="    Update method: Overwrite old data\r\n    Import method: Overwrite old data\r\n    Multiple tabs:\r\n")+"     - Each refreshed page will automatically save settings data before refreshing, and then read settings data after refreshing. Therefore, settings will not change.\r\n     - Refreshing, closing, switching tabs, and other operations will trigger automatic saving. Therefore, the latest settings are usually based on the last operation on the webpage."),this.isLocalStorageSupported||(a='当前浏览器或浏览器模式不支持"浏览器本地存储"，已关闭保存功能，并不会存储任何数据。但是您仍然可以通过使用 [删除数据] 进行强制清空数据，即使当前浏览器本地存储中不应该存在有数据。\r\n\r\n',i='The browser or browser mode does not support "browser local storage". The save function has been disabled, and no data will be stored. However, you can still use the "Delete Data" option to forcefully clear any data, even though there should not be any data present in the browser local storage.'),e="";break;case"D-AutoKeyRotation":a="  • TAKGPT 通过 Key 特征、第三方接口的关键词自动分类。如果未正确识别为第三方 Key ，则可以点击 [级别] 进行修改 (单向操作)。",a=(a=(a=(a=(a=(a+="\r\n\r\n  • 自动轮换 API Key 算法是根据订阅计划和免费计划的密钥特性设计的。结合 OpenAI 错误代码，根据实际使用情况动态标记 API Key 并智能调用，无需人工干预。")+"\r\n  • [自动轮换API Key] 与 [自动重问] 的结合：(第三方单Key模式下触发自动重问的情况会减少) 当请求出现错误时，会自动判断是否需要  [自动重问] 。为了提供更好的用户体验，自动重试不会无限制进行，有些情况会中止重试，而需要自动重试的情况会综合考虑错误类型、已重试次数和已等待时间来判断是否适合通过轮换 Key 来重发请求。"+"\r\n  • 自动轮换 API Key 功能不支持手动关闭。支持 Key 数量：1 个或以上。")+"\r\n  • 对于非付费用户，如果您有两个 OpenAI 免费计划的账号，将获得很好的体验。建议往 TAKGPT 添加每个 OpenAI 账号的 Key 的数量为 2～3 个 (虽然相同账号下的Key是共享请求配额的)，当然，每个账号只取  1 个 Key 也是可以的。"+"\r\n  • 单个添加和批量添加没有区别。单个添加时不会记录无效 Key，而批量添加时，无效 Key 会在被记录。")+'\r\n  • 批量添加仅支持以 "sk-" 开头的 Key，可识别两种格式：1）每行一个以"sk-"开头的 key；2）识别文本中带双引号的以"sk-"开头、长度为 51 位的 Key（支持不换行的文本，比如直接复制 JSON 文件的文本内容）。'+"\r\n  • 批量添加时，不会立即验证有效性。如果添加了大量无效 Key，请求过程中，当单次连续检测到 20 个无效 Key 时，检测会中止。")+"\r\n  • 可修改级别，点击 API Key 的级别，根据提示进行修改。通常不需要修改级别。如果您的付费 Key 没有被标记为付费，这不是一个问题，不会影响实际使用。当出现连续被调用的情况，并达到鉴别标准时，系统会自动标记为付费。这需要一个过程，取决于添加 Key 的数量、请求的频率以及 Key 是否独享的情况。"+'\r\n  • 如果想恢复之前被标记为"超出配额"的 Key，可以手动修改它的级别，优先改成 0 或 1。')+"\r\n  • 批量删除：[设置] > [删除数据]，删除所有 API Key 。"+"\r\n  • 如果需要修改 TAKGPT 的 JSON 数据文件，推荐 JSON 在线编辑工具：https://jsoneditoronline.org",i="  • TAKGPT uses key features and keywords from third-party interfaces to automatically categorize. If it is not correctly recognized as a third-party key, you can click [level] to modify it (one-way operation).",i=(i=(i=(i=(i=(i+="\r\n\r\n  • The algorithm of [Auto Key Rotation] is designed according to the characteristics of keys in subscription and free plans. Combining with OpenAI error codes, API Key is dynamically marked and intelligently called based on actual usage.")+'\r\n  • [Auto Key Rotation] and [Auto Retry]: (Under the "3rd party Key Mode", there will be fewer "Auto-Retry".) When a request encounters an error, the system will automatically determine whether to retry. To provide a better user experience, auto-retry will not be performed indefinitely. Some situations may stop retrying, while situations that require auto-retry will be judged comprehensively based on error types, number of retries, and waiting time to determine whether it is suitable to resend the request by rotating the Key.'+"\r\n  • [Auto Key Rotation] cannot be manually turned off. Supports Key quantity: 1 or more.")+"\r\n  • For non-paying users, if you have two OpenAI free plan accounts, you can get a better user experience. It is recommended to add 2-3 Keys for each OpenAI account added to TAKGPT (although Keys under the same account share request quota), and of course, only adding 1 Key for each account is also acceptable."+"\r\n  • There is no difference between adding a single Key or adding Keys in bulk. Invalid Keys will not be recorded when adding a single Key, while invalid Keys will be recorded when adding Keys in bulk.")+'\r\n  • [Bulk Add] only supports keys starting with "sk-", and it can recognize two formats: 1) one key starting with "sk-" per line; 2) a Key starting with "sk-" and with a length of 51 characters recognized in a text enclosed in double quotes (Supports text without line breaks, such as directly copying the text content of a JSON file.).'+"\r\n  • When adding Keys in bulk, the system will not immediately check their validity. If a large number of invalid Keys are added, the check will be stopped when 20 consecutive invalid Keys are detected during the request process.")+"\r\n  • The level can be modified by clicking on the level of the API Key and following the prompts. Usually, there is no need to modify the level. If your paid Key is not marked as a paid account, it is not an issue and will not impact actual usage. When a Key is called continuously and reaches the identification standard, it will be automatically marked as a paid account. This is a process that depends on the number of Keys added, request frequency, and whether the Key is exclusively used."+'\r\n  • If you want to restore a Key that was marked as "Quota exceeded", you can manually modify its level, preferably to 0 or 1.')+"\r\n  • Batch deletion: [Settings] > [Delete Data] > Delete all API Keys."+"\r\n  • If you want to modify the JSON file for TAKGPT, we recommend using an online JSON editor tool: https://jsoneditoronline.org",e="";break;default:a="",i="",e=""}t="cn"==this.settingsLanguage?a:i,this.showNotification(t,"center",e)},openDialogTodo_Settings(){this.inputApiURL=this.apiURL;let t=!(this.btnDisabledState_SaveApiURL=!0);"cn"===this.settingsLanguage?!(t=this.apiURLOptions_cn.some(t=>t.url===this.inputApiURL.toLowerCase()))&&this.isLoadThirdPartyPaidAPIs&&(t=this.apiURLOptions_LoadThirdPartyPaidAPIs.some(t=>t.url===this.inputApiURL.toLowerCase())):t=this.apiURLOptions_en.some(t=>t.url===this.inputApiURL.toLowerCase()),t?this.selectedApiURL=this.inputApiURL.toLowerCase():this.selectedApiURL="";var e="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en;this.inputGPTImageUrl=this.isgptGreenSvgShow?e:this.gptAvatarURL,this.inputUserImageUrl=this.userAvatarURL,this.btnDisabledState_updateUserImageUrl=!0,this.btnDisabledState_updateGPTImageUrl=!0,this.isShowDialog_Settings=!0},changeSimpleMode(t){if(!1!==t){let t="",e=6e3;e=this.isSimpleMode?(t="cn"==this.settingsLanguage?"默认模式 (简约模式，适合已熟悉新版本 TAKGPT 的用户)":"Normal Mode (Simple Mode, suitable for users familiar with the new version of TAKGPT.)","cn"==this.settingsLanguage?4500:6e3):(t="cn"==this.settingsLanguage?"新用户模式 (此模式下会增加功能提示，并提供更丰富的帮助内容)":"User Onboarding (this mode provides more functional prompts and richer help content.)","cn"==this.settingsLanguage?5500:6e3),this.showNotification(t,"bottom","",6e3)}document.documentElement.clientWidth<450?(this.isShowTotaltokensSVG=!0,this.isShowTotaltokensLabel=!1):(this.isShowTotaltokensSVG=!0,this.isShowTotaltokensLabel=!this.isSimpleMode),document.documentElement.clientWidth<471?this.isShowQACountLabel=!1:this.isShowQACountLabel=!this.isSimpleMode},showProConfig(){let t="";t=this.isShowProConfig?(this.isShowProConfig=!1,"cn"==this.settingsLanguage?"隐藏 API专业设置":"Hide Professional API Settings"):(this.isShowProConfig=!0,"cn"==this.settingsLanguage?"显示 API专业设置":"Show Professional API Settings"),this.showNotification(t,"bottom")},changeSmartMaxTokens(){this.isReminded_SmartMaxTokens=5;var t=this.openSmartMaxTokens?"已启用 智能max_tokens":"已关闭 智能max_tokens",e=this.openSmartMaxTokens?"Smart max_tokens Enabled":"Smart max_tokens Disabled",t="cn"==this.settingsLanguage?t:e;this.showNotification(t,"bottom")},isDisableZoomOnIOS(){var t=/iPad|iPhone|ios|iPod/.test(navigator.userAgent),e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),a=/Quark|quark/.test(navigator.userAgent);return!(!t&&!e||a)},changePageScaling(t){let e;!1===t?e=parseFloat(this.pageScaling):(e=parseFloat(this.selectedPageScaling)/100,this.selectedPageScaling=""),((e=isNaN(e)?.8:e)<.5||1<e)&&(e=.8),this.pageScaling=e.toFixed(2);var a=this.isDisableZoomOnIOS()?"user-scalable=no,":"user-scalable=yes,",a="width=device-width,initial-scale="+this.pageScaling+",minimum-scale=0.5,maximum-scale=2,"+a+"viewport-fit=cover";document.querySelector('meta[name="viewport"]').setAttribute("content",a),!1!==t&&(a=(100*parseFloat(this.pageScaling)).toFixed(0)+"%",t="cn"==this.settingsLanguage?"网页显示比例已改为 "+a+" (如果网页放大了，请双指操作缩小)":"Page display scale has been changed to "+a+" (If the page is zoomed in, use two fingers to zoom out).",a="cn"==this.settingsLanguage?6500:7500,this.showNotification(t,"bottom","",a),this.changeSimpleMode(!1))},isTotaltokens_Exceeds_Maxtokens(t){t=null!=t?t:this.gptModelList.find(t=>t.modelname===this.apiGPTModel);if(this.isModelDataExist_In_gptModelList(t),this.totaltokens>t.maxtokens){const e="cn"==this.settingsLanguage?"当前上下文记忆已使用的 tokens 数量为 "+this.totaltokens+" ，已超出当前模型支持的最大 max_tokens 数量 ( "+t.maxtokens+" )！\r\n请处理历史记录或切换到支持更大 max_tokens 的模型。\r\n\r\n当前模型(model):  "+this.apiGPTModel:"The current context has used "+this.totaltokens+" tokens, which exceeds the maximum max_tokens "+t.maxtokens+" supported by the current model! \r\nPlease handle the chat history or switch to a model that supports a larger max_tokens.\r\n\r\nThe current model: "+this.apiGPTModel;return setTimeout(()=>{alert(e)},80),!0}return!1},isModelDataExist_In_gptModelList(t){var e;t||(t='警告\r\n\r\n当前版本的 TAKGPT 代码中未包含当前模型 "'+this.apiGPTModel+'" ，这会产生一系列错误。\r\n\r\n解决方法：1) 在 [设置] 中更换一个现有的模型，即可解决问题。 2) 如果想使用模型 "'+this.apiGPTModel+'"，你可以更换含有该模型的 TAKGPT 版本，或者编辑 html 代码，将该模型资料添加到模型库中 (代码中搜索模型库变量名: gptModelList)。',e='Warnings\r\n\r\nThe current code does not include the current model "'+this.apiGPTModel+'", which will lead to many errors. \r\n\r\nTo resolve this issue, there are two possible solutions:  1) You can switch to a different existing model in the [Settings] to resolve the problem. 2) If you want to use the model "'+this.apiGPTModel+'", you can either switch to a TAKGPT version that includes this model or edit the code to add the model to the model library (search for the variable name "gptModelList").',t="cn"==this.settingsLanguage?t:e,alert(t))},changeGPTModel(){let t="";var e=this.gptModelList.find(t=>t.modelname===this.apiGPTModel);let a=!1;this.isTotaltokens_Exceeds_Maxtokens(e)?this.apiMaxTokens=e.maxtokens-1:(e.maxtokens>=this.totaltokens+1&&(200<(e=e.maxtokens-this.totaltokens)-this.apiMaxTokens||(this.apiMaxTokens=this.apiMaxTokens>e?e:this.apiMaxTokens,a=!0)),!a||this.openSmartMaxTokens||apiGPTModel.includes("gpt-3.5")?(t="cn"==this.settingsLanguage?'"GPT模型 (model)" 变更为 '+this.apiGPTModel:'"model" changed to '+this.apiGPTModel,this.showNotification(t,"bottom","",2e3)):(t="cn"==this.settingsLanguage?"不同模型的 max_tokens 上限不同，建议启用 [智能max_tokens] 功能":"The max_tokens limit varies for different models. Enable the [Smart max_tokens] feature for optimal results.",this.showNotification(t,"bottom","",5e3)))},changeTemperature(){var t="cn"==this.settingsLanguage?'"temperature" 变更为 '+this.apitemperature.toString():'"temperature" changed to '+this.apitemperature.toString();this.showNotification(t,"bottom","",1800)},changeMaxTokens(){var t;this.openSmartMaxTokens||(t="cn"==this.settingsLanguage?'"max_tokens" 变更为 '+this.apiMaxTokens.toString():'"max_tokens" changed to '+this.apiMaxTokens.toString(),this.showNotification(t,"bottom","",1800))},changeTopP(){var t="cn"==this.settingsLanguage?'"top_p" 变更为 '+this.apiTopP.toString():'"top_p" changed to '+this.apiTopP.toString();this.showNotification(t,"bottom","",1800)},changePresencePenalty(){var t="cn"==this.settingsLanguage?'"presence_penalty" 变更为 '+this.apiPresencePenalty.toString():'"presence_penalty" changed to '+this.apiPresencePenalty.toString();this.showNotification(t,"bottom","",1800)},changeFrequencyPenalty(){var t="cn"==this.settingsLanguage?'"frequency_penalty" 变更为 '+this.apiFrequencyPenalty.toString():'"frequency_penalty" changed to '+this.apiFrequencyPenalty.toString();this.showNotification(t,"bottom","",1800)},TAKGPTTokenizer(t){var e=[];const a=[];var i=[],s=[],n=[],o=[],r=[],l=t.match(/[\u2E80-\u9FFF]/g),l=(l&&e.push(...l),t.match(/\d+/g)),l=(l&&l.forEach(e=>{if(3<e.length)for(let t=0;t<e.length;t+=3)a.push(e.slice(t,t+3));else a.push(e)}),t.match(/[^\u2E80-\u9FFFa-zA-Z0-9\s]/g)),l=(l&&i.push(...l),t.match(/[a-zA-Z]+/g)),l=(l&&n.push(...l),t.match(/\s+[a-zA-Z]+/g)),l=(l&&s.push(...l),t.match(/\s+/g)),l=(l&&o.push(...l),t.match(/\s{2,}/g)),t=(l&&r.push(...l),n.length/.75),l=t+e.length/.83+ +a.length+i.length/1.3+((o.length-s.length<0?0:o.length-s.length)/1.3+r.length/2.5);return l*=1.05,Math.ceil(l)},autoAdjustMaxTokens(n){if(this.openSmartMaxTokens&&!this.isFixingMaxTokens_SmartMaxTokens){var o=this.gptModelList.find(t=>t.modelname===this.apiGPTModel);if(this.isModelDataExist_In_gptModelList(o),0!=this.userMsgTokensForRetry)this.apiMaxTokens=o.maxtokens-this.totaltokens,4097<this.apiMaxTokens?this.apiMaxTokens=this.apiMaxTokens-600:3500<this.apiMaxTokens?this.apiMaxTokens=this.apiMaxTokens-350:2600<this.apiMaxTokens?this.apiMaxTokens=this.apiMaxTokens-300:1500<this.apiMaxTokens?this.apiMaxTokens=this.apiMaxTokens-200:600<this.apiMaxTokens&&(this.apiMaxTokens=this.apiMaxTokens-100);else{let e=0;try{e=this.TAKGPTTokenizer(n)}catch(t){e=Math.ceil(.75*n.length);var n="cn"==this.settingsLanguage?"\r\n\r\nSafari?(不排除是浏览器兼容性问题) 出错了(this.TAKGPTTokenizer - 估算tokens时出错了)，可能是因为您发的内容太太太大了～\r\n请避免发送大量文本，建议您撤回刚刚发送的内容。大量文本会占用本地存储空间，而浏览器本地存储通常只支持5-10MB的容量。发送大量文本可能会导致自动保存不断失败而频繁报错。":"\r\n\r\nSafari?(It is possible that this is a browser compatibility issue.) Oops, an error occurred (this.TAKGPTTokenizer - There seems to be an error in the token calculation), possibly because the content you provided is tooooo large!\r\nPlease avoid sending large amounts of text. It is recommended that you withdraw the content you just sent. Large amounts of text can occupy local storage space, and browser local storage usually supports a capacity of only 5-10MB. Sending large amounts of text may result in frequent errors due to continuous failure of automatic saving.";this.showNotification("Error Message: "+t.message+n,"center","Error - this.TAKGPTTokenizer")}this.msgContent.length<2?(e+=13,""!=(n=this.msgContent[0].content)&&(n=this.TAKGPTTokenizer(n),e+=n)):e+=10;let a=o.maxtokens-this.totaltokens-e,t=0,i=0,s=0;if(o.maxtokens<4100&&e<500?t=200-150*e/500:16300<o.maxtokens&&e<500&&(i=200-150*e/500),4100<o.maxtokens&&(s=a/4096*400),15800<a&&16300<o.maxtokens&&o.maxtokens<16400)a=a-400+i;else if(15e3<a&&16300<o.maxtokens&&o.maxtokens<16400)a=a-370+i;else if(4096<a)a-=s;else if(3500<a)a=a-400+t;else if(2500<a)a=a-370+t;else if(1500<a)a-=300;else if(1e3<a)a-=250;else if(600<a)a-=200;else if(500<a)a-=100;else if(300<a)a-=80;else if(100<a)a-=35;else if(25<a)a-=10;else if(0<a)a=0<a-3?a-3:a;else{let t=e/6;n=this.apiCheckedData.filter(t=>[0,1,2,3].includes(t.level)).length;3<=n||this.apiCheckedData.some(t=>0===t.level)?t=e/4:2<=n&&(t=e/5.3),a=50<=t?t:50}this.apiMaxTokens=Math.ceil(a)}}},saveApiURL(){if(!this.checkBusyStatus()){let t="";if(""==this.inputApiURL.trim()){this.inputApiURL=this.OpenAI_API_URL,this.apiURL=this.inputApiURL,this.selectedApiURL=this.inputApiURL,this.btnDisabledState_SaveApiURL=!0,this.check_KeyMode_byURL_ChangeKey(),t="cn"==this.settingsLanguage?"已重置为OpenAI官方接口":"API URL (endpoint) has been restored to the OpenAI link.";var a="cn"==this.settingsLanguage?2500:3800;this.showNotification(t,"bottom","",a)}else{let e=!1;try{e=this.apiURLOptions_cn.some(t=>t.url.trim()===this.inputApiURL.toLowerCase().trim())||this.apiURLOptions_en.some(t=>t.url.trim()===this.inputApiURL.toLowerCase().trim())||this.apiURLOptions_LoadThirdPartyPaidAPIs.some(t=>t.url.trim()===this.inputApiURL.toLowerCase().trim())}catch(t){e=!1}if(!e){if(!/^(https?|http):\/\/[^\s/$.?#]+\.[^\s]*$/.test(this.inputApiURL.toLowerCase().trim()))return t="cn"==this.settingsLanguage?"网址格式错误，请输入以 https:// 或 http:// 开头的完整的接口网址后重新保存":"URL format is incorrect. Please enter a complete API URL starting with https:// or http:// and save again.",this.settingsLanguage,void this.showNotification(t,"bottom","",3800);if(!this.inputApiURL.toLowerCase().trim().endsWith("/v1/chat/completions"))if(t="cn"==this.settingsLanguage?'GPT-3.5、GPT-4 聊天接口网址的标准格式应以 "/v1/chat/completions" 结尾，如官方接口 "https://api.openai.com/v1/chat/completions"。\r\n\r\n但不排除此接口是可用的，请确认是否继续保存？':'The standard format for the GPT-3.5 and GPT-4 chat API URL should end with "/v1/chat/completions", such as the OpenAI API "https://api.openai.com/v1/chat/completions".\r\n\r\nHowever, it is not ruled out that the current API URL is usable. Please confirm if you want to continue saving?',!confirm(t))return}this.apiURL=this.inputApiURL.trim(),this.btnDisabledState_SaveApiURL=!0;var a=this.isThirdPartyAPIKeyEnabled,i=this.check_KeyMode_byURL();if(a&&!i&&this.check_KeyMode_byURL_ChangeKey(a,i),t="cn"==this.settingsLanguage?"保存成功":"Save successful",this.showNotification(t,"bottom"),this.isThirdPartyAPIKeyEnabled){let t=0;this.apiCheckedData.filter(t=>"third-party"===t.vpn&&t.apiurl.toLowerCase()===this.apiURL.toLowerCase()).length<1&&(t=1e3,this.btnDisabledState_CheckAPI)&&(this.api="",this.changeButtonDisabledState(!0)),setTimeout(()=>{this.restoreApiKeyInput(!1,!1)},t)}}}},loadThirdPartyPaidAPIs(){this.isLoadThirdPartyPaidAPIs=!this.isLoadThirdPartyPaidAPIs;let t=!1;var e;"cn"===this.settingsLanguage?!(t=this.apiURLOptions_cn.some(t=>t.url===this.inputApiURL.toLowerCase()))&&this.isLoadThirdPartyPaidAPIs&&(t=this.apiURLOptions_LoadThirdPartyPaidAPIs.some(t=>t.url===this.inputApiURL.toLowerCase())):t=this.apiURLOptions_en.some(t=>t.url===this.inputApiURL.toLowerCase()),t?this.selectedApiURL=this.inputApiURL.toLowerCase():this.selectedApiURL="",e="cn"==this.settingsLanguage?this.isLoadThirdPartyPaidAPIs?"已显示第三方代理平台 (在右侧预设选项中)":"已隐藏第三方代理平台 (右侧预设选项)":this.isLoadThirdPartyPaidAPIs?"Third-party API displayed (in the pre-set option on the right)":"Third-party API hidden (pre-set option on the right)",this.showNotification(e,"bottom","",2900)},updateInputApiURL(){this.inputApiURL=this.selectedApiURL,this.saveApiURL()},inputApiURLChange(){this.selectedApiURL="",this.btnDisabledState_SaveApiURL=!1},checkBusyStatus(t){let e="";return this.isSendingNow||this.isSendingNow_ForSmartMaxTokens?(e="cn"==this.settingsLanguage?"正在发送消息，请等发送结束后再继续操作":"Sending message, please wait until finished before continuing.",this.showNotification(e,"bottom","",2900),!0):this.isCheckingApiKeyNow?(e="cn"==this.settingsLanguage?"正在验证 API Key，请等验证结束后再继续操作":"Verifying API Key, please wait until finished before continuing.",this.showNotification(e,"bottom","",2900),!0):!("ForChat"!==t||!this.localStorageEvent_chatDataList_update_start||(e="cn"==this.settingsLanguage?"正在标签页之间同步数据，请1～2秒后再继续操作":"Synchronizing data between tabs, please wait 1 to 2 seconds before continuing.",this.showNotification(e,"bottom","",3900),0))},inputImageUrlChange(t){"user"==t?this.btnDisabledState_updateUserImageUrl=!1:this.btnDisabledState_updateGPTImageUrl=!1},updateSelectedImage(t){var e=this.selectedImageUrl;if(this.selectedImageUrl="","Change-GPT-Green-SVG"==e)"gpt"==t&&(this.inputGPTImageUrl="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en);else{if("uploadimage"==e)return void this.openFileDialog_Avatar(t);"user"==t?this.inputUserImageUrl=e:this.inputGPTImageUrl=e}this.updateAvatar(t)},updateAvatar(a,t){let e="",i="",s=!1!==t||t;""==(e=("user"==a?this.inputUserImageUrl:this.inputGPTImageUrl).trim())?(i="cn"==this.settingsLanguage?"图片的网址为空":"Image URL is empty",s&&this.showNotification(i,"bottom")):"user"==a||e!=this.GPTGreenSVG_UrlText_cn&&e!=this.GPTGreenSVG_UrlText_en?(t=new Image,i="cn"==this.settingsLanguage?"更换中...":"Updating...",s&&this.showNotification(i,"bottom","",2900),t.onload=()=>{"user"==a?(this.userAvatarURL=this.inputUserImageUrl,this.btnDisabledState_updateUserImageUrl=!0):(this.gptAvatarURL=this.inputGPTImageUrl,this.isgptGreenSvgShow=!1,this.btnDisabledState_updateGPTImageUrl=!0),i="cn"==this.settingsLanguage?"已更换头像":"Avatar has been updated",s&&setTimeout(()=>{this.showNotification(i,"bottom")},1250)},t.onerror=()=>{"user"==a?this.btnDisabledState_updateUserImageUrl=!1:this.btnDisabledState_updateGPTImageUrl=!1;let t="cn"==this.settingsLanguage?"无法使用该图片作为头像，请选择其他图片":"Unable to use this image as an avatar. Please select another image.";var e;s?(clearTimeout(this.notificationTimeoutId),setTimeout(()=>{this.isShowNotification=!1,this.notificationTimeoutId=-1},600),setTimeout(()=>{alert(t)},800)):"user"==a&&"https://tak.teamdts.online/me-bili.jpg"===this.userAvatarURL||(e="cn"==this.settingsLanguage?"user"==a?"[用户头像]":"[GPT头像]":"user"==a?"[User Avatar]":"[GPT Avatar]",i="cn"==this.settingsLanguage?e+" 未能加载":e+" failed to load",e=this.isShowNotification?5e3:200,setTimeout(()=>{this.showNotification(i,"bottom","",2e3)},e))},t.src=e):(this.gptAvatarURL="",this.isgptGreenSvgShow=!0,this.btnDisabledState_updateGPTImageUrl=!0,i="cn"==this.settingsLanguage?"已更换头像":"Avatar has been updated",s&&this.showNotification(i,"bottom"))},addInput_FileDialog_Avatar(o){var t="user"==o?document.getElementById("inputFileAvatar-user"):document.getElementById("inputFileAvatar-gpt"),e=document.getElementById("dialog-settings"),a=document.getElementById("div-upload-userAvataror"),i=document.getElementById("div-upload-gptAvataror"),s=document.getElementById("div-upload-gptAvataror-SVG");t&&("user"==o?a.onclick=null:(i.onclick=null,s.onclick=null),t.onchange=null,e.removeChild(t));const n=document.createElement("input");return n.type="file",n.accept="image/*",n.style.display="none",n.id="user"==o?"inputFileAvatar-user":"inputFileAvatar-gpt",e.appendChild(n),"user"==o?a.onclick=()=>n.click():(i.onclick=()=>n.click(),s.onclick=()=>n.click()),n.onchange=t=>{let a="",i="bottom";if(t.target&&t.target.files&&0!=t.target.files.length){var t=t.target.files[0],e=t.size/1024,s=URL.createObjectURL(t);if("user"==o)if(350<e)a="cn"==this.settingsLanguage?"上传的图片大小超过了 350KB (0.35MB)，因此无法保存到浏览器本地存储 (localStorage) 中。这不会影响使用，只是在刷新或重新打开网页后，[用户头像]会失效，需要重新上传。\r\n\r\n  • localStorage容量有限，所以限制只存储大小在 350KB (0.35MB) 以内的1张图片，且只能是[用户头像]。\r\n  • 上传的图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输。":"The image you uploaded exceeds 350KB (0.35MB) in size and cannot be stored in the browser's local storage (localStorage). This will not affect usage, but the [User Avatar] will need to be re-uploaded when the page is reopened or refreshed.\r\n\r\n  • Due to limited capacity, localStorage restricts the storage of only one image under 350KB (0.35MB) and it can only be the user avatar. \r\n  • The uploaded images will only be stored in your browser cache and will not be transmitted over the network.",i="center";else{this.userAvatarUp_blobUrl=s,this.userAvatarUp_blob=t;const n=new FileReader;n.readAsDataURL(t),n.onload=()=>{this.userAvatarUp_base64=n.result},a="cn"==this.settingsLanguage?"上传成功（图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输）":"Upload successful (the image will only be stored in the browser cache and will not be transmitted over the network).",i="bottom"}else a="cn"==this.settingsLanguage?"上传的[GPT头像]，不会存储到浏览器本地存储 (localStorage) 中，在刷新或重新打开网页后，上传的[GPT头像]将会失效，需要重新上传。\r\n\r\n  • localStorage容量有限，所以限制只存储大小在 350KB (0.35MB) 以内的1张图片，且只能是[用户头像]。\r\n  • 上传的图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输。":"The uploaded [GPT Avatar] will not be stored in the browser's local storage (localStorage). After reopening or refreshing the page, the uploaded [GPT Avatar] will become invalid and need to be re-uploaded.\r\n\r\n  • Due to limited capacity, localStorage restricts the storage of only one image under 350KB (0.35MB) and it can only be the [User Avatar]. \r\n  • The uploaded images will only be stored in your browser cache and will not be transmitted over the network.",i="center";"user"==o?this.inputUserImageUrl=s:this.inputGPTImageUrl=s,this.updateAvatar(o,!0),this.addInput_FileDialog_Avatar(o),setTimeout(()=>{var t="cn"==this.settingsLanguage?5200:6500,e="cn"==this.settingsLanguage?"提醒":"Tip";this.showNotification(a,i,e,t)},2600)}},n},openFileDialog_Avatar(t){var e="user"==t?document.getElementById("inputFileAvatar-user"):document.getElementById("inputFileAvatar-gpt"),t=(e||this.addInput_FileDialog_Avatar(t),e.click(),/iPad|iPhone|ios|iPod/.test(navigator.userAgent)&&!window.MSStream),e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);(t||e)&&(t="cn"==this.settingsLanguage?"Safari浏览器(Mac/iPhone)与iPhone全系列机型，仅支持通过点击右侧头像来上传图片":'For Safari (Mac/iPhone) and iPhone users, uploading images is only supported by clicking the "Avatar" on the right-hand side.',e="cn"==this.settingsLanguage?5500:7300,this.showNotification(t,"bottom","",e))},changeLanguage(){window.currentlang=this.settingsLanguage,"先验证API"==this.sentext||"Check API First"==this.sentext?this.sentext="cn"==this.settingsLanguage?"先验证API":"Check API First":"发送"==this.sentext||"Send"==this.sentext?this.sentext="cn"==this.settingsLanguage?"发送":"Send":"API Key错误"==this.sentext||"API Key Error"==this.sentext?this.sentext="cn"==this.settingsLanguage?"API Key错误":"API Key Error":"重新验证API"==this.sentext||"Recheck API"==this.sentext?this.sentext="cn"==this.settingsLanguage?"重新验证API":"Recheck API":"请重发"!=this.sentext&&"Please Retry"!=this.sentext||(this.sentext="cn"==this.settingsLanguage?"请重发":"Please Retry"),"已验证"==this.apibtntext||"Checked"==this.apibtntext?this.apibtntext="cn"==this.settingsLanguage?"已验证":"Checked":"<< 验证"!=this.apibtntext&&"<< Check"!=this.apibtntext||(this.apibtntext="cn"==this.settingsLanguage?"<< 验证":"<< Check"),this.inputGPTImageUrl.trim()!=this.GPTGreenSVG_UrlText_cn&&this.inputGPTImageUrl.trim()!=this.GPTGreenSVG_UrlText_en||(this.inputGPTImageUrl="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en)},changeContextualMode(){var t="cn"==this.settingsLanguage?"当前对话的 [记忆模式] 已变更"+(this.isSimpleMode?"":"。 提示: 每个对话的 [记忆模式] 都是独立的"):"The [Contextual Mode] of the current Chat has been changed."+(this.isSimpleMode?"":"  Tip: The [Contextual Mode] of each Chat is independent."),e="cn"==this.settingsLanguage?this.isSimpleMode?1600:2500:this.isSimpleMode?1900:3e3;this.showNotification(t,"bottom","",e)},changeStyle_FontSize(){},changeStyle_Time_WechatStyle(){let e=this.settingsTime_WechatStyle?"20px":"33px";document.querySelectorAll(".newcontext-hr").forEach(function(t){t.style.marginBottom=e})},changeStyle_Time(){},changeStyle_DividerLine(){let e=this.settingsDividerLine?"block":"none";document.querySelectorAll(".newcontext-hr").forEach(function(t){t.style.display=e})},handleShortcut(t){var e=t.key||t.keyCode||t.which;if("F1"===e||112===e){if(t.preventDefault(),!this.settingsShortcut_Clear)return;if(this.btnDisabledState_Clear)return;if(this.isShowDialog_Settings)return;if(this.isShowDialog_PromptGenerator)return;if(this.isShowNotification&&"center"===this.setNotificationPosition)return;if(this.isShowDialog_ChatList)return;if(this.isShowDialog_AutoKeyRotation)return;this.clearContext()}if("F2"===e||113===e){if(t.preventDefault(),!this.settingsShortcut_CheckApiKey)return;if(this.isShowNotification&&"center"===this.setNotificationPosition)return;if(this.isShowDialog_AutoKeyRotation)return void(this.isShowDialog_AutoKeyRotation=!1);this.clickOpenAutoKeyRotation()}if("F3"===e||114===e){if(t.preventDefault(),!this.settingsShortcut_Undo)return;if(this.btnDisabledState_Undo)return;if(this.isShowDialog_Settings)return;if(this.isShowDialog_PromptGenerator)return;if(this.isShowNotification&&"center"===this.setNotificationPosition)return;if(this.isShowDialog_ChatList)return;if(this.isShowDialog_AutoKeyRotation)return;this.undo()}"F4"!==e&&115!==e||(t.preventDefault(),!this.settingsShortcut_Retry)||this.btnDisabledState_Undo||this.isShowDialog_Settings||this.isShowDialog_PromptGenerator||this.isShowNotification&&"center"===this.setNotificationPosition||this.isShowDialog_ChatList||this.isShowDialog_AutoKeyRotation||this.retry()},findMaxBackticks(e){let a,i;if(a="`{5}",(i=new RegExp(a)).test(e)){for(let t=6;t<=100;t++)if(a="`".repeat(t),!(i=new RegExp(a)).test(e))return"`".repeat(t)}else for(let t=4;3<=t;t--)if(a="`".repeat(t),(i=new RegExp(a)).test(e))return"`".repeat(t+1);return""},addSystemPromptToChatHistory(t,e){let a=/\r?\n\r?\n/.test(this.gptSystemPromptReadOnly.trim());var i=this.findMaxBackticks(this.gptSystemPromptReadOnly.trim());a=""!=i||a,i=""==i?"````":i;let s=(a=this.chatHistoryPromptOnlyUseBackticks?!0:a)?"\r\n"+i+"\r\n":"\r\n> ",n=a?"\r\n"+i+"\r\n\r\n":"\r\n\r\n",o="";""==this.gptSystemPromptReadOnly.trim()&&(o="cn"==this.settingsLanguage?": 空":": None",s="\r\n",n="\r\n");i="cn"==this.settingsLanguage?t+o+s:e+o+s;this.chathistory+=i+this.gptSystemPromptReadOnly.trim()+n},restoreDefault_APISettings(){this.openSmartMaxTokens=!0,this.apitemperature=JSON.parse(JSON.stringify(this.userVariables_default.apitemperature)),this.apiMaxTokens=JSON.parse(JSON.stringify(this.userVariables_default.apiMaxTokens)),this.apiGPTModel=JSON.parse(JSON.stringify(this.userVariables_default.apiGPTModel));var t="cn"==this.settingsLanguage?"API设置 已恢复默认值":"API Settings have been reset to default values.",e="cn"==this.settingsLanguage?2500:3300;this.showNotification(t,"bottom","",e)},restoreDefault_ProfessionalAPISettings(){var t,e;this.checkBusyStatus()||(this.apiTopP=JSON.parse(JSON.stringify(this.userVariables_default.apiTopP)),this.apiPresencePenalty=JSON.parse(JSON.stringify(this.userVariables_default.apiPresencePenalty)),this.apiFrequencyPenalty=JSON.parse(JSON.stringify(this.userVariables_default.apiFrequencyPenalty)),t="cn"==this.settingsLanguage?"API专业设置 已恢复默认值。 提示: 接口网址 (API URL) 需手动修改":"Professional API Settings have been reset to default values. Tip: API URL (Endpoint) needs to be manually modified.",e="cn"==this.settingsLanguage?5e3:6500,this.showNotification(t,"bottom","",e))},restoreDefault_GeneralSettings(){var t,e;this.checkBusyStatus()||(this.settingsFontSize=JSON.parse(JSON.stringify(this.userVariables_default.settingsFontSize)),this.changeStyle_FontSize(),this.settingsTime_WechatStyle=JSON.parse(JSON.stringify(this.userVariables_default.settingsTime_WechatStyle)),this.changeStyle_Time_WechatStyle(),this.settingsTime_Message=JSON.parse(JSON.stringify(this.userVariables_default.settingsTime_Message)),this.changeStyle_Time(),this.settingsDividerLine=JSON.parse(JSON.stringify(this.userVariables_default.settingsDividerLine)),this.changeStyle_DividerLine(),this.settingsShortcut_CheckApiKey=JSON.parse(JSON.stringify(this.userVariables_default.settingsShortcut_CheckApiKey)),this.settingsShortcut_Clear=JSON.parse(JSON.stringify(this.userVariables_default.settingsShortcut_Clear)),this.settingsShortcut_Undo=JSON.parse(JSON.stringify(this.userVariables_default.settingsShortcut_Undo)),this.settingsShortcut_Retry=JSON.parse(JSON.stringify(this.userVariables_default.settingsShortcut_Retry)),t="cn"==this.settingsLanguage?"常规设置 已恢复默认设置。 提示: 记忆模式、语言和头像设置需手动修改":"General Settings have been reset to default values. Tip: Contextual Mode, Language, and Avatar settings need to be manually modified.",e="cn"==this.settingsLanguage?5e3:6500,this.showNotification(t,"bottom","",e))},clickOpenChatList(){this.isShowDialog_ChatList=!0;var t="cn"==this.settingsLanguage?"在聊天界面中，点击任意头像可快速打开对话列表":"In the chat interface, clicking on any avatar quickly opens the chat list.";this.showNotification(t,"bottom","",6500)},clickOpenPromptGenerator(){this.isShowDialog_PromptGenerator=!0;var t="cn"==this.settingsLanguage?"在聊天界面中，点击斜杆 (/) 可快速打开提示词窗口":"In the chat interface, clicking on the slash (/) quickly opens the Prompt Generator.";this.showNotification(t,"bottom","",6500)},changeSelectedExportChatHistory(){var t=this.selectedExportChatHistory,e=(this.selectedExportChatHistory="","cn"==this.settingsLanguage?"正在导出 { #"+this.chatid+" } 的聊天记录":"Exporting chat history of { #"+this.chatid+" }");this.showNotification(e,"bottom","",4e3),"ChatHistory_Single_MD"==t?this.ExportData_SingleRound(!0,!0,!1,"markdown"):"ChatHistory_Single_TXT"==t?this.ExportData_SingleRound(!0,!0,!1,"plain"):"ChatHistory_ALL_MD"==t?this.ExportData(this.chathistory,this.exportTXTFileName,"markdown"):"ChatHistory_ALL_TXT"==t&&this.ExportData(this.chathistory,this.exportTXTFileName,"plain")},changeSelectedDeleteLocalStorageData(){if(this.checkBusyStatus("ForChat"))this.selectedDeleteLocalStorageData="";else{let e="",t=2e3,a=0;this.isLocalStorageSupported||(e="cn"==this.settingsLanguage?"正在尝试强制清除浏览器本地存储(localStorage)...":"Forcefully deleting browser local storage in progress..."),""!==(e=this.isLocalStorageAllowed?e:"cn"==this.settingsLanguage?"正在尝试强制清除浏览器本地存储(localStorage)...":"Forcefully deleting browser local storage in progress...")&&(this.showNotification(e,"bottom","",3500),a=2500),e="";var i=this.selectedDeleteLocalStorageData;this.selectedDeleteLocalStorageData="";try{"DeleteAllData"===i?(localStorage.removeItem("chatDataList"),localStorage.removeItem("apikeyData"),localStorage.removeItem("promptsData"),localStorage.removeItem("userSettings"),e="cn"==this.settingsLanguage?"已删除所有数据":"All data has been deleted",this.chatDataList=[],this.chatList_addNewChatData(!0),this.setVariablesToThis(this.apikeyData_default,this.apikeyData_default,!0),this.lastAPIKeyInputText="",((this.lastAPIKeyInputText_Available="")!==this.defaultAPIKey||0<this.default_apiKeyArray_WrittenInTheCode.length)&&(e+="cn"==this.settingsLanguage?"。（密钥: 部分写在代码里的 API Key 无法被删除，刷新后会恢复）":". (API keys: Some API Keys written in the code cannot be deleted and will be restored after refreshing.)",t=7e3),this.setVariablesToThis(this.promptsData_default,this.promptsData_default,!0),this.btnDisabledState_SetSystemPrompt=!1,this.userAvatarUp_base64="",this.userAvatarUp_blob=null,this.userAvatarUp_blobUrl="",this.inputUserImageUrl="https://tak.teamdts.online/me-bili.jpg",this.updateAvatar("user",!1),this.inputGPTImageUrl="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en,this.updateAvatar("gpt",!1),this.setVariablesToThis(this.userVariables_default,this.userVariables_default,!0),this.inputApiURL=this.apiURL,this.selectedApiURL=this.inputApiURL,this.settingsContextualMode=JSON.parse(JSON.stringify(this.chatVariables_default.settingsContextualMode)),this.openSmartMaxTokens=!0,this.changePageScaling(!1),this.changeLanguage(),this.changeSimpleMode(!1),this.inputapichange(!1),this.btnDisabledState_SaveApiURL=!0,this.changeStyle_FontSize(),this.changeStyle_Time_WechatStyle(),this.changeStyle_Time(),this.changeStyle_DividerLine(),localStorage.removeItem("chatDataList"),localStorage.removeItem("apikeyData"),localStorage.removeItem("promptsData"),localStorage.removeItem("userSettings")):"DeleteChatDataList"===i?(this.chatDataList=[],localStorage.removeItem("chatDataList"),this.chatList_addNewChatData(!0),e="cn"==this.settingsLanguage?"已删除所有对话数据":"All chat data has been deleted"):"DeleteAPIKeyData"===i?(localStorage.removeItem("apikeyData"),this.setVariablesToThis(this.apikeyData_default,this.apikeyData_default,!0),this.inputapichange(!1),this.lastAPIKeyInputText="",this.lastAPIKeyInputText_Available="",e="cn"==this.settingsLanguage?"已删除密钥 (API Key) 数据":"API Keys data has been deleted",(""!==this.defaultAPIKey||0<this.default_apiKeyArray_WrittenInTheCode.length)&&(e+="cn"==this.settingsLanguage?"。 部分写在代码里的 API Key 无法被删除，刷新后会恢复":". Some API Keys written in the code cannot be deleted and will be restored after refreshing.",t=6e3)):"DeletePromptsData"===i?(localStorage.removeItem("promptsData"),this.setVariablesToThis(this.promptsData_default,this.promptsData_default,!0),this.btnDisabledState_SetSystemPrompt=!1,e="cn"==this.settingsLanguage?"已删除提示词数据":"Prompts data has been deleted"):"DeleteUploadedUserAvatar"===i?(this.userAvatarUp_base64="",this.userAvatarUp_blob=null,this.userAvatarUp_blobUrl="",this.inputUserImageUrl="https://tak.teamdts.online/me-bili.jpg",this.updateAvatar("user",!1),this.localStorage_SaveData(null,"userSettings"),e="cn"==this.settingsLanguage?"已删除上传的用户头像":"Uploaded user avatar have been deleted"):"DeleteSettingsData"===i&&(this.userAvatarUp_base64="",this.userAvatarUp_blob=null,this.userAvatarUp_blobUrl="",this.inputUserImageUrl="https://tak.teamdts.online/me-bili.jpg",this.updateAvatar("user",!1),this.inputGPTImageUrl="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en,this.updateAvatar("gpt",!1),localStorage.removeItem("userSettings"),this.setVariablesToThis(this.userVariables_default,this.userVariables_default,!0),this.inputApiURL=this.apiURL,this.selectedApiURL=this.inputApiURL,this.openSmartMaxTokens=!0,this.changePageScaling(!1),this.changeLanguage(),this.changeSimpleMode(!1),this.inputapichange(!1),this.btnDisabledState_SaveApiURL=!0,this.changeStyle_FontSize(),this.changeStyle_Time_WechatStyle(),this.changeStyle_Time(),this.changeStyle_DividerLine(),e="cn"==this.settingsLanguage?"已删除设置数据":"Settings data has been deleted"),setTimeout(()=>{this.showNotification(e,"bottom","",t)},a)}catch(t){e="cn"==this.settingsLanguage?"出错了\r\n\r\n错误信息："+t.message:"Error\r\n\r\nError Message: "+t.message,this.showNotification(e,"center","Error - changeSelectedDeleteLocalStorageData()"),console.error("changeSelectedDeleteLocalStorageData() - 删除数据",t)}}},changeSelectedExportLocalStorageData(){if(this.checkBusyStatus("ForChat"))this.selectedExportLocalStorageData="";else if(this.isLocalStorageSupported){this.isLocalStorageAllowed;let s="",n=this.selectedExportLocalStorageData;this.selectedExportLocalStorageData="";try{this.localStorage_SaveData(null,null),setTimeout(()=>{this.localStorage_SaveData(null,null);let t=this.exportJSONFileName,a={};if("ExportAllData"===n){if(s="cn"==this.settingsLanguage?"正在导出JSON文件 - 所有数据":"Exporting JSON file - All Data",["userSettings","chatDataList","apikeyData","promptsData"].forEach(function(t){var e=localStorage.getItem(t);null!=e&&(a[t]=JSON.parse(e))}),0==Object.keys(a).length)return s="cn"==this.settingsLanguage?"浏览器本地存储(localStorage) - 数据为空，中止导出":"No data available for export in the browser's local storage.",void this.showNotification(s,"bottom","",5500);t+="AllData"}else if("ExportChatDataList"===n){s="cn"==this.settingsLanguage?"正在导出JSON文件 - 所有对话数据":"Exporting JSON file - All Chat Data";var e=localStorage.getItem("chatDataList");if(null==e)return s="cn"==this.settingsLanguage?"浏览器本地存储(localStorage) - 无对话数据，中止导出":"No Chat Data available for export in the browser's local storage.",void this.showNotification(s,"bottom","",5500);a.chatDataList=JSON.parse(e),t+="AllChatData"}else if("ExportAPIKeyData"===n){s="cn"==this.settingsLanguage?"正在导出JSON文件 - 密钥/API Key数据":"Exporting JSON file - API Keys Data";var e=localStorage.getItem("apikeyData"),i=JSON.parse(e);if(null==e||null==i||""===i.api&&(null==i.apiCheckedData||0===i.apiCheckedData.length))return s="cn"==this.settingsLanguage?"浏览器本地存储(localStorage) - 无密钥/API Key数据，中止导出":"No API Keys Data available for export in the browser's local storage.",void this.showNotification(s,"bottom","",5500);a.apikeyData=JSON.parse(e),t+="APIKeyData"}else if("ExportPromptsData"===n){s="cn"==this.settingsLanguage?"正在导出JSON文件 - 提示词数据":"Exporting JSON file - Prompt Generator Data";var i=localStorage.getItem("promptsData");if(null==i)return s="cn"==this.settingsLanguage?"浏览器本地存储(localStorage) - 无提示词数据，中止导出":"No Prompt Generator Data available for export in the browser's local storage.",void this.showNotification(s,"bottom","",5500);a.promptsData=JSON.parse(i),t+="PromptsData"}else if("ExportSettingsData"===n){s="cn"==this.settingsLanguage?"正在导出JSON文件 - 设置数据":"Exporting JSON file - Settings Data";e=localStorage.getItem("userSettings");if(null==e)return s="cn"==this.settingsLanguage?"浏览器本地存储(localStorage) - 无设置数据，中止导出":"No Settings Data available for export in the browser's local storage.",void this.showNotification(s,"bottom","",5500);a.userSettings=JSON.parse(e),t+="SettingsData"}this.showNotification(s,"bottom","",4e3),i=JSON.stringify(a),this.ExportData_JSON(i,t)},150)}catch(t){s="cn"==this.settingsLanguage?"出错了\r\n\r\n错误信息："+t.message:"Error\r\n\r\nError Message: "+t.message,this.showNotification(s,"center","Error - changeSelectedExportLocalStorageData()"),console.error("changeSelectedExportLocalStorageData() - 导出数据",t)}}},importLocalStorageData(){if(!this.checkBusyStatus("ForChat")){let m="";const y=this.settingsLanguage;if(this.isLocalStorageSupported||(m="cn"==this.settingsLanguage?"当前浏览器或浏览器模式不支持本地存储(localStorage)功能":"The browser or browser mode does not support local storage."),""!==(m=this.isLocalStorageAllowed?m:"cn"==this.settingsLanguage?"当前浏览器本地存储已被禁用，导入功能不可用":"The browser's local storage has been disabled and cannot be imported."))this.showNotification(m,"bottom","",3500);else{m="";try{this.localStorage_SaveData(null,null),setTimeout(()=>{this.localStorage_SaveData(null,null);var t=document.getElementById("inputFileImportData"),e=document.getElementById("dialog-settings");t&&(t.onchange=null,e.removeChild(t));let a=document.createElement("input");a.type="file",a.accept=".json",a.style.display="none",a.id="inputFileImportData",e.appendChild(a),a.onchange=t=>{var e,t=t.target.files[0];t&&((e=new FileReader).onload=e=>{try{var i=e.target.result,a=JSON.parse(i);if(null==a||"object"!=typeof a)m="cn"==this.settingsLanguage?"文件错误，非TAKGPT的数据文件":"File error, not a data file for TAKGPT",this.showNotification(m,"bottom","",6e3);else if(a.hasOwnProperty("chatDataList")||a.hasOwnProperty("apikeyData")||a.hasOwnProperty("promptsData")||a.hasOwnProperty("userSettings")){if(m="cn"==y?"导入的数据清单：":"Imported data list:",a.hasOwnProperty("chatDataList")){var s=a.chatDataList;let t=0,n=0,o=0,r=0;s.forEach(e=>{let a=!1,i=e.chatcreatedtime,s=e.chatid;this.chatDataList.forEach(t=>{t.chatcreatedtime===e.chatcreatedtime&&(JSON.stringify(t)===JSON.stringify(e)?(a=!0,n++):(i=this.newChatCreatedTime_ForCopyChatData(e),s+="cn"==this.settingsLanguage?" 副本[导入冲突]":" Copy [Import Conflict]",o++))}),a||(e.chatcreatedtime=i,e.chatid=s,this.chatDataList.push(e),r++),t++}),r-=o,this.isLocalStorageAllowed&&this.isLocalStorageSupported&&localStorage.setItem("chatDataList",JSON.stringify(this.chatDataList));var l="\r\n\r\n  • 对话数据: OK，导入完成，数据已合并。JSON文件包含对话记录 "+t+" 条，其中：全新的对话 "+r+" 条；已存在的对话(完全一致) "+n+" 条；内容冲突的对话(存在差异) "+o+" 条。",h="\r\n\r\n  • Chat Data: OK, import successful, the data has been merged.  The JSON file contains "+t+" chat entries: "+r+" new entries, "+n+" existing entries, and "+o+" conflicting entries.";m+="cn"==y?l:h}if(a.hasOwnProperty("apikeyData")){var o=a.apikeyData;let t=null==o?[]:o.apiCheckedData;t=(t=null==t?[]:t).filter(t=>t.apikey&&""!==t.apikey.trim()),this.validateApiCheckedData(t);const p=this.apiCheckedData.filter(t=>t.apikey&&""!==t.apikey.trim());let i=0,s=0,n=0;t.forEach(e=>{(20<e.succcount||20<e.failcount)&&(a=Math.max(e.succcount,e.failcount)/20,e.succcount=Math.ceil(e.succcount/a),e.failcount=Math.ceil(e.failcount/a));var t,a=p.findIndex(t=>t.apikey===e.apikey);-1!==a?(t=p[a],e.updatetime>t.updatetime?(p[a]=e,i++):s++):(p.push(e),n++)}),this.apiCheckedData=p,r=i+s;var r,c,d=this.getVariablesFromThis(this.apikeyData_default),g=(d.version=this.apikeyData_Version,localStorage.setItem("apikeyData",JSON.stringify(d)),!this.btnDisabledState_CheckAPI&&(c=this.apiCheckedData.filter(t=>"third-party"===t.vpn&&t.apiurl.toLowerCase()===this.apiURL.toLowerCase()),!this.isThirdPartyAPIKeyEnabled||this.isThirdPartyAPIKeyEnabled&&0<c.length)&&this.restoreApiKeyInput(!1,!1),"\r\n\r\n  • 密钥/API Key数据: OK，导入完成，数据已合并，将自动轮换API Key。JSON文件包含API Key数量 "+t.length+" 个，其中：新的 "+n+" 个；已存在的 "+r+" 个 (更新较新使用日期的 "+i+" 个，无需更新的 "+s+" 个)。"),u="\r\n\r\n  • API Keys Data: OK, import successful, the data has been merged. Additionally, the API Keys will be automatically rotated.  The JSON file contains "+t.length+" API Keys: "+n+" new keys; "+r+" existing keys (updated "+i+" data with newer usage dates and "+s+" do not require updates).";m+="cn"==y?g:u}a.hasOwnProperty("promptsData")&&(m+="cn"==y?"\r\n\r\n  • 提示词数据: 暂不支持导入":"\r\n\r\n  • Prompt Generator Data: Import is not supported at the moment, under development."),a.hasOwnProperty("userSettings")&&(this.islocalStorageFirstLoad=!0,this.RestoreData_userSettings(a.userSettings),this.islocalStorageFirstLoad=!1,m+="cn"==y?"\r\n\r\n  • 设置数据: OK，导入完成，已更新为新的设置":"\r\n\r\n  • Settings Data: OK, import successful, the data has been replaced with new settings."),setTimeout(()=>{this.localStorage_SaveData(null,null);var t=this.chatDataList.find(t=>t.chatcreatedtime===this.chatcreatedtime);this.loadChatData(t),this.changePageScaling(!1),this.changeLanguage(),this.changeSimpleMode(!1),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata")})},0);const t="cn"==y?"导入报告":"Import Report";setTimeout(()=>{this.showNotification(m,"center",t)},650)}else m="cn"==this.settingsLanguage?"文件错误，未包含TAKGPT数据":"File error, does not contain TAKGPT data",this.showNotification(m,"bottom","",6e3)}catch(t){e=t.message||"",s=t.name||"";if(this.localStorageExceedsMaximum(e,s)){let t=null,e=null,a=(t=this.calculateLocalStorageSize(),e=this.calculateLocalStorageUsage(),m="cn"==this.settingsLanguage?"导入失败 - 本地存储空间不足\r\n\r\n":"Import Failed - Insufficient Local Storage Space\r\n\r\n","");a=null!==t&&null!==e&&t!==e?(t>e&&(l=t,t=e,e=l),"\r\n\r\n"+(a=(a="cn"==this.settingsLanguage?"当前浏览器本地存储已使用 ":"The current browser's local storage usage is ")+(this.settingsLanguage,t+" ～ "+e)+" MB")+"。"):(t=null===t?e:t,a="cn"==this.settingsLanguage?"当前浏览器本地存储已使用 ":"The current browser's local storage usage is ","\r\n\r\n"+(a+=(this.settingsLanguage,t+" MB"))+"。");h=(this.calculateStringSize(i,"utf-16")/1024/1024).toFixed(3)+" MB";m=(m+="cn"==this.settingsLanguage?"本次导入的 JSON 数据大小为 "+h:"The size of the JSON data imported this time is "+h)+a+("cn"==this.settingsLanguage?"浏览器通常仅支持约 5MB 或 10MB 的本地存储空间 (localStorage)，不同浏览器和版本之间可能会有所差异。如果由于浏览器本地存储空间不足而导入失败，您可以尝试删除一些对话数据 (或先抹掉日志)，或者尝试更换浏览器后再次导入。\r\n建议: 在重新导入之前先刷新页面。":"Browsers typically only support around 5MB or 10MB of local storage space, with variations across different browsers and versions. If the import fails due to insufficient browser storage space, you can try deleting some chat data or erase logs, or switch to a different browser and try again. \r\nSuggestion: Refresh the page before importing again."),alert(m)}else m="cn"==this.settingsLanguage?"出错了\r\n\r\n错误信息："+t.message:"Error\r\n\r\nError Message: "+t.message,this.showNotification(m,"center","Err - { reader.onload = (event) => }"),console.error("importLocalStorageData() - reader.onload = (event) => 事件",t)}},e.readAsText(t)),a.remove()},m="cn"==this.settingsLanguage?"导入数据：自动验证由TAKGPT导出的JSON数据文件":"Import: Auto-validating the JSON data file exported by TAKGPT.",this.showNotification(m,"bottom","",2e4),a.click()},150)}catch(t){var e=t.message||"",a=t.name||"";this.localStorageExceedsMaximum(e,a)||(m="cn"==this.settingsLanguage?"出错了\r\n\r\n错误信息："+t.message:"Error\r\n\r\nError Message: "+t.message,this.showNotification(m,"center","Err - importLocalStorageData()"),console.error("importLocalStorageData() - 导入数据",t))}}}},getLocalStorageSize(){this.isLocalStorageSupported&&(this.isLocalStorageAllowed,this.checkBusyStatus("ForChat")||(this.localStorage_SaveData(null,"chatDataList"),setTimeout(()=>{this.localStorage_SaveData(null,null),setTimeout(()=>{let t=null,e=null,a=null,i=null,s=null,n=0;try{t=this.calculateLocalStorageSize()}catch(t){}try{e=this.calculateLocalStorageUsage()}catch(t){}try{a=this.calculateLocalStorageUsage_Item("avatar")}catch(t){}try{i=this.calculateLocalStorageUsage_Item("chatDataList")}catch(t){}try{s=this.calculateLocalStorageUsage_Item("promptsData")}catch(t){}try{let e=0;this.chatDataList.forEach(t=>{t=t.chatVariables.chathistory,t=this.calculateStringSize(t,"utf-16")/1024/1024;e+=t}),n=e.toFixed(4)}catch(t){}let o="";var r,l="cn"==this.settingsLanguage?"浏览器本地存储 (localStorage) 使用情况：\r\n":"The usage of browser local storage (localStorage) :\r\n",h=(a=null==a?0:a,i=null==i?0:i,s=null==s?0:s,a="0"===a.toString()?"0.0000":a,i="0"===i.toString()?"0.0000":i,s="0.0003"===s.toString()?" < 0.0003":s,n=null===n?"0.0000":n,"\r\n"),h=(h=(h=(h=(h=(h=(h=(h=(h=(h+="cn"==this.settingsLanguage?"\r\n  部分数据的存储情况如下:":"\r\n  Storage status for some data:")+("cn"==this.settingsLanguage?"\r\n  • 聊天数据占用："+i+" MB  (其中日志部分占用："+n+" MB)":"\r\n  • Chat data size: "+i+' MB  (with "Logs" size: '+n+" MB)"))+("cn"==this.settingsLanguage?"\r\n  • 用户头像(转码后)占用："+a+" MB":"\r\n  • User avatar (encoded) size: "+a+" MB"))+("cn"==this.settingsLanguage?"\r\n  • 提示词数据占用："+s+" MB":"\r\n  • Prompts data size: "+s+" MB"))+"\r\n  • ..."+("cn"==this.settingsLanguage?"\r\n\r\n  小贴士:":"\r\n\r\n  Tips:"))+("cn"==this.settingsLanguage?"\r\n  • 电脑端浏览器本地存储通常为 10MB":"\r\n  • Local storage for desktop browsers is typically 10MB."))+("cn"==this.settingsLanguage?"\r\n  • 移动端浏览器本地存储通常为 5MB":"\r\n  • Local storage for mobile browsers is typically 5MB."))+("cn"==this.settingsLanguage?"\r\n  • Safari (iPhone / Mac) 的本地存储一般为 5MB":"\r\n  • Local storage for Safari (iPhone / Mac) is usually 5MB."))+("cn"==this.settingsLanguage?'\r\n  • "日志": 单个对话的所有记录 (包含操作记录、撤回的内容以及发送失败的内容等)，用于导出 Markdown 格式的纯文本聊天记录，有些对话日志可能会比较大。':'\r\n  • "Logs": All records of individual conversations, including activity logs, retracted messages, and failed messages, are stored. These logs can be exported as plain text chat records in Markdown format. Some logs of chats may be large in size.'))+("cn"==this.settingsLanguage?"\r\n  • 如何删除对话日志: 打开 [对话列表]，点击 [...] 选 抹掉日志":"\r\n  • How to delete chat logs: Open the [Chat List], click on [...], and select Erase logs.");null!==t&&null!==e&&t!==e?(t>e&&(r=t,t=e,e=r),o=l+(o="cn"==this.settingsLanguage?"已使用："+t+" ～ "+e+" MB":"Used: "+t+" ～ "+e+" MB"),-.1<5-e?o+="cn"==this.settingsLanguage?"\r\n预计剩余可用 (假设上限为 5MB)："+(5-e).toFixed(4)+" MB\r\n预计剩余可用 (假设上限为 10MB)："+(10-e).toFixed(4)+" MB":"\r\nEstimated Remaining Size (assuming a limit of 5MB): "+(5-e).toFixed(4)+" MB\r\nEstimated Remaining Size (assuming a limit of 10MB): "+(10-e).toFixed(4)+" MB":o+="cn"==this.settingsLanguage?"\r\n预计剩余可用 (假设上限为 10MB)："+(10-e).toFixed(4)+" MB":"\r\nEstimated Remaining Size (assuming a limit of 10MB): "+(10-e).toFixed(4)+" MB",o+=h):null===t&&null!==e||null!==t&&null===e||null!==t&&t===e?(t=null===t?e:t,o=l+(o="cn"==this.settingsLanguage?"已使用："+t+" MB":"Used: "+t+" MB"),-.1<5-e?o+="cn"==this.settingsLanguage?"\r\n预计剩余可用 (假设上限为 5MB)："+(5-t).toFixed(4)+" MB\r\n预计剩余可用 (假设上限为 10MB)："+(10-t).toFixed(4)+" MB":"\r\nEstimated Remaining Size (assuming a limit of 5MB): "+(5-t).toFixed(4)+" MB\r\nEstimated Remaining Size (assuming a limit of 10MB): "+(10-t).toFixed(4)+" MB":o+="cn"==this.settingsLanguage?"\r\n预计剩余可用 (假设上限为 10MB)："+(10-t).toFixed(4)+" MB":"\r\nEstimated Remaining Size (assuming a limit of 10MB): "+(10-t).toFixed(4)+" MB",o+=h):o=l+(o="cn"==this.settingsLanguage?"出错了，计算失败。":"Error occurred, calculation failed.");let c=0;this.isShowNotification&&(c=1300),setTimeout(()=>{var t="cn"==this.settingsLanguage?"用量统计":"Usage statistics";this.showNotification(o,"center",t)},c)},100)},150)))},calculateLocalStorageSize(){let t=0;for(var e=0;e<localStorage.length;e++){var a=localStorage.key(e),i=localStorage.getItem(a),a=this.calculateStringSize(a+i,"utf-16");t+=a}return t=(t/=1048576).toFixed(4)},calculateStringSize(t,e){var a,i,s,n=0;if("utf-16"===(e=e?e.toLowerCase():"")||"utf16"===e)for(i=0,s=t.length;i<s;i++)n+=(a=t.charCodeAt(i))<=65535?2:4;else for(i=0,s=t.length;i<s;i++)n+=(a=t.charCodeAt(i))<=127?1:a<=2047?2:a<=65535?3:4;return n},calculateLocalStorageUsage(){let t=0;for(var e=0;e<localStorage.length;e++){var a=localStorage.key(e),i=localStorage.getItem(a),a=a.length+2*i.length;t+=a}let s=t/1024/1024;return s=s.toFixed(4)},calculateLocalStorageUsage_Item(t){t="avatar"===t?"userSettings":t;var e=localStorage.getItem(t);let a=0;if(e)if("userSettings"===t){var i=JSON.parse(e);if(i.avatar)return a=(2*JSON.stringify(i.avatar).length/1024/1024).toFixed(4)}else if("chatDataList"===t||"promptsData"===t)return a=((t.length+2*e.length)/1024/1024).toFixed(4);return null},localStorageExceedsMaximum(t,e){var a=(e=null==(t=null==t?"":t)?"":e).toUpperCase(),t=t.includes("quota")&&t.includes("exceeded"),e=e.includes("QuotaExceededError")||a.includes("EXCEEDED")&&a.includes("QUOTA")||a.includes("ERROR")&&a.includes("QUOTA");if(t||e){0;const i="cn"==this.settingsLanguage?"  • 您的浏览器本地存储已超过最大容量限制。\r\n  • 如果频繁弹出本提示，是因为自动保存时由于存储空间不足而保存失败，请尽快释放存储空间，否则新数据将持续保存失败 (最近的数据会丢失)。\r\n\r\n小贴士:\r\n  • 不同浏览器的本地存储限额不同，常见的限额为 10MB或 5MB。您可以打开新页面，[设置] > [数据管理与隐私]中，点击打开最后一个 [用量统计]，以查看本地存储的使用情况。\r\n  • 在  [数据管理与隐私] 中您可以删除全部对话数据，在 [对话列表窗口] 中您可以选择性删除单个对话数据或抹掉对话日志。需要备份的对话可选择导出 JSON 文件。\r\n  • 导入时请注意: 1) 确保本地存储有足够的可用空间来容纳导入的数据; 2) 超过 5MB 的数据需要使用支持 10MB 本地存储的浏览器来进行导入; 3) 可使用隐私模式或使用其他浏览器来临时处理数据。":"  • The browser's local storage has exceeded the maximum capacity limit.\r\n  • If this prompt frequently pops up, it is because the automatic saving fails due to insufficient storage space. Please free up storage space as soon as possible, otherwise new data will continue to fail to save (The most recent data will be lost).\r\n\r\nTips:\r\n  • Different browsers have different limits for local storage, with the most common limits being 10MB or 5MB. You can open a new page and go to [Settings] > [Data Privacy and Management]. Click on the last option [Usage Statistics] to view the usage of local storage.\r\n  • In [Data Privacy and Management], you can delete all chat data, and in [Chat List], you can selectively delete individual chat data or erase logs. Before deletion, you can choose to export a JSON file as a backup.\r\n  • Note when importing: 1) Ensure sufficient available space in local storage to accommodate imported data; 2) Use a browser that supports 10MB local storage for importing data exceeding 5MB; 3) Use privacy mode or an alternative browser to temporarily handle the data.",s="cn"==this.settingsLanguage?"本地存储 (localStorage) 空间不足":"Insufficient local storage space";return setTimeout(()=>{this.showNotification(i,"center",s)},2e3),!0}return!1},localStorageEvent_chatDataList(t,e,a){if(this.isLocalStorageAllowed&&this.isLocalStorageSupported){this.localStorageEvent_chatDataList_update_start=!0;const o=JSON.parse(event.newValue||"[]"),r=JSON.parse(event.oldValue||"[]");var i=o.filter(e=>!r.some(t=>t.chatcreatedtime===e.chatcreatedtime)),s=r.filter(e=>!o.some(t=>t.chatcreatedtime===e.chatcreatedtime)),n=o.filter(e=>{var t=r.find(t=>t.chatcreatedtime===e.chatcreatedtime);return t&&JSON.stringify(t)!==JSON.stringify(e)});i.forEach(t=>{var e;null!==t.chatcreatedtime&&(t.chatcreatedtime===this.chatcreatedtime?((e=this.getSelectedChatData()).chatcreatedtime=this.newChatCreatedTime_ForCopyChatData(e),e.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),e.chatid+="cn"==this.settingsLanguage?" 副本[同步-创建时间冲突]":" Copy [Sync - Created Time Conflict]",JSON.parse(JSON.stringify(e)),this.chatDataList.unshift(e),this.loadChatData(e),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata")}),this.chatDataList.unshift(t),this.chatDataList_Sort(),this.saveChatData_Single(e),this.gotoTop_List()):(this.chatDataList.unshift(t),this.chatDataList_Sort()))}),s.forEach(e=>{if(null!==e.chatcreatedtime)if(e.chatcreatedtime===this.chatcreatedtime){const a=this.chatid;this.chatDataList=this.chatDataList.filter(t=>t.chatcreatedtime!==e.chatcreatedtime),this.chatDataList==[]||0==this.chatDataList.length?(setTimeout(()=>{var t="cn"==this.settingsLanguage?"当前对话 { #"+a+" } 在同步过程中被删除。\r\n当前列表空，已为您自动添加新的对话":"The chat { #"+a+" } was deleted during synchronization.\r\nThe chat list is empty. A new chat has been automatically added.",e="cn"==this.settingsLanguage?"浏览器本地存储 - 同步 - 通知":"Browser Local Storage Sync Notification";this.showNotification(t,"center",e)},1400),this.chatList_addNewChatData(!0)):(setTimeout(()=>{var t="cn"==this.settingsLanguage?"当前对话 { #"+a+" } 在同步过程中被删除":"The chat { #"+a+" } was deleted during synchronization.",e="cn"==this.settingsLanguage?"浏览器本地存储 - 同步 - 通知":"Browser Local Storage Sync Notification";this.showNotification(t,"center",e)},1400),this.loadChatData(this.chatDataList[0]),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata",50)}),this.gotoTop_List())}else this.chatDataList=this.chatDataList.filter(t=>t.chatcreatedtime!==e.chatcreatedtime)}),n.forEach(e=>{var t,a,i,s;null!==e.chatcreatedtime&&(e.chatcreatedtime===this.chatcreatedtime?(s=this.getSelectedChatData(),(t=!this.compareChatData(e,s))&&(i=this.chatid,s.chatcreatedtime=this.newChatCreatedTime_ForCopyChatData(s),s.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),s.chatid+="cn"==this.settingsLanguage?" 副本[同步冲突]":" Copy [Sync Conflict]",a=JSON.parse(JSON.stringify(s)),s=s.chatid,this.chatDataList.unshift(a),this.loadChatData(a),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata")}),i="cn"==this.settingsLanguage?"当前对话 { #"+i+" } 在同步过程中被修改，已为您自动创建对话的副本 { #"+s+" } 。\r\n当一个对话在多个标签页或窗口中同时被打开时，会出现这种情况。":"The chat { #"+i+" } has been modified during synchronization, and a copy of the chat has been created { #"+s+" } .\r\nThis can occur when a conversation is opened in multiple tabs/windows at once.",s="cn"==this.settingsLanguage?"浏览器本地存储 - 同步 - 通知":"Browser Local Storage Sync Notification",this.showNotification(i,"center",s),this.saveChatData_Single(a),this.gotoTop_List()),i=this.chatDataList.find(t=>t.chatcreatedtime===e.chatcreatedtime),e=JSON.parse(JSON.stringify(e)),Object.assign(i,e),t||(this.loadChatData(i),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata",50)}))):(s=this.chatDataList.find(t=>t.chatcreatedtime===e.chatcreatedtime),e=JSON.parse(JSON.stringify(e)),Object.assign(s,e)))}),this.localStorageEvent_chatDataList_update_start=!1,this.localStorage_SaveData(null,"chatDataList")}},compareChatData(t,e){var a,i=["chatlasttime","chatid","chattitle","version","msg"];for(a in t)if(!i.includes(a)&&JSON.stringify(t[a])!==JSON.stringify(e[a]))return!1;return!0},newChatCreatedTime_ForCopyChatData(t){let e=new Date(t.chatcreatedtime.replace(/-/g,"/")).getTime(),a=(e+=1e3,this.formatDateYYYYMMDDHHmmss(new Date(e),":"));for(var i=null==(i=this.localStorage_GetDataByKey("chatDataList"))?[]:i;this.isTimeConflict(a,i,this.chatDataList);)e+=1e3,a=this.formatDateYYYYMMDDHHmmss(new Date(e),":");return a},isTimeConflict(e,a,i){for(let t=0;t<a.length;t++)if(a[t].chatcreatedtime===e)return!0;for(let t=0;t<i.length;t++)if(i[t].chatcreatedtime===e)return!0;return!1},checkLocalStorageSupport(){var e="__test__",a=window.localStorage;try{return a?(a.setItem(e,e),a.getItem(e)===e&&(a.removeItem(e),!0)):!1}catch(t){a=t.message||"",e=t.name||"";return this.localStorageExceedsMaximum(a,e),!1}},localStorage_SaveData(a,t){if(this.isLocalStorageSupported&&this.isLocalStorageAllowed&&(!(this.isSendingNow||this.isCheckingApiKeyNow||this.isSendingNow_ForSmartMaxTokens)||null!=t&&"chatDataList"!=t&&"apikeyData"!=t)&&!this.localStorageEvent_chatDataList_update_start){if(null==t){let t=3e3,e=Date.now()-this.localStorage_lastSaveTime||1/0;if(a&&a.type){if("WindowBlur"==a.type?(e=Date.now()-this.localStorage_lastSaveTime_onblur||1/0,t=1e4):("pagehide"!=a.type&&"unload"!=a.type&&"beforeunload"!=a.type||(t=400),this.localStorage_lastSaveTime_onblur=this.localStorage_lastSaveTime),e<t)return}else if(t=100,e<t)return}null!=t&&"userSettings"!=t||this.saveUserSettings(),null!=t&&"chatDataList"!=t||(this.saveChatData_Selected(),this.chatDataList_Sort()),null!=t&&"apikeyData"!=t||this.saveApikeyData(),null!=t&&"promptsData"!=t||this.savePromptsData(),null==t&&(this.localStorage_lastSaveTime=Date.now(),this.localStorage_lastSaveTime_onblur=Date.now())}},localStorage_GetDataByKey(e){if(!this.isLocalStorageSupported||!this.isLocalStorageAllowed)return null;try{var t=JSON.parse(localStorage.getItem(e));return null!=t?t:"chatDataList"==e?[]:null}catch(t){return console.error("localStorage_GetDataByKey()",t),this.showNotification("keyname:\r\n"+e+"Error Name:\r\n"+t.name+"\r\n\r\nError Message:\r\n"+t.message,"center","Error - localStorage_GetDataByKey()"),null}},localStorage_RestoreData(){var t=this.localStorage_GetDataByKey("userSettings"),e=this.localStorage_GetDataByKey("chatDataList"),a=this.localStorage_GetDataByKey("apikeyData"),i=this.localStorage_GetDataByKey("promptsData");if(null===t&&(null===e||0===e.length)&&null===a&&null===i)return!1;this.RestoreData_userSettings(t),this.setVariablesToThis(null==a?{}:a,this.apikeyData_default,!0),this.apiCheckedData=this.apiCheckedData.filter(t=>""!==t.apikey.trim()),this.validateApiCheckedData(this.apiCheckedData),this.setVariablesToThis(null==i?{}:i,this.promptsData_default,!0),this.chatDataList=null==e?[]:e,this.chatDataList_Sort();t=null==this.chatDataList||null==this.chatDataList[0]?{}:JSON.parse(JSON.stringify(this.chatDataList[0]));return this.loadChatData(t),!(this.islocalStorageFirstLoad=!1)},RestoreData_userSettings(e){if(null!==e){var t=null==e.userVariables?{}:e.userVariables,t=(this.setVariablesToThis(t,this.userVariables_default,!0),null==e.userAvatarURL||""==e.userAvatarURL.trim()),a=(t?this:e).userAvatarURL,t=((t=null==e.gptAvatarURL)?this:e).gptAvatarURL,e=e.avatar;try{if(this.islocalStorageFirstLoad&&e&&""!=e){var i=e.split(","),s=i[0].match(/:(.*?);/)[1],n=atob(i[1]);let t=n.length;for(var o=new Uint8Array(t);t--;)o[t]=n.charCodeAt(t);this.userAvatarUp_base64=e,this.userAvatarUp_blob=new Blob([o],{type:s}),this.userAvatarUp_blobUrl=URL.createObjectURL(this.userAvatarUp_blob)}}catch(t){console.error("userSettings.avatar转换过程出错"),this.userAvatarUp_base64="",this.userAvatarUp_blob=null,this.userAvatarUp_blobUrl=""}this.islocalStorageFirstLoad&&a.startsWith("blob:")&&this.userAvatarUp_blobUrl.startsWith("blob:")?this.inputUserImageUrl=JSON.parse(JSON.stringify(this.userAvatarUp_blobUrl)):this.inputUserImageUrl=a;i="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en;this.islocalStorageFirstLoad?t.startsWith("blob:")||""==t?this.inputGPTImageUrl=i:this.inputGPTImageUrl=t:this.inputGPTImageUrl=this.isgptGreenSvgShow?i:t,this.updateAvatar("user",!1),this.updateAvatar("gpt",!1)}},validateApiCheckedData(t){t.forEach(t=>{t.apikey="string"==typeof t.apikey?t.apikey:"",t.apiurl="string"==typeof t.apiurl?t.apiurl:"",t.date1=Number.isInteger(t.date1)?t.date1:0,t.date2=Number.isInteger(t.date2)?t.date2:0,t.date3=Number.isInteger(t.date3)?t.date3:0,t.nexttime=Number.isInteger(t.nexttime)?t.nexttime:0,t.level=null!=t.level&&"number"==typeof t.level?t.level:null,t.freq="number"!=typeof t.freq||isNaN(t.freq)?0:t.freq,t.vpn="string"==typeof t.vpn?t.vpn:"",t.vpn=t.vpn.includes("GPT-")||"third-party"===t.vpn?t.vpn:"",t.owner="string"==typeof t.owner?t.owner:"me",t.succcount=Number.isInteger(t.succcount)?t.succcount:0,t.failcount=Number.isInteger(t.failcount)?t.failcount:0,t.succrate="number"!=typeof t.succrate||isNaN(t.succrate)?0:t.succrate,t.updatetime=Number.isInteger(t.updatetime)?t.updatetime:0})},setVariablesToThis(e,a,i){Object.keys(a).forEach(t=>{a.hasOwnProperty(t)&&(e.hasOwnProperty(t)?this[t]=e[t]:!0===i&&(this[t]=JSON.parse(JSON.stringify(a[t]))))})},getVariablesFromThis(e){const a={};return Object.keys(e).forEach(t=>{e.hasOwnProperty(t)&&(a[t]=this[t])}),a},saveUserSettings(){var e=this.getVariablesFromThis(this.userVariables_default),e={version:this.userSettings_Version,avatar:this.userAvatarUp_base64,userAvatarURL:this.userAvatarURL,gptAvatarURL:this.gptAvatarURL,userVariables:e};try{localStorage.setItem("userSettings",JSON.stringify(e))}catch(t){var e=t.message||"",a=t.name||"";this.localStorageExceedsMaximum(e,a)}},saveApikeyData(){var e=this.localStorage_GetDataByKey("apikeyData");let t=null==e?[]:e.apiCheckedData;t=(t=null==t?[]:t).filter(t=>t.apikey&&""!==t.apikey.trim()),this.validateApiCheckedData(t);const i=this.apiCheckedData.filter(t=>t.apikey&&""!==t.apikey.trim());t.forEach(e=>{var t,a=i.findIndex(t=>t.apikey===e.apikey);-1!==a?(t=i[a],e.updatetime>t.updatetime&&(i[a]=e)):i.push(e)}),this.apiCheckedData=i;e=this.getVariablesFromThis(this.apikeyData_default);e.version=this.apikeyData_Version;try{localStorage.setItem("apikeyData",JSON.stringify(e))}catch(t){var e=t.message||"",a=t.name||"";this.localStorageExceedsMaximum(e,a)}},savePromptsData(){var e=this.localStorage_GetDataByKey("promptsData"),e=(null==e||e.gptPrompts,this.getVariablesFromThis(this.promptsData_default));e.version=this.promptsData_Version;try{localStorage.setItem("promptsData",JSON.stringify(e))}catch(t){var e=t.message||"",a=t.name||"";this.localStorageExceedsMaximum(e,a)}},saveChatData_Selected(){let e=this.getSelectedChatData();if(null!=e&&null!=e.chatcreatedtime){var a=this.chatDataList.find(t=>null===t.chatcreatedtime);let t=this.localStorage_GetDataByKey("chatDataList");if(null!=t){var i=(t=t.filter(t=>null!==t.chatcreatedtime)).findIndex(t=>t.chatcreatedtime===e.chatcreatedtime);-1!==i?t[i]=e:t.unshift(e);try{localStorage.setItem("chatDataList",JSON.stringify(t))}catch(t){var i=t.message||"",s=t.name||"";this.localStorageExceedsMaximum(i,s)}null!=a&&t.unshift(a),this.chatDataList=t}}},saveChatData_Single(e){if(null!=e&&null!=e.chatcreatedtime){var a=this.localStorage_GetDataByKey("chatDataList");if(null!=a){var i=a.findIndex(t=>t.chatcreatedtime===e.chatcreatedtime);-1!==i?a[i]=e:a.unshift(e);try{localStorage.setItem("chatDataList",JSON.stringify(a))}catch(t){i=t.message||"",a=t.name||"";this.localStorageExceedsMaximum(i,a)}}}},saveChatData_NoLocalStorage(t){let e=t;null!=(e=null==t?this.getSelectedChatData():e)&&null!=e.chatcreatedtime&&(-1!==(t=this.chatDataList.findIndex(t=>t.chatcreatedtime===e.chatcreatedtime))?this.chatDataList[t]=e:this.chatDataList.unshift(e),this.chatDataList_Sort())},chatDataList_Sort(){null!=this.chatDataList&&this.chatDataList.sort((t,e)=>{t=(t.chatlasttime?new Date(t.chatlasttime.replace(/-/g,"/")):new Date("9999-12-31")).getTime();return(e.chatlasttime?new Date(e.chatlasttime.replace(/-/g,"/")):new Date("9999-12-31")).getTime()-t})},getSelectedChatData(){var t=this.getVariablesFromThis(this.chatVariables_default),t=JSON.parse(JSON.stringify(t)),t={version:this.chatDataList_Version,chatcreatedtime:this.chatcreatedtime,chatlasttime:this.chatlasttime,chatid:this.chatid,chattitle:this.chattitle,msgList:this.msgList,msgContent:this.msgContent,msgTokens:this.msgTokens,msgContentForMsgList_SingleRound:this.msgContentForMsgList_SingleRound,msg:this.msg,chatVariables:t};return JSON.parse(JSON.stringify(t))},chatList_ClickChatData(e){var t;e.chatcreatedtime===this.chatcreatedtime||this.checkBusyStatus("ForChat")||(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),t=this.chatDataList.find(t=>t.chatcreatedtime===e.chatcreatedtime),this.loadChatData(t),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata")}),t="cn"==this.settingsLanguage?"已切换对话":"Chat is switched",this.showNotification(t,"bottom"))},loadChatData(t){this.selectedChatData=null==t?{}:JSON.parse(JSON.stringify(t));var t=null==this.selectedChatData.chatVariables?{}:this.selectedChatData.chatVariables,t=JSON.parse(JSON.stringify(t)),e=document.querySelectorAll("hr.newcontext-hr");for(let t=0;t<e.length;t++)e[t].remove();var a=document.querySelectorAll(".msgcopydiv");for(let t=0;t<a.length;t++){var i=a[t].querySelectorAll(".copybtn");for(let t=0;t<i.length;t++)i[t].remove()}this.setVariablesToThis(t,this.chatVariables_default,!0),this.setVariablesToThis(JSON.parse(JSON.stringify(this.selectedChatData)),this.chatData_default,!1),setTimeout(()=>{this.inputapichange(!1)},10),this.btnDisabledState_SetSystemPrompt=!1},chatList_EditChatID(n){event.stopPropagation(),this.checkBusyStatus("ForChat")||(this.localStorage_SaveData(null,"chatDataList"),setTimeout(()=>{var i=this.chatDataList.find(t=>t.chatcreatedtime===n.chatcreatedtime);if(i){let e=null;var s=/[^\x00-\xff]/g;let t="cn"==this.settingsLanguage?"修改对话ID：":"Edit Chat ID:",a=!1;for(this.is_Alert_Confirm_Prompt_Open=!0;(null===e||20<e.replace(s,"aa").length)&&(e=null===e?null==i.chatid?"":i.chatid:e,a&&(t="cn"==this.settingsLanguage?"修改对话ID，最大 20 个字符(中文为10个字)：":"Edit Chat ID, maximum length is 20 .(some characters may take up more than one character space):"),null!==(e=window.prompt(t,e)));)a=!0;setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),setTimeout(()=>{var t;null!==e&&((t=this.chatDataList.find(t=>t.chatcreatedtime===n.chatcreatedtime)).chatid=e.trim(),t.chatcreatedtime===this.chatcreatedtime&&(this.chatid=e.trim()),null!=t.chatcreatedtime&&this.saveChatData_Single(t),t="cn"==this.settingsLanguage?"修改成功":"Modification successful",this.showNotification(t,"bottom"))},200)}},100))},chatList_EditChatTitle(n){event.stopPropagation(),this.checkBusyStatus("ForChat")||(this.localStorage_SaveData(null,"chatDataList"),setTimeout(()=>{let i=this.chatDataList.find(t=>t.chatcreatedtime===n.chatcreatedtime);if(i){let e=null;var s=/[^\x00-\xff]/g;let t="cn"==this.settingsLanguage?"修改对话标题：":"Edit Chat Title:",a=!1;for(this.is_Alert_Confirm_Prompt_Open=!0;(null===e||46<e.replace(s,"aa").length)&&(e=null===e?i.chattitle:e,a&&(t="cn"==this.settingsLanguage?"修改对话标题，最大 46 个字符(中文为23个字)：":"Edit Chat Title, max 46 characters (some characters may take up more than one character space):"),null!==(e=window.prompt(t,e)));)a=!0;setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),setTimeout(()=>{var t;null!==e&&((i=this.chatDataList.find(t=>t.chatcreatedtime===n.chatcreatedtime)).chattitle=e.trim(),i.chatcreatedtime===this.chatcreatedtime&&(this.chattitle=e.trim()),null!=i.chatcreatedtime&&this.saveChatData_Single(i),t="cn"==this.settingsLanguage?"修改成功":"Modification successful",this.showNotification(t,"bottom"))},200)}},100))},chatList_addNewChatData(t){let e="";t=t!=event&&null!=t&&t;if(!t){if(this.checkBusyStatus("ForChat"))return;if(null!=this.chatcreatedtime){if(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),-1!==this.chatDataList.findIndex(t=>null===t.chatcreatedtime)){if(e="cn"==this.settingsLanguage?"列表中已存在空白对话，是否继续生成新的对话？":"New blank chat exists in the list. Continue creating a new chat?",this.is_Alert_Confirm_Prompt_Open=!0,!confirm(e))return void setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100);setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}}else if(0<this.chatDataList.length)return e="cn"==this.settingsLanguage?"当前已经是新的对话":"A new chat has already been started.",void this.showNotification(e,"bottom")}var a=JSON.parse(JSON.stringify(this.chatVariables_default)),i=JSON.parse(JSON.stringify(this.chatData_default));i.version=this.chatDataList_Version,i.chatVariables=a;let s=1;for(;this.chatDataList.some(t=>parseInt(t.chatid)===s);)s++;i.chatid=s.toString(),t||(this.chatDataList=this.chatDataList.filter(t=>null!==t.chatcreatedtime),this.chatDataList_Sort()),this.chatDataList.unshift(i),this.loadChatData(this.chatDataList[0]),this.$nextTick(()=>{this.todoList_ChatDataRestored("new")}),t||(e="cn"==this.settingsLanguage?"新对话开始":"New chat started",this.showNotification(e,"bottom"))},todoList_ChatDataRestored(t,e){this.initTheFirstMessage(),"hasdata"==t&&(this.add_hr_For_ChatDataRestored(),this.changeStyle_Time_WechatStyle(),this.changeStyle_FontSize(),this.changeStyle_Time(),this.changeStyle_DividerLine(),i=(a=document.querySelector(".textareachatinputbox")).scrollHeight,s=parseInt(i)+6,parseInt(i)<=38?a.style.maxHeight="38px":parseInt(i)<450?a.style.maxHeight=s.toString()+"px":a.style.maxHeight="456px");var a,i=this.msgList[this.msgList.length-1].my,s=(i||"请重发"!=this.sentext&&"Please Retry"!=this.sentext||(this.sentext="cn"==this.settingsLanguage?"发送":"Send"),!i||"发送"!=this.sentext&&"Send"!=this.sentext||(this.sentext="cn"==this.settingsLanguage?"请重发":"Please Retry"),this.initAddCopyButtonForMessage(),this.formatDateYYYYMMDDHHmmss(new Date,":"));this.msgList[0].datetime="2000-01-01 00:00:00"==this.msgList[0].datetime?s:this.msgList[0].datetime,this.msgContentForMsgList_SingleRound[0].datetime="2000-01-01 00:00:00"==this.msgContentForMsgList_SingleRound[0].datetime?s:this.msgContentForMsgList_SingleRound[0].datetime,null!=e&&"number"==typeof e?setTimeout(()=>{this.scrollToBottomView()},e):"new"!=t&&this.scrollToBottomView(),"new"==t&&"cn"!=this.settingsLanguage&&(this.chathistory="# Chat History  \r\n\r\n")},changeSelectedChatListMoreOptions(r){if(event.stopPropagation(),this.checkBusyStatus("ForChat"))this.selectedChatListMoreOptions="";else{var t=this.selectedChatListMoreOptions;this.selectedChatListMoreOptions="";const l=this.chatcreatedtime===r.chatcreatedtime;if("CreateCopy"===t?(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{var t=this.chatDataList.find(t=>t.chatcreatedtime===r.chatcreatedtime),e=JSON.parse(JSON.stringify(t)),e=(e.chatcreatedtime=this.newChatCreatedTime_ForCopyChatData(t),e.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),e.chatid+="cn"==this.settingsLanguage?" 副本":" Copy",this.chatDataList.unshift(e),this.loadChatData(e),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata")}),this.saveChatData_Single(e),this.isLocalStorageSupported&&this.isLocalStorageAllowed,this.chatDataList_Sort(),"cn"==this.settingsLanguage?"成功创建 { #"+e.chatid+" }，当前对话为 { #"+t.chatid+" } 的副本":"Copy of chat { #"+e.chatid+" } created successfully. It is a replica of chat { #"+t.chatid+" } .");this.showNotification(e,"bottom","",5500),this.gotoTop_List()},150)):"ClearPrevious"===t?(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{var t=this.chatDataList.find(t=>t.chatcreatedtime===r.chatcreatedtime),e=(t.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),t.msgContentForMsgList_SingleRound.length-1),e=(1<t.msgList.length&&(0==e?t.msgList=[t.msgList[0]]:(e=t.msgList.slice(-e),t.msgList=[t.msgList[0]].concat(e))),t.chatVariables.chathistory),a="cn"==this.settingsLanguage?"# GPT聊天记录 / Chat History  \r\n\r\n":"# Chat History  \r\n\r\n",i="cn"==this.settingsLanguage?"#### #无记忆状态，新对话开始\r\n***\r\n\r\n":"#### #The context was emptied. New Chat begins.\r\n***\r\n\r\n",s="cn"==this.settingsLanguage?"#### #无记忆状态，新对话开始\r\n***\r\n\r\n":"#### #The context was emptied. New Chat begins.\r\n***\r\n\r\n";let n=e.lastIndexOf(i),o=i.length;-1===n&&(n=e.lastIndexOf(s),o=s.length),-1!==n&&(t.chatVariables.chathistory=e.substring(n+o),t.chatVariables.chathistory=a+t.chatVariables.chathistory),l?(this.loadChatData(t),this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata",50)}),this.gotoTop_List()):(this.saveChatData_Single(t),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(t),this.chatDataList_Sort())},150)):"ClearAll"===t?(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{var i=this.chatDataList.find(t=>t.chatcreatedtime===r.chatcreatedtime),s=i.chatVariables.hasSystemPromptBeenSaved,n=i.chatVariables.gptSystemPromptReadOnly;if(i.chatVariables=JSON.parse(JSON.stringify(this.chatVariables_default)),i.chatVariables.hasSystemPromptBeenSaved=s,i.chatVariables.gptSystemPromptReadOnly=n,"cn"!=this.settingsLanguage&&(i.chatVariables.chathistory="# Chat History  \r\n\r\n"),""==this.gptSystemPrompt_hidden.trim()){var s=i.chatVariables.gptSystemPromptReadOnly,n=/\r?\n\r?\n/.test(s),n=""!=(o=this.findMaxBackticks(s))||n,o=""==o?"````":o;let t=n?"\r\n"+o+"\r\n":"\r\n> ",e=n?"\r\n"+o+"\r\n\r\n":"\r\n\r\n",a="";""==s&&(a="cn"==this.settingsLanguage?": 空":": None",t="\r\n",e="\r\n");n="cn"==this.settingsLanguage?"### #系统提示词 system prompt ":"### #System Prompt ";i.chatVariables.chathistory+=n+a+t+s+e}i.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),i.msgList=[i.msgList[0]],i.msgContent=[i.msgContent[0]],i.msgTokens=[i.msgTokens[0]],i.msgContentForMsgList_SingleRound=[i.msgContentForMsgList_SingleRound[0]],l?(this.loadChatData(i),this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),this.$nextTick(()=>{this.todoList_ChatDataRestored("ClearAll")}),this.gotoTop_List()):(this.saveChatData_Single(i),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(i),this.chatDataList_Sort())},150)):"ExportChatData"===t?(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{var t=this.exportJSONFileName;let e=null==r.chatid?"":r.chatid.toString();var a="(#"+e+")",a=(notif="cn"==this.settingsLanguage?"正在导出JSON文件 - 单个对话数据":"Exporting JSON file - Single Chat Data",notif+=a,this.chatDataList.filter(t=>t.chatcreatedtime===r.chatcreatedtime)),i={},a=(i.chatDataList=a,JSON.stringify(i)),t=(t+="SingleChatData")+(e="(ID "+(e=""===(e=(e=e.replace(/[\\/:\*\?"<>\|]/g,"")).replace(/[\/\?<>\\:\*\|":]/g,"")).trim()?"":e)+")");this.showNotification(notif,"bottom","",2800),this.ExportData_JSON(a,t)},150)):"EraseLogs"===t&&(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{var t=this.chatDataList.find(t=>t.chatcreatedtime===r.chatcreatedtime),e=(t.chatlasttime=this.formatDateYYYYMMDDHHmmss(new Date,":"),"cn"==this.settingsLanguage?"# GPT聊天记录 / Chat History  \r\n\r\n":"# Chat History  \r\n\r\n"),a="cn"==this.settingsLanguage?"### #于 "+t.chatlasttime+" 手动抹掉日志\r\n***\r\n\r\n":"### #Manually erase logs on "+t.chatlasttime+"\r\n***\r\n\r\n",e=(t.chatVariables.chathistory=e+a,l?(this.loadChatData(t),this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),this.$nextTick(()=>{this.todoList_ChatDataRestored("ClearAll")}),this.gotoTop_List()):(this.saveChatData_Single(t),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(t),this.chatDataList_Sort()),"cn"==this.settingsLanguage?"已抹掉对话 { #"+t.chatid+" } 的日志":"The logs for chat { #"+t.chatid+" } have been erased");this.showNotification(e,"bottom","",3500)},150)),"ClearPrevious"==t||"ClearAll"==t){var e=""!=r.chatid.toString().trim()?"#"+r.chatid.toString()+" ":"",t="ClearAll"==t?"":"cn"==this.settingsLanguage?" (保留最近单轮对话)":" (Keep the latest round)";const notif="cn"==this.settingsLanguage?e+"对话已清空"+t:e+"Chat has been cleared"+t;this.showNotification(notif,"bottom","",2700)}event.target.blur()}},gotoTop_List(){setTimeout(()=>{document.querySelector("#dialog-ChatList .dialog-content").scrollIntoView({behavior:"smooth",block:"start"})},160)},gotoTop(){event.stopPropagation();const t=document.getElementById("app");this.$nextTick(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})});var e="cn"==this.settingsLanguage?"已定位到最早的消息":"Reached earliest message";this.showNotification(e,"bottom")},gotoBottom(){event.stopPropagation(),this.scrollToBottomView();var t="cn"==this.settingsLanguage?"已定位到最新消息":"Reached latest message";this.showNotification(t,"bottom")},deleteChatData(n){event.stopPropagation();const o=this.chatcreatedtime===n.chatcreatedtime;this.checkBusyStatus("ForChat")||(this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed||this.saveChatData_NoLocalStorage(null),setTimeout(()=>{let s="cn"==this.settingsLanguage?"您确定要删除这个对话吗？此操作无法撤销。":"Are you sure you want to delete this chat? This action cannot be undone.";null!==n.chatcreatedtime&&(s=(s+="cn"==this.settingsLanguage?"\r\n\r#":"\r\n\r\n#")+n.chatid,""!=n.chattitle&&(s=(s+=(this.settingsLanguage,"\r\n#"))+n.chattitle),s=(s=(s=(s+="cn"==this.settingsLanguage?"\r\n上次活动时间：":"\r\nLast Activity Time: ")+n.chatlasttime)+("cn"==this.settingsLanguage?"\r\n对话创建时间：":"\r\nChat Creation Time: "))+n.chatcreatedtime),this.is_Alert_Confirm_Prompt_Open=!0,confirm(s)?(setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),setTimeout(()=>{var t,e=this.chatDataList.find(t=>null===t.chatcreatedtime),a=null==(a=this.localStorage_GetDataByKey("chatDataList"))?[]:a,e=(null!=e&&a.unshift(e),this.isLocalStorageAllowed&&this.isLocalStorageSupported&&(this.chatDataList=a),this.chatDataList_Sort(),this.chatDataList.findIndex(t=>t.chatcreatedtime===n.chatcreatedtime));this.chatDataList=this.chatDataList.filter(t=>t.chatcreatedtime!==n.chatcreatedtime),s="cn"==this.settingsLanguage?"对话已删除":"Chat has been deleted",this.showNotification(s,"bottom");try{o?this.chatDataList==[]||0==this.chatDataList.length?(this.isLocalStorageAllowed&&this.isLocalStorageSupported&&localStorage.setItem("chatDataList",JSON.stringify(this.chatDataList)),setTimeout(()=>{s="cn"==this.settingsLanguage?"列表空，已自动添加一个新的对话":"The list is empty. A new chat has been automatically added.",this.showNotification(s,"bottom","",2900)},1400),this.chatList_addNewChatData(!0)):(i=this.chatDataList.filter(t=>null!==t.chatcreatedtime),this.isLocalStorageAllowed&&this.isLocalStorageSupported&&localStorage.setItem("chatDataList",JSON.stringify(i)),e=(e=(e-=1)<0?0:e)<this.chatDataList.length?e:0,this.loadChatData(this.chatDataList[e]),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata",100)})):(t=this.chatDataList.filter(t=>null!==t.chatcreatedtime),this.isLocalStorageAllowed&&this.isLocalStorageSupported&&localStorage.setItem("chatDataList",JSON.stringify(t))),this.chatDataList_Sort()}catch(t){var a=t.message||"",i=t.name||"";this.localStorageExceedsMaximum(a,i)}},100)):setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)},100))},changeChatListMaxWidth(){var t=document.querySelector("#dialog-ChatList .dialog");let e="cn"==this.settingsLanguage?"最大宽度已恢复":"Max-Width restored";null!=t&&("430px"==t.style.maxWidth?(t.style.maxWidth="800px",t.style.width="87%",e="cn"==this.settingsLanguage?"最大宽度已调至最大":"Max-Width adjusted to maximum"):(t.style.maxWidth="430px",t.style.width="95%"),this.showNotification(e,"bottom","",2300))},changeChatListTransparent(){var t=document.querySelector("#dialog-ChatList .dialog"),e=document.querySelector("#dialog-ChatList .dialog-bottom");let a="cn"==this.settingsLanguage?"已恢复为不透明":"Restored to opacity";null!=t&&("rgb(237, 237, 237)"==t.style.backgroundColor?(this.isChatListTransparent=!0,t.style.backgroundColor="rgba(237, 237, 237, 0.03)",e.style.backgroundColor="rgba(237, 237, 237, 0.05)",a="cn"==this.settingsLanguage?"已变更为透明":"Changed to transparent"):(this.isChatListTransparent=!1,t.style.backgroundColor="rgb(237, 237, 237)",e.style.backgroundColor="rgba(237, 237, 237)"),this.showNotification(a,"bottom"))},copySystemPromptToEditor(){var t=this.gptSystemPromptReadOnly.trim();let e="";""==t?(e="cn"==this.settingsLanguage?"当前的系统提示词为空":"The current system prompt is empty",this.showNotification(e,"bottom")):""!=this.gptSystemPrompt.trim()&&(e="cn"==this.settingsLanguage?"提示词编辑框中已存在内容，确认覆盖吗？":"Content exists in Prompt Editor, confirm overwrite?",!confirm(e))||(this.gptSystemPrompt=t,this.btnDisabledState_SetSystemPrompt=!0,e="cn"==this.settingsLanguage?"已复制到编辑区":"Copied to the Prompt Editor",this.showNotification(e,"bottom","",2e3))},changePromptGeneratorMaxWidth(){var t=document.querySelector("#dialog-promptgenerator .dialog");let e="cn"==this.settingsLanguage?"适合移动设备的宽度":"Optimized for mobile devices";null!=t&&("95%"==t.style.width?(t.style.width="75%",t.style.maxWidth="75%",e="cn"==this.settingsLanguage?"适合更大分辨率的宽度":"Optimized to support larger screens"):(t.style.width="95%",t.style.maxWidth="800px"),this.showNotification(e,"bottom","",2300))},changePromptGeneratorLayout(){var t="cn"==this.settingsLanguage?"布局切换成功":"Layout changed";"20px 20px 20px 20px"==this.styleDialogLayout.padding?this.styleDialogLayout.padding="20px 20px 20px 45px":"20px 20px 20px 45px"==this.styleDialogLayout.padding?this.styleDialogLayout.padding="20px 45px 20px 20px":this.styleDialogLayout.padding="20px 20px 20px 20px",this.showNotification(t,"bottom")},changeElementHeight(t){let e="cn"==this.settingsLanguage?"高度已调整":"Height adjusted";var a,t=document.querySelector("."+t);null!=t&&("100px"==(a=t.style.height)?t.style.height="250px":e="250px"==a?(t.style.height="500px","cn"==this.settingsLanguage?"高度已调至最大":"Height adjusted to maximum"):(t.style.height="100px","cn"==this.settingsLanguage?"高度已恢复":"Height restored"),this.showNotification(e,"bottom"))},changeElementLineBreak(t){let e="cn"==this.settingsLanguage?"切换为 不自动换行":"Changed to no-wrap";var a,t=document.querySelector("."+t);null!=t&&(("pre"==(a=t.style.whiteSpace)||"pre-wrap"==a)&&"pre"==a?(t.style.whiteSpace="pre-wrap",e="cn"==this.settingsLanguage?"切换为 自动换行":"Changed to auto-wrap"):t.style.whiteSpace="pre",this.showNotification(e,"bottom"))},setSystemPrompt(){let t="cn"==this.settingsLanguage?"保存成功":"Saved successfully",e=1450;this.checkBusyStatus()||(""!=this.gptSystemPrompt_hidden.trim()?(t="cn"==this.settingsLanguage?"保存失败，代码中存在隐藏提示词":'Save failed, there is a hidden "system prompt" in the code.',e=4e3):(this.btnDisabledState_SetSystemPrompt=!0,this.msgContent[0]={role:"system",content:this.gptSystemPrompt.trim()},this.msgContentForMsgList_SingleRound[0]={role:"system",content:this.gptSystemPrompt.trim()},this.gptSystemPromptReadOnly=this.gptSystemPrompt.trim(),""===this.gptSystemPrompt.trim()&&(t="cn"==this.settingsLanguage?"保存成功，已取消系统提示词":"Save successful. System Prompt has been cancelled",e=3500),this.hasSystemPromptBeenSaved?this.addSystemPromptToChatHistory("### #新的系统提示词 system prompt ","### #New System Prompt "):(this.hasSystemPromptBeenSaved=!0,this.addSystemPromptToChatHistory("### #默认的系统提示词 system prompt ","### #Default System Prompt ")),this.updateChatLastTime(this.formatDateYYYYMMDDHHmmss(new Date,":"))),this.showNotification(t,"bottom","",e))},clickOpenAutoKeyRotation(){var t,e=document.querySelector(".textareabulkaddapikey");this.apiCheckedData.length<1&&(t="cn"==this.settingsLanguage?"当前无可用的 API Key":"No available API Keys currently",this.showNotification(t,"bottom","",1800)),!this.isThirdPartyAPIKeyEnabled&&this.apiCheckedData.filter(t=>"third-party"!==t.vpn).length<1?this.isShowBulkAddPanel_AutoKeyRotation=!0:this.isThirdPartyAPIKeyEnabled||null==e||""!==e.value.trim()||(this.isShowBulkAddPanel_AutoKeyRotation=!1),this.isShowDialog_AutoKeyRotation=!0},changeAutoKeyRotationSorted(){if(!this.checkBusyStatus()){this.changeAutoKeyRotationSorted_Mode++,this.changeAutoKeyRotationSorted_Mode=2<this.changeAutoKeyRotationSorted_Mode?0:this.changeAutoKeyRotationSorted_Mode;let t;t=1===this.changeAutoKeyRotationSorted_Mode?(this.apiCheckedData.sort((t,e)=>t.level!==e.level?null===t.level?-1:null===e.level?1:t.level-e.level:t.nexttime-e.nexttime),"cn"==this.settingsLanguage?"按级别排序。 *排序对自动轮换功能没有影响":"Sort by level.  * Sorting has no impact on auto-rotation."):2===this.changeAutoKeyRotationSorted_Mode?(this.apiCheckedData.sort((t,e)=>e.succrate!==t.succrate?e.succrate-t.succrate:t.level!==e.level?null===t.level?-1:null===e.level?1:t.level-e.level:t.nexttime-e.nexttime),"cn"==this.settingsLanguage?"按成功率排序。 *排序对自动轮换功能没有影响":"Sort by success rate.  * Sorting has no impact on auto-rotation."):0===this.changeAutoKeyRotationSorted_Mode?(this.apiCheckedData.sort((t,e)=>e.updatetime-t.updatetime),"cn"==this.settingsLanguage?"按更新时间排序。 *排序对自动轮换功能没有影响":"Sort by update time.  * Sorting has no impact on auto-rotation."):(this.changeAutoKeyRotationSorted_Mode=1,"cn"==this.settingsLanguage?"按级别排序。 *排序对自动轮换功能没有影响":"Sort by level.  * Sorting has no impact on auto-rotation."),this.showNotification(t,"bottom","",3300)}},changeIsThirdPartyAPIKeyEnabled(){let t=3500;var e=this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL?"cn"==this.settingsLanguage?"。 提醒: 当前使用的是第三方接口，请确保其支持官方Key":" Tip: Currently using a Third-party API, please ensure that it supports OpenAI Keys.":"";let a="cn"==this.settingsLanguage?"使用 OpenAI 官方Key，将自动轮换 API Key"+e:"Use OpenAI API Keys will automatically rotate the API Keys."+e;t=e?6500:4500,this.isThirdPartyAPIKeyEnabled?(e=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?"cn"==this.settingsLanguage?"。 提醒: 当前接口不支持第三方Key":" Tip: The current API URL does not support Third-party Keys.":"",a="cn"==this.settingsLanguage?'使用第三方专用Key，已停止"自动轮换API Key"'+e:'Use Third-party Key, the "Auto Key Rotation" has been stopped.'+e,t=e?7e3:4500,this.defaultSelectedOneKey_ThirdParty()||this.btnDisabledState_CheckAPI&&(this.api="",this.changeButtonDisabledState(!0))):(""===this.lastAPIKeyInputText_Available&&this.apiCheckedData.filter(t=>"third-party"!==t.vpn).length<1&&(""===this.defaultAPIKey||!this.defaultAPIKey.startsWith("sk-"))&&0===this.default_apiKeyArray_WrittenInTheCode.length&&this.btnDisabledState_CheckAPI&&(this.api="",this.changeButtonDisabledState(!0)),this.restoreApiKeyInput(!1,!1)),this.showNotification(a,"bottom","",t)},useThirdPartyApiKey(e){if(!this.checkBusyStatus()&&(this.api=e.apikey,this.inputapichange(!1),""!==e.apiurl)&&e.apiurl.toLowerCase()!==this.apiURL.toLowerCase()){var a="该 API Key 上次使用的接口与当前接口不一致。\r\n\r\n点击 [确定 (好)] 可快速更换为上次使用的接口网址，点击 [取消] 则保持当前接口网址不变，请选择...\r\n\r\n上次接口: "+e.apiurl+"\r\n当前接口: "+this.apiURL,t="The API URL used with this API Key last time differs from the current API URL. \r\n\r\nClick [Confirm (OK)] to quickly change it to the API URL used last time, or click [Cancel] to keep the current API URL unchanged. Please choose...\r\n\r\nLast API URL: "+e.apiurl+"\r\nCurrent API URL: "+this.apiURL,a="cn"==this.settingsLanguage?a:t,t=(this.is_Alert_Confirm_Prompt_Open=!0,confirm(a));if(t){setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),this.apiURL=e.apiurl,this.inputApiURL=e.apiurl;let t=!(this.btnDisabledState_SaveApiURL=!0);"cn"===this.settingsLanguage?!(t=this.apiURLOptions_cn.some(t=>t.url===this.inputApiURL.toLowerCase()))&&this.isLoadThirdPartyPaidAPIs&&(t=this.apiURLOptions_LoadThirdPartyPaidAPIs.some(t=>t.url===this.inputApiURL.toLowerCase())):t=this.apiURLOptions_en.some(t=>t.url===this.inputApiURL.toLowerCase()),t?this.selectedApiURL=this.inputApiURL.toLowerCase():this.selectedApiURL="",a="cn"==this.settingsLanguage?"接口网址已变更":"API URL has been changed",this.showNotification(a,"bottom","",1600)}else setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}},defaultSelectedOneKey_ThirdParty(){var t=this.apiCheckedData.filter(t=>"third-party"===t.vpn&&t.apiurl.toLowerCase()===this.apiURL.toLowerCase());return 0<t.length&&(t.sort((t,e)=>e.updatetime-t.updatetime),this.api=t[0].apikey,this.inputapichange(!1),!0)},check_KeyMode_byURL(){var t=this.isThirdPartyAPIKeyEnabled;return this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL||"https://chatgpt1.nextweb.fun/api/proxy/v1/chat/completions"===this.apiURL.toLowerCase()?this.isThirdPartyAPIKeyEnabled=!1:0<this.apiCheckedData.filter(t=>"third-party"===t.vpn&&t.apiurl.toLowerCase()===this.apiURL.toLowerCase()).length||this.list_OnlyUseThirdPartyKey_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?this.isThirdPartyAPIKeyEnabled=!0:t},check_KeyMode_byKey(){this.apiCheckedData.filter(t=>"third-party"===t.vpn).some(t=>t.apikey.trim()==this.api.trim())||!this.api.startsWith("sk-")||this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?this.isThirdPartyAPIKeyEnabled=!0:this.isThirdPartyAPIKeyEnabled=!1},check_KeyMode_byURL_ChangeKey(t,e){t=null!=t?t:this.isThirdPartyAPIKeyEnabled,e=null!=e?e:this.check_KeyMode_byURL();let a=!0;return t&&!e?(""===this.lastAPIKeyInputText_Available&&this.apiCheckedData.filter(t=>"third-party"!==t.vpn).length<1&&(""===this.defaultAPIKey||!this.defaultAPIKey.startsWith("sk-"))&&0===this.default_apiKeyArray_WrittenInTheCode.length&&(this.btnDisabledState_CheckAPI&&(this.api="",this.changeButtonDisabledState(!0)),a=!1),this.restoreApiKeyInput(!1,!1)):!t&&e&&(this.apiCheckedData.filter(t=>"third-party"===t.vpn&&t.apiurl.toLowerCase()===this.apiURL.toLowerCase()).length<1&&(a=!1,this.btnDisabledState_CheckAPI)&&(this.api="",this.changeButtonDisabledState(!0)),this.restoreApiKeyInput(!1,!1)),a},check_KeyMode_Sending(){if(this.check_KeyMode_byURL_ChangeKey())return!0;{let t,e,a,i,s=0;this.isThirdPartyAPIKeyEnabled?(i="cn"==this.settingsLanguage?"使用第三方代理专用Key (第三方单Key模式)":"Use Third-party Key (3rd party Key Mode)",e="当前接口地址仅支持第三方专用Key，已为您自动更换 [Key模式] 为: "+i+"\r\n\r\n请手动选择一个第三方专用Key (或添加一个) 后，再重发消息。如果您要使用 OpenAI 官方Key，请更改 [接口网址] 为官方接口 (或支持官方Key的第三方接口)。",a='The current API URL (API Endpoint) only supports Third-party API Keys. [Key Mode] has been automatically changed to "'+i+'" for you. \r\n\r\nPlease specify a Third-party API Key manually (or add a new one) before resending the request. If you want to use an OpenAI API Key, please change [API URL] to the OpenAI API Endpoint (or a Third-party API Endpoint that supports OpenAI API Keys).',t="cn"==this.settingsLanguage?e:a,s=550):(i="cn"==this.settingsLanguage?"使用 OpenAI 官方Key (自动轮换API Key)":"Use OpenAI API Keys (Auto Key Rotation)",e="当前接口地址仅支持 OpenAI 官方Key，已为您自动更换 [Key模式] 为: "+i+"\r\n\r\n但是当前没有可用的 OpenAI 官方Key，请求已被中止，请添加 OpenAI API Key。如果您要使用第三方专用Key，请更改 [接口网址] 为第三方接口。",a='The current API URL (API Endpoint) only supports OpenAI API Key, and it has automatically changed the [Key Mode] to "'+i+'" for you. \r\n\r\nHowever, there is currently no available OpenAI API Key, and the request has been aborted. Please add an OpenAI API Key. If you want to use a Third-party API Key, please change the [API URL] to the Third-party API.',t="cn"==this.settingsLanguage?e:a);const n="cn"==this.settingsLanguage?"提醒 - 已中止发送请求":"Reminder - Request has been suspended";return setTimeout(()=>{this.showNotification(t,"center",n)},s),!1}},autoKeyRotation_BulkAdd(){let t="cn"==this.settingsLanguage?"开始批量添加API Key":"Start bulk adding API Keys";this.isShowBulkAddPanel_AutoKeyRotation&&(t="cn"==this.settingsLanguage?"批量添加已准备就绪":"Bulk adding is ready"),this.isShowBulkAddPanel_AutoKeyRotation=!0,this.showNotification(t,"bottom","",1800),setTimeout(()=>{document.querySelector("#dialog-AutoKeyRotation .dialog-content").scrollIntoView({behavior:"smooth",block:"start"})},0)},submitBulkApiKeys(h,e,c){if(!this.checkBusyStatus()){h=null==h||h,e=null==e||e,c=null==c?[]:c,this.saveApikeyData();let l="";var d=document.querySelector(".textareabulkaddapikey");if(h&&null==d)console.error("submitBulkApiKeys() - document.querySelector('.textareabulkaddapikey') == null ");else if(h&&""===d.value.trim())l="cn"==this.settingsLanguage?"内容为空":"Content is empty",this.showNotification(l,"bottom");else{const a=/^sk-[a-zA-Z0-9]+$/,i=/^sk-[a-zA-Z0-9]{48}$/;let n=[];const s=[];let o=[];(c=(c=h?d.value.trim().split("\n"):c).filter(t=>""!==t.trim()).map(t=>t.trim())).forEach(t=>{a.test(t)?(n.push(t),i.test(t)||o.push(t)):s.push(t)}),h&&(c=/"sk-[a-zA-Z0-9]{48}"/g,null!=(c=d.value.trim().match(c)))&&0<c.length&&(c=c.map(t=>t.replace(/"/g,"")),n=n.concat(c));let t=!1,r=(0===n.length?l="cn"==this.settingsLanguage?"错误：未包含 API Key":"Error: No API Key included":0!==s.length&&h?(l="cn"==this.settingsLanguage?"文本包含有非 API Key 的数据，已找到 "+n.length+" 个 API Key，是否直接提交？":"The text contains non-API Key data. Currently, "+n.length+" API Keys have been found. Would you like to submit them directly?",this.is_Alert_Confirm_Prompt_Open=!0,confirm(l)?t=!0:l="cn"==this.settingsLanguage?"未提交，请检查后重新提交":"Not submitted, please check and resubmit",setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)):t=!0,"bottom");if(t){var c=n.filter((t,e)=>n.indexOf(t)===e),g=c.length!==n.length,c=(o=o.filter((t,e)=>o.indexOf(t)===e),c.map(t=>({apikey:t})));this.validateApiCheckedData(c);const m=this.apiCheckedData.filter(t=>t.apikey&&""!==t.apikey.trim());let t=0,a=0,i=[];c.forEach(e=>{-1!==m.findIndex(t=>t.apikey===e.apikey)?a++:(m.push(e),i.push(e.apikey),t++)}),this.apiCheckedData=m;var u=this.getVariablesFromThis(this.apikeyData_default);u.version=this.apikeyData_Version;try{localStorage.setItem("apikeyData",JSON.stringify(u))}catch(t){var u=t.message||"",p=t.name||"";this.localStorageExceedsMaximum(u,p)}this.btnDisabledState_CheckAPI||this.restoreApiKeyInput(!1,!1);let e="",s="";g&&this.settingsLanguage;s=h?(e="OK，批量添加完成。","OK, Bulk addition successful. "):(e="OK，完成。","OK, Successful. "),e=e+"总共检测到 "+c.length+" 个 API Key，其中：新的 "+t+" 个；已存在的 "+a+" 个。",s=s+"Detected a total of "+c.length+" API Keys: "+t+" new keys; "+a+" existing keys.",0<i.length&&(u=(u="cn"==this.settingsLanguage?"\r\n\r\n以下为新增 API Key 的清单:":"\r\n\r\nThe following are the newly added API Keys :")+"\r\n"+i.join("\r\n"),e+=u,s+=u),0<(o=o.filter(t=>i.includes(t))).length&&(p=(p="cn"==this.settingsLanguage?"\r\n\r\n其中部分 API Key 的位数不正确，疑似错误 Key 的清单：":"\r\n\r\nSome of the API Keys have incorrect lengths :")+"\r\n"+o.join("\r\n"),e+=p,s+=p),l="cn"==this.settingsLanguage?e:s,r="center",h&&(d.value="",this.isShowBulkAddPanel_AutoKeyRotation=!1)}(h||e)&&this.showNotification(l,r,"",1800)}}},autoKeyRotation_EditLevel(e){if(event.stopPropagation(),!this.checkBusyStatus()){this.saveApikeyData();var i=this.apiCheckedData.find(t=>t.apikey===e.apikey);if(null!=i){let t=null;var s=/^([01234589]|333)?$/;let e="cn"==this.settingsLanguage?'所有[级别]都是全自动调节的，会自我修复，通常无需修改。\r\n如需修改请输入 1 位数字并确认：[0]匹配付费账号；[1～5]匹配非付费账号；[8]无效的密钥；[9]配额不足(含过期)。\r\n\r\n输入[333]并确认，可将 Key 改为"第三方代理专用Key"。':'[Level] is intelligently adjusted and automatically repaired, usually requiring no modification.\r\nTo make changes, please enter a single digit and confirm: [0] for matching paid accounts; [1-5] for matching non-paid accounts; [8] for invalid API Key; [9] for insufficient quota (including expiration, etc.).\r\n\r\nOther: Enter [333] and confirm to change the Key to "Third-party Key".',a=!1;for(this.is_Alert_Confirm_Prompt_Open=!0;(null===t||!s.test(t))&&(t=null===t?null==i.level?"":i.level:t,a&&(e="cn"==this.settingsLanguage?'所有[级别]都是全自动调节的，通常无需修改。\r\n如果不确定，可取消修改，或直接改为[0~5]的 1 位数字，值越小，优先级越高，会提前被调用并根据实际使用情况动态调节。\r\n\r\n输入[333]并确认，可将 Key 改为"第三方代理专用Key"。':'[Level] is intelligently adjusted and usually do not require modification.\r\nIf unsure, you can cancel the modification or directly change it to a single digit from [0-5]. The smaller the value, the higher the priority. It will be called in advance and dynamically adjusted based on actual usage.\r\n\r\nOther: Enter [333] and confirm to change the Key to "Third-party Key".'),null!==(t=window.prompt(e,t)));)a=!0;if(setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),null!==t&&""!==t){if(333===(t=parseInt(t)))i.level=0,i.vpn="third-party";else{if(t<0||9<t||6===t||7===t)return;i.level=t}var n=this.getVariablesFromThis(this.apikeyData_default);n.version=this.apikeyData_Version;try{localStorage.setItem("apikeyData",JSON.stringify(n))}catch(t){var n=t.message||"",o=t.name||"";this.localStorageExceedsMaximum(n,o)}n="cn"==this.settingsLanguage?"修改成功":"Modification successful";this.showNotification(n,"bottom")}}}},deleteApiData(e){if(event.stopPropagation(),!this.checkBusyStatus()){this.saveApikeyData();var a=("cn"==this.settingsLanguage?"您确定要删除下面这个 API Key 吗？":"Are you sure you want to delete this API Key below?")+"\r\n\r\n"+e.apikey;if(this.is_Alert_Confirm_Prompt_Open=!0,confirm(a)){setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100);var t=this.api===e.apikey,a=(this.apiCheckedData=this.apiCheckedData.filter(t=>t.apikey!==e.apikey),a="cn"==this.settingsLanguage?"API Key 已删除":"API Key has been deleted",this.showNotification(a,"bottom"),this.getVariablesFromThis(this.apikeyData_default));a.version=this.apikeyData_Version;try{localStorage.setItem("apikeyData",JSON.stringify(a))}catch(t){var a=t.message||"",i=t.name||"";this.localStorageExceedsMaximum(a,i)}this.lastAPIKeyInputText_Available===e.apikey&&(this.lastAPIKeyInputText_Available=""),t&&(this.isThirdPartyAPIKeyEnabled?(this.api="",this.changeButtonDisabledState(!0)):this.restoreApiKeyInput(!1,!1)),this.apiCheckedData.length<1&&(this.btnDisabledState_CheckAPI&&(this.api=""),this.changeButtonDisabledState(!0))}else setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}},getFirstAvailableAPIKey(a){if(this.saveApikeyData(),this.isThirdPartyAPIKeyEnabled){let t=this.apiCheckedData.find(t=>"third-party"===t.vpn&&t.apikey===this.api.trim());return null==t&&(console.log("getFirstAvailableAPIKey() 获取第三方key出错：",t),console.log("this.api.trim()：",this.api.trim()),console.log("this.apiCheckedData：",this.apiCheckedData),t={apikey:this.api.trim()},this.changeButtonDisabledState(!0)),t}let i;null!=a&&null!=a[0]?(i=(i="string"==typeof a[0]?this.apiCheckedData.filter(t=>!a.includes(t.apikey)):this.apiCheckedData.filter(e=>!a.some(t=>t.apikey===e.apikey))).filter(t=>"third-party"!==t.vpn)).filter(t=>8!==t.level&&9!==t.level).length<1&&(i=this.apiCheckedData):i=this.apiCheckedData.filter(t=>"third-party"!==t.vpn);let e=this.apiCheckedData.filter(t=>"third-party"!==t.vpn).sort((t,e)=>t.level!==e.level?null===t.level?-1:null===e.level?1:t.level-e.level:t.nexttime-e.nexttime);var s=e.filter(t=>0===t.level||8!==t.level&&9!==t.level&&t.nexttime<=(new Date).getTime());let t=e=0<s.length?s:e;this.apiGPTModel.includes("gpt-4")&&0<(s=e.filter(t=>"GPT-4"===t.vpn)).length&&(t=s);var s=e.slice(),n=t.slice();try{var o=Math.random();const m=Math.random();var r,l=Math.random();if(this.apiGPTModel.includes("gpt-4")){let t;Math.random()<=.8?(0<(t=i.filter(t=>"GPT-4"===t.vpn)).length||0<(t=i.filter(t=>null===t.level||0===t.level)).length)&&(i=t):(0<(t=i.filter(t=>null===t.level||0===t.level)).length||0<(t=i.filter(t=>"GPT-4"===t.vpn)).length)&&(i=t)}if(o<=.8)e=i.sort((t,e)=>{var a;return t.level!==e.level?null===t.level?-1:null===e.level?1:t.level-e.level:m<=.65||0===(a=i.filter(t=>0!==t.nexttime)).length?t.nexttime-e.nexttime:(a=a.sort((t,e)=>t.nexttime-e.nexttime)).indexOf(t)-a.indexOf(e)}),Math.random()<=.85&&0<(r=e.filter(t=>0===t.level||8!==t.level&&9!==t.level&&t.nexttime<=(new Date).getTime())).length&&(e=r);else{let t=i.slice();var h,c,d=t.filter(t=>8!==t.level&&9!==t.level),g=(t=0<d.length?d:t).filter(t=>t.nexttime<=(new Date).getTime()),u=(t=5<g.length?g:t).filter(t=>t.updatetime<(new Date).getTime()-2e4),p=(t=3<u.length?u:t).filter(t=>0!==t.level);0<p.length&&(t=p),e=l<=.8?0===(h=t.filter(t=>0!==t.succrate)).length?t.sort((t,e)=>t.nexttime-e.nexttime):h.sort((t,e)=>e.succrate-t.succrate).slice(0,5).sort((t,e)=>t.nexttime-e.nexttime):0<(c=t.filter(t=>0===t.succrate)).length?c.sort((t,e)=>t.nexttime-e.nexttime):t.sort((t,e)=>t.nexttime-e.nexttime)}}catch(t){console.error(t),console.error("getFirstAvailableAPIKey() 获取key算法出错：",t.message),e=this.apiGPTModel.includes("gpt-4")?Math.random()<=.75?n:e:s}return e[0]},sendRequest_or_restoreApiKeyInput(){if(this.btnDisabledState_CheckAPI){this.apiCheckedData.find(t=>t.apikey===this.api.trim());let t="";t="cn"==this.settingsLanguage?"目前无法通过 API Key 查询 OpenAI API 余额，点击 [取消] 可以中止查询，点击 [确认 / 好] 可以通过  Session Key 来查询余额。\r\n\r\n • 7月22日～26日，OpenAI 陆续停止了使用 API Key 来查询余额和其他账号信息的通道。现在需要使用 Session Key 来进行查询，但 Session Key 是动态变化的，需要登录 OpenAI 后获取，一段时间后或者退出登录后 Session Key 会自动换新，需要重新获取。":"Currently, unable to query OpenAI API balance using API Key. Click [Cancel] to abort, or click [Confirm / OK] to use the Session Key for balance inquiry.\r\n\r\n • From July 22nd to 26th, OpenAI suspended the ability to query balances and other account information using the API Key. Currently, to check the balance, a Session Key needs to be used. However, the Session Key is dynamically changing and needs to be obtained after logging into OpenAI. After a certain period of time or logging out, the Session Key will automatically refresh, requiring obtaining again.",this.is_Alert_Confirm_Prompt_Open=!0,confirm(t)&&this.sendRequest_usingSessionKey(),setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}else this.restoreApiKeyInput(!1,!0)},sendRequest_usingSessionKey(){let t=null;var e=/^sess-[a-zA-Z0-9]{40}$/;let a="cn"==this.settingsLanguage?"OpenAI API 账号余额查询 (via Session Key)\r\n\r\n • Session Key 获取方法(具体请网络搜索)：登录 OpenAI 后，通过浏览器的开发者工具 ，在 [Headers/标头] 中找到 [Authorization]，可获得以“sess-”开头的总长度为45位的 Session Key。\r\n\r\n请将其粘贴在下方，查询将返回包含余额在内的完整的信息：":'OpenAI API Balance Query (via Session Key)\r\n\r\n • To obtain the Session Key (for specifics, please Google): After logging in to OpenAI, open DevTools in your browser and look for [Authorization] under [Headers]. There, you will find a 45-character Session Key starting with "sess-". \r\n\r\nPlease paste it here to check the balance:',i=!1;for(this.is_Alert_Confirm_Prompt_Open=!0;(null===t||!e.test(t.trim()))&&(t=null===t?"":t.trim(),i&&(a="cn"==this.settingsLanguage?"Session Key 格式错误！\r\n\r\nsess码是以“sess-”开头的总长度为45位的密钥，请将其粘贴在下方，确认查询后将返回 OpenAI API 余额信息：":'Invalid Session Key format! \r\n\r\nThe key should start with "sess-" and have a total length of 45 characters. Please paste it below and confirm. After the query, it will return the OpenAI API balance:'),null!==(t=window.prompt(a,t)));)i=!0;setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),null!==t&&window.sendRequest(t.trim())},restoreApiKeyInput(a,i){if(!this.checkBusyStatus()){i=!0===i,i=!!(a=!0===a)||i;let t,e=!1;if(this.isThirdPartyAPIKeyEnabled?this.apiCheckedData.filter(t=>"third-party"===t.vpn).length<1&&(""===this.defaultAPIKey||this.defaultAPIKey.startsWith("sk-"))&&(e=!0):""===this.lastAPIKeyInputText_Available&&this.apiCheckedData.filter(t=>"third-party"!==t.vpn).length<1&&(""===this.defaultAPIKey||!this.defaultAPIKey.startsWith("sk-"))&&0===this.default_apiKeyArray_WrittenInTheCode.length&&(e=!0),e)!a&&i&&(this.api="",t="cn"==this.settingsLanguage?"无可恢复的 API Key，请继续输入新的Key并验证":"No available API Key to restore. Please enter a new Key and check it.",this.showNotification(t,"bottom","",4500));else if(this.isThirdPartyAPIKeyEnabled)0<this.apiCheckedData.filter(t=>"third-party"===t.vpn).length?this.defaultSelectedOneKey_ThirdParty()||setTimeout(()=>{this.isShowDialog_AutoKeyRotation=!0,t="cn"==this.settingsLanguage?"当前为第三方 Key 模式，请手动选择对应的第三方 Key":"Currently in Third-party Key Mode, please select the Third-party Key manually.",this.showNotification(t,"bottom","",5e3)},200):""===this.defaultAPIKey||this.defaultAPIKey.startsWith("sk-")||(this.api=this.defaultAPIKey,this.inputapichange(!1));else{if(a){if(t="cn"==this.settingsLanguage?"是否需要恢复一个 OpenAI 官方的 API Key？":"Do you need to recover an OpenAI API Key?",this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL&&(t=(t+="cn"==this.settingsLanguage?"\r\n\r\n • Key模式: 使用OpenAI官方Key (自动轮换API Key)":"\r\n\r\n • Key Mode: Use OpenAI API Keys (Auto Key Rotation)")+("cn"==this.settingsLanguage?"\r\n • API接口: <第三方> "+this.apiURL:"\r\n • API URL: <Third-party> "+this.apiURL),this.isSimpleMode||(t+="cn"==this.settingsLanguage?"\r\n\r\n提醒: 如果第三方接口不支持OpenAI官方Key，则需要在[设置]>[自动轮换API Key]中更改Key模式。":"\r\n\r\nTip: If the third-party API does not support the OpenAI key, you will need to change the Key Mode in [Settings]>[Auto Key Rotation].")),this.is_Alert_Confirm_Prompt_Open=!0,!confirm(t))return void setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100);setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}if(i&&(t="cn"==this.settingsLanguage?"已恢复 API Key":"API Key has been restored",this.showNotification(t,"bottom","",2e3)),""!==this.lastAPIKeyInputText_Available)this.api=this.lastAPIKeyInputText_Available;else{a=this.getFirstAvailableAPIKey();if(null!=a&&null!=a.apikey)this.api=a.apikey;else{if(0<this.default_apiKeyArray_WrittenInTheCode.length){i=this.default_apiKeyArray_WrittenInTheCode.find(e=>this.apiCheckedData.some(t=>t.apikey===e));if(null!=i)return this.api=i,void this.inputapichange(!1)}if(""!==this.defaultAPIKey&&this.defaultAPIKey.startsWith("sk-")&&this.apiCheckedData.some(t=>t.apikey===this.defaultAPIKey))this.api=this.defaultAPIKey;else{let t="";t=""!==(t=0<this.default_apiKeyArray_WrittenInTheCode.length?this.default_apiKeyArray_WrittenInTheCode[0]:t)?t:""!==this.defaultAPIKey?this.defaultAPIKey:this.lastAPIKeyInputText,this.api=t}}}this.inputapichange(!1)}}},updateApiCheckedData(h,c,d){if(null==h||""===h||null==c||0===c||null==d)console.error("updateApiCheckedData - Err - Null");else if(13!==c.toString().length||isNaN(new Date(c).getTime()))console.error("updateApiCheckedData - Err - not Timestamp");else if(""!==d){h=h.trim(),this.saveApikeyData();var g,u=this.apiCheckedData.find(t=>t.apikey===h);if(u)if(u.updatetime=(new Date).getTime(),"success"===d){let t=!1;0<=u.level&&u.level<=5&&0!==u.date3&&((g=c-u.date1)<19500?(u.level=0,t=!0):g<39500?(u.level=0===u.level?0:1,t=!0):g<59500&&(u.level=1<=u.level-3?u.level-3:1,t=!0)),u.succcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4,(100<u.succcount||100<u.failcount)&&(u.succcount=Math.ceil(u.succcount/5),u.failcount=Math.ceil(u.failcount/5)),60500<c-u.date1&&(u.date1=0),60500<c-u.date2&&(u.date2=0),60500<c-u.date3&&(u.date3=0),0===u.date1&&(u.date1=u.date2,u.date2=u.date3,u.date3=0),0===u.date1&&(u.date1=u.date2,u.date2=0),0===u.date1?u.date1=c:0===u.date2?u.date2=c:(0!==u.date3&&(u.date1=u.date2,u.date2=u.date3),u.date3=c),0===u.date2||0===u.date3||u.date3>u.date2+20500||u.date3>u.date1+20500?u.nexttime=c:u.nexttime=c+20500,8===u.level||9===u.level||null===u.level?u.level=1:!1===t&&0<=u.level&&u.level<=5&&(0!==u.date3?u.level=1<=u.level-3?u.level-3:u.level<1?u.level:1:0!==u.date2?u.level=2<=u.level-2?u.level-2:u.level<2?u.level:2:u.level=2<=u.level-1?u.level-1:u.level<2?u.level:2),u.apiurl=this.apiURL.trim(),!this.api.startsWith("sk-")||this.api.startsWith("sk-")&&this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?u.vpn="third-party":"third-party"===u.vpn||!this.apiGPTModel.includes("gpt-4")&&"GPT-4"!==u.vpn||(u.vpn="GPT-4",u.level=0)}else"429-2"===d||"404"===d?("429-2"===d?u.level=9:"404"!==d||this.isThirdPartyAPIKeyEnabled||this.apiGPTModel.includes("gpt-4")&&1<=u.level&&u.level<=5&&(u.level=u.level+1<=5?u.level+1:5),u.failcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4,(100<u.succcount||100<u.failcount)&&(u.succcount=Math.ceil(u.succcount/5),u.failcount=Math.ceil(u.failcount/5)),u.nexttime="429-2"===d?c:c+20500):"429-3"===d||"429-4"===d||"500"===d||"503"===d?9===u.level&&(u.level=null):"429-1"===d||"429-1-day"===d||"429-5"===d||"400"===d?("429-1"===d||"429-1-day"===d?(8!==u.level&&9!==u.level||(u.level=null),0===u.level?u.level=1:1<=u.level&&u.level<=5&&(0===u.date1?u.level=u.level+2<=5?u.level+2:5:0===u.date2?20500<c-u.date1&&(u.level=u.level+1<=5?u.level+1:5):(0!==u.date3||40500<c-u.date1||20500<c-u.date2)&&(u.level=u.level+1<=5?u.level+1:5))):"400"===d?8===u.level||9===u.level||null===u.level?u.level=1:0<=u.level&&u.level<=5&&(0!==u.date3?(g=c-u.date1)<19500?(u.level=0,isLevelChanged=!0):g<39500?(u.level=0===u.level?0:1,isLevelChanged=!0):g<59500?(u.level=1<=u.level-3?u.level-3:1,isLevelChanged=!0):u.level=2<=u.level-1?u.level-1:2:u.level=2<=u.level-1?u.level-1:2):"429-5"!==d||8!==u.level&&9!==u.level||(u.level=null),"429-1"===d||"429-1-day"===d||"429-5"===d?(u.failcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4):"400"===d&&(u.succcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4),(100<u.succcount||100<u.failcount)&&(u.succcount=Math.ceil(u.succcount/5),u.failcount=Math.ceil(u.failcount/5)),"429-1-day"===d?u.nexttime=c+432e3:"429-5"===d?u.nexttime=c:0===u.date1?u.nexttime=c+20500:0===u.date2?"429-1"===d?(u.nexttime=u.date1+20500,u.nexttime=u.nexttime<c?c:u.nexttime):u.nexttime=c+20500:0===u.date3&&"429-1"===d?(u.nexttime=u.date2+20500,u.nexttime=u.nexttime<c?c:u.nexttime):u.nexttime=c+20500):"429-other"===d||"error-other"===d?(1<=u.level&&u.level<=5&&(u.level=u.level+1<=5?u.level+1:5),u.failcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4,u.nexttime=c+20500):"401"===d&&(u.level=8,u.failcount++,u.succrate=Math.round(u.succcount/(u.succcount+u.failcount)*1e4)/1e4,u.nexttime=c);else{let t=null,e=0,a=0,i=0,s=0,n=0,o="",r="",l=!1;"success"===d?(t=1,e=1,i=Math.round(e/(e+a)*1e4)/1e4,s=c,n=c,o=this.apiURL.trim(),!this.api.startsWith("sk-")||this.api.startsWith("sk-")&&this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?r="third-party":!this.api.startsWith("sk-")||!this.list_OnlyUseThirdPartyKey_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))||(g="本次需要您手动标记当前 API Key 是否属于 OpenAI 官方Key。\r\n\r\n点击 [确定 (好)] 将标记为 OpenAI 官方Key，点击 [取消] 将标记为第三方接口的专用Key，请选择...\r\n\r\nAPI Key: "+this.api+"\r\n接口网址: "+this.apiURL,u="Please manually confirm if the current API Key belongs to OpenAI API Key this time. \r\n\r\nClick [Confirm (OK)] to mark it as OpenAI API Key, or click [Cancel] to mark it as a Third-party API Key. Please choose...\r\n\r\nAPI Key: "+this.api+"\r\nAPI URL (Endpoint): "+this.apiURL,g="cn"==this.settingsLanguage?g:u,confirm(g))?this.apiGPTModel.includes("gpt-4")&&(r="GPT-4",t=0):(r="third-party",l=!0,this.isThirdPartyAPIKeyEnabled=!0)):"429-2"===d||"404"===d?(t=9,a=1,i=Math.round(e/(e+a)*1e4)/1e4,n=c):"429-3"!==d&&"429-4"!==d&&"500"!==d&&"503"!==d&&("429-1"===d||"429-1-day"===d||"400"===d?(t=1,"429-1"===d||"429-1-day"===d?(a=1,i=Math.round(e/(e+a)*1e4)/1e4):"400"===d&&(e=1,i=Math.round(e/(e+a)*1e4)/1e4),n="429-1-day"===d?c+432e3:"400"===d?c:c+20500):"429-other"!==d&&"error-other"!==d||(a=1,i=Math.round(e/(e+a)*1e4)/1e4,n=c+20500)),(this.api.startsWith("sk-")&&!this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))&&"401"!==d&&"404"!==d&&"error-other"!==d||(l||!this.api.startsWith("sk-")||this.api.startsWith("sk-")&&this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t)))&&"success"===d)&&this.apiCheckedData.push({apikey:h,apiurl:o,date1:s,date2:0,date3:0,nexttime:n,level:t,freq:0,vpn:r,owner:"me",succcount:e,failcount:a,succrate:i,updatetime:(new Date).getTime()})}this.saveApikeyData()}},showStatus(){let t="";var e=this.apiURL.toLowerCase()===this.OpenAI_API_URL?"<OpenAI> ":"",a=this.btnDisabledState_CheckAPI?this.api:"",i=!this.isSimpleMode&&this.apiGPTModel.includes("gpt-3.5")&&this.apiGPTModel.includes("16k")?"cn"==this.settingsLanguage?"<蓝> ":"<Blue> ":"",s=!this.isSimpleMode&&this.apiGPTModel.includes("gpt-3.5")&&9999<this.totaltokens?"cn"==this.settingsLanguage?"<蓝> ":"<Blue> ":"",n=this.isSimpleMode||this.apiGPTModel.includes("gpt-3.5")||this.apiGPTModel.includes("32k")||this.openSmartMaxTokens||3999<this.apiMaxTokens||3999<this.totaltokens?"":"cn"==this.settingsLanguage?"<橙> ":"<Orange> ",o=this.isSimpleMode||this.apiGPTModel.includes("gpt-3.5")||!this.apiGPTModel.includes("32k")?"":"cn"==this.settingsLanguage?"<红> ":"<Red> ",r=this.isSimpleMode||this.apiGPTModel.includes("gpt-3.5")||!this.openSmartMaxTokens?"":"cn"==this.settingsLanguage?"<红> ":"<Red> ",l=!this.isSimpleMode&&!this.apiGPTModel.includes("gpt-3.5")&&3999<this.apiMaxTokens?"cn"==this.settingsLanguage?"<红> ":"<Red> ":"",h=!this.isSimpleMode&&!this.apiGPTModel.includes("gpt-3.5")&&3999<this.totaltokens?"cn"==this.settingsLanguage?"<红> ":"<Red> ":"";t=(t=(t=(t=(t+="cn"==this.settingsLanguage?"① 模型 :  "+i+n+o+this.apiGPTModel:"① Model :  "+i+n+o+this.apiGPTModel)+("cn"==this.settingsLanguage?"\r\n② Token用量 :  "+s+h+this.totaltokens+" tokens":"\r\n② Tokens of context :  "+s+h+this.totaltokens+" tokens"))+("cn"==this.settingsLanguage?"\r\n③ max_tokens参数 :  "+l+this.apiMaxTokens:"\r\n③ max_tokens (completion) :  "+l+this.apiMaxTokens))+("cn"==this.settingsLanguage?"\r\n④ 智能max_tokens :  "+r+(this.openSmartMaxTokens?"已启用":"已关闭"):"\r\n④ Smart max_tokens :  "+r+(this.openSmartMaxTokens?"Enabled":"Disabled")))+("cn"==this.settingsLanguage?"\r\n⑤ API接口 :  "+e+this.apiURL:"\r\n⑤ API URL :  "+e+this.apiURL),t=this.isThirdPartyAPIKeyEnabled?(t+="cn"==this.settingsLanguage?"\r\n⑥ Key模式 :  第三方单Key模式 (使用第三方代理专用Key)":"\r\n⑥ Key Mode :  3rd party Key Mode (Use Third-party Key)")+("cn"==this.settingsLanguage?"\r\n⑦ API Key :  "+a:"\r\n⑦ API Key:  "+a):(t+="cn"==this.settingsLanguage?"\r\n⑥ Key模式 :  自动轮换API Key (使用OpenAI官方Key)":"\r\n⑥ Key Mode :  Auto Key Rotation (Use OpenAI API Keys)")+("cn"==this.settingsLanguage?"\r\n⑦ API Key :  <上次> "+a:"\r\n⑦ API Key :  <Last> "+a),t+="cn"==this.settingsLanguage?"\r\n⑧ 系统提示词 :  "+(""==this.gptSystemPromptReadOnly.trim()?"无":"有"):"\r\n⑧ System Prompt :  "+(""==this.gptSystemPromptReadOnly.trim()?"No":"Yes");let c="";Number.isInteger(this.settingsContextualMode)?0===this.settingsContextualMode?c="cn"==this.settingsLanguage?"不限制":"No Limit":this.settingsContextualMode<100?c="cn"==this.settingsLanguage?"上限 "+this.settingsContextualMode+" 条":"Limit: "+this.settingsContextualMode:100<this.settingsContextualMode&&(c="cn"==this.settingsLanguage?"始终保留最后 "+(this.settingsContextualMode-100)+" 条":"Keep Last: "+(this.settingsContextualMode-100)):c="",t+="cn"==this.settingsLanguage?"\r\n⑨ 记忆模式 :  "+c:"\r\n⑨ Contextual Mode :  "+c;i=this.isShowNotification?1900:0;const d="cn"==this.settingsLanguage?"当前状态":"Current status";setTimeout(()=>{this.showNotification(t,"center",d)},i)},clearContext(){this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!0,this.totaltokens=0,this.msgContent=[this.msgContent[0]],this.msgTokens=[this.msgTokens[0]],this.succQA_Count=0,this.msgContentForMsgList_SingleRound=[this.msgContentForMsgList_SingleRound[0]],this.userMsgTokensForRetry=0;var t="cn"==this.settingsLanguage?"### #清空上下文记忆\r\n\r\n":"### #Clear Context\r\n\r\n";this.chathistory+=t,this.add_hr_newRoundContext(!1),this.updateChatLastTime(this.formatDateYYYYMMDDHHmmss(new Date,":"))},openDialog_Help(){var t="cn"==this.settingsLanguage?"TAKGPT v69.69 - 帮助":"TAKGPT v69.69 - Help",e="cn"==this.settingsLanguage?'TAKGPT - A ChatGPT (GPT-3.5 / GPT-4) Webpage with Just a Single HTML File \r\n\r\nTAKGPT ，只有一个 html 文件的 ChatGPT (GPT-3.5 / GPT-4) 聊天网页。下载到电脑即可使用，像打开一张图片一样简单。支持上传至所有免费的静态网页托管平台，非常流畅。  1) 接口: 自定义接口，支持 OpenAI 官方API 和第三方平台API (反代)。  2) 模型: 支持最新的 GPT-3.5 和 GPT-4 模型。  3) 密钥: 支持 OpenAI 官方Key 和第三方平台专用Key，支持轮询。  4) 数据安全: 数据仅存储在浏览器本地存储中，支持导出、导入、删除。代码开源，安全无风险。\r\n\r\n#开始使用\r\n填入 API Key 或批量添加后即可开始聊天。\r\n\r\n#对话\r\n  • 功能: 多对话管理、全自动保存、支持创建副本、多标签页数据同步、可导出 (备份/迁移/分享)、可导入 (还原对话)。 \r\n  • 聊天: 1) 全自动智能调节 max_tokens。 2) 支持自动重问 (发送失败时智能判断是否重试)。 3) 支持 Markdown，方法与官网相同。*当 GPT 回复未使用 Markdown 语法时，可要求其使用 Markdown 格式回复（主要应用于代码、表格、文章排版、显示网络图片等）。 4) iPhone / iPad 中，搜狗输入法在换行时可能存在兼容性问题。 5) 电脑端支持 Shift + Enter 、Ctrl + Enter 、Command(⌘) + Enter 换行。 6) 如果想中断正在发送的请求，可通过刷新网页来实现。\r\n\r\n#提示词窗口\r\n截止 v69.69 版本，暂时只有设置系统提示词的功能，可在提示词窗口中点击蓝色小问号 [?] 了解更多。\r\n\r\n#设置窗口\r\n常规设置、记忆模式 (上下文模式)、 API 设置、查询 API 余额和有效期、 API 专业设置、上传头像、导出纯文本聊天记录、本地数据管理等，可在设置窗口中点击蓝色小问号 [?] 了解更多。\r\n\r\n#其他\r\n  • [清除记忆] 按钮颜色: 如果当前对话的 [记忆模式] 设置了上限，那么当记忆 (上下文) 接近上限时，颜色会变为橘红色，当记忆达到上限时，会变为红色 (颜色变化只是提醒作用，无需用户操作)。\r\n  • [Token用量] 文字颜色: 1) 当上下文 tokens 已达到 2000 ，颜色为橘红色。2) 达到当前模型tokens上限的 90% 时，颜色变为红色并加粗。\r\n  • [状态] 按钮颜色: 通过颜色区分不同模型与不同设置的费用差异。1) gpt-3.5 模型，按钮为绿色。选 16k 版本时，颜色会变为蓝色。 2) gpt-4 模型，按钮为橘红色。当满足以下任一条件时，颜色会变为红色：选用 32k 版本 / 开启"smart max_tokens" / max_tokens 参数的设置高于4000 / 上下文 tokens 已达到4000 。':'TAKGPT - A ChatGPT (GPT-3.5 / GPT-4) Webpage with Just a Single HTML File \r\n\r\nTAKGPT is a lightweight single-page chat application that can be deployed statically, with no need for a server. It can be uploaded to any static website hosting platform like GitHub and provides a very smooth browsing experience.  1) API: Supports OpenAI API and third-party API (reverse proxy). 2) Model: Supports the latest GPT-3.5 and GPT-4 models. 3) API Key: Supports both OpenAI API Key and third-party proxy website keys. Supports fully automatic intelligent rotation of API keys. 4) User Data Security: Supports browser local storage. All data is stored solely in the browser cache and supports export, import, and deletion. \r\n\r\n#Getting Started \r\nEnter API Key or add them in bulk, and start chatting. \r\n\r\n#Chat\r\n  • Features: Multiple chat management, automatic saving, support for creating copies, data synchronization across multiple tab pages, export capability (backup/migration/sharing), import capability (restore chats). \r\n  • Chatting:  1) Fully automatic intelligent adjustment of max_tokens.  2) Supports automatic retry (intelligently determines whether to retry when a request fails).  3) Markdown is supported, same as the official website. *When GPT replies without using Markdown syntax, you can ask it to reply in Markdown format (mainly used for code, tables, article formatting, displaying web images, etc.).  4) Line Breaks on Computer: Supports Shift + Enter, Ctrl + Enter line breaks, and Mac also support Command(⌘) + Enter line breaks.  5) There is no stop request function. If you want to interrupt a request that is being sent, you can do so by refreshing the web page.\r\n\r\n#Prompt Generator \r\nv69.69, only the function of setting system prompt is available. Click the blue question mark [?] in the prompt generator window to learn more. \r\n\r\n#Settings \r\nFeatures: General settings, Contextual Mode, API settings, checking API balance and validity period, API professional settings, uploading avatars, exporting chat history as plain text, local data management, etc. Learn more by clicking the blue question mark [?] in the settings window.\r\n\r\n#Other\r\n  • [Clear Context] Button Color: If the [Contextual Mode] of the current chat has set a limit, the color will turn orange-red when the context is approaching the limit, and turn red when the context reaches the limit (the color change is only a reminder and does not require user action).\r\n  • [Tokens Usage] Text Color:  1) When the context tokens reach 2000, the color will turn orange-red. 2) When the token usage reaches 90% of the current model\'s limit, the color will turn red and bold.\r\n  • [Status] Button Color:  By using different colors, distinguish cost variations based on different models and settings.  1) For the gpt-3.5 model, the button color is green. When selecting the 16k version, the color will turn blue. 2) For the gpt-4 model, the button color is orange-red. It will turn red when any of the following conditions are met: selecting the 32k version, enabling "smart max_tokens", setting the max_tokens parameter above 4000, or reaching 4000 context tokens.';this.showNotification(e,"center",t)},add_hr_newRoundContext(t){var e;let a;2<this.msgList.length&&(a=this.msgList[this.msgList.length-1].my?document.querySelectorAll(".userinfo"):document.querySelectorAll(".aiinfo"),t&&1<this.msgContentForMsgList_SingleRound.length||("HR"!=(t=a[a.length-1]).parentElement.nextElementSibling.tagName&&(this.msgList[this.msgList.length-1].hr=!0,(e=document.createElement("hr")).classList.add("newcontext-hr"),e.style.marginBottom=this.settingsTime_WechatStyle?"20px":"33px",e.style.display=this.settingsDividerLine?"block":"none",t.parentElement.insertAdjacentElement("afterend",e),this.scrollToBottomView()),t="cn"==this.settingsLanguage?"#### #无记忆状态，新对话开始\r\n***\r\n\r\n":"#### #The context was emptied. New Chat begins.\r\n***\r\n\r\n",this.chathistory+=t,""==this.gptSystemPrompt_hidden.trim()&&this.addSystemPromptToChatHistory("#### #当前系统提示词 system prompt ","#### #Current System Prompt ")))},add_hr_For_ChatDataRestored(){document.querySelectorAll("div.msgdatetimediv").forEach(t=>{var e;"true"===t.getAttribute("data-hr")&&((e=document.createElement("hr")).classList.add("newcontext-hr"),e.style.marginBottom=this.settingsTime_WechatStyle?"20px":"33px",e.style.display=this.settingsDividerLine?"block":"none",t.parentElement.insertAdjacentElement("afterend",e))})},undo(){var t;this.scrollToBottomView(),1<this.msgContentForMsgList_SingleRound.length?(t="cn"==this.settingsLanguage?"### #撤销\r\n\r\n":"### #Undo\r\n\r\n",this.chathistory+=t,this.userMsgTokensForRetry=0,t=this.msgList.pop(),this.msgContentForMsgList_SingleRound.pop(),t.my||(this.msgContent.pop(),this.msgTokens.pop(),this.msgList.pop(),this.msgContentForMsgList_SingleRound.pop(),this.msgContent.pop(),this.msgTokens.pop(),this.succQA_Count=this.msgContent.length-1),this.msgContentForMsgList_SingleRound.length<2?(this.btnDisabledState_Undo=!0,this.btnDisabledState_Clear=!0,"请重发"!=this.sentext&&"Please Retry"!=this.sentext||(this.sentext="cn"==this.settingsLanguage?"发送":"Send")):this.msgContent.length<2&&(this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!1),this.totaltokens=this.msgTokens[this.msgTokens.length-1].total_tokens,this.$nextTick(()=>{this.add_hr_newRoundContext(!0)}),this.updateChatLastTime(this.formatDateYYYYMMDDHHmmss(new Date,":")),0!=this.msgContent.length&&0!=this.msgContentForMsgList_SingleRound.length||console.error("undo(). length == 0. [Undo] 意外错误 Error bug")):(console.error("undo(). length <= 1 && Undo is available. [Retry] 意外错误 Error bug"),this.btnDisabledState_Undo=!0,this.btnDisabledState_Clear=!0)},retry(){if(!this.isTotaltokens_Exceeds_Maxtokens()&&this.check_KeyMode_Sending()){try{var t,a=this.sendMsg_ContextualMode("retry");if("string"==typeof a){if("no clear context and abort operation"===a)return i="cn"==this.settingsLanguage?"已中止[重问]":"Aborted [Retry]",void this.showNotification(i,"bottom","",1800);if("clear context and cancel retry"===a)return t="cn"==this.settingsLanguage?"已清除记忆，并取消了 [重问]":"Context cleared and [Retry] canceled",void this.showNotification(t,"bottom","",3100)}}catch(t){console.error('sendMsg_ContextualMode("retry") - 重问过程中，"上下文模式"执行时出错了',t)}if(this.isRetry_RetryMessage="",1<this.msgContentForMsgList_SingleRound.length){var i="cn"==this.settingsLanguage?"### #重问\r\n\r\n":"### #Retry\r\n\r\n",a=(this.chathistory+=i,this.msgList.pop());let t=this.msgContentForMsgList_SingleRound.pop(),e=0;a.my?(e=this.msgTokens[this.msgTokens.length-1].total_tokens,0!=this.userMsgTokensForRetry&&(e=this.userMsgTokensForRetry)):(this.msgContent.pop(),this.msgTokens.pop(),this.msgList.pop(),this.msgContentForMsgList_SingleRound.pop(),t=this.msgContent.pop(),this.succQA_Count=this.msgContent.length-1,e=this.msgTokens[this.msgTokens.length-1].total_tokens,this.userMsgTokensForRetry=e,this.msgTokens.pop(),0!=this.msgContent.length&&0!=this.msgTokens.length||alert(" 找到一个bug\r\nA new bug has appeared.\r\n\r\n已回复后的重问，在两次pop()后 this.msgContent.length 和 this.msgTokens.length 都不该为0 ，此时应该至少有1条数据，([0] = System Prompt 系统指令)。 \r\n\r\nthis.msgContent.length: "+this.msgContent.length+"\r\n\r\nthis.msgTokens.length: "+this.msgTokens.length)),this.totaltokens=e,0!=this.msgContent.length&&0!=this.msgContentForMsgList_SingleRound.length||console.error("retry(). length == 0. [Retry] 意外错误 Error bug"),this.isRetry_RetryMessage=t.content,this.$nextTick(()=>{this.sendMsg()})}else console.error("retry(). length <= 1 && Retry is available. [Retry] 意外错误 Error bug"),this.btnDisabledState_Undo=!0,this.btnDisabledState_Clear=!0}},checkAPIbtn(){let a="";if(this.api=this.api.trim(),this.check_KeyMode_byURL(),""==this.api)this.sentext="cn"==this.settingsLanguage?"先验证API":"Check API First",a="cn"==this.settingsLanguage?"请填入 API Key":"Please enter the API Key",this.showNotification(a,"bottom"),this.isThirdPartyAPIKeyEnabled||this.restoreApiKeyInput(!0,!0);else if(!this.isSendingNow)if(this.saveApikeyData(),this.apiCheckedData.some(t=>t.apikey.trim()==this.api))this.inputapichange(!0);else{const i=(new Date).getTime();if(i-this.lastCheckApiTime<4e3)a="cn"==this.settingsLanguage?"请勿频繁发送请求，需间隔4秒":"Requests too fast, please wait 4 seconds between each one.",this.showNotification(a,"bottom","",2600);else{this.lastCheckApiTime=i,this.isCheckingApiKeyNow=!0,this.btnDisabledState_ApiURL=!0,this.btnDisabledState_Language=!0,this.btnDisabledState_ContextualMode=!0,this.btnDisabledState_KeyMode=!0,this.beginLoadingAnimation(),document.querySelector(".inputapikey").readOnly=!0,a="cn"==this.settingsLanguage?"验证中...":"Checking...",this.lastAPIKeyInputText=this.api,this.hasSystemPromptBeenSaved||(""!=this.gptSystemPrompt.trim()&&""==this.gptSystemPromptReadOnly.trim()&&""==this.gptSystemPrompt_hidden.trim()&&(a+="cn"==this.settingsLanguage?"    提示: [系统提示词]需要保存后才会生效":"    Tip: [System Prompt] will only take effect after being saved."),this.hasSystemPromptBeenSaved=!0),this.showNotification(a,"bottom","",6e4);var e=["hi~","Hey ChatGPT","hi","hello","Hi, how are you?","What's up?","Hello there!","How are you","Hey!","Sup?","Yo!","Howdy!","Hey?","Yo~","Hiya","Hello GPT, what's up?","Hey GPT"];let t="hi";"string"!=typeof(t=0<e.length?e[Math.floor(Math.random()*e.length)]:t)&&(t="hi"),axios.defaults.timeout=21e3,axios.post(this.apiURL,{messages:[{role:"user",content:t}],max_tokens:15,model:this.apiGPTModel},{headers:{"content-type":"application/json",Authorization:"Bearer "+this.api}}).then(t=>{var e;if(!t.data||!t.data.hasOwnProperty("choices"))throw t=this.thirdPartyAPI_ErrorOccurred_ButResponseWasNormal(t),(e=new Error("")).code="",e.request={responseText:JSON.stringify(t)},e;this.isCheckingApiKeyNow=!1,this.endLoadingAnimation(),this.lastAPIKeyInputText_Available=this.api.startsWith("sk-")&&!this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?this.api:"",document.querySelector(".inputapikey").readOnly=!1,this.changeButtonDisabledState(!1),this.btnDisabledState_ApiURL=!1,this.btnDisabledState_Language=!1,this.btnDisabledState_ContextualMode=!1,this.btnDisabledState_KeyMode=!1,this.check_KeyMode_byKey(),a="cn"==this.settingsLanguage?"验证成功，API Key 可用":"Successful, API Key is valid.",this.showNotification(a,"bottom","",1800),this.updateApiCheckedData(this.api,i,"success")}).catch(t=>{console.log("error",t),this.isCheckingApiKeyNow=!1,this.endLoadingAnimation(),document.querySelector(".inputapikey").readOnly=!1,!this.btnDisabledState_Sending&&this.btnDisabledState_CheckAPI||(this.changeButtonDisabledState(!0),this.btnDisabledState_ApiURL=!1,this.btnDisabledState_Language=!1,this.btnDisabledState_ContextualMode=!1,this.btnDisabledState_KeyMode=!1,this.check_KeyMode_byKey(),t.message&&t.message.includes("Type error")||t.message&&t.message.includes("401")?this.sentext="cn"==this.settingsLanguage?"API Key错误":"API Key Error":this.sentext="cn"==this.settingsLanguage?"先验证API":"Check API First",this.catchApiErrorCode(t,i))})}}},catchApiErrorCode(e,t){var a,i=this.apiCheckedData.find(t=>t.apikey===this.api);let s=null!=i&&0===i.updatetime,n=(this.list_OnlyUseThirdPartyKey_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))&&(s=!1),450),o="",r="",l="",h="",c="",d="";var g,u,p,m,i=/timeout of \d+ms exceeded/;try{if(e.request&&e.request.responseText)if((a=JSON.parse(e.request.responseText)).error&&"object"==typeof a.error&&a.error.message&&a.error.type&&a.error.code)h=a.error.message,c=a.error.type,d=a.error.code;else{for(g of Object.keys(a))if("object"==typeof a[g]){if(null!==a[g])for(u of Object.keys(a[g]))u.toLowerCase().includes("message")||u.toLowerCase().includes("msg")||u.toLowerCase().includes("err")?(p=u.toLowerCase().includes("err")?u+": ":"",h=h+(""===h?"":"\r\n")+p+("string"==typeof a[g][u]?a[g][u]:JSON.stringify(a[g][u]))):u.toLowerCase().includes("code")?d=a[g][u]?a[g][u].toString():"":u.toLowerCase().includes("type")&&(c=a[g][u]?a[g][u].toString():"")}else g.toLowerCase().includes("message")||g.toLowerCase().includes("msg")||g.toLowerCase().includes("err")?(m=g.toLowerCase().includes("err")?g+": ":"",h=h+(""===h?"":"\r\n")+m+("string"==typeof a[g]?a[g]:JSON.stringify(a[g]))):g.toLowerCase().includes("code")?d=a[g]?a[g].toString():"":g.toLowerCase().includes("type")&&(c=a[g]?a[g].toString():"");""===h&&(h=e.request.responseText)}}catch(t){""===h&&e&&e.request&&(e.request.responseText&&(h="string"==typeof e.request.responseText?e.request.responseText:JSON.stringify(e.request.responseText)),e.request.response)&&""===h&&(h="string"==typeof e.request.response?e.request.response:JSON.stringify(e.request.response)),""===d&&e&&e.response&&e.response.data&&(d=JSON.stringify(e.response.data))}let y="",f="",S="",b="";var L=this.gptModelList.find(t=>t.modelname===this.apiGPTModel);if(this.isModelDataExist_In_gptModelList(L),e.message&&e.message.includes("Type error"))o="API Key 含有非法符号。密钥不允许含有汉字、全角符号或其他非法符号。建议复制粘贴 API Key，避免意外输入全角符号或其他非法符号。",r="All API keys do not contain any full-width symbols or other illegal symbols. It is recommended to copy and paste the API Key to avoid entering illegal symbols.",o+="\r\n\r\n  • 当前 API Key : "+this.api,r+="\r\n\r\n  • The current API Key : "+this.api,l="cn"==this.settingsLanguage?"错误 - API Key 格式非法":"Error - Invalid API Key Format",y="";else if(e.message&&("timeout exceeded"==e.message||i.test(e.message))){var A=this.apiURL.toLowerCase()===this.OpenAI_API_URL&&this.api.startsWith("sk-");o="连接超时，服务器生成回复所用时间过长，或者是网络问题。",r="Connection timed out, the server took too long to generate a response, or there is a network issue.",A?(o+='\r\n  • 如果网络正常，需要确认您的IP所在地 (国家或地区) 是否属于 OpenAI 的服务范围。\r\n  • 如果您在国内使用 OpenAI 官方接口，必须使用"魔法"才能建立连接。\r\n\r\n  • OpenAI支持的国家或地区:(需魔法) https://platform.openai.com/docs/supported-countries ',r+="\r\n  • Please check your network and confirm whether your IP location is within OpenAI's service scope to decide whether V P N is required.\r\n\r\n  • Supported countries and territories:  https://platform.openai.com/docs/supported-countries "):(o+='\r\n  • 如果您使用第三方接口，需要明确该接口是否支持免"魔法"，以及该接口网址当前是否为可用状态 (服务器是否稳定)。\r\n',r+="\r\n  • If using a third-party API, please ensure its validity and whether the server is currently running stable.\r\n"),o+='\r\n  • 什么是"魔法"？一种可以让您的手机或电脑出趟国的技术，优质的魔法会让OpenAI认为您的设备是真的在国外。',i.test(e.message)&&(A=e.message.match(/timeout of (\d+)ms exceeded/))&&(i=A[1]/1e3,o+="\r\n  • 当前代码中设置的超时时间为："+i+" 秒",r+="\r\n  • The timeout set in the code is: "+i+" seconds"),l="cn"==this.settingsLanguage?"错误 - 网络连接超时":"Error - Timeout exceeded",y="",f="timeout exceeded",S="连接超时，自动重发中...",b="Connection timed out, automatically retrying...",setTimeout(()=>{var t;!this.isSendingNow&&!this.isSendingNow_ForSmartMaxTokens||this.isShowNotification||(t="cn"==this.settingsLanguage?'小提示: TAKGPT 不支持中止请求。如果想中断请求，可通过刷新网页来实现。通常，刷新不会导致数据丢失，但某些刷新网页的方式可能无法触发"自动保存"，请根据使用经验做出相应的判断。':'Tip: TAKGPT does not support interrupting requests. If you want to interrupt a request, you can do so by refreshing the webpage. Usually, refreshing will not cause data loss, but some ways of refreshing the webpage may not trigger "auto-save". Please use your experience to judge accordingly.',this.showNotification(t,"bottom","",18e3))},5e3)}else if(e.message&&"Network Error"==e.message)o="网络错误，可能只是暂时的，建议先重试一次。",r="Network error. The error may be temporary, so it is recommended to try again first. ",this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&(o+="\r\n ★ 当前使用的是第三方API，如果是由于第三方接口的原因临时出现网络错误，可能是因为服务器过载、正在进行维护，或者因 IP / DNS解析问题导致连接不稳定。如果错误频繁发生，您可以尝试更改网络环境 (更改IP、切换移动流量/Wi-Fi、打开或关闭魔法、更换一个公共DNS)。",r+="\r\n ★ Currently using a third-party API. If there is a temporary network error, it may be due to server overload, maintenance, or unstable connection caused by issues such as IP/DNS resolution. If network errors occur frequently, you can try changing the network environment (change your IP, switch mobile network / Wi-Fi, open or disable VPN, or switch to a public DNS)."),this.apiURL.toLowerCase().includes("api2gpt")&&(o+='\r\n ★ 您当前使用的是第三方平台 api2gpt，当前 模型 与 Key 可能都没有问题，但是存在一个"同源跨域"的错误 (不允许有多个 ”Access-Control-Allow-Origin” CORS 头)，导致无法兼容 api2gpt，问题可能不大，但作者不懂，搞不定。您可以在电脑上调试查看错误，尝试修复它。(愿意的话，可以在 github / gitee 上告诉我解决方法，感谢～)',r+='\r\n ★ 您当前使用的是第三方平台 api2gpt，当前 模型 与 Key 可能都没有问题，但是存在一个"同源跨域"的错误 (不允许有多个 ”Access-Control-Allow-Origin” CORS 头)，导致无法兼容 api2gpt，问题可能不大，但作者不懂，搞不定。您可以在电脑上调试查看错误，尝试修复它。(愿意的话，可以在 github / gitee 上告诉我解决方法，感谢～)'),o+='\r\n\r\n网络错误存在多种可能，请自行排查：\r\n  • 无法与接口网址 (API URL) 建立连接，该服务器不存在或遇故障当前无法访问；\r\n  • 本机当前无网络，网络已断开或网络不稳定，请检查网络状态后重试；\r\n  • IP限制，当前IP或其所在地被限制访问。可尝试使用"魔法"，如果正在使用，请检查"魔法"是否不稳定或已经断开；\r\n  • 其他原因，请以实际情况为准。',r+="\r\n\r\nPossible reasons:\r\n  • Unable to connect to the API Endpoint (API url). The server does not exist or is not accessible due to a malfunction.\r\n  • Your device is currently not connected to the network. The network may be disconnected or unstable. Please check the network status and try again.\r\n  • Due to limitations on this IP or its location, access may be restricted. You could try using a V P N. If you are already using a V P N, please check if it is unstable or has been disconnected.\r\n  • For any other reasons, please refer to the actual situation.",l="cn"==this.settingsLanguage?"错误 - 网络故障":"Error - Network error",y="",f="Network Error",S="网络错误，自动重发中...",b="Network error, automatically retrying...";else if(e.message&&e.message.includes("401")){var A=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?(this.settingsLanguage," OpenAI "):"cn"==this.settingsLanguage?" OpenAI 或 第三方平台 ":" OpenAI or a Third-party platform ";o="API Key 无效。建议复制粘贴 API Key，避免输错。如果仍然出错，说明是无效密钥，或密钥已被停用、删除，建议登录"+A+"查看 API Key 是否出现变动。",r="API Key is invalid. It is recommended to copy and paste the API Key to avoid input errors. If the error persists, it indicates an invalid API key or that the API key has been deactivated or deleted, please log in to"+A+"to check the API Key.",l="cn"==this.settingsLanguage?"错误 - 401 无效的 API Key":"Error - 401 API Key is invalid",y=h.toLowerCase().includes("openai.com")||this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?"401":"error-other",h.toLowerCase().includes("associated with a deactivated account")&&h.toLowerCase().includes("openai.com")&&(o+="\r\n ★ 该 API Key 对应的 OpenAI 账号已被停用。",r+="\r\n ★ The OpenAI account associated with this API Key has been deactivated."),h.toLowerCase().includes("no permission to access")&&(o="您没有此模型 (model: "+this.apiGPTModel+") 的访问权限，请更换模型 (model) 或在第三方网站中修改模型的权限。",r="You do not have permission to access this model (model: "+this.apiGPTModel+"), Please switch to a different model or modify the model's permissions on the third-party website.",l="cn"==this.settingsLanguage?"错误 - 401 无访问权限":"Error - 401 No access permission",y=""),o+="\r\n\r\n  • 当前 API Key : "+this.api,r+="\r\n\r\n  • The current API Key : "+this.api,this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL&&(o+="\r\n  • 请参阅下方的 API 错误信息 (如果错误提示有冲突，请以 [API错误信息] 的内容为准)。",r+="\r\n  • Please refer to the API Error Message below (If there are any discrepancies, please refer to the [API error message] as it is correct)."),!0!==this.isSendingNow_ForSmartMaxTokens||this.isThirdPartyAPIKeyEnabled||(i=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?"cn"==this.settingsLanguage?" OpenAI ":"OpenAI":"cn"==this.settingsLanguage?"网站":"website",o=o+"\r\n  • 如果您在"+i+"后台确认此 API Key 已失效或已被删除，请考虑在 TAKGPT 中删除此  API Key，因为它无法恢复。",r=r+"\r\n  • If you have confirmed in the "+i+" backend that this API Key is invalid or has been deleted, please consider removing this API Key from TAKGPT as it cannot be recovered.",o+="\r\n  • 当使用过的 API Key 失效时，将暂停 [自动重问] 并显示本通知。您可以关闭本通知后手动重发请求以继续聊天。",r+="\r\n  • When a previously used API Key becomes invalid, it will pause [Auto-Retry] and display this notification. "),s&&!this.isThirdPartyAPIKeyEnabled&&(f="FirstCheckedKey_401",S="全新Key - 密钥无效，自动重发中...",b="New Key - API Key error, automatically retrying...")}else if(e.message&&e.message.includes("429"))h.includes("Rate limit reached for")&&"requests"==c?(o="请求过于频繁，API速率限制已达上限，短时间内提交了过多的请求，超出允许的请求数量。",r="The API rate limit has been reached, possibly due to submitting too many requests in a short period of time, exceeding the allowed number of requests.",h.includes("Limit: 3 / min")?(o+="\r\n\r\n  • 目前，OpenAI 免费账号的 API Key 限制每分钟最多 3 次请求。实际使用时，API Key 超过 1 分钟没有发起任何请求，那么下次使用时，连发 3 次请求将不受限制，3 次后连续的快速的请求会有 20 秒的限制。\r\n  • 同一账号下的多个 API Key 会共享限制。同理，“超过 1 分钟没有发起任何请求”这个条件也是指同一账号的所有 API Key 均未发过请求。",r+="\r\n\r\n  • For free accounts, OpenAI allows a maximum of 3 API calls per minute (this limit is shared among multiple API keys under the same account). If an API key under the same account remains inactive for more than 1 minute, the next 3 consecutive requests will be unrestricted. However, after the 3rd request, there will be a 20-second limit on consecutive rapid requests."):h.includes("Limit: 60 / min")?o+="\r\n\r\n  • 目前，OpenAI 付费账号 (开通48小时内) 的 API Key 限制每分钟最多 60 次请求（GPT3.5模型）。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 3500 / min")?o+="\r\n\r\n  • 目前，OpenAI 付费账号 (开通48小时后) 的 API Key 限制每分钟最多 3500 次请求（GPT3.5模型）。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 200 / min")?o+="\r\n\r\n  • 当前 GPT-4 模型限制每分钟最多 200 次请求。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 400 / min")?o+="\r\n\r\n  • 当前 GPT-4 模型限制每分钟最多 400 次请求。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 1000 / min")?o+="\r\n\r\n  • 当前 GPT-4 模型限制每分钟最多 1000 次请求。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 200 / day")?o=(o+="\r\n\r\n  • 目前，OpenAI 的免费账号限制 API 每天最多 200 次请求（GPT3.5模型）,之后每隔 7分12秒 恢复 1 次请求额度。")+"\r\n  • 官方算法：24小时 ÷ 200次 = 7分12秒/次\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 2000 / day")&&(o+="\r\n\r\n  • 目前，OpenAI 的付费账号 (开通48小时内) 限制 API 每天最多 2000 次请求（GPT3.5模型）,之后应该是每隔约 43 秒恢复 1 次请求额度（具体情况请查看 [API错误信息]）。\r\n  • 同一账号下的多个 API Key 会共享限制。"),o+="\r\n  • 当前 API Key : "+this.api,r+="\r\n  • The current API Key : "+this.api,l="cn"==this.settingsLanguage?"错误 - 429 请求速度过快":"Error - 429 Rate limit reached for requests",y=h.includes("Limit: 200 / day")?"429-1-day":"429-1",this.isThirdPartyAPIKeyEnabled||(f="429-1",S="请求过于频繁，API速率限制已达上限，自动重发中...",b="The API rate limit has been reached for requests, automatically retrying..."),n=this.isFixingMaxTokens_SmartMaxTokens&&this.isFirstRetry_SmartMaxTokens?5e3:n,this.isFirstRetry_SmartMaxTokens=!1):h.includes("You exceeded your current quota")||"insufficient_quota"==c?(o="超出配额，账号已无额度。例如：免费账号超额或到期、账号达到月度最大支出限制、账号达到设定的周期限制...",r="Exceeding current quota, such as reaching maximum monthly spend, exceeding free plan limits, or reaching expiration.",o+="\r\n\r\n  • 当前 API Key : "+this.api,r+="\r\n\r\n  • The current API Key : "+this.api,!0===this.isSendingNow_ForSmartMaxTokens?(o+="\r\n  • 当 API Key 首次出现配额不足时，将中止 [自动重问] 并显示本通知。您可以关闭本通知后手动重发请求以继续聊天。",r+="\r\n  • When the API Key first encounters insufficient quota, it will abort [Auto-Retry] and display this notification. "):!1!==this.isSendingNow_ForSmartMaxTokens||this.isThirdPartyAPIKeyEnabled||(A=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?"cn"==this.settingsLanguage?" OpenAI 官网":" in OpenAI":"",o=o+"\r\n  • 此 API Key 已保存，但由于超出配额，目前无法使用。在"+A+"为其续费或开通付费后，请在 TAKGPT 中手动更新其状态以恢复可用。如果不再使用该 API Key，也可以手动删除（不删除也不会有影响）。",r=r+"\r\n  • The API Key has been saved, but it cannot be used due to exceeding the current quota. If you have changed the plan or renewed it"+A+", please manually mark it as available in the API key management feature of TAKGPT. If you no longer use this API Key, you can also manually delete it (not deleting it will not have any impact).",""===this.lastAPIKeyInputText_Available&&(this.lastAPIKeyInputText_Available=this.api.startsWith("sk-")&&!this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?this.api:""),this.changeButtonDisabledState(!1)),l="cn"==this.settingsLanguage?"错误 - 429 配额不足":"Error - 429 Insufficient quota",y="429-2",s&&!this.isThirdPartyAPIKeyEnabled&&(f="FirstCheckedKey_429-2",S="全新Key - 配额不足，自动重发中...",b="New Key - Insufficient quota, automatically retrying...")):h.includes("The engine is currently overloaded")?(o="服务器正在面临着高流量访问，或正在维护更新，当前繁忙，无法处理请求。请稍等片刻后重试。",r="Servers are experiencing high traffic and are unable to process your request at the moment. Please retry your requests after a brief wait.",l="cn"==this.settingsLanguage?"错误 - 429 服务器过载":"Error - 429 Servers overloaded",y="429-3",f="429-3",S="服务器过载，自动重发中...",b="Servers overloaded，automatically retrying..."):h.includes("That model is currently overloaded with other requests")?(o="该模型当前已经超载，请稍等片刻后重试。",r="That model is currently overloaded with other requests. Please retry your requests after a brief wait.",l="cn"==this.settingsLanguage?"错误 - 429 模型超载":"Error - 429 Model overloaded",y="429-4",f="429-4",S="模型超载，自动重发中...",b="Model overloaded，automatically retrying..."):h.includes("Rate limit reached for")&&"tokens"==c?(o="令牌（tokens）请求过于频繁，API速率限制已达上限，短时间内提交了过多的令牌（tokens），超出允许的请求数量。",r="The API rate limit has been reached, possibly due to submitting too many tokens in a short period of time, exceeding the allowed number of requests.",h.includes("Limit: 40000 / min")?o+="\r\n\r\n  • OpenAI 的免费账号限制 API 每分钟最多 40000 令牌（GPT3.5模型），请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 60000 / min")?o+="\r\n\r\n  • OpenAI 的付费账号 (开通48小时内) 限制 API 每分钟最多 60000 令牌（当前GPT3.5模型），请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 90000 / min")?o+="\r\n\r\n  • OpenAI 的付费账号 (开通48小时后) 限制 API 每分钟最多 90000 令牌（当前GPT3.5模型），请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 120000 / min")?o+="\r\n\r\n  • OpenAI 的付费账号 (开通48小时内) 限制 API 每分钟最多 120000 令牌（当前GPT3.5模型），请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 180000 / min")?o+="\r\n\r\n  • OpenAI 的付费账号 (开通48小时后) 限制 API 每分钟最多 180000 令牌（当前GPT3.5模型），请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 40000 / min")?o+="\r\n\r\n  • 当前 GPT-4 模型限制 API 每分钟最多 40000 令牌，请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 80000 / min")?o+="\r\n\r\n  • 当前 GPT-4 模型限制 API 每分钟最多 80000 令牌，请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。":h.includes("Limit: 150000 / min")&&(o+="\r\n\r\n  • 当前 GPT-4 模型限制 API 每分钟最多 150000 令牌，请稍后重试。\r\n  • 同一账号下的多个 API Key 会共享限制。"),o+="\r\n  • 当前 API Key : "+this.api,r+="\r\n\r\n  • The current API Key : "+this.api,l="cn"==this.settingsLanguage?"错误 - 429 令牌（tokens）的请求速度过快":"Error - 429 Rate limit reached for tokens",y="429-5",this.isThirdPartyAPIKeyEnabled||(f="429-5",S="请求过于频繁，令牌 (tokens) 的API速率限制已达上限，自动重发中...",b="The API rate limit has been reached for tokens, automatically retrying...")):(o="HTTP请求 - 错误代码:  "+e.code+"\r\nHTTP请求 - 错误信息:  "+e.message,r="HTTP Error Code:  "+e.code+"\r\nHTTP Error Message:  "+e.message,l="cn"==this.settingsLanguage?"错误 - 429 其他":"Error - 429 Other",y="429-other");else if(e.message&&e.message.includes("404")){l=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?(o="必须是组织的成员才能使用API，而当前账号不属于任何组织。OpenAI官方解释：https://help.openai.com/en/articles/6891827-error-code-404-you-must-be-a-member-of-an-organization-to-use-the-api ",r="To use the API, you must be a member of an organization, and your current account is not part of an organization. OpenAI API Error Codes Explained: https://help.openai.com/en/articles/6891827-error-code-404-you-must-be-a-member-of-an-organization-to-use-the-api ","cn"==this.settingsLanguage?"错误 - 404 账号不属于任何组织":"Error - 404 Account is not part of an organization"):(o="请参阅下方的 API 错误信息 (以 [API错误信息] 的内容为准)。",r="Please refer to the API Error Message below.","cn"==this.settingsLanguage?"错误 - 404 其他":"Error - 404 Other"),(h.includes("does not exist")||"model_not_found"===d)&&(o="模型 "+this.apiGPTModel+" 不存在或者您没有访问权限，请更换一个拥有权限的 API Key，或更换模型后再次尝试。",r="The model "+this.apiGPTModel+" does not exist or you do not have access to it. Please use an API Key with proper permissions or try switching to a different model and try again.",l="cn"==this.settingsLanguage?"错误 - 404 模型不存在 / 无访问权限":"Error - 404 Model Not Found / Access Denied",this.apiGPTModel.includes("gpt-4")&&(o+="\r\n\r\n  • GPT-4 模型仅对付费API用户开放，请使用具备 GPT-4 权限的 API Key。如果您当前的 API Key 已经具备 GPT-4 权限，请尝试切换其他 GPT-4 模型。",this.isThirdPartyAPIKeyEnabled||(o+="\r\n  • 如果您没有支持 GPT-4 的 API Key，请不要选择 GPT-4 模型进行反复请求。TAKGPT 没有对此进行限制，但不建议这样做。",r+="\r\n\r\n  • If you do not have an API Key that supports GPT-4, please refrain from selecting the GPT-4 model for repetitive requests. TAKGPT does not have restrictions on this, but it is not recommended to do so.")),this.isThirdPartyAPIKeyEnabled)&&(o+="\r\n  • 有些第三方平台只支持部分模型，建议查阅第三方接口平台的文档。"),o+="\r\n  • 当前 API Key : "+this.api,r+="\r\n  • The current API Key : "+this.api,h.toLowerCase().includes("model is not available")&&(o=o+"\r\n  • 当前模型 (model: "+this.apiGPTModel+") 不可用，请更换模型 (model) 。",r="Please refer to the API Error Message below.");i=h.toLowerCase().includes("key")&&h.toLowerCase().includes("not found")||(h.toLowerCase().includes("key")||h.includes("密钥"))&&(h.includes("无效")||h.includes("不存在"));y=i&&this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL?(A=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?(this.settingsLanguage," OpenAI "):"cn"==this.settingsLanguage?" OpenAI 或 第三方平台 ":" OpenAI or a Third-party platform ",o=o+"\r\n\r\nAPI Key 无效。建议复制粘贴 API Key，避免输错。如果仍然出错，说明是无效密钥，或密钥已被停用、删除，建议登录"+A+"查看 API Key 是否出现变动。",r=r+"\r\n\r\nAPI Key is invalid. It is recommended to copy and paste the API Key to avoid input errors. If the error persists, it indicates an invalid API key or that the API key has been deactivated or deleted, please log in to"+A+"to check the API Key.","error-other"):"404",s&&!this.isThirdPartyAPIKeyEnabled?(f="FirstCheckedKey_404",S="全新Key - Key错误，非组织成员，自动重发中...",b="New Key - Error, Account not in organization, automatically retrying...",!h.includes("does not exist")&&"model_not_found"!==d||(S="全新Key - 模型不存在或无使用权限，自动重发中...",b="New Key - Model does not exist or access denied, automatically retrying...")):this.isThirdPartyAPIKeyEnabled||!h.includes("does not exist")&&"model_not_found"!==d||(f="Model_404",S="模型不存在或无使用权限，自动重发中...",b="Model does not exist or access denied, automatically retrying...")}else if(e.message&&e.message.includes("500"))h.toLowerCase().includes("key")&&h.toLowerCase().includes("ak-")?(i=this.apiURL.toLowerCase()===this.OpenAI_API_URL||this.apiURL.toLowerCase()===this.OpenaiProxyCom_API_URL?(this.settingsLanguage," OpenAI "):"cn"==this.settingsLanguage?" OpenAI 或 第三方平台 ":" OpenAI or a Third-party platform ",o="API Key 无效。建议复制粘贴 API Key，避免输错。如果仍然出错，说明是无效密钥，或密钥已被停用、删除，建议登录"+i+"查看 API Key 是否出现变动。",r="API Key is invalid. It is recommended to copy and paste the API Key to avoid input errors. If the error persists, it indicates an invalid API key or that the API key has been deactivated or deleted, please log in to"+i+"to check the API Key.",o+="\r\n\r\n  • 当前 API Key : "+this.api,r+="\r\n\r\n  • The current API Key : "+this.api,o+="\r\n  • 请参阅下方的 API 错误信息。",r+="\r\n  • Please refer to the API Error Message below.",l="cn"==this.settingsLanguage?"错误 - 500 其他":"Error - 500 Other",y="error-other"):(o="服务器在处理您的请求时出现错误，是服务器的问题，请稍等片刻后重试。",r="The server had an error while processing your request. Issue on OpenAI servers, please retry your requests after a brief wait.",l="cn"==this.settingsLanguage?"错误 - 500 服务器在处理请求时出错":"Error - 500 Server error while processing request",y="500",f="500",S="服务器在处理请求时出错，自动重发中...",b="Server error while processing request，automatically retrying...");else if(e.message&&e.message.includes("503")&&h.includes("That model is currently overloaded with other requests"))o="该模型当前已经超载，您可以重新尝试下请求。",r="That model is currently overloaded with other requests. You can retry your request.",l="cn"==this.settingsLanguage?"错误 - 503 模型超载":"Error - 503 Model overloaded",y="503",f="503",S="模型超载，自动重发中...",b="Model overloaded，automatically retrying...";else if(e.message&&e.message.includes("503")&&h.includes("The server had an error while processing your request"))o="服务器在处理您的请求时发生了错误，您可以重新尝试下请求。",r="The server had an error while processing your request. You can retry your request.",l="cn"==this.settingsLanguage?"错误 - 503 服务器在处理请求时出错":"Error - 503 Server error while processing request",y="503",f="503",S="服务器在处理请求时出错，自动重发中...",b="Server error while processing request，automatically retrying...";else if(e.message&&e.message.includes("400")&&h.includes("Please reduce the length of the messages")){let t="",e="";var A=h.match(/maximum context length is (\d+) tokens/),i=A?A[1]:null,A=h.match(/messages resulted in (\d+) tokens/),A=A?A[1]:null,P=h.match(/requested (\d+) tokens \(/),P=P?P[1]:null,_=h.match(/\((\d+) in the messages,/),_=_?_[1]:null,T=h.match(/, (\d+) in the completion/),T=T?T[1]:null;if(null!=i&&null!=A){t=(t=(t=t+"\r\n\r\n"+("#A = 当前模型支持的最大上下文长度："+i+" tokens\r\n"))+("#B = 您当前发送的上下文长度："+A+" tokens (GPT的记忆，包含本次发送内容)\r\n")+"#C = GPT尚未回复的单条内容长度：未知 \r\n")+("规则： B + C  < A ( "+i+" )\r\n")+("★ 当前：仅 B 就已经超过 "+i+" （超出了 "+(A-i)+" ）"),this.isSimpleMode||(t=(t+='\r\n\r\n  • token：单位，即"令牌"')+"\r\n  • 当前 GPT 模型 ("+L.modelname+") 最高支持 "+L.maxtokens+"/"+(L.maxtokens+1)+" tokens\r\n  • 以下属于正常现象：首条消息额外占用 13 个token，之后的每条消息都会额外加 10 个token (发送只有 1 个token的内容，实际上会占用 11 个token)。(与代码写法有一定关系)"),o="发送失败，GPT记忆（上下文长度）超过上限。关闭通知后，您可以选择：修改发送内容长度、撤销聊天记录等操作来继续之前的对话。";o=this.openSmartMaxTokens?o+'\r\n\r\n★ 已为您关闭"智能max_tokens"功能，请根据下方的错误提示信息来修改发送内容的长度 (或通过 [撤销]、[清除记忆] 来释放tokens)，然后手动调节 [API设置] 中的 [max_tokens] 。待问题解决后，下次可尝试重新打开该功能。':o+'\r\n\r\n★ 请根据下方的错误提示信息来修改发送内容的长度 (或通过 [撤销]、[清除记忆] 来释放tokens)，然后手动调节 [API设置] 中的 [max_tokens] 。注意: 当前无法使用"智能max_tokens"功能，当您解决"内容超量"问题后，可尝试重新打开"智能max_tokens"功能。',o+=t,e=e+"\r\n\r\n"+'  • "messages" :  The current length of the context (including the last message sent).',this.isSimpleMode||(e+="\r\n  • The following is a normal phenomenon: The first message will occupy an additional 13 tokens, and each subsequent message will add 10 additional tokens (sending content with 1 token will actually occupy 11 tokens). (It is related to the code writing style.)"),r="Sending failed. The length of the context exceeds the limit. After closing the notification, you can choose to modify the content, or undo to continue.";r=this.openSmartMaxTokens?r+'\r\n\r\n★ The "Smart max_tokens" feature has been turned off for you. Please make adjustments (such as modifying the content length) based on the [API Error Message] below, and then manually adjust [API Settings] > [max_tokens] for this request. Once the issue is resolved, you can re-enable this feature for the next request.':r+'\r\n\r\n★ Please make adjustments (such as modifying the content length) based on the [API Error Message] below, and then manually adjust [API Settings] > [max_tokens] for this request. (The "Smart max_tokens" feature is currently unavailable. You can try re-enabling it once you have resolved the "content exceeds limit" issue).',r+=e,l="cn"==this.settingsLanguage?"错误 - 400 记忆达到上限":"Error - 400 Context length exceeds the limit",this.isSendingNow_ForSmartMaxTokens&&this.openSmartMaxTokens&&(n=1400,A="cn"==this.settingsLanguage?"已关闭 智能max_tokens":"Smart max_tokens Disabled",this.showNotification(A,"bottom")),this.openSmartMaxTokens=!1,this.isReminded_SmartMaxTokens=2}else if(null!=i&&null!=P&&null!=_&&null!=T){t=(t=(t=(t=t+"\r\n\r\n"+("#A = 当前模型支持的最大上下文长度："+i+" tokens\r\n"))+("#B = 您当前发送的上下文长度："+_+" tokens (GPT的记忆，含本次发送内容)\r\n")+("#C = 当前设置允许GPT回复的最大长度："+T+" tokens (API设置：max_tokens)\r\n"))+("#D = B + C ，当前 D = "+P+" tokens\r\n")+("规则：D < "+i+" \r\n"))+("当前：D > "+i+" \r\n")+"解释：总量 A 有限制，当记忆 B 增加到某个程度时， C (max_tokens) 就需要动态下调\r\n";A=parseInt(i)-parseInt(_);t+="★ 调整：如果不修改发送内容，当前 A - B = "+A+'，所以必须调整API设置中的"max_tokens"，最大为 '+(A-1)+"，然后重问即可",this.isSimpleMode||(t=(t+='\r\n\r\n  • token：单位，即"令牌"')+"\r\n  • 当前 GPT 模型 ("+L.modelname+") 最高支持 "+L.maxtokens+"/"+(L.maxtokens+1)+" tokens\r\n  • 以下属于正常现象：首条消息额外占用 13 个token，之后的每条消息都会额外加 10 个token (发送只有 1 个token的内容，实际上会占用 11 个token)。(与代码写法有一定关系，本代码将空的提示词设为空的字符串提交)"),o="发送失败，GPT记忆（上下文长度）即将超限。关闭通知后，您可以选择：调整max_tokens后点击重问、撤销聊天记录、修改发送内容长度等操作来继续之前的对话。",o=this.openSmartMaxTokens?o+'\r\n\r\n★ 已为您关闭"智能max_tokens"功能，本次请根据下方的错误提示信息来手动调节 [API设置] 中的 [max_tokens] 。待问题解决后，下次可尝试重新打开该功能。':o+'\r\n\r\n★ 请根据下方的错误提示信息来手动调节 [API设置] 中的 [max_tokens] 。\r\n★ 提醒: 当前未启用"智能max_tokens"功能，建议您打开"智能max_tokens"功能，当其无法使用而自动关闭时，再尝试手动调节 max_tokens。',o+=t,e=(e=e+"\r\n\r\n"+'  • "messages" :  The current length of the context (including the last message sent).\r\n')+'  • "completion" :  The API parameter "max_tokens" (adjustable in the API settings).\r\n'+("  •  Tip:  Here's an example, if you don't want to modify the content being sent: Currently "+i+" - "+_+" = "+A+', so you need to adjust the "max_tokens" in [API Settings] to be less than '+A+" ( ★ maximum value is "+(A-1)+"), then click [Retry] to resend the request."),this.isSimpleMode||(e+="\r\n  • The following is a normal phenomenon: The first message will occupy an additional 13 tokens, and each subsequent message will add 10 additional tokens (sending content with 1 token will actually occupy 11 tokens). (It is related to the code writing style, when the system prompt is empty, this code submits an empty string to OpenAI.)"),r="Sending failed. The length of the context is about to exceed the limit. After closing the notification, you can choose to retry after modifying the max_tokens, undo, or modify the content to continue.";if(r=this.openSmartMaxTokens?r+'\r\n\r\n★ The "Smart max_tokens" feature has been turned off for you. Please manually adjust [API Settings] > [max_tokens] based on the [API Error Message] below. Once the issue is resolved, you can re-enable this feature for the next request.':r+'\r\n\r\n★ Please manually adjust [API Settings] > [max_tokens] based on the [API Error Message] below. \r\n★ Reminder: The "Smart max_tokens" feature is currently disabled. It is recommended to enable the "Smart max_tokens" feature, and only manually adjust max_tokens when it stops automatically.',r+=e,l="cn"==this.settingsLanguage?"错误 - 400 记忆即将达到上限":"Error - 400 Context length is about to exceed the limit",this.isSendingNow_ForSmartMaxTokens&&this.openSmartMaxTokens&&0<A-1)return this.isFixingMaxTokens_SmartMaxTokens=!0,this.apiMaxTokens=A-1,T="cn"==this.settingsLanguage?"#### #自动修复错误中，即将自动重问\r\n\r\n":"#### #Auto-correcting error, will automatically retry\r\n\r\n",this.chathistory+=T,this.isFirstRetry_SmartMaxTokens=!0,this.retry(),o="max_tokens过高，已自动修复，并自动重问一次",r="max_tokens was set too high, it has been automatically corrected and the request is now being automatically resent.",notif="cn"==this.settingsLanguage?o:r,P="cn"==this.settingsLanguage?4500:6e3,void this.showNotification(notif,"bottom","",P);this.isSendingNow_ForSmartMaxTokens&&this.openSmartMaxTokens&&(n=1400,L="cn"==this.settingsLanguage?"已关闭 智能max_tokens":"Smart max_tokens Disabled",this.showNotification(L,"bottom")),this.openSmartMaxTokens=!1,this.isReminded_SmartMaxTokens=2}else o="发送失败，GPT记忆（上下文长度）达上限。",r="Sending failed. The length of the context exceeds the limit. ",l="cn"==this.settingsLanguage?"错误 - 400 其他 ":"Error - 400 Other ";y="400"}else""===e.code&&""===e.message||(o="HTTP请求 - 错误代码:  "+e.code+"\r\nHTTP请求 - 错误信息:  "+e.message,r="HTTP Error Code:  "+e.code+"\r\nHTTP Error Message:  "+e.message),o=(""===o?"":o+"\r\n\r\n")+"  • 当前 API Key : "+this.api,r=(""===r?"":r+"\r\n\r\n")+"  • The current API Key : "+this.api,""===h&&""===c&&""===d||(o+="\r\n  • 请参阅下方的 API 错误信息。",r+="\r\n  • Please refer to the API Error Message below."),(h.toLowerCase().includes("invalid token")||h.toLowerCase().includes("invalid")&&(h.toLowerCase().includes("token")||h.toLowerCase().includes("key")))&&(o=o+"\r\n  • 密钥无效"+(h.toLowerCase().includes("token")?" (令牌无效)":"")+"，请核对接口网址 (API URL) 与密钥 (API Key) 是否匹配。",r=r+"\r\n  • Invalid API Key"+(h.toLowerCase().includes("token")?" (Invalid API Token)":"")+". Please check if the API Endpoint (API URL) matches the API Key"+(h.toLowerCase().includes("token")?" (API Token).":".")),h.toLowerCase().includes("not authorized")&&h.toLowerCase().includes("this model")&&(o=o+"\r\n  • 您无权使用此模型 (model: "+this.apiGPTModel+")，请更换模型 (model) 或升级权限。",r=r+"\r\n  • 您无权使用此模型 (model: "+this.apiGPTModel+")，请更换模型 (model) 或升级权限。"),h.toLowerCase().includes("not enough credit")&&(o+="\r\n  • 您的账号信用/额度不足。",r+="\r\n  • 您的账号信用/额度不足。"),h.toLowerCase().includes("an error occurred with this application")&&(o+="\r\n  • 服务器发生了错误，可能只是暂时的，建议先重试一次。",r+="\r\n  • An error occurred with the server. The error may be temporary, so it is recommended to try again first."),h.toLowerCase().includes("reduce the max_tokens")&&this.api.startsWith("fk")&&(o+='\r\n  • 您正在使用第三方接口 api2d ，如果您的点数不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 api2d 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费点数超出账号的可用点数，则请求失败 (无论 GPT 最终回复的长度是多少)。',r+='\r\n  • 您正在使用第三方接口 api2d ，如果您的点数不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 api2d 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费点数超出账号的可用点数，则请求失败 (无论 GPT 最终回复的长度是多少)。'),h.toLowerCase().includes("reduce the max_tokens")&&this.api.toLowerCase().startsWith("aigc")&&(o+='\r\n  • 您正在使用第三方接口 AIGC2D ，如果您的点数不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 AIGC2D 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费点数超出账号的可用点数，则请求失败 (无论 GPT 最终回复的长度是多少)。',r+='\r\n  • 您正在使用第三方接口 AIGC2D ，如果您的点数不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 AIGC2D 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费点数超出账号的可用点数，则请求失败 (无论 GPT 最终回复的长度是多少)。'),h.toLowerCase().includes("需要余额大于")&&h.toLowerCase().includes("更小的max_tokens参数")&&(o+='\r\n  • 您正在使用第三方接口 closeai-asia ，如果您的余额不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 closeai-asia 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费金额超出账号的可用余额，则请求失败 (无论 GPT 最终回复的长度是多少)。',r+='\r\n  • 您正在使用第三方接口 closeai-asia ，如果您的余额不是很多，建议关闭 TAKGPT 的"智能max_tokens"功能，并根据错误信息在设置中手动调节 max_tokens。因为"智能max_tokens"功能会尽可能把 max_tokens 调高，但是 closeai-asia 平台会通过设置的 max_tokens 来预估单次的消费额，max_tokens 越高，估算的消费就越高，若估算的消费金额超出账号的可用余额，则请求失败 (无论 GPT 最终回复的长度是多少)。'),h.toLowerCase().includes("allowed now, your model")&&this.api.startsWith("fk")&&(o=o+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请根据 [API 错误信息] 更换当前支持的模型 (model) 。",r=r+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请根据 [API 错误信息] 更换当前支持的模型 (model) 。"),h.toLowerCase().includes("model")&&h.toLowerCase().includes("is not in acceptable range")&&(o=o+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请根据 [API 错误信息] 更换当前支持的模型 (model) 。",r=r+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请根据 [API 错误信息] 更换当前支持的模型 (model) 。"),h.toLowerCase().includes("model not found")&&(o=o+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请更换模型 (model)。",r=r+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请更换模型 (model)。"),h.toLowerCase().includes("模型")&&h.toLowerCase().includes("无可用渠道")&&(o=o+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请更换模型 (model) 或升级权限。",r=r+"\r\n  • 不支持此模型 (model: "+this.apiGPTModel+")，请更换模型 (model) 或升级权限。"),h.toLowerCase().includes("quota is not enough")&&(o+="\r\n  • 您的账号 Quota 额度不足。",r+="\r\n  • Quota is not enough."),h.toLowerCase().includes("bad request")&&!h.toLowerCase().includes("quota is not enough")&&(o+='\r\n  • 请求错误，请参照错误信息自行排查。如无明细信息，可优先排查"模型"因素：1) 是否选了 GPT-4 模型，而该接口不支持 GPT-4 模型 (或账号无  GPT-4 权限); 2) 如果选的是 GPT-3.5 模型，可能是该接口仅支持一两种 GPT-3.5 模型，可切换为基础的 gpt-3.5-turbo 模型试试; 3) 模型正确后，才会进一步验证 Key 的有效性。',r+='\r\n  • 请求错误，请参照错误信息自行排查。如无明细信息，可优先排查"模型"因素：1) 是否选了 GPT-4 模型，而该接口不支持 GPT-4 模型 (或账号无  GPT-4 权限); 2) 如果选的是 GPT-3.5 模型，可能是该接口仅支持一两种 GPT-3.5 模型，可切换为基础的 gpt-3.5-turbo 模型试试; 3) 模型正确后，才会进一步验证 Key 的有效性。'),l="cn"==this.settingsLanguage?"错误 - 其他":"Error - Other",y="error-other";""===h&&""===c&&""===d||(r=this.isThirdPartyAPIKeyEnabled||this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL?(o=o+"\r\n\r\nAPI错误信息:\r\n"+h+(""===c?"":"\r\nAPI错误类型:\r\n"+c)+(""===d?"":"\r\nAPI错误码:\r\n"+d),r+"\r\n\r\nAPI Error Message:\r\n"+h+(""===c?"":"\r\nAPI Error Type:\r\n"+c)+(""===d?"":"\r\nAPI Error Code:\r\n"+d)):(o=o+"\r\n\r\nOpenAI - API错误信息:\r\n"+h+"\r\nOpenAI - API错误类型:\r\n"+c+(""===d?"":"\r\nOpenAI - API错误码:\r\n"+d)+"\r\nOpenAI - 服务器状态:\r\nhttps://status.openai.com/\r\nOpenAI - 费率限制规则 (含免费):\r\nhttps://platform.openai.com/docs/guides/rate-limits/overview",r+"\r\n\r\nOpenAI - API Error Message:\r\n"+h+"\r\nOpenAI - API Error Type:\r\n"+c+(""===d?"":"\r\nOpenAI - API Error Code:\r\n"+d)+"\r\nOpenAI - OpenAI Status:\r\nhttps://status.openai.com/\r\nOpenAI - Rate limits:\r\nhttps://platform.openai.com/docs/guides/rate-limits/overview")),notif="cn"==this.settingsLanguage?o:r;i="cn"==this.settingsLanguage?S:b,_=this.isSendingNow_ForSmartMaxTokens;this.isSendingNow_ForSmartMaxTokens=!1,this.updateApiCheckedData(this.api,t,y),_&&""!==f?this.autoRetry(f,i,notif,l):setTimeout(()=>{this.showNotification(notif,"center",l)},n)},autoRetry(t,i,s,n){0===this.autoRetry_FirstTime&&(this.autoRetry_FirstTime=(new Date).getTime());const e=(new Date).getTime();var a=e-this.autoRetry_FirstTime;let o="",r=0,l=("429-1"!==t&&"429-5"!==t&&"FirstCheckedKey_401"!==t&&"FirstCheckedKey_429-2"!==t&&"FirstCheckedKey_404"!==t&&"Model_404"!==t||((h=this.autoRetry_apiKeyExcludeList.find(t=>t.apikey===this.api))?h.time=e:(h={apikey:this.api,time:e},this.autoRetry_apiKeyExcludeList.push(h))),this.autoRetry_apiKeyExcludeList=this.autoRetry_apiKeyExcludeList.filter(t=>e-t.time<=2e4),this.apiCheckedData.filter(e=>!this.autoRetry_apiKeyExcludeList.some(t=>t.apikey===e.apikey)&&8!==e.level&&9!==e.level&&"third-party"!==e.vpn));!this.isThirdPartyAPIKeyEnabled&&this.apiGPTModel.includes("gpt-4")&&(h=l.filter(t=>"GPT-4"===t.vpn||null===t.level||0===t.level),l=h);var h=l.length;"timeout exceeded"===t||"Network Error"===t?this.autoRetry_log.includes("timeout exceeded")||this.autoRetry_log.includes("Network Error")||6e3<a?o="center":(o="bottom",r="Network Error"===t?1200:0):o="429-1"===t||"429-5"===t||"Model_404"===t?8<=(this.autoRetry_log.match(/429-1|429-5|Model_404/g)||[]).length||h<1||1e4<a?"center":"bottom":"429-3"===t||"429-4"===t||"500"===t||"503"===t?3<=(this.autoRetry_log.match(/(429-3|429-4|500|503)/g)||[]).length||h<1||3e4<a?"center":"bottom":"FirstCheckedKey_401"!==t&&"FirstCheckedKey_429-2"!==t&&"FirstCheckedKey_404"!==t||20<=(this.autoRetry_log.match(/(FirstCheckedKey_401|FirstCheckedKey_429-2|FirstCheckedKey_404)/g)||[]).length||h<1||6e4<a?"center":(r=0,"bottom"),"bottom"===o?(this.autoRetry_log+=t+" ",setTimeout(()=>{this.retry()},r)):(this.autoRetry_apiKeyExcludeList=[],this.autoRetry_FirstTime=0,this.autoRetry_log=""),setTimeout(()=>{var t="center"===o?s:i,e=!0===this.isShowNotification&&"bottom"===this.setNotificationPosition&&"bottom"===o,a=this.setNotificationContent.includes("自动重问")||this.setNotificationContent.includes("自动重发")||this.setNotificationContent.includes("自动重试")||this.setNotificationContent.toLowerCase().includes("retry")||this.setNotificationContent.toLowerCase().includes("resend");e&&a?this.setNotificationContent=t:this.showNotification(t,o,n,2300)},80)},scrollToBottomView(){const t=document.querySelector(".bottom-position");var e=document.body.offsetHeight+8+8;document.documentElement.clientHeight<e&&this.$nextTick(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})})},scrollToBottomViewClick(){this.isfirstclickonchatinputbox&&navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&(this.isfirstclickonchatinputbox=!1,this.scrollToBottomView())},closeSoftwareKeyboard(){var t=document.body.offsetHeight-95+8,e=document.documentElement.clientHeight;let a=!1;navigator.userAgent.match(/(pad|iPad)/i)?t<3*e/7&&(a=!0):navigator.userAgent.match(/(phone|pod|iPhone|iPod|ios|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&t<5*e/7&&(a=!0),a&&this.$nextTick(()=>{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()})},newLine(t){(window.event||t).returnValue=!1;const e=t.target,a=e.selectionStart;var i=this.msg.split("");i.splice(a,0,"\n"),this.msg=i.join(""),Vue.nextTick(()=>{e.selectionStart=e.selectionEnd=a+1;var t=parseInt(e.scrollHeight)+6;e.style.height="38px",e.style.maxHeight=t.toString()+"px",e.style.height=t.toString()+"px"})},textareaEnter(t){var e=window.event||t;"Enter"!=e.key||"Enter"!=e.code&&"NumpadEnter"!=e.code||13!=e.keyCode||(e.returnValue=!1,this.sendMsg())},textareaMobileInputCompatibility(t){try{"\n"===t.key&&"Unidentified"===t.code&&0===t.keyCode?(t.preventDefault(),this.newLine(t),this.bugfixing_BaiduInput_NewLine_timestamp=(new Date).getTime()):"\r\r"===t.key&&"Unidentified"===t.code&&229===t.keyCode?(t.preventDefault(),this.newLine(t)):"Backspace"!==t.key&&"Backspace"!==t.code||(new Date).getTime()-this.bugfixing_BaiduInput_NewLine_timestamp<100&&t.preventDefault()}catch(t){}},sendMsg(){if(!this.isCheckingApiKeyNow&&!this.btnDisabledState_Sending)if(""==this.api.trim())this.sentext="cn"==this.settingsLanguage?"先验证API":"Check API First";else if(this.btnDisabledState_CheckAPI){if(null==window.marked)alert("marked.js（Markdown插件）尚未加载成功，请数秒后再尝试...\r\nmarked.js (Markdown Plugin) has not been loaded successfully, please try again in a few seconds...");else if(!this.isTotaltokens_Exceeds_Maxtokens()){let a=!1,i="";if(""!=this.isRetry_RetryMessage&&(a=!0,i=this.isRetry_RetryMessage,this.autoAdjustMaxTokens(i)),this.isRetry_RetryMessage="",a||""!=this.msg.trim()){if(a||this.check_KeyMode_Sending()){if(!a)try{var s=this.sendMsg_ContextualMode("send");if("string"==typeof s)if("no clear context and abort operation"===s)return n="cn"==this.settingsLanguage?"已中止[发送]":"Aborted [Send]",void this.showNotification(n,"bottom")}catch(t){console.error('sendMsg_ContextualMode("send") - 发送过程中，"上下文模式"执行时出错了',t)}this.isReminded_SmartMaxTokens=0<=this.isReminded_SmartMaxTokens?this.isReminded_SmartMaxTokens-1:this.isReminded_SmartMaxTokens,this.openSmartMaxTokens||0!==this.isReminded_SmartMaxTokens||(s="cn"==this.settingsLanguage?'提醒: 当前未启用"智能max_tokens"，建议在 [设置] 中启用该功能':"Tip: Enabling the [Settings] > [Smart max_tokens] can reduce errors. Currently, it is disabled.",this.showNotification(s,"bottom","",4500)),this.isSendingNow=!0,this.isSendingNow_ForSmartMaxTokens=!0,this.btnDisabledState_ApiURL=!0,this.btnDisabledState_Language=!0,this.btnDisabledState_ContextualMode=!0,this.btnDisabledState_KeyMode=!0,this.msgList[this.msgList.length-1].my&&this.msgContentForMsgList_SingleRound[this.msgContentForMsgList_SingleRound.length-1].content!=this.msg&&(this.userMsgTokensForRetry=0),this.beginLoadingAnimation(),document.querySelector(".inputapikey").readOnly=!0,a||(i=this.msg,this.isFixingMaxTokens_SmartMaxTokens=!1,this.autoAdjustMaxTokens(i),this.autoRetry_apiKeyExcludeList=[],this.autoRetry_FirstTime=0,this.autoRetry_log="");let t=marked.parse(i);""==i.trim()||""==i.replace(/^\n|\n$/g,"").trim()?t="<p> </p>":""==t.trim()&&(t="<p>"+i+"</p>"),""==t.trim()&&(t="<p> </p>");var n=this.formatDateYYYYMMDDHHmmss(new Date,":");let e=null;(!0===this.msgList[this.msgList.length-1].hr||null!=this.displayDatetime_WeChatStyle())&&(e=n.slice(5,16)),this.msgList.push({msg:t,my:!0,datetime:n,wechatstyledatetime:e}),this.$nextTick(()=>{var t=document.querySelectorAll("div.usermsg"),t=t[t.length-1];this.closeSoftwareKeyboard(),this.scrollToBottomView(),this.addCopyButtonToPreTags(t),this.addCopyButtonToChatMessage(t.parentElement)}),""!=this.gptSystemPrompt_hidden.trim()&&(this.msgContent[0]={role:"system",content:this.gptSystemPrompt_hidden.trim()},this.msgContentForMsgList_SingleRound[0]={role:"system",content:this.gptSystemPrompt_hidden.trim()},this.gptSystemPromptReadOnly="hidden system prompt"),this.msgContent.push({role:"user",content:i}),this.msgTokens.push({role:"user",completion_tokens:0,total_tokens:0}),this.succQA_Count=this.msgContent.length-1,this.msgContentForMsgList_SingleRound.push({role:"user",content:i,datetime:n});this.settingsLanguage;this.chathistory+="**User** _"+n+"_  \r\n"+i.replace(/\n/g,"\r\n")+"\r\n\r\n",this.btnDisabledState_Sending=!0,this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!0,a||(this.msg="",(s=document.querySelector(".textareachatinputbox")).style.maxHeight="38px",s.style.borderRadius="0px 6px 6px 0px",s.style.zIndex="900000"),null==this.chatcreatedtime&&(this.chatcreatedtime=n,(s=null==(s=this.chatDataList.find(t=>null===t.chatcreatedtime))?{}:s).chatcreatedtime=this.chatcreatedtime,this.selectedChatData=JSON.parse(JSON.stringify(s))),this.chatlasttime=n;const r=(new Date).getTime();s=this.getFirstAvailableAPIKey(this.autoRetry_apiKeyExcludeList);this.api=s.apikey,this.api=this.api.trim(),this.lastAPIKeyInputText=this.api,axios.defaults.timeout=61e3,axios.post(this.apiURL,{messages:this.msgContent,max_tokens:this.apiMaxTokens,temperature:this.apitemperature,model:this.apiGPTModel,top_p:this.apiTopP,presence_penalty:this.apiPresencePenalty,frequency_penalty:this.apiFrequencyPenalty},{headers:{"content-type":"application/json",Authorization:"Bearer "+this.api}}).then(t=>{if(!t.data||!t.data.hasOwnProperty("choices"))throw e=this.thirdPartyAPI_ErrorOccurred_ButResponseWasNormal(t),(a=new Error("")).code="",a.request={responseText:JSON.stringify(e)},a;this.isSendingNow=!1,this.isSendingNow_ForSmartMaxTokens=!1,this.endLoadingAnimation(),document.querySelector(".inputapikey").readOnly=!1,this.isFixingMaxTokens_SmartMaxTokens=!1,this.lastAPIKeyInputText_Available=this.api.startsWith("sk-")&&!this.excludeList_ThirdPartyKeyStartWithSK_DomainKeyword.some(t=>this.apiURL.toLowerCase().includes(t))?this.api:"",this.autoRetry_apiKeyExcludeList=[],this.autoRetry_FirstTime=0,this.autoRetry_log="";var e=t.data.choices[0].message.content,a=t.data.usage.total_tokens;let i=marked.parse(e);""==e.trim()||""==e.replace(/^\n|\n$/g,"").trim()?i="<p> </p>":""==i.trim()&&(i="<p>"+e+"</p>"),""==i.trim()&&(i="<p> </p>");var s=this.formatDateYYYYMMDDHHmmss(new Date,":"),n=(this.msgList.push({msg:i,my:!1,datetime:s}),this.$nextTick(()=>{var t=document.querySelectorAll("div.aimsg"),t=t[t.length-1];this.scrollToBottomView(),this.addCopyButtonToPreTags(t),this.addCopyButtonToChatMessage(t.parentElement)}),this.msgContentForMsgList_SingleRound.push({role:t.data.choices[0].message.role,content:e,datetime:s}),this.msgContent.length<2&&alert(" 找到一个bug\r\nA new bug has appeared.\r\n\r\n发送成功后 && PUSH之前，this.msgContent.length < 2，此时应该至少有两条，1-系统指令 2-提问的问题。  \r\n\r\nthis.msgContent.length："+this.msgContent.length),this.msgContent.push({role:t.data.choices[0].message.role,content:e}),this.succQA_Count=this.msgContent.length-1,this.msgTokens[this.msgTokens.length-1].total_tokens=t.data.usage.prompt_tokens,this.msgTokens.length<2&&alert(" 找到一个bug\r\nA new bug has appeared.\r\n\r\n发送成功后 && PUSH之前，this.msgTokens.length < 2。  \r\n\r\nthis.msgTokens.length："+this.msgTokens.length),this.msgTokens[this.msgTokens.length-2].total_tokens);this.msgTokens[this.msgTokens.length-1].completion_tokens=t.data.usage.prompt_tokens-n,this.msgTokens.push({role:"AI",completion_tokens:t.data.usage.completion_tokens,total_tokens:a}),this.totaltokens=a;let o;o=""!=this.gptSystemPrompt_hidden.trim()?(this.settingsLanguage,"**GPT::Hidden** _"):(this.settingsLanguage,"**GPT** _"),this.chathistory+=o+s+"_  \r\n"+e.replace(/\n/g,"\r\n")+"\r\n\r\n",this.btnDisabledState_Sending=!1,this.btnDisabledState_Clear=!1,this.btnDisabledState_Undo=!1,this.btnDisabledState_ApiURL=!1,this.btnDisabledState_Language=!1,this.btnDisabledState_ContextualMode=!1,this.btnDisabledState_KeyMode=!1,this.btnDisabledState_Export=!1,this.sentext="cn"==this.settingsLanguage?"发送":"Send",this.userMsgTokensForRetry=0,this.sendMsg_ContextualMode_ReachLimit_Reminder(),this.updateChatLastTime(s),this.check_KeyMode_byKey(),this.updateApiCheckedData(this.api,r,"success")}).catch(t=>{console.log("error",t),this.isSendingNow=!1,this.endLoadingAnimation(),document.querySelector(".inputapikey").readOnly=!1,this.sentext="cn"==this.settingsLanguage?"请重发":"Please Retry",this.btnDisabledState_Sending=!1,this.btnDisabledState_ApiURL=!1,this.btnDisabledState_Language=!1,this.btnDisabledState_ContextualMode=!1,this.btnDisabledState_KeyMode=!1,this.btnDisabledState_Export=!1,this.msgContent.pop(),this.msgTokens.pop(),this.succQA_Count=this.msgContent.length-1,1<this.msgContent.length?(this.btnDisabledState_Clear=!1,this.btnDisabledState_Undo=!1):1<this.msgContentForMsgList_SingleRound.length&&(this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!1),this.check_KeyMode_byKey();var e="cn"==this.settingsLanguage?"### #错误\r\n\r\n":"### #Error\r\n\r\n";this.chathistory+=e,this.catchApiErrorCode(t,r),this.updateChatLastTime(null)})}}else{let t="cn"==this.settingsLanguage?"无法发送空白消息":"Unable to send blank messages",e=1500;!1!==this.btnDisabledState_Undo||"请重发"!=this.sentext&&"Please Retry"!=this.sentext||(t="cn"==this.settingsLanguage?"无法发送空白消息。如果想重新发送，请点击 [重问] 按钮":"Unable to send blank messages. If you want to resend, click the [Retry] button.",e=2900),void this.showNotification(t,"bottom","",e)}}}else this.sentext="cn"==this.settingsLanguage?"重新验证API":"Recheck API",this.apibtntext="cn"==this.settingsLanguage?"<< 验证":"<< Check"},thirdPartyAPI_ErrorOccurred_ButResponseWasNormal(i){let s;if(i.data.hasOwnProperty("error")&&i.data.hasOwnProperty("msg"))s={msg:i.data.msg,error:i.data.error};else{let t="",e="",a="";var n=null;if(null!==(n=i.data&&null!==i.data?i.data:i.request&&i.request.data&&null!==i.request.data?i.request.data:null)&&"object"==typeof n){var o,r,l,h,c=Object.keys(n);for(o of c)if("object"==typeof n[c]){if(null!==n[o])for(r of Object.keys(n[o]))r.toLowerCase().includes("message")||r.toLowerCase().includes("msg")||r.toLowerCase().includes("err")?(l=r.toLowerCase().includes("err")?r+": ":"",t=t+(""===t?"":"\r\n")+l+("string"==typeof n[o][r]?n[o][r]:JSON.stringify(n[o][r]))):r.toLowerCase().includes("code")?a=n[o][r]?n[o][r].toString():"":r.toLowerCase().includes("type")&&(e=n[o][r]?n[o][r].toString():"")}else o.toLowerCase().includes("message")||o.toLowerCase().includes("msg")||o.toLowerCase().includes("err")?(h=o.toLowerCase().includes("err")?o+": ":"",t=t+(""===t?"":"\r\n")+h+("string"==typeof n[o]?n[o]:JSON.stringify(n[o]))):o.toLowerCase().includes("code")?a=n[o]?n[o].toString():"":o.toLowerCase().includes("type")&&(e=n[o]?n[o].toString():"")}""===t&&i&&i.request&&(i.request.responseText&&(t="string"==typeof i.request.responseText?i.request.responseText:JSON.stringify(i.request.responseText)),i.request.response)&&""===t&&(t="string"==typeof i.request.response?i.request.response:JSON.stringify(i.request.response)),""===a&&i&&i.response&&i.response.data&&(a=JSON.stringify(i.response.data)),s={msg:t,type:e,code:a}}return s},sendMsg_ContextualMode(e){if(Number.isInteger(this.settingsContextualMode)&&0!==this.settingsContextualMode){var a=100<this.settingsContextualMode?this.settingsContextualMode-100:this.settingsContextualMode;let t=this.succQA_Count;if("retry"===e&&1<this.msgContentForMsgList_SingleRound.length&&!this.msgList[this.msgList.length-1].my&&(t-=2),this.settingsContextualMode<100){if(t<a)return"";var i="retry"===e&&this.succQA_Count>a||"retry"===e&&t===this.succQA_Count&&this.succQA_Count===a;if(t>a||i){var s="当前已有 "+this.succQA_Count+" 条记忆 (上下文)，已达到当前记忆模式设置的上限 ("+a+"条)，本次需手动确认下一步的操作。\r\n\r\n点击 [确定 (好)] 将执行默认操作，记忆会被清除，"+("send"===e?"并继续发送消息":"并取消 [重问]")+"。点击 [取消] 将中止当前操作，记忆会被保留，您可以在 [设置] 中修改 [记忆模式]。请选择...",e=this.succQA_Count+" messages in current context have reached the "+a+"-message limit set in [Contextual Mode]. Please manually confirm next step.\r\n\r\nClick [Confirm (OK)] to execute default action, clear context, and "+("send"===e?"continue sending messages":"cancel [Retry]")+", or click [Cancel] to abort current operation, the context will not be cleared, and then you can modify [Contextual Mode] in [Settings]. Please choose...",s="cn"==this.settingsLanguage?s:e,e=(this.is_Alert_Confirm_Prompt_Open=!0,confirm(s));if(!e)return setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100),"no clear context and abort operation";setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100)}s=("cn"==this.settingsLanguage?"#### #记忆模式 - 达上限: ":"#### #Contextual mode - Limit reached: ")+a+"\r\n";return this.chathistory+=s,this.clearContext(),i?"clear context and cancel retry":""}}return""},sendMsg_ContextualMode_ReachLimit_Reminder(){try{if(Number.isInteger(this.settingsContextualMode)){let a="";0<this.settingsContextualMode&&this.settingsContextualMode<100?this.succQA_Count===this.settingsContextualMode-2?a="Limit-1":this.succQA_Count===this.settingsContextualMode&&(a="Limit-2"):100<this.settingsContextualMode&&(this.succQA_Count===this.settingsContextualMode-102?a="KeepLast-1":this.succQA_Count===this.settingsContextualMode-100&&(a="KeepLast-2"));var t=this.isShowNotification?3e3:0;""!==a&&setTimeout(()=>{if(!this.isShowNotification){let t="",e=0;"Limit-2"===a?(t="cn"==this.settingsLanguage?"记忆 (上下文) 达到上限，下次发送时将自动清除":"Context limit reached, will be cleared on next send.",e="cn"==this.settingsLanguage?2300:2400):"KeepLast-2"===a&&(t="cn"==this.settingsLanguage?"记忆 (上下文) 达到上限，记忆将只保留最近的 "+(this.settingsContextualMode-100)+" 条消息":"Context reached limit, only the latest "+(this.settingsContextualMode-100)+" messages will be retained in the context.",e="cn"==this.settingsLanguage?2700:3100),""!==t&&this.showNotification(t,"bottom","",e)}},t)}}catch(t){console.error("sendMsg_ContextualMode_ReachLimit_Reminder - 出错了",t)}},updateChatLastTime(t){null!==t&&(this.chatlasttime=t);t=this.chatDataList.find(t=>t.chatcreatedtime===this.chatcreatedtime);(t=null==t?{}:t).chatlasttime=this.chatlasttime,setTimeout(()=>{this.localStorage_SaveData(null,"chatDataList"),this.isLocalStorageSupported&&this.isLocalStorageAllowed,this.gotoTop_List()},0)},textareaChatInputBox_blur(){this.isfirstclickonchatinputbox=!0;var t=document.querySelector(".textareachatinputbox");t.style.minHeight="38px",t.style.height="38px",t.style.borderRadius="0px 6px 6px 0px",t.style.zIndex="900000"},textareaChatInputBox_focus(){var t=document.querySelector(".textareachatinputbox");t.style.minHeight="38px",t.style.height=t.style.maxHeight,t.style.zIndex="900002",38<parseInt(t.style.height)?t.style.borderRadius="6px 6px 6px 0px":t.style.borderRadius="0px 6px 6px 0px"},inputapiblur(){this.api=this.api.trim(),document.querySelector(".inputapikey").type="password"},inputapifocus(){document.querySelector(".inputapikey").type="text"},changeButtonDisabledState(t){!0===t?(this.btnDisabledState_CheckAPI=!1,this.btnDisabledState_Sending=!0,this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!0,null!=this.timerId?this.sentext="cn"==this.settingsLanguage?"重新验证API":"Recheck API":this.sentext="cn"==this.settingsLanguage?"先验证API":"Check API First",this.apibtntext="cn"==this.settingsLanguage?"<< 验证":"<< Check"):!1===t&&(this.btnDisabledState_CheckAPI=!0,this.btnDisabledState_Sending=!1,1<this.msgContent.length?(this.btnDisabledState_Clear=!1,this.btnDisabledState_Undo=!1):1<this.msgContentForMsgList_SingleRound.length?(this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!1):(this.btnDisabledState_Clear=!0,this.btnDisabledState_Undo=!0),this.sentext="cn"==this.settingsLanguage?"发送":"Send",this.apibtntext="cn"==this.settingsLanguage?"已验证":"Checked")},inputapichange(t){let e="";this.apiCheckedData.some(t=>t.apikey.trim()==this.api.trim())?(this.changeButtonDisabledState(!1),!0===t&&(e="cn"==this.settingsLanguage?"API Key 可用":"API Key is valid",setTimeout(()=>{this.showNotification(e,"bottom","",1700)},2300)),this.isThirdPartyAPIKeyEnabled&&!this.apiCheckedData.filter(t=>"third-party"===t.vpn).some(t=>t.apikey.trim()==this.api.trim())&&(e="cn"==this.settingsLanguage?'当前Key与模式不匹配，请重选Key，或者改为"使用OpenAI官方Key"':'The current key does not match the mode. Please select a new key or change to "Use OpenAI API Keys".',setTimeout(()=>{this.showNotification(e,"bottom","",8e3),this.isShowDialog_AutoKeyRotation=!0},!0===t?5e3:2700))):(this.changeButtonDisabledState(!0),!0===t&&0<this.apiCheckedData.length&&""!==this.api.trim()&&(e="cn"==this.settingsLanguage?"需要验证 API Key":"API Key needs to be checked",setTimeout(()=>{this.showNotification(e,"bottom","",1800)},2300)))},beginLoadingAnimation(){this.endLoadingAnimation();let t;var e=["发送中 ▁","发送中 ▂","发送中 ▃","发送中 ▅","发送中 ▆","发送中 ▇"],a=["Sending ▁","Sending ▂","Sending ▃","Sending ▅","Sending ▆","Sending ▇"];t="cn"==this.settingsLanguage?e:a,this.btnDisabledState_CheckAPI||(t="cn"==this.settingsLanguage?["验证中◈◇◇","验证中◇◈◇","验证中◇◇◈"]:["Checking◈◇◇","Checking◇◈◇","Checking◇◇◈"]);let i=0;this.timerId=setInterval(()=>{this.sentext=t[i%t.length],i++},580)},endLoadingAnimation(){clearInterval(this.timerId)},addCopyButtonToPreTags(t){t.querySelectorAll("pre code").forEach(t=>{var e,a,i,s;"pre"===t.parentElement.tagName.toLowerCase()&&((e=document.createElement("button")).classList.add("copybtn"),e.setAttribute("data-clipboard-nextelementsibling",""),(a=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("height","16"),a.setAttribute("width","16"),a.setAttribute("viewBox","0 0 16 16"),a.setAttribute("version","1.1"),a.classList.add("clippy"),(s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"),(i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"),a.appendChild(s),a.appendChild(i),(s=document.createElement("div")).appendChild(a),e.appendChild(s),t.parentElement.classList.add("snippet"),t.parentElement.insertBefore(e,t),addEventListenerCopyBtnTooltip(e))})},addCopyButtonToChatMessage(t){var e=document.createElement("button"),a=(e.classList.add("copybtn"),e.setAttribute("data-clipboard-nextelementsibling",""),document.createElementNS("http://www.w3.org/2000/svg","svg")),i=(a.setAttribute("width","14"),a.setAttribute("height","17"),a.setAttribute("fill","#191919"),a.classList.add("clippy"),document.createElementNS("http://www.w3.org/2000/svg","path")),i=(i.setAttribute("d","m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z"),a.appendChild(i),document.createElement("div"));i.appendChild(a),e.appendChild(i),t.prepend(e),addEventListenerCopyBtnTooltip(e)},initAddCopyButtonForMessage(){this.$nextTick(()=>{var e=document.querySelectorAll("div.aimsg"),a=document.querySelectorAll("div.usermsg");for(let t=0;t<e.length;t++)this.addCopyButtonToPreTags(e[t]),this.addCopyButtonToChatMessage(e[t].parentElement);for(let t=0;t<a.length;t++)this.addCopyButtonToPreTags(a[t]),this.addCopyButtonToChatMessage(a[t].parentElement)})},initMarkdown(){null!=window.marked&null!=window.hljs&&(marked.setOptions({renderer:new marked.Renderer,sanitize:!0,smartLists:!0,silent:!0,highlight:function(t){return hljs.highlightAuto(t).value}}),this.initialization())},initialization(){this.setVariablesToThis(this.userVariables_default,this.userVariables_default,!0),this.isgptGreenSvgShow=!0,this.gptAvatarURL="",this.inputGPTImageUrl="cn"==this.settingsLanguage?this.GPTGreenSVG_UrlText_cn:this.GPTGreenSVG_UrlText_en;let t=!1,e;if(this.isLocalStorageAllowed&&this.isLocalStorageSupported&&!0===(e=this.localStorage_RestoreData())&&0<this.chatDataList.length?(this.changePageScaling(!1),this.changeLanguage(),this.changeSimpleMode(!1),this.$nextTick(()=>{this.todoList_ChatDataRestored("hasdata",800)}),this.isShowDialog_ChatList=!0):t=!0,t){this.chatList_addNewChatData(!0),this.changePageScaling(!1),this.changeLanguage(),this.changeSimpleMode(!1);let t="",e="",a="";navigator.language&&(t=navigator.language.substr(0,2)),navigator.userLanguage&&(e=navigator.userLanguage.substr(0,2)),navigator.languages&&0<navigator.languages.length&&(a=navigator.languages[0].substr(0,2)),"cn"==this.settingsLanguage&&"zh"!=t&&"zh"!=e&&"zh"!=a&&this.showNotification("Change the language. Click on the gear icon > Language, and select English.","bottom","",4e3)}try{this.submitBulkApiKeys(!1,!1,this.default_apiKeyArray_WrittenInTheCode)}catch(t){console.error("submitBulkApiKeys - 加载默认API Key数据 Initialize Default ApiKeysArray，出错了",t)}this.$nextTick(()=>{setTimeout(()=>{if(!this.btnDisabledState_CheckAPI&&!this.isThirdPartyAPIKeyEnabled&&0<this.apiCheckedData.filter(t=>"third-party"!==t.vpn).length)if(""===this.api.trim())this.restoreApiKeyInput(!1,!1);else{let t="cn"==this.settingsLanguage?"是否需要恢复一个可用的 OpenAI 官方密钥 (API Key) ?":"Do you need to recover an available OpenAI API Key ?";this.apiURL.toLowerCase()!==this.OpenAI_API_URL&&this.apiURL.toLowerCase()!==this.OpenaiProxyCom_API_URL&&(t=(t+="cn"==this.settingsLanguage?"\r\n\r\n • Key模式: 使用OpenAI官方Key (自动轮换API Key)":"\r\n\r\n • Key Mode: Use OpenAI API Keys (Auto Key Rotation)")+("cn"==this.settingsLanguage?"\r\n • API接口: <第三方> "+this.apiURL:"\r\n • API URL: <Third-party> "+this.apiURL),this.isSimpleMode||(t+="cn"==this.settingsLanguage?"\r\n\r\n提醒: 如果第三方接口不支持OpenAI官方Key，则需要在[设置]>[自动轮换API Key]中更改Key模式。":"\r\n\r\nTip: If the third-party API does not support the OpenAI key, you will need to change the Key Mode in [Settings]>[Auto Key Rotation].")),setTimeout(()=>{this.btnDisabledState_CheckAPI||(this.is_Alert_Confirm_Prompt_Open=!0,confirm(t)&&this.restoreApiKeyInput(!1,!0),setTimeout(()=>{this.is_Alert_Confirm_Prompt_Open=!1},100))},1500)}},0)}),window.addEventListener("storage",()=>{"chatDataList"===event.key&&this.localStorageEvent_chatDataList(event.key,event.newValue,event.oldValue)});try{var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&-1<navigator.platform.toLowerCase().indexOf("mac")&&-1<navigator.userAgent.toLowerCase().indexOf("macintosh"),i=!navigator.maxTouchPoints&&2<navigator.maxTouchPoints,s=RegExp(/Android|webOS|iPhone|iPod|iPad/i).test(navigator.userAgent),n="undefined"!=typeof window&&/Win/i.test(navigator.platform),o=/Edg/i.test(navigator.userAgent),r=/Chrome/.test(navigator.userAgent),l=a&&!i&&!s&&!n&&!o&&!r,h="file:"===window.location.protocol;if(l&&h&&this.isLocalStorageAllowed&&this.isLocalStorageSupported&&!e){var c=this.isShowNotification?4e3:2e3,d='If you open a local .html file directly in Safari on a Mac computer, under the conditions of using Safari browser, Mac computer, and having the URL starting with "file:", the data syncing feature between tabs will be disabled. To resolve this issue, you can try changing any one of these conditions. You can switch to a different browser, use an online version, or utilize the built-in local web server functionality on Mac.';const g="cn"==this.settingsLanguage?'在Mac电脑上，如果您使用Safari直接打开本地的.html文件，即Mac电脑、Safari浏览器以及网页地址以"file:"开头，这三个条件同时存在时，标签页之间的数据同步功能将失效。\r\n要解决这个问题，只需改变其中任何一个条件即可。您可以尝试换个浏览器，或者使用在线的版本，或者使用Mac自带的本地web服务器功能。\r\n\r\n'+d:d,u="cn"==this.settingsLanguage?"提醒 Reminder":"Reminder";setTimeout(()=>{this.showNotification(g,"center",u)},c)}}catch(t){}document.addEventListener("keydown",this.handleShortcut),document.getElementById("dialog-settings").addEventListener("change",function(t){t.target.classList.contains("dropdown")&&t.target.blur()}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.localStorage_SaveData(event)}),window.addEventListener("pagehide",()=>{this.localStorage_SaveData(event)}),window.onblur=()=>{this.is_Alert_Confirm_Prompt_Open||this.localStorage_SaveData({type:"WindowBlur"})},window.addEventListener("unload",()=>{this.localStorage_SaveData(event)}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||window.addEventListener("beforeunload",()=>{this.localStorage_SaveData(event)})},initTheFirstMessage(){let t=marked.parse(this.thefirstmessage);""==this.thefirstmessage.trim()||""==this.thefirstmessage.replace(/^\n|\n$/g,"").trim()?t="<p> </p>":""==t.trim()&&(t="<p>"+this.thefirstmessage+"</p>"),""==t.trim()&&(t="<p> </p>"),0<this.msgList.length&&(this.msgList[0].msg=""==this.msgList[0].msg?t:this.msgList[0].msg)},initClipboard(){var t=new ClipboardJS("[data-clipboard-nextelementsibling]",{target:function(t){return t.nextElementSibling}});t.on("success",function(t){t.clearSelection(),document.activeElement.blur();let e="tooltipped-w";t.trigger.nextElementSibling.classList.contains("usermsg")&&(e="tooltipped-nw"),t.trigger.nextElementSibling.classList.contains("aimsg")&&(e="tooltipped-ne"),t.trigger.nextElementSibling.classList.contains("inputghostforcopyapikey")&&(e="tooltipped-n");var a="cn"==window.currentlang?"已复制":"Copied!";showCopyBtnTooltip(t.trigger,a,e)}),t.on("error",function(t){let e="tooltipped-w";t.trigger.nextElementSibling.classList.contains("usermsg")?e="tooltipped-ne":t.trigger.nextElementSibling.classList.contains("aimsg")?e="tooltipped-nw":t.trigger.nextElementSibling.classList.contains("inputghostforcopyapikey")&&(e="tooltipped-ne"),showCopyBtnTooltip(t.trigger,fallbackCopyBtnMessage(t.action),e)})},loadScriptFromCDN(a,e,i){var t=document.createElement("script");t.src=a,document.head.appendChild(t),t.onerror=()=>{if(e&&0<e.length){var t=e.shift();this.loadScriptFromCDN(t,e,i)}else{console.error("所有CDN链接均失效。最后尝试的备用链接是(CDN Failed)："+a),this.isShowNotification||(this.setNotificationContent.includes("Loading Error")||(this.setNotificationContent="cn"==this.settingsLanguage?"网页加载错误列表 ( Loading Error List)：":"Loading Error List:"),this.setNotificationPosition="center",this.isNotificationHasMask=!0,this.notificationTimeoutId=-1,this.setNotificationTitle="cn"==this.settingsLanguage?"错误 Error":"Error",this.isShowNotification=!0);let t="",e="";a.includes("marked")?(t="\r\n\r\n☒ !! 错误：Markdown插件marked.js加载失败，将无法使用GPT！请检查网络后刷新页面。  !! Error:Failed to load plugin marked.js. The GPT will be unavailable. Please check your network and refresh the page to try again.",e="\r\n\r\n☒ !! Error:Failed to load plugin marked.js. The GPT will be unavailable. Please check your network and refresh the page to try again.",this.setNotificationContent+="cn"==this.settingsLanguage?t:e,this.msgList[0].msg="<p>"+this.thefirstmessage+"</p>"):a.includes("highlight")?(t="\r\n\r\n☒ !! 错误：代码高亮插件highlight.js加载失败，将无法使用GPT！请检查网络后刷新页面。  !! Error: Failed to load plugin highlight.js. The GPT will be unavailable. Please check your network and refresh the page to try again.",e="\r\n\r\n☒ !! Error: Failed to load plugin highlight.js.The GPT will be unavailable. Please check your network and refresh the page to try again.",this.setNotificationContent+="cn"==this.settingsLanguage?t:e):a.includes("axios")?(t="\r\n\r\n☒ !! 错误：HTTP库Axios.js加载失败，将无法使用GPT！请检查网络后刷新页面。  !! Error: The HTTP library (Axios.js) failed to load. The GPT will be unavailable. Please check your network and refresh the page to try again.",e="\r\n\r\n☒ !! Error: The HTTP library (Axios.js) failed to load. The GPT will be unavailable. Please check your network and refresh the page to try again.",this.setNotificationContent+="cn"==this.settingsLanguage?t:e):a.includes("clipboard")&&(t="\r\n\r\n☒ 错误：一键复制插件clipboard.js加载失败，复制按钮功能将失效，不影响其他功能，可继续使用。（建议先刷新页面重试一次）  Error: (Please refresh the page once.) The clipboard plugin clipboard.js failed to load, but GPT can still be used. The copy button will not work, but other features can still be used normally.",e="\r\n\r\n☒ Error: (Please refresh the page once.) The clipboard plugin clipboard.js failed to load, but GPT can still be used. The copy button will not work, but other features can still be used normally.",this.setNotificationContent+="cn"==this.settingsLanguage?t:e)}},t.onload=i},loadCssFileFromCDN(e,a){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t),t.onerror=()=>{var t;a&&0<a.length?(t=a.shift(),this.loadCssFileFromCDN(t,a)):console.error("所有CSS的CDN链接均失效(CDN Failed)，仅缺失部分样式，不影响功能的正常使用。最后尝试的备用链接是："+e)}},decryptAPIKeyBase64(t){try{return atob(t)}catch(t){return console.error("decryptAPIKeyBase64 - Decryption failed 加密Key的编码可能有问题:",t),null}},addEncryptedAPIKeysTo_apiKeyArray(){try{this.default_apiKeyArray_WrittenInTheCode_Encrypted_Base64.filter(t=>""!==t.trim()).map(t=>t.trim()).forEach(t=>{t=this.decryptAPIKeyBase64(t);null===t||this.default_apiKeyArray_WrittenInTheCode.includes(t)||this.default_apiKeyArray_WrittenInTheCode.push(t)})}catch(t){console.error("addEncryptedAPIKeysTo_apiKeyArray - 添加加密Key到数组时出错了",t)}}},mounted(){this.defaultAPIKey=this.api.trim(),this.addEncryptedAPIKeysTo_apiKeyArray();try{this.default_apiKeyArray_WrittenInTheCode=this.default_apiKeyArray_WrittenInTheCode.filter(t=>""!==t.trim()&&t.trim().startsWith("sk-")).map(t=>t.trim())}catch(t){this.default_apiKeyArray_WrittenInTheCode=[],console.error("default_apiKeyArray_WrittenInTheCode - 写在代码中的api key存在问题，已清空处理，不影响使用。",t)}this.apiCheckedData=this.apiCheckedData.filter(t=>t.apikey&&""!==t.apikey.trim()),this.current_Year=(new Date).getFullYear().toString(),this.promptsData_default.gptSystemPrompt=JSON.parse(JSON.stringify(this.gptSystemPrompt)),document.querySelectorAll("div.aimsg")[0].innerHTML="<p> </p>";for(let t=.5;t<1.01;t+=.05)this.selectedPageScalingOptions.push((100*t.toFixed(2)).toFixed(0)+"%");var t=document.getElementById("loading-mask"),t=(null!=t&&t.classList.add("dialog-wrapper-hide"),this.isLocalStorageSupported=this.checkLocalStorageSupport(),this.loadScriptFromCDN("https://unpkg.com/marked@4.3.0/marked.min.js",["https://cdn.bootcdn.net/ajax/libs/marked/4.3.0/marked.min.js","https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"],()=>{this.initMarkdown()}),this.loadScriptFromCDN("https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js",["https://cdn.bootcdn.net/ajax/libs/highlight.js/11.7.0/highlight.min.js","https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"],()=>{this.initMarkdown()}),this.loadScriptFromCDN("https://unpkg.com/axios@1.3.2/dist/axios.min.js",["https://cdn.bootcdn.net/ajax/libs/axios/1.3.2/axios.min.js","https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.2/axios.min.js"],()=>{}),this.loadScriptFromCDN("https://unpkg.com/clipboard@2.0.11/dist/clipboard.min.js",["https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js","https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"],()=>{this.initClipboard()}),this.loadCssFileFromCDN("https://unpkg.com/@highlightjs/cdn-assets@11.7.0/styles/panda-syntax-dark.min.css",["https://cdn.bootcdn.net/ajax/libs/highlight.js/11.7.0/styles/panda-syntax-dark.min.css","https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/panda-syntax-dark.min.css"]),document.querySelector(".btncopyapikey")),t=(addEventListenerCopyBtnTooltip(t),document.querySelector(".btncopynotification")),e=(addEventListenerCopyBtnTooltip(t),document.querySelectorAll("#dialog-promptgenerator .copybtn"));for(let t=0;t<e.length;t++)addEventListenerCopyBtnTooltip(e[t]);""!=this.gptSystemPrompt_hidden.trim()&&(this.gptSystemPromptReadOnly="hidden system prompt"),this.addInput_FileDialog_Avatar("user"),this.addInput_FileDialog_Avatar("gpt")},beforeDestroy(){document.removeEventListener("keydown",this.handleShortcut)}}).mount("#app")</script> <script>let textarea_Chat=document.querySelector(".textareachatinputbox");textarea_Chat.addEventListener("input",t=>{var e;textarea_Chat.style.height="38px",textarea_Chat.style.height=t.target.scrollHeight+"px",38<parseInt(t.target.scrollHeight)?(e=parseInt(t.target.scrollHeight)+6,parseInt(t.target.scrollHeight)<450?textarea_Chat.style.maxHeight=e.toString()+"px":textarea_Chat.style.maxHeight="456px",textarea_Chat.style.height=e.toString()+"px",textarea_Chat.style.borderRadius="6px 6px 6px 0px"):(textarea_Chat.style.maxHeight="38px",textarea_Chat.style.borderRadius="0px 6px 6px 0px")})</script> <script>try{let e=-1!=navigator.userAgent.indexOf("Firefox"),t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=/chrome/i.test(navigator.userAgent),a=/webkit/i.test(navigator.userAgent),r=document.createElement("style");r.type="text/css",e||t?(r.innerHTML=".userinfo { padding-right: 6px; } .btn { margin-right: 13px; }",document.getElementsByTagName("head")[0].appendChild(r)):n||i||a||(r.innerHTML=".userinfo { padding-right: 3px; } .btn { margin-right: 10px; }",document.getElementsByTagName("head")[0].appendChild(r))}catch{}</script> <script>var isCheckAPIKey=!1,isError=!1;async function checkBilling(r){isError=!1;var a=new Date,o=new Date(a-7776e6),l=new Date(a.getTime()+864e5),a=new Date(a),o=(a.setDate(1),"https://api.openai.com/v1/dashboard/billing/usage?start_date="+formatDate(o)+"&end_date="+formatDate(l)),r={Authorization:"Bearer "+r,"Content-Type":"application/json"};try{let n=await fetch("https://api.openai.com/v1/dashboard/billing/subscription",{headers:r});if(!n.ok)return console.log("urlSubscription - response.ok:",n.ok),y="cn"==window.currentlang?"!! ?":"!! Failed to check the balance.\r\n\r\nTip: If your location is not supported by OpenAI, use a VPN to check your balance.",alert(y),isError=!0,[null,null,null,null,null,null,null,null,null];var i,c,s,u=await n.json(),d=Math.floor(Date.now()/1e3),g=u.access_until,p=(g<d&&(i="cn"==window.currentlang?"OpenAI API的账号余额似乎已到期, 但不排除仍然能用，请登录OpenAI进行查看。\r\n查询结果正在生成...":"It seems that the OpenAI API account balance has expired, but it is still possible that it can still be used. Please log in to OpenAI to check. \r\nQuery results are being generated...",alert(i)),u.hard_limit_usd),w=u.has_payment_method;let e=(await(n=await fetch(o,{headers:r})).json()).total_usage/100,t;o="https://api.openai.com/v1/dashboard/billing/usage?start_date="+formatDate(a)+"&end_date="+formatDate(l),w?(c=await(n=await fetch(o,{headers:r})).json(),e=c.total_usage/100):(s=await(n=await fetch(o,{headers:r})).json(),t=s.total_usage/100);var h=p-e;return[u.account_name,w,p,e,h,g,u.plan.title,u.plan.id,t]}catch(n){isCheckAPIKey=!(isError=!0),console.log(n);var y="cn"==window.currentlang?"!! ?":"!! Failed to check the balance.\r\n\r\nTip: If your location is not supported by OpenAI, use a VPN to check your balance.";return alert(y),[null,null,null,null,null,null,null,null,null]}}function formatDate(n){var e=n.getFullYear();let t,r;return String.prototype.padStart?(t=(n.getMonth()+1).toString().padStart(2,"0"),r=n.getDate().toString().padStart(2,"0")):(t=(n.getMonth()+1).toString(),r=n.getDate().toString(),1===t.length&&(t="0"+t),1===r.length&&(r="0"+r)),e+"-"+t+"-"+r}function sendRequest(A){let n,e,t;isCheckAPIKey?(n="已在为您查询OpenAI API的余额，请关闭弹窗后耐心等待。\r\n等待期间可进行其他操作，正常情况下数秒内完成，如等待时间过长，请检查下网络状态。",e="Your request is currently being processed. Please close the pop-up window and wait patiently.",t="cn"==window.currentlang?n:e,alert(t)):(isCheckAPIKey=!0,n="将为您查询OpenAI API的账号余额，请先关闭本弹窗，待查询结果出来后会自动弹出。\r\n\r\n注意: 查余额需要魔法",e="After closing this pop-up window, the account balance of the API will be checked. The query result will automatically pop up when it is available.\r\n\r\nTip: If your location is not supported by OpenAI, use a VPN to check your balance.",t="cn"==window.currentlang?n:e,alert(t),checkBilling(A).then(d=>{if(isError&&null==d[0]&&null==d[1])isCheckAPIKey=!1;else{var g=new Date(1e3*d[5]),p=g.getFullYear()+"-",w=String(g.getMonth()+1).replace(/^(\d)$/,"0$1")+"-",h=String(g.getDate()).replace(/^(\d)$/,"0$1")+" ",y=String(g.getHours()).replace(/^(\d)$/,"0$1")+":",I=String(g.getMinutes()).replace(/^(\d)$/,"0$1")+":",g=String(g.getSeconds()).replace(/^(\d)$/,"0$1");d[5]=p+w+h+y+I+g;let n,e,t,r,a,o,l,i,c,s,u;s=d[1]?(r="cn"==window.currentlang?"\r\n本月上限：  $":"\r\nTotal Amount (M): $",a="cn"==window.currentlang?"\r\n实际消费：  $":"\r\nTotal Usage (M): $",o="cn"==window.currentlang?"\r\n剩余限额：  $":"\r\nRemaining (M): $",l="cn"==window.currentlang?"\r\n到期时间(?)：":"\r\nExpiration Date(?): ","cn"==window.currentlang?"\r\n无":"\r\nNone"):(r="cn"==window.currentlang?"\r\n账号总额：  $":"\r\nTotal Amount: $",a="cn"==window.currentlang?"\r\n累计消耗：  $":"\r\nTotal Usage: $",o="cn"==window.currentlang?"\r\n剩余额度：  $":"\r\nRemaining: $",l="cn"==window.currentlang?"\r\n到期时间：  ":"\r\nExpiration Date: ",("cn"==window.currentlang?"\r\n本月消耗：  $":"\r\nMonthly Usage: $")+" ".repeat(10-d[8].toFixed(4).length)+d[8].toFixed(4)),n="cn"==window.currentlang?"OpenAI API 账号余额查询结果\r\n":"OpenAI API Balance Query Result\r\n",A.startsWith("sk-")&&(n="cn"==window.currentlang?n+"\r\n • 自7月22日起，OpenAI 已停止使用 API Key 查询余额 (余额无数据)。现在需要使用 Session Key 来查询余额，但 Session Key 是动态变化的，目前暂时没有很好的余额查询方案。\r\n":n+"\r\n • Starting from July 22nd, OpenAI has stopped displaying the balance when querying with an API Key. Now, to check the balance, you need to use a Session Key. However, the Session Key is dynamically changing, so currently there is no good solution to query the balance.\r\n"),e=("cn"==window.currentlang?"\r\n账号归属：  ":"\r\nAccount Name: ")+d[0],t=("cn"==window.currentlang?"\r\n是否绑卡：  ":"\r\nHas Payment: ")+(d[1]?"Yes":"No"),r=r+" ".repeat(10-d[2].toFixed(4).length)+d[2].toFixed(4),a=a+" ".repeat(10-d[3].toFixed(4).length)+d[3].toFixed(4),o=o+" ".repeat(10-d[4].toFixed(4).length)+d[4].toFixed(4),l+=d[5],i=("cn"==window.currentlang?"\r\n账号用途：  ":"\r\nAbout Plan(?): ")+d[6];p="cn"==window.currentlang?"免费计划":"Free Plan",w=(c=("cn"==window.currentlang?"\r\n订阅情况：  ":"\r\nSubscription: ")+("free"==d[7]?p:d[7]+" (Paid Account ?)"),s=s,"cn"==window.currentlang?"\r\n*非绑卡用户默认统计范围为90天。":"\r\n*Default query for 90 days usage.(For Non-Payment users)"),h="cn"==window.currentlang?"\r\n*绑卡用户返回的数据应该都只是当月的，但我没绑过卡无法验证统计范围。":"\r\n*I don't have a payment account, so I can't verify the time range of data for payment users. However, hope the label is not wrong.",y=d[1]?h:w;u="cn"==window.currentlang?"\r\n\r\n余额查询代码 v7.23  \r\n以上信息均由官方接口返回，实时查询当前 API Key，不会存储数据，无泄漏风险，原理见代码。":"\r\n\r\nBalance Inquiry Code Version 7.23  \r\nUse OpenAI API, real-time query, your data will not be saved, API Key can be changed at any time. ",isCheckAPIKey=!1,d[1]?alert(n+e+t+r+a+o+l+i+c+u+y):alert(n+e+t+r+s+a+o+l+i+c+u+y)}}).catch(n=>{isCheckAPIKey=!1,console.log(n);n="cn"==window.currentlang?"!! ?":"!! Failed to check the balance.\r\n\r\nTip: If your location is not supported by OpenAI, use a VPN to check your balance.";alert(n)}))}</script> 
